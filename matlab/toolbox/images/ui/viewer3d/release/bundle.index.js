(()=>{var __webpack_modules__={4371:(D,V,f)=>{var R,B;R=[f(9178),f(1873),f(7800),f(2749),f(7342)],B=f.dj.d(R,function(d,N,_,l,n){"use strict";var r=0,h=1,u=2,g="This deferred has already been fulfilled.",p=Object.freeze||function(){},y=function(A,C,z,H,q){d("config-deferredInstrumentation")&&C===u&&T.instrumentRejected&&A.length===0&&T.instrumentRejected(z,!1,H,q);for(var P=0;P<A.length;P++)x(A[P],C,z,H)},x=function(A,C,z,H){var q=A[C],P=A.deferred;if(q)try{var Z=q(z);if(C===r)typeof Z<"u"&&M(P,C,Z);else{if(Z&&typeof Z.then=="function"){A.cancel=Z.cancel,Z.then(w(P,h),w(P,u),w(P,r));return}M(P,h,Z)}}catch(K){M(P,u,K)}else M(P,C,z);d("config-deferredInstrumentation")&&C===u&&T.instrumentRejected&&T.instrumentRejected(z,!!q,H,P.promise)},w=function(A,C){return function(z){M(A,C,z)}},M=function(A,C,z){if(!A.isCanceled())switch(C){case r:A.progress(z);break;case h:A.resolve(z);break;case u:A.reject(z);break}},T=function(A){var C=this.promise=new l,z=this,H,q,P,Z=!1,K=[];d("config-deferredInstrumentation")&&Error.captureStackTrace&&(Error.captureStackTrace(z,T),Error.captureStackTrace(C,T)),this.isResolved=C.isResolved=function(){return H===h},this.isRejected=C.isRejected=function(){return H===u},this.isFulfilled=C.isFulfilled=function(){return!!H},this.isCanceled=C.isCanceled=function(){return Z},this.progress=function(k,ae){if(H){if(ae===!0)throw new Error(g);return C}else return y(K,r,k,null,z),C},this.resolve=function(k,ae){if(H){if(ae===!0)throw new Error(g);return C}else return y(K,H=h,q=k,null,z),K=null,C};var Y=this.reject=function(k,ae){if(H){if(ae===!0)throw new Error(g);return C}else return d("config-deferredInstrumentation")&&Error.captureStackTrace&&Error.captureStackTrace(P={},Y),y(K,H=u,q=k,P,z),K=null,C};this.then=C.then=function(k,ae,j){var F=[j,k,ae];return F.cancel=C.cancel,F.deferred=new T(function(J){return F.cancel&&F.cancel(J)}),H&&!K?x(F,H,q,P):K.push(F),F.deferred.promise},this.cancel=C.cancel=function(k,ae){if(H){if(ae===!0)throw new Error(g)}else{if(A){var j=A(k);k=typeof j>"u"?k:j}if(Z=!0,H){if(H===u&&q===k)return k}else return typeof k>"u"&&(k=new _),Y(k),k}},p(C)};return T.prototype.toString=function(){return"[object Deferred]"},n&&n(T),T},D,V),D.exports=B},3543:(D,V,f)=>{var R,B;R=[f(3660),f(1929)],B=f.dj.d(R,function(d,N){"use strict";var _=d.after;function l(){}return l.prototype={on:function(n,r){return N.parse(this,n,r,function(h,u){return _(h,"on"+u,r,!0)})},emit:function(n,r){var h=[this];return h.push.apply(h,arguments),N.emit.apply(N,h)}},l},D,V),D.exports=B},5642:(D,V,f)=>{var R,B;R=[f(9424),f(4371),f(2749),f(7800),f(9178),f(1873),f(1636)],B=f.dj.d(R,function(d,N,_,l,n,r,h){var u=function(){},g=Object.freeze||function(){},p=d.Deferred=function(y){var x,w,M,T,A,C,z,H=this.promise=new _;function q(K){if(w)throw new Error("This deferred has already been resolved");x=K,w=!0,P()}function P(){for(var K;!K&&z;){var Y=z;z=z.next,(K=Y.progress==u)&&(w=!1);var k=A?Y.error:Y.resolved;if(n("config-useDeferredInstrumentation")&&A&&N.instrumentRejected&&N.instrumentRejected(x,!!k),k)try{var ae=k(x);if(ae&&typeof ae.then=="function"){ae.then(r.hitch(Y.deferred,"resolve"),r.hitch(Y.deferred,"reject"),r.hitch(Y.deferred,"progress"));continue}var j=K&&ae===void 0;K&&!j&&(A=ae instanceof Error),Y.deferred[j&&A?"reject":"resolve"](j?x:ae)}catch(F){Y.deferred.reject(F)}else A?Y.deferred.reject(x):Y.deferred.resolve(x)}}this.isResolved=H.isResolved=function(){return T==0},this.isRejected=H.isRejected=function(){return T==1},this.isFulfilled=H.isFulfilled=function(){return T>=0},this.isCanceled=H.isCanceled=function(){return M},this.resolve=this.callback=function(K){this.fired=T=0,this.results=[K,null],q(K)},this.reject=this.errback=function(K){A=!0,this.fired=T=1,n("config-useDeferredInstrumentation")&&N.instrumentRejected&&N.instrumentRejected(K,!!z),q(K),this.results=[null,K]},this.progress=function(K){for(var Y=z;Y;){var k=Y.progress;k&&k(K),Y=Y.next}},this.addCallbacks=function(K,Y){return this.then(K,Y,u),this},H.then=this.then=function(K,Y,k){var ae=k==u?this:new p(H.cancel),j={resolved:K,error:Y,progress:k,deferred:ae};return z?C=C.next=j:z=C=j,w&&P(),ae.promise};var Z=this;H.cancel=this.cancel=function(){if(!w){var K=y&&y(Z);w||(K instanceof Error||(K=new l(K)),K.log=!1,Z.reject(K))}M=!0},g(H)};return r.extend(p,{addCallback:function(y){return this.addCallbacks(r.hitch.apply(d,arguments))},addErrback:function(y){return this.addCallbacks(null,r.hitch.apply(d,arguments))},addBoth:function(y){var x=r.hitch.apply(d,arguments);return this.addCallbacks(x,x)},fired:-1}),p.when=d.when=h,p},D,V),D.exports=B},640:(D,V,f)=>{var R,B;R=[f(9424),f(9178),f(1873)],B=f.dj.d(R,function(d,N,_){var l={},n,r;N("csp-restrictions")||(r=function(p){return l[p]=new Function("item","index","array",p)});function h(p){var y=!p;return function(x,w,M){var T=0,A=x&&x.length||0,C;if(A&&typeof x=="string"&&(x=x.split("")),typeof w=="string"){if(N("csp-restrictions"))throw new TypeError("callback must be a function");w=l[w]||r(w)}if(M){for(;T<A;++T)if(C=!w.call(M,x[T],T,x),p^C)return!C}else for(;T<A;++T)if(C=!w(x[T],T,x),p^C)return!C;return y}}function u(p){var y=1,x=0,w=0;return p||(y=x=w=-1),function(M,T,A,C){if(C&&y>0)return g.lastIndexOf(M,T,A);var z=M&&M.length||0,H=p?z+w:x,q;for(A===n?q=p?x:z+w:A<0?(q=z+A,q<0&&(q=x)):q=A>=z?z+w:A,z&&typeof M=="string"&&(M=M.split(""));q!=H;q+=y)if(M[q]==T)return q;return-1}}var g={every:h(!1),some:h(!0),indexOf:u(!0),lastIndexOf:u(!1),forEach:function(p,y,x){var w=0,M=p&&p.length||0;if(M&&typeof p=="string"&&(p=p.split("")),typeof y=="string"){if(N("csp-restrictions"))throw new TypeError("callback must be a function");y=l[y]||r(y)}if(x)for(;w<M;++w)y.call(x,p[w],w,p);else for(;w<M;++w)y(p[w],w,p)},map:function(p,y,x,w){var M=0,T=p&&p.length||0,A=new(w||Array)(T);if(T&&typeof p=="string"&&(p=p.split("")),typeof y=="string"){if(N("csp-restrictions"))throw new TypeError("callback must be a function");y=l[y]||r(y)}if(x)for(;M<T;++M)A[M]=y.call(x,p[M],M,p);else for(;M<T;++M)A[M]=y(p[M],M,p);return A},filter:function(p,y,x){var w=0,M=p&&p.length||0,T=[],A;if(M&&typeof p=="string"&&(p=p.split("")),typeof y=="string"){if(N("csp-restrictions"))throw new TypeError("callback must be a function");y=l[y]||r(y)}if(x)for(;w<M;++w)A=p[w],y.call(x,A,w,p)&&T.push(A);else for(;w<M;++w)A=p[w],y(A,w,p)&&T.push(A);return T},clearCache:function(){l={}}};return N("extend-dojo")&&_.mixin(d,g),g},D,V),D.exports=B},6723:(D,V,f)=>{var R,B;R=[f(8455),f(9178),f.dj.c(D)],B=f.dj.d(R,function(d,N,_){var l={};if(N("dojo-config-api")){var n=_.rawConfig,r;for(r in n)l[r]=n[r]}else{var h=function(g,p,y){for(r in g)r!="has"&&N.add(p+r,g[r],0,y)};l=N("dojo-loader")?_.rawConfig:d.dojoConfig||d.djConfig||{},h(l,"config",1),h(l.has,"",1)}if(l.updateLocale=function(g,p){var y,x,w="en-us";if(g.indexOf(p)>=0&&p!=="zh"){l.locale=p;return}if(y=p.split("-")[0],y==="zh"){l.locale=w.toLocaleLowerCase();return}for(var M=0;M<g.length;M=M+1)if(x=g[M].split("-")[0],y===x){l.locale=g[M];break}l.locale||(l.locale=w.toLowerCase())},!l.locale&&typeof navigator<"u"){var u=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage;u=l._testLanguageOverride||u,u&&(u=u.toLowerCase(),l.supportedLocales&&l.updateLocale(l.supportedLocales,u))}return l.locale||(l.locale="en-us"),l},D,V),D.exports=B},5135:(D,V,f)=>{var R,B;R=[f(9424),f(1929),f(7505),f(3660),f(4409),f(4905),f(8609),f(1873),f(3720)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u){h.add("events-keypress-typed",function(){var C={charCode:0};try{C=document.createEvent("KeyboardEvent"),(C.initKeyboardEvent||C.initKeyEvent).call(C,"keypress",!0,!0,null,!1,!1,!1,!1,9,3)}catch(z){}return C.charCode==0&&!h("opera")});function g(C,z,H,q,P){if(q=u.hitch(H,q),!C||!(C.addEventListener||C.attachEvent))return l.after(C||d.global,z,q,!0);if(typeof z=="string"&&z.substring(0,2)=="on"&&(z=z.substring(2)),C||(C=d.global),!P)switch(z){case"keypress":z=M;break;case"mouseenter":z=r.enter;break;case"mouseleave":z=r.leave;break}return N(C,z,q,P)}var p={106:42,111:47,186:59,187:43,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39,229:113},y=h("mac")?"metaKey":"ctrlKey",x=function(C,z){var H=u.mixin({},C,z);return w(H),H.preventDefault=function(){C.preventDefault()},H.stopPropagation=function(){C.stopPropagation()},H};function w(C){C.keyChar=C.charCode?String.fromCharCode(C.charCode):"",C.charOrCode=C.keyChar||C.keyCode}var M;if(h("events-keypress-typed")){var T=function(C,z){try{return C.keyCode=z}catch(H){return 0}};M=function(C,z){var H=N(C,"keydown",function(P){var Z=P.keyCode,K=Z!=13&&Z!=32&&(Z!=27||!h("ie"))&&(Z<48||Z>90)&&(Z<96||Z>111)&&(Z<186||Z>192)&&(Z<219||Z>222)&&Z!=229;if(K||P.ctrlKey){var Y=K?0:Z;if(P.ctrlKey){if(Z==3||Z==13)return z.call(P.currentTarget,P);Y>95&&Y<106?Y-=48:!P.shiftKey&&Y>=65&&Y<=90?Y+=32:Y=p[Y]||Y}var k=x(P,{type:"keypress",faux:!0,charCode:Y});z.call(P.currentTarget,k),h("ie")&&T(P,k.keyCode)}}),q=N(C,"keypress",function(P){var Z=P.charCode;return Z=Z>=32?Z:0,P=x(P,{charCode:Z,faux:!0}),z.call(this,P)});return{remove:function(){H.remove(),q.remove()}}}}else h("opera")?M=function(C,z){return N(C,"keypress",function(H){var q=H.which;return q==3&&(q=99),q=q<32&&!H.shiftKey?0:q,H.ctrlKey&&!H.shiftKey&&q>=65&&q<=90&&(q+=32),z.call(this,x(H,{charCode:q}))})}:M=function(C,z){return N(C,"keypress",function(H){return w(H),z.call(this,H)})};var A={_keypress:M,connect:function(C,z,H,q,P){var Z=arguments,K=[],Y=0;K.push(typeof Z[0]=="string"?null:Z[Y++],Z[Y++]);var k=Z[Y+1];K.push(typeof k=="string"||typeof k=="function"?Z[Y++]:null,Z[Y++]);for(var ae=Z.length;Y<ae;Y++)K.push(Z[Y]);return g.apply(this,K)},disconnect:function(C){C&&C.remove()},subscribe:function(C,z,H){return _.subscribe(C,u.hitch(z,H))},publish:function(C,z){return _.publish.apply(_,[C].concat(z))},connectPublisher:function(C,z,H){var q=function(){A.publish(C,arguments)};return H?A.connect(z,H,q):A.connect(z,q)},isCopyKey:function(C){return C[y]}};return A.unsubscribe=A.disconnect,h("extend-dojo")&&u.mixin(d,A),A},D,V),D.exports=B},1203:(D,V,f)=>{var R,B;R=[f(9424),f(9178),f(1873)],B=f.dj.d(R,function(d,N,_){var l=_.mixin,n=Object.prototype,r=n.toString,h,u=0,g="constructor";N("csp-restrictions")?h=function(){}:h=new Function;function p(F,J){throw new Error("declare"+(J?" "+J:"")+": "+F)}function y(F,J){for(var te=[],_e=[{cls:0,refs:[]}],ne={},le=1,be=F.length,je=0,ze,Re,nt,$e,_t,Ut,Zt,oi;je<be;++je){for(nt=F[je],nt?r.call(nt)!="[object Function]"&&p("mixin #"+je+" is not a callable constructor.",J):p("mixin #"+je+" is unknown. Did you use dojo.require to pull it in?",J),Re=nt._meta?nt._meta.bases:[nt],$e=0,ze=Re.length-1;ze>=0;--ze)_t=Re[ze].prototype,_t.hasOwnProperty("declaredClass")||(_t.declaredClass="uniqName_"+u++),Zt=_t.declaredClass,ne.hasOwnProperty(Zt)||(ne[Zt]={count:0,refs:[],cls:Re[ze]},++le),Ut=ne[Zt],$e&&$e!==Ut&&(Ut.refs.push($e),++$e.count),$e=Ut;++$e.count,_e[0].refs.push($e)}for(;_e.length;){for($e=_e.pop(),te.push($e.cls),--le;oi=$e.refs,oi.length==1;){if($e=oi[0],!$e||--$e.count){$e=0;break}te.push($e.cls),--le}if($e)for(je=0,be=oi.length;je<be;++je)$e=oi[je],--$e.count||_e.push($e)}return le&&p("can't build consistent linearization",J),nt=F[0],te[0]=nt?nt._meta&&nt===te[te.length-nt._meta.bases.length]?nt._meta.bases.length:1:0,te}function x(F,J,te,_e){var ne,le,be,je,ze,Re,nt,$e,_t,Ut=this._inherited=this._inherited||{};if(typeof F=="string"&&(ne=F,F=J,J=te,te=_e),typeof F=="function")je=F,F=J,J=te;else try{je=F.callee}catch(Zt){if(Zt instanceof TypeError)p("strict mode inherited() requires the caller function to be passed before arguments",this.declaredClass);else throw Zt}if(ne=ne||je.nom,ne||p("can't deduce a name to call inherited()",this.declaredClass),te=_e=0,ze=this.constructor._meta,be=ze.bases,_t=Ut.p,ne!=g){if(Ut.c!==je&&(_t=0,Re=be[0],ze=Re._meta,ze.hidden[ne]!==je)){le=ze.chains,le&&typeof le[ne]=="string"&&p("calling chained method with inherited: "+ne,this.declaredClass);do if(ze=Re._meta,nt=Re.prototype,ze&&(nt[ne]===je&&nt.hasOwnProperty(ne)||ze.hidden[ne]===je))break;while(Re=be[++_t]);_t=Re?_t:-1}if(Re=be[++_t],Re)if(nt=Re.prototype,Re._meta&&nt.hasOwnProperty(ne))te=nt[ne];else{$e=n[ne];do if(nt=Re.prototype,te=nt[ne],te&&(Re._meta?nt.hasOwnProperty(ne):te!==$e))break;while(Re=be[++_t])}te=Re&&te||n[ne]}else{if(Ut.c!==je&&(_t=0,ze=be[0]._meta,ze&&ze.ctor!==je)){for(le=ze.chains,(!le||le.constructor!=="manual")&&p("calling chained constructor with inherited",this.declaredClass);(Re=be[++_t])&&(ze=Re._meta,!(ze&&ze.ctor===je)););_t=Re?_t:-1}for(;(Re=be[++_t])&&(ze=Re._meta,te=ze?ze.ctor:Re,!te););te=Re&&te}if(Ut.c=te,Ut.p=_t,te)return J===!0?te:te.apply(this,J||F)}function w(F,J,te){return typeof F=="string"?typeof J=="function"?this.__inherited(F,J,te,!0):this.__inherited(F,J,!0):typeof F=="function"?this.__inherited(F,J,!0):this.__inherited(F,!0)}function M(F,J,te,_e){var ne=this.getInherited(F,J,te);if(ne)return ne.apply(this,_e||te||J||F)}var T=d.config.isDebug?M:x;function A(F){for(var J=this.constructor._meta.bases,te=0,_e=J.length;te<_e;++te)if(J[te]===F)return!0;return this instanceof F}function C(F,J){for(var te in J)te!=g&&J.hasOwnProperty(te)&&(F[te]=J[te]);if(N("bug-for-in-skips-shadowed"))for(var _e=_._extraNames,ne=_e.length;ne;)te=_e[--ne],te!=g&&J.hasOwnProperty(te)&&(F[te]=J[te])}function z(F,J){var te,_e;for(te in J)_e=J[te],(_e!==n[te]||!(te in n))&&te!=g&&(r.call(_e)=="[object Function]"&&(_e.nom=te),F[te]=_e);if(N("bug-for-in-skips-shadowed")&&J)for(var ne=_._extraNames,le=ne.length;le;)te=ne[--le],_e=J[te],(_e!==n[te]||!(te in n))&&te!=g&&(r.call(_e)=="[object Function]"&&(_e.nom=te),F[te]=_e);return F}function H(F){return j.safeMixin(this.prototype,F),this}function q(F,J){return F instanceof Array||typeof F=="function"||(J=F,F=void 0),J=J||{},F=F||[],j([this].concat(F),J)}function P(F,J){return function(){var te=arguments,_e=te,ne=te[0],le,be,je,ze=F.length,Re;try{if(!(this instanceof te.callee))return ae(te)}catch(nt){}if(J&&(ne&&ne.preamble||this.preamble))for(Re=new Array(F.length),Re[0]=te,be=0;ne=te[0],ne&&(le=ne.preamble,le&&(te=le.apply(this,te)||te)),le=F[be].prototype,le=le.hasOwnProperty("preamble")&&le.preamble,le&&(te=le.apply(this,te)||te),++be!=ze;)Re[be]=te;for(be=ze-1;be>=0;--be)le=F[be],je=le._meta,le=je?je.ctor:le,le&&le.apply(this,Re?Re[be]:te);le=this.postscript,le&&le.apply(this,_e)}}function Z(F,J){return function(){var te=arguments,_e=te,ne=te[0],le;try{if(!(this instanceof te.callee))return ae(te)}catch(be){}J&&(ne&&(le=ne.preamble,le&&(_e=le.apply(this,_e)||_e)),le=this.preamble,le&&le.apply(this,_e)),F&&F.apply(this,te),le=this.postscript,le&&le.apply(this,te)}}function K(F){return function(){var J=arguments,te=0,_e,ne;try{if(!(this instanceof J.callee))return ae(J)}catch(le){}for(;_e=F[te];++te)if(ne=_e._meta,_e=ne?ne.ctor:_e,_e){_e.apply(this,J);break}_e=this.postscript,_e&&_e.apply(this,J)}}function Y(F,J,te){return function(){var _e,ne,le,be=0,je=1;for(te&&(be=J.length-1,je=-1);_e=J[be];be+=je)ne=_e._meta,le=(ne?ne.hidden:_e.prototype)[F],le&&le.apply(this,arguments)}}function k(F){h.prototype=F.prototype;var J=new h;return h.prototype=null,J}function ae(F){var J=F.callee,te=k(J);return J.apply(te,F),te}function j(F,J,te){typeof F!="string"&&(te=J,J=F,F=""),te=te||{};var _e,ne,le,be,je,ze,Re,nt=1,$e=J;if(r.call(J)=="[object Array]"?(ze=y(J,F),le=ze[0],nt=ze.length-le,J=ze[nt]):(ze=[0],J?r.call(J)=="[object Function]"?(le=J._meta,ze=ze.concat(le?le.bases:J)):p("base class is not a callable constructor.",F):J!==null&&p("unknown base class. Did you use dojo.require to pull it in?",F)),J)for(ne=nt-1;_e=k(J),!!ne;--ne)le=ze[ne],(le._meta?C:l)(_e,le.prototype),N("csp-restrictions")?be=function(){}:be=new Function,be.superclass=J,be.prototype=_e,J=_e.constructor=be;else _e={};for(j.safeMixin(_e,te),le=te.constructor,le!==n.constructor&&(le.nom=g,_e.constructor=le),ne=nt-1;ne;--ne)le=ze[ne]._meta,le&&le.chains&&(Re=l(Re||{},le.chains));if(_e["-chains-"]&&(Re=l(Re||{},_e["-chains-"])),J&&J.prototype&&J.prototype["-chains-"]&&(Re=l(Re||{},J.prototype["-chains-"])),le=!Re||!Re.hasOwnProperty(g),ze[0]=be=Re&&Re.constructor==="manual"?K(ze):ze.length==1?Z(te.constructor,le):P(ze,le),be._meta={bases:ze,hidden:te,chains:Re,parents:$e,ctor:te.constructor},be.superclass=J&&J.prototype,be.extend=H,be.createSubclass=q,be.prototype=_e,_e.constructor=be,_e.getInherited=w,_e.isInstanceOf=A,_e.inherited=T,_e.__inherited=x,F&&(_e.declaredClass=F,_.setObject(F,be)),Re)for(je in Re)_e[je]&&typeof Re[je]=="string"&&je!=g&&(le=_e[je]=Y(je,ze,Re[je]==="after"),le.nom=je);return be}return d.safeMixin=j.safeMixin=z,d.declare=j,j},D,V),D.exports=B},4409:(D,V,f)=>{var R,B;R=[f(9424),f(1929),f(9178),f(8771)],B=f.dj.d(R,function(d,N,_,l){if(N._fixEvent){var n=N._fixEvent;N._fixEvent=function(h,u){return h=n(h,u),h&&l.normalizeEvent(h),h}}var r={fix:function(h,u){return N._fixEvent?N._fixEvent(h,u):h},stop:function(h){_("dom-addeventlistener")||h&&h.preventDefault?(h.preventDefault(),h.stopPropagation()):(h=h||window.event,h.cancelBubble=!0,N._preventDefault.call(h))}};return _("extend-dojo")&&(d.fixEvent=r.fix,d.stopEvent=r.stop),r},D,V),D.exports=B},5747:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9424),__webpack_require__(2570)],__WEBPACK_AMD_DEFINE_RESULT__=__webpack_require__.dj.d(__WEBPACK_AMD_DEFINE_ARRAY__,function(dojo,json){return dojo.fromJson=function(js){return eval("("+js+")")},dojo._escapeString=json.stringify,dojo.toJsonIndentStr="	",dojo.toJson=function(D,V){return json.stringify(D,function(f,R){if(R){var B=R.__json__||R.json;if(typeof B=="function")return B.call(R)}return R},V&&dojo.toJsonIndentStr)},dojo},module,exports),module.exports=__WEBPACK_AMD_DEFINE_RESULT__},9424:(D,V,f)=>{var R,B;R=[f(8455),f(9178),f(6723),f.dj.c(D),f.dj.m(D)],B=f.dj.d(R,function(d,N,_,l,n){var r,h,u={},g={},p={config:_,global:d,dijit:u,dojox:g},y={dojo:["dojo",p],dijit:["dijit",u],dojox:["dojox",g]},x=l.map&&l.map[n.id.match(/[^\/]+/)[0]],w;for(h in x)y[h]?y[h][0]=x[h]:y[h]=[x[h],{}];for(h in y)w=y[h],w[1]._scopeName=w[0],_.noGlobals||(d[w[0]]=w[1]);p.scopeMap=y,p.baseUrl=p.config.baseUrl=l.baseUrl,p.isAsync=!N("dojo-loader")||l.async,p.locale=_.locale;var M="$Rev:$".match(/[0-9a-f]{7,}/);if(p.version={major:1,minor:17,patch:1,flag:"",revision:M?M[0]:NaN,toString:function(){var z=p.version;return z.major+"."+z.minor+"."+z.patch+z.flag+" ("+z.revision+")"}},N.add("extend-dojo",1),N("csp-restrictions")||Function("d","d.eval = function(){return d.global.eval ? d.global.eval(arguments[0]) : eval(arguments[0]);}")(p),N("host-rhino")?p.exit=function(z){quit(z)}:p.exit=function(){},N("host-webworker")||N.add("dojo-guarantee-console",1),N("dojo-guarantee-console")){N.add("console-as-object",function(){return Function.prototype.bind&&console&&typeof console.log=="object"}),typeof console<"u"||(console={});var T=["assert","count","debug","dir","dirxml","error","group","groupEnd","info","profile","profileEnd","time","timeEnd","trace","warn","log"],A;for(r=0;A=T[r++];)console[A]?N("console-as-object")&&(console[A]=Function.prototype.bind.call(console[A],console)):function(){var z=A+"";console[z]="log"in console?function(){var H=Array.prototype.slice.call(arguments);H.unshift(z+":"),console.log(H.join(" "))}:function(){},console[z]._fake=!0}()}if(N.add("dojo-debug-messages",!!_.isDebug),p.deprecated=p.experimental=function(){},N("dojo-debug-messages")&&(p.deprecated=function(z,H,q){var P="DEPRECATED: "+z;H&&(P+=" "+H),q&&(P+=" -- will be removed in version: "+q),console.warn(P)},p.experimental=function(z,H){var q="EXPERIMENTAL: "+z+" -- APIs subject to change without notice.";H&&(q+=" "+H),console.warn(q)}),N.add("dojo-modulePaths",1),N("dojo-modulePaths")&&_.modulePaths){p.deprecated("dojo.modulePaths","use paths configuration");var C={};for(h in _.modulePaths)C[h.replace(/\./g,"/")]=_.modulePaths[h];l({paths:C})}return N.add("dojo-moduleUrl",1),N("dojo-moduleUrl")&&(p.moduleUrl=function(z,H){p.deprecated("dojo.moduleUrl()","use require.toUrl","2.0");var q=null;return z&&(q=l.toUrl(z.replace(/\./g,"/")+(H?"/"+H:"")+"/*.*").replace(/\/\*\.\*/,"")+(H?"":"/")),q}),p._hasResource={},p},D,V),D.exports=B},1873:(D,V,f)=>{var R,B;R=[f(9424),f(9178),f(3994)],B=f.dj.d(R,function(d,N){N.add("bug-for-in-skips-shadowed",function(){for(var p in{toString:1})return 0;return 1});var _=N("bug-for-in-skips-shadowed")?"hasOwnProperty.valueOf.isPrototypeOf.propertyIsEnumerable.toLocaleString.toString.constructor".split("."):[],l=_.length,n=function(p,y,x){x||(p[0]&&d.scopeMap[p[0]]?x=d.scopeMap[p.shift()][1]:x=d.global);try{for(var w=0;w<p.length;w++){var M=p[w];if(M==="__proto__"||M==="constructor")return;if(!(M in x))if(y)x[M]={};else return;x=x[M]}return x}catch(T){}},r=Object.prototype.toString,h=function(p,y,x){return(x||[]).concat(Array.prototype.slice.call(p,y||0))},u=/\{([^\}]+)\}/g,g={_extraNames:_,_mixin:function(p,y,x){var w,M,T,A={};for(w in y)M=y[w],(!(w in p)||p[w]!==M&&(!(w in A)||A[w]!==M))&&(p[w]=x?x(M):M);if(N("bug-for-in-skips-shadowed")&&y)for(T=0;T<l;++T)w=_[T],M=y[w],(!(w in p)||p[w]!==M&&(!(w in A)||A[w]!==M))&&(p[w]=x?x(M):M);return p},mixin:function(p,y){p||(p={});for(var x=1,w=arguments.length;x<w;x++)g._mixin(p,arguments[x]);return p},setObject:function(p,y,x){var w=p.split("."),M=w.pop(),T=n(w,!0,x);return T&&M?T[M]=y:void 0},getObject:function(p,y,x){return p?n(p.split("."),y,x):x},exists:function(p,y){return g.getObject(p,!1,y)!==void 0},isString:function(p){return typeof p=="string"||p instanceof String},isArray:Array.isArray||function(p){return r.call(p)=="[object Array]"},isFunction:function(p){return r.call(p)==="[object Function]"},isObject:function(p){return p!==void 0&&(p===null||typeof p=="object"||g.isArray(p)||g.isFunction(p))},isArrayLike:function(p){return!!p&&!g.isString(p)&&!g.isFunction(p)&&!(p.tagName&&p.tagName.toLowerCase()=="form")&&(g.isArray(p)||isFinite(p.length))},isAlien:function(p){return p&&!g.isFunction(p)&&/\{\s*\[native code\]\s*\}/.test(String(p))},extend:function(p,y){for(var x=1,w=arguments.length;x<w;x++)g._mixin(p.prototype,arguments[x]);return p},_hitchArgs:function(p,y){var x=g._toArray(arguments,2),w=g.isString(y);return function(){var M=g._toArray(arguments),T=w?(p||d.global)[y]:y;return T&&T.apply(p||this,x.concat(M))}},hitch:function(p,y){if(arguments.length>2)return g._hitchArgs.apply(d,arguments);if(y||(y=p,p=null),g.isString(y)){if(p=p||d.global,!p[y])throw['lang.hitch: scope["',y,'"] is null (scope="',p,'")'].join("");return function(){return p[y].apply(p,arguments||[])}}return p?function(){return y.apply(p,arguments||[])}:y},delegate:function(){function p(){}return function(y,x){p.prototype=y;var w=new p;return p.prototype=null,x&&g._mixin(w,x),w}}(),_toArray:N("ie")?function(){function p(y,x,w){for(var M=w||[],T=x||0;T<y.length;T++)M.push(y[T]);return M}return function(y){return(y.item?p:h).apply(this,arguments)}}():h,partial:function(p){var y=[null];return g.hitch.apply(d,y.concat(g._toArray(arguments)))},clone:function(p){if(!p||typeof p!="object"||g.isFunction(p))return p;if(p.nodeType&&"cloneNode"in p)return p.cloneNode(!0);if(p instanceof Date)return new Date(p.getTime());if(p instanceof RegExp)return new RegExp(p);var y,x,w;if(g.isArray(p))for(y=[],x=0,w=p.length;x<w;++x)x in p&&(y[x]=g.clone(p[x]));else y=p.constructor?new p.constructor:{};return g._mixin(y,p,g.clone)},trim:String.prototype.trim?function(p){return p.trim()}:function(p){return p.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},replace:function(p,y,x){return p.replace(x||u,g.isFunction(y)?y:function(w,M){return g.getObject(M,!1,y)})}};return N("extend-dojo")&&g.mixin(d,g),g},D,V),D.exports=B},8609:(D,V,f)=>{var R,B;R=[f(9424),f(1873),f(3994)],B=f.dj.d(R,function(d,N,_){return _("host-browser")&&(d._name="browser",N.mixin(d,{isBrowser:!0,isFF:_("ff"),isIE:_("ie"),isKhtml:_("khtml"),isWebKit:_("webkit"),isMozilla:_("mozilla"),isMoz:_("mozilla"),isOpera:_("opera"),isSafari:_("safari"),isChrome:_("chrome"),isMac:_("mac"),isIos:_("ios"),isAndroid:_("android"),isWii:_("wii"),isQuirks:_("quirks"),isAir:_("air")})),_},D,V),D.exports=B},8145:(D,V,f)=>{var R,B;R=[f(9424),f(1873),f(3994)],B=f.dj.d(R,function(d,N,_){var l={global:d.global,doc:d.global.document||null,body:function(n){return n=n||d.doc,n.body||n.getElementsByTagName("body")[0]},setContext:function(n,r){d.global=l.global=n,d.doc=l.doc=r},withGlobal:function(n,r,h,u){var g=d.global;try{return d.global=l.global=n,l.withDoc.call(null,n.document,r,h,u)}finally{d.global=l.global=g}},withDoc:function(n,r,h,u){var g=l.doc,p=_("quirks"),y=_("ie"),x,w,M;try{return d.doc=l.doc=n,d.isQuirks=_.add("quirks",d.doc.compatMode=="BackCompat",!0,!0),_("ie")&&(M=n.parentWindow)&&M.navigator&&(x=parseFloat(M.navigator.appVersion.split("MSIE ")[1])||void 0,w=n.documentMode,w&&w!=5&&Math.floor(x)!=w&&(x=w),d.isIE=_.add("ie",x,!0,!0)),h&&typeof r=="string"&&(r=h[r]),r.apply(h,u||[])}finally{d.doc=l.doc=g,d.isQuirks=_.add("quirks",p,!0,!0),d.isIE=_.add("ie",y,!0,!0)}}};return _("extend-dojo")&&N.mixin(d,l),l},D,V),D.exports=B},8519:(D,V,f)=>{var R,B;R=[f(9424),f(8609),f.dj.c(D),f(7841),f(3458),f(2693),f(5642),f(6723),f(5747),f(1873),f(640),f(1929),f(3660),f(1563),f(9810),f(3638)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u,g,p,y,x,w,M,T,A){d._xhrObj=T._create;var C=d.config;d.objectToQuery=l.objectToQuery,d.queryToObject=l.queryToObject,d.fieldToObject=r.fieldToObject,d.formToObject=r.toObject,d.formToQuery=r.toQuery,d.formToJson=r.toJson,d._blockAsync=!1;var z=d._contentHandlers=d.contentHandlers={text:function(Y){return Y.responseText},json:function(Y){return g.fromJson(Y.responseText||null)},"json-comment-filtered":function(Y){u.useCommentedJson||console.warn(`Consider using the standard mimetype:application/json. json-commenting can introduce security issues. To decrease the chances of hijacking, use the standard the 'json' handler and prefix your json with: {}&&
Use djConfig.useCommentedJson=true to turn off this message.`);var k=Y.responseText,ae=k.indexOf("/*"),j=k.lastIndexOf("*/");if(ae==-1||j==-1)throw new Error("JSON was not comment filtered");return g.fromJson(k.substring(ae+2,j))},javascript:function(Y){return d.eval(Y.responseText)},xml:function(Y){var k=Y.responseXML;if(k&&N("dom-qsa2.1")&&!k.querySelectorAll&&N("dom-parser")&&(k=new DOMParser().parseFromString(Y.responseText,"application/xml")),N("ie")&&(!k||!k.documentElement)){var ae=function(F){return"MSXML"+F+".DOMDocument"},j=["Microsoft.XMLDOM",ae(6),ae(4),ae(3),ae(2)];y.some(j,function(F){try{var J=new ActiveXObject(F);J.async=!1,J.loadXML(Y.responseText),k=J}catch(te){return!1}return!0})}return k},"json-comment-optional":function(Y){return Y.responseText&&/^[^{\[]*\/\*/.test(Y.responseText)?z["json-comment-filtered"](Y):z.json(Y)}};d._ioSetArgs=function(Y,k,ae,j){var F={args:Y,url:Y.url},J=null;if(Y.form){var te=n.byId(Y.form),_e=te.getAttributeNode("action");F.url=F.url||(_e?_e.value:d.doc?d.doc.URL:null),J=r.toObject(te)}var ne={};J&&p.mixin(ne,J),Y.content&&p.mixin(ne,Y.content),Y.preventCache&&(ne["dojo.preventCache"]=new Date().valueOf()),F.query=l.objectToQuery(ne),F.handleAs=Y.handleAs||"text";var le=new h(function(Re){Re.canceled=!0,k&&k(Re);var nt=Re.ioArgs.error;return nt||(nt=new Error("request cancelled"),nt.dojoType="cancel",Re.ioArgs.error=nt),nt});le.addCallback(ae);var be=Y.load;be&&p.isFunction(be)&&le.addCallback(function(Re){return be.call(Y,Re,F)});var je=Y.error;je&&p.isFunction(je)&&le.addErrback(function(Re){return je.call(Y,Re,F)});var ze=Y.handle;return ze&&p.isFunction(ze)&&le.addBoth(function(Re){return ze.call(Y,Re,F)}),le.addErrback(function(Re){return j(Re,le)}),C.ioPublish&&d.publish&&F.args.ioPublish!==!1&&(le.addCallbacks(function(Re){return d.publish("/dojo/io/load",[le,Re]),Re},function(Re){return d.publish("/dojo/io/error",[le,Re]),Re}),le.addBoth(function(Re){return d.publish("/dojo/io/done",[le,Re]),Re})),le.ioArgs=F,le};var H=function(Y){var k=z[Y.ioArgs.handleAs](Y.ioArgs.xhr);return k===void 0?null:k},q=function(Y,k){return k.ioArgs.args.failOk||console.error(Y),Y},P=function(Y){Z<=0&&(Z=0,C.ioPublish&&d.publish&&(!Y||Y&&Y.ioArgs.args.ioPublish!==!1)&&d.publish("/dojo/io/stop"))},Z=0;w.after(M,"_onAction",function(){Z-=1}),w.after(M,"_onInFlight",P),d._ioCancelAll=M.cancelAll,d._ioNotifyStart=function(Y){C.ioPublish&&d.publish&&Y.ioArgs.args.ioPublish!==!1&&(Z||d.publish("/dojo/io/start"),Z+=1,d.publish("/dojo/io/send",[Y]))},d._ioWatch=function(Y,k,ae,j){var F=Y.ioArgs.options=Y.ioArgs.args;p.mixin(Y,{response:Y.ioArgs,isValid:function(J){return k(Y)},isReady:function(J){return ae(Y)},handleResponse:function(J){return j(Y)}}),M(Y),P(Y)};var K="application/x-www-form-urlencoded";return d._ioAddQueryToUrl=function(Y){Y.query.length&&(Y.url+=(Y.url.indexOf("?")==-1?"?":"&")+Y.query,Y.query=null)},d.xhr=function(Y,k,ae){var j,F=d._ioSetArgs(k,function(_e){j&&j.cancel()},H,q),J=F.ioArgs;"postData"in k?J.query=k.postData:"putData"in k?J.query=k.putData:"rawBody"in k?J.query=k.rawBody:(arguments.length>2&&!ae||"POST|PUT".indexOf(Y.toUpperCase())===-1)&&d._ioAddQueryToUrl(J);var te={method:Y,handleAs:"text",timeout:k.timeout,withCredentials:k.withCredentials,ioArgs:J};typeof k.headers<"u"&&(te.headers=k.headers),typeof k.contentType<"u"&&(te.headers||(te.headers={}),te.headers["Content-Type"]=k.contentType),typeof J.query<"u"&&(te.data=J.query),typeof k.sync<"u"&&(te.sync=k.sync),d._ioNotifyStart(F);try{j=T(J.url,te,!0)}catch(_e){return F.cancel(),F}return F.ioArgs.xhr=j.response.xhr,j.then(function(){F.resolve(F)}).otherwise(function(_e){J.error=_e,_e.response&&(_e.status=_e.response.status,_e.responseText=_e.response.text,_e.xhr=_e.response.xhr),F.reject(_e)}),F},d.xhrGet=function(Y){return d.xhr("GET",Y)},d.rawXhrPost=d.xhrPost=function(Y){return d.xhr("POST",Y,!0)},d.rawXhrPut=d.xhrPut=function(Y){return d.xhr("PUT",Y,!0)},d.xhrDelete=function(Y){return d.xhr("DELETE",Y)},d._isDocumentOk=function(Y){return A.checkStatus(Y.status)},d._getText=function(Y){var k;return d.xhrGet({url:Y,sync:!0,load:function(ae){k=ae}}),k},p.mixin(d.xhr,{_xhrObj:d._xhrObj,fieldToObject:r.fieldToObject,formToObject:r.toObject,objectToQuery:l.objectToQuery,formToQuery:r.toQuery,formToJson:r.toJson,queryToObject:l.queryToObject,contentHandlers:z,_ioSetArgs:d._ioSetArgs,_ioCancelAll:d._ioCancelAll,_ioNotifyStart:d._ioNotifyStart,_ioWatch:d._ioWatch,_ioAddQueryToUrl:d._ioAddQueryToUrl,_isDocumentOk:d._isDocumentOk,_getText:d._getText,get:d.xhrGet,post:d.xhrPost,put:d.xhrPut,del:d.xhrDelete}),d.xhr},D,V),D.exports=B},3660:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d;function N(h,u,g,p){var y=h[u],x=u=="around",w;if(x){var M=g(function(){return y.advice(this,arguments)});w={remove:function(){M&&(M=h=g=null)},advice:function(T,A){return M?M.apply(T,A):y.advice(T,A)}}}else w={remove:function(){if(w.advice){var T=w.previous,A=w.next;!A&&!T?delete h[u]:(T?T.next=A:h[u]=A,A&&(A.previous=T)),h=g=w.advice=null}},id:h.nextId++,advice:g,receiveArguments:p};if(y&&!x)if(u=="after"){for(;y.next&&(y=y.next););y.next=w,w.previous=y}else u=="before"&&(h[u]=w,w.next=y,y.previous=w);else h[u]=w;return w}function _(h){return function(u,g,p,y){var x=u[g],w;(!x||x.target!=u)&&(u[g]=w=function(){for(var T=w.nextId,A=arguments,C=w.before;C;)C.advice&&(A=C.advice.apply(this,A)||A),C=C.next;if(w.around)var z=w.around.advice(this,A);for(var H=w.after;H&&H.id<T;){if(H.advice)if(H.receiveArguments){var q=H.advice.apply(this,A);z=q===d?z:q}else z=H.advice.call(this,z,A);H=H.next}return z},x&&(w.around={advice:function(T,A){return x.apply(T,A)}}),w.target=u,w.nextId=w.nextId||0);var M=N(w||x,h,p,y);return p=null,M}}var l=_("after"),n=_("before"),r=_("around");return{before:n,around:r,after:l}},D,V),D.exports=B},4348:(D,V,f)=>{var R,B;R=[V,f(3994),f(1873),f(3458),f(2442),f(1502)],B=f.dj.d(R,function(d,N,_,l,n,r){var h={innerHTML:1,textContent:1,className:1,htmlFor:N("ie")?1:0,value:1},u={classname:"class",htmlfor:"for",tabindex:"tabIndex",readonly:"readOnly"};function g(p,y){var x=p.getAttributeNode&&p.getAttributeNode(y);return!!x&&x.specified}d.has=function(y,x){var w=x.toLowerCase();return!!h[r.names[w]||x]||g(l.byId(y),u[w]||x)},d.get=function(y,x){y=l.byId(y);var w=x.toLowerCase(),M=r.names[w]||x,T=h[M],A=y[M];if(T&&typeof A<"u")return A;if(M=="textContent")return r.get(y,M);if(M!="href"&&(typeof A=="boolean"||_.isFunction(A)))return A;var C=u[w]||x;return g(y,C)?y.getAttribute(C):null},d.set=function(y,x,w){if(y=l.byId(y),arguments.length==2){for(var M in x)d.set(y,M,x[M]);return y}var T=x.toLowerCase(),A=r.names[T]||x,C=h[A];return A=="style"&&typeof w!="string"?(n.set(y,w),y):C||typeof w=="boolean"||_.isFunction(w)?r.set(y,x,w):(y.setAttribute(u[T]||x,w),y)},d.remove=function(y,x){l.byId(y).removeAttribute(u[x.toLowerCase()]||x)},d.getNodeProp=function(y,x){y=l.byId(y);var w=x.toLowerCase(),M=r.names[w]||x;if(M in y&&M!="href")return y[M];var T=u[w]||x;return g(y,T)?y.getAttribute(T):null}},D,V),D.exports=B},2490:(D,V,f)=>{var R,B;R=[V,f(9424),f(3994),f(8145),f(3458),f(4348)],B=f.dj.d(R,function(d,N,_,l,n,r){var h={option:["select"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","thead","tr"],legend:["fieldset"],caption:["table"],colgroup:["table"],col:["table","colgroup"],li:["ul"]},u=/<\s*([\w\:]+)/,g={},p=0,y="__"+N._scopeName+"ToDomId";for(var x in h)if(h.hasOwnProperty(x)){var w=h[x];w.pre=x=="option"?'<select multiple="multiple">':"<"+w.join("><")+">",w.post="</"+w.reverse().join("></")+">"}var M;_("ie")<=8&&(M=function(P){P.__dojo_html5_tested="yes";var Z=C("div",{innerHTML:"<nav>a</nav>",style:{visibility:"hidden"}},P.body);Z.childNodes.length!==1&&"abbr article aside audio canvas details figcaption figure footer header hgroup mark meter nav output progress section summary time video".replace(/\b\w+\b/g,function(K){P.createElement(K)}),q(Z)});function T(P,Z){var K=Z.parentNode;K&&K.insertBefore(P,Z)}function A(P,Z){var K=Z.parentNode;K&&(K.lastChild==Z?K.appendChild(P):K.insertBefore(P,Z.nextSibling))}d.toDom=function(Z,K){K=K||l.doc;var Y=K[y];Y||(K[y]=Y=++p+"",g[Y]=K.createElement("div")),_("ie")<=8&&!K.__dojo_html5_tested&&K.body&&M(K),Z+="";var k=Z.match(u),ae=k?k[1].toLowerCase():"",j=g[Y],F,J,te,_e;if(k&&h[ae])for(F=h[ae],j.innerHTML=F.pre+Z+F.post,J=F.length;J;--J)j=j.firstChild;else j.innerHTML=Z;if(j.childNodes.length==1)return j.removeChild(j.firstChild);for(_e=K.createDocumentFragment();te=j.firstChild;)_e.appendChild(te);return _e},d.place=function(Z,K,Y){if(K=n.byId(K),typeof Z=="string"&&(Z=/^\s*</.test(Z)?d.toDom(Z,K.ownerDocument):n.byId(Z)),typeof Y=="number"){var k=K.childNodes;!k.length||k.length<=Y?K.appendChild(Z):T(Z,k[Y<0?0:Y])}else switch(Y){case"before":T(Z,K);break;case"after":A(Z,K);break;case"replace":K.parentNode.replaceChild(Z,K);break;case"only":d.empty(K),K.appendChild(Z);break;case"first":if(K.firstChild){T(Z,K.firstChild);break}default:K.appendChild(Z)}return Z};var C=d.create=function(Z,K,Y,k){var ae=l.doc;return Y&&(Y=n.byId(Y),ae=Y.ownerDocument),typeof Z=="string"&&(Z=ae.createElement(Z)),K&&r.set(Z,K),Y&&d.place(Z,Y,k),Z};function z(P){if("innerHTML"in P)try{P.innerHTML="";return}catch(K){}for(var Z;Z=P.lastChild;)P.removeChild(Z)}d.empty=function(Z){z(n.byId(Z))};function H(P,Z){P.firstChild&&z(P),Z&&(_("ie")&&Z.canHaveChildren&&"removeNode"in P?P.removeNode(!1):Z.removeChild(P))}var q=d.destroy=function(Z){Z=n.byId(Z),Z&&H(Z,Z.parentNode)}},D,V),D.exports=B},2693:(D,V,f)=>{var R,B;R=[f(1873),f(3458),f(7841),f(2570)],B=f.dj.d(R,function(d,N,_,l){function n(u,g,p){if(p!==null){var y=u[g];typeof y=="string"?u[g]=[y,p]:d.isArray(y)?y.push(p):u[g]=p}}var r="file|submit|image|reset|button",h={fieldToObject:function(g){var p=null;if(g=N.byId(g),g){var y=g.name,x=(g.type||"").toLowerCase();if(y&&x&&!g.disabled)if(x=="radio"||x=="checkbox")g.checked&&(p=g.value);else if(g.multiple){p=[];for(var w=[g.firstChild];w.length;)for(var M=w.pop();M;M=M.nextSibling)if(M.nodeType==1&&M.tagName.toLowerCase()=="option")M.selected&&p.push(M.value);else{M.nextSibling&&w.push(M.nextSibling),M.firstChild&&w.push(M.firstChild);break}}else p=g.value}return p},toObject:function(g){for(var p={},y=N.byId(g).elements,x=0,w=y.length;x<w;++x){var M=y[x],T=M.name,A=(M.type||"").toLowerCase();T&&A&&r.indexOf(A)<0&&!M.disabled&&(n(p,T,h.fieldToObject(M)),A=="image"&&(p[T+".x"]=p[T+".y"]=p[T].x=p[T].y=0))}return p},toQuery:function(g){return _.objectToQuery(h.toObject(g))},toJson:function(g,p){return l.stringify(h.toObject(g),null,p?4:0)}};return h},D,V),D.exports=B},8771:(D,V,f)=>{var R,B;R=[f(3994),f(8145),f(3458),f(2442)],B=f.dj.d(R,function(d,N,_,l){var n={};n.boxModel="content-box",d("ie")&&(n.boxModel=document.compatMode=="BackCompat"?"border-box":"content-box"),n.getPadExtents=function(w,M){w=_.byId(w);var T=M||l.getComputedStyle(w),A=l.toPixelValue,C=A(w,T.paddingLeft),z=A(w,T.paddingTop),H=A(w,T.paddingRight),q=A(w,T.paddingBottom);return{l:C,t:z,r:H,b:q,w:C+H,h:z+q}};var r="none";n.getBorderExtents=function(w,M){w=_.byId(w);var T=l.toPixelValue,A=M||l.getComputedStyle(w),C=A.borderLeftStyle!=r?T(w,A.borderLeftWidth):0,z=A.borderTopStyle!=r?T(w,A.borderTopWidth):0,H=A.borderRightStyle!=r?T(w,A.borderRightWidth):0,q=A.borderBottomStyle!=r?T(w,A.borderBottomWidth):0;return{l:C,t:z,r:H,b:q,w:C+H,h:z+q}},n.getPadBorderExtents=function(w,M){w=_.byId(w);var T=M||l.getComputedStyle(w),A=n.getPadExtents(w,T),C=n.getBorderExtents(w,T);return{l:A.l+C.l,t:A.t+C.t,r:A.r+C.r,b:A.b+C.b,w:A.w+C.w,h:A.h+C.h}},n.getMarginExtents=function(w,M){w=_.byId(w);var T=M||l.getComputedStyle(w),A=l.toPixelValue,C=A(w,T.marginLeft),z=A(w,T.marginTop),H=A(w,T.marginRight),q=A(w,T.marginBottom);return{l:C,t:z,r:H,b:q,w:C+H,h:z+q}},n.getMarginBox=function(w,M){w=_.byId(w);var T=M||l.getComputedStyle(w),A=n.getMarginExtents(w,T),C=w.offsetLeft-A.l,z=w.offsetTop-A.t,H=w.parentNode,q=l.toPixelValue,P;if(d("mozilla")){var Z=parseFloat(T.left),K=parseFloat(T.top);!isNaN(Z)&&!isNaN(K)?(C=Z,z=K):H&&H.style&&(P=l.getComputedStyle(H),P.overflow!="visible"&&(C+=P.borderLeftStyle!=r?q(w,P.borderLeftWidth):0,z+=P.borderTopStyle!=r?q(w,P.borderTopWidth):0))}else(d("opera")||d("ie")==8&&!d("quirks"))&&H&&(P=l.getComputedStyle(H),C-=P.borderLeftStyle!=r?q(w,P.borderLeftWidth):0,z-=P.borderTopStyle!=r?q(w,P.borderTopWidth):0);return{l:C,t:z,w:w.offsetWidth+A.w,h:w.offsetHeight+A.h}},n.getContentBox=function(w,M){w=_.byId(w);var T=M||l.getComputedStyle(w),A=w.clientWidth,C,z=n.getPadExtents(w,T),H=n.getBorderExtents(w,T);return A?(C=w.clientHeight,H.w=H.h=0):(A=w.offsetWidth,C=w.offsetHeight),d("opera")&&(z.l+=H.l,z.t+=H.t),{l:z.l,t:z.t,w:A-z.w-H.w,h:C-z.h-H.h}};function h(x,w,M,T,A,C){C=C||"px";var z=x.style;isNaN(w)||(z.left=w+C),isNaN(M)||(z.top=M+C),T>=0&&(z.width=T+C),A>=0&&(z.height=A+C)}function u(x){return x.tagName.toLowerCase()=="button"||x.tagName.toLowerCase()=="input"&&(x.getAttribute("type")||"").toLowerCase()=="button"}function g(x){return n.boxModel=="border-box"||x.tagName.toLowerCase()=="table"||u(x)}function p(x){var w={x:0,y:0,width:0,height:0,top:0,right:0,bottom:0,left:0},M;try{M=x.getBoundingClientRect()}catch(T){return w}return typeof M.left>"u"?w:M}n.setContentSize=function(w,M,T){w=_.byId(w);var A=M.w,C=M.h;if(g(w)){var z=n.getPadBorderExtents(w,T);A>=0&&(A+=z.w),C>=0&&(C+=z.h)}h(w,NaN,NaN,A,C)};var y={l:0,t:0,w:0,h:0};return n.setMarginBox=function(w,M,T){w=_.byId(w);var A=T||l.getComputedStyle(w),C=M.w,z=M.h,H=g(w)?y:n.getPadBorderExtents(w,A),q=n.getMarginExtents(w,A);if(d("webkit")&&u(w)){var P=w.style;C>=0&&!P.width&&(P.width="4px"),z>=0&&!P.height&&(P.height="4px")}C>=0&&(C=Math.max(C-H.w-q.w,0)),z>=0&&(z=Math.max(z-H.h-q.h,0)),h(w,M.l,M.t,C,z)},n.isBodyLtr=function(w){return w=w||N.doc,(N.body(w).dir||w.documentElement.dir||"ltr").toLowerCase()=="ltr"},n.docScroll=function(w){w=w||N.doc;var M=w.parentWindow||w.defaultView;return"pageXOffset"in M?{x:M.pageXOffset,y:M.pageYOffset}:(M=d("quirks")?N.body(w):w.documentElement)&&{x:n.fixIeBiDiScrollLeft(M.scrollLeft||0,w),y:M.scrollTop||0}},n.getIeDocumentElementOffset=function(x){return{x:0,y:0}},n.fixIeBiDiScrollLeft=function(w,M){M=M||N.doc;var T=d("ie");if(T&&!n.isBodyLtr(M)){var A=d("quirks"),C=A?N.body(M):M.documentElement,z=N.global;return T==6&&!A&&z.frameElement&&C.scrollHeight>C.clientHeight&&(w+=C.clientLeft),T<8||A?w+C.clientWidth-C.scrollWidth:-w}return w},n.position=function(x,w){x=_.byId(x);var M=N.body(x.ownerDocument),T=p(x);if(T={x:T.left,y:T.top,w:T.right-T.left,h:T.bottom-T.top},d("ie")<9&&(T.x-=d("quirks")?M.clientLeft+M.offsetLeft:0,T.y-=d("quirks")?M.clientTop+M.offsetTop:0),w){var A=n.docScroll(x.ownerDocument);T.x+=A.x,T.y+=A.y}return T},n.getMarginSize=function(w,M){w=_.byId(w);var T=n.getMarginExtents(w,M||l.getComputedStyle(w)),A=p(w);return{w:A.right-A.left+T.w,h:A.bottom-A.top+T.h}},n.normalizeEvent=function(x){if("layerX"in x||(x.layerX=x.offsetX,x.layerY=x.offsetY),!("pageX"in x)){var w=x.target,M=w&&w.ownerDocument||document,T=d("quirks")?M.body:M.documentElement;x.pageX=x.clientX+n.fixIeBiDiScrollLeft(T.scrollLeft||0,M),x.pageY=x.clientY+(T.scrollTop||0)}},n},D,V),D.exports=B},1502:(D,V,f)=>{var R,B;R=[V,f(9424),f(3994),f(1873),f(3458),f(2442),f(2490),f(5135)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u){var g={},p=1,y=N._scopeName+"attrid";_.add("dom-textContent",function(w,M,T){return"textContent"in T}),d.names={class:"className",for:"htmlFor",tabindex:"tabIndex",readonly:"readOnly",colspan:"colSpan",frameborder:"frameBorder",rowspan:"rowSpan",textcontent:"textContent",valuetype:"valueType"};function x(w){for(var M="",T=w.childNodes,A=0,C;C=T[A];A++)C.nodeType!=8&&(C.nodeType==1?M+=x(C):M+=C.nodeValue);return M}d.get=function(M,T){M=n.byId(M);var A=T.toLowerCase(),C=d.names[A]||T;return C=="textContent"&&!_("dom-textContent")?x(M):M[C]},d.set=function(M,T,A){M=n.byId(M);var C=arguments.length;if(C==2&&typeof T!="string"){for(var z in T)d.set(M,z,T[z]);return M}var H=T.toLowerCase(),q=d.names[H]||T;if(q=="style"&&typeof A!="string")return r.set(M,A),M;if(q=="innerHTML")return _("ie")&&M.tagName.toLowerCase()in{col:1,colgroup:1,table:1,tbody:1,tfoot:1,thead:1,tr:1,title:1}?(h.empty(M),M.appendChild(h.toDom(A,M.ownerDocument))):M[q]=A,M;if(q=="textContent"&&!_("dom-textContent"))return h.empty(M),M.appendChild(M.ownerDocument.createTextNode(A)),M;if(l.isFunction(A)){var P=M[y];P||(P=p++,M[y]=P),g[P]||(g[P]={});var Z=g[P][q];if(Z)u.disconnect(Z);else try{delete M[q]}catch(K){}return A?g[P][q]=u.connect(M,q,A):M[q]=null,M}return M[q]=A,M}},D,V),D.exports=B},2442:(D,V,f)=>{var R,B;R=[f(3994),f(3458),f(8145)],B=f.dj.d(R,function(d,N,_){var l,n={};d("webkit")?l=function(T){var A;if(T.nodeType==1){var C=T.ownerDocument.defaultView;A=C.getComputedStyle(T,null),!A&&T.style&&(T.style.display="",A=C.getComputedStyle(T,null))}return A||{}}:d("ie")&&(d("ie")<9||d("quirks"))?l=function(T){return T.nodeType==1&&T.currentStyle?T.currentStyle:{}}:l=function(T){if(T.nodeType===1){var A=T.ownerDocument.defaultView,C=A.opener?A:_.global.window;return C.getComputedStyle(T,null)||{}}return{}},n.getComputedStyle=l;var r;d("ie")?r=function(T,A){if(!A)return 0;if(A=="medium")return 4;if(A.slice&&A.slice(-2)=="px")return parseFloat(A);var C=T.style,z=T.runtimeStyle,H=T.currentStyle,q=C.left,P=z.left;z.left=H.left;try{C.left=A,A=C.pixelLeft}catch(Z){A=0}return C.left=q,z.left=P,A}:r=function(T,A){return parseFloat(A)||0},n.toPixelValue=r;var h="DXImageTransform.Microsoft.Alpha",u=function(T,A){try{return T.filters.item(h)}catch(C){return A?{}:null}},g=d("ie")<9||d("ie")<10&&d("quirks")?function(T){try{return u(T).Opacity/100}catch(A){return 1}}:function(T){return l(T).opacity},p=d("ie")<9||d("ie")<10&&d("quirks")?function(T,A){A===""&&(A=1);var C=A*100,z=A===1;if(z?(T.style.zoom="",u(T)&&(T.style.filter=T.style.filter.replace(new RegExp("\\s*progid:"+h+"\\([^\\)]+?\\)","i"),""))):(T.style.zoom=1,u(T)?u(T,1).Opacity=C:T.style.filter+=" progid:"+h+"(Opacity="+C+")",u(T,1).Enabled=!0),T.tagName.toLowerCase()=="tr")for(var H=T.firstChild;H;H=H.nextSibling)H.tagName.toLowerCase()=="td"&&p(H,A);return A}:function(T,A){return T.style.opacity=A},y={left:!0,top:!0},x=/margin|padding|width|height|max|min|offset/;function w(T,A,C){if(A=A.toLowerCase(),C=="auto"){if(A=="height")return T.offsetHeight;if(A=="width")return T.offsetWidth}if(A=="fontweight")switch(C){case 700:return"bold";case 400:default:return"normal"}return A in y||(y[A]=x.test(A)),y[A]?r(T,C):C}var M={cssFloat:1,styleFloat:1,float:1};return n.get=function(A,C){var z=N.byId(A),H=arguments.length,q=C=="opacity";if(H==2&&q)return g(z);C=M[C]?"cssFloat"in z.style?"cssFloat":"styleFloat":C;var P=n.getComputedStyle(z);return H==1?P:w(z,C,P[C]||z.style[C])},n.set=function(A,C,z){var H=N.byId(A),q=arguments.length,P=C=="opacity";if(C=M[C]?"cssFloat"in H.style?"cssFloat":"styleFloat":C,q==3)return P?p(H,z):H.style[C]=z;for(var Z in C)n.set(A,Z,C[Z]);return n.getComputedStyle(H)},n},D,V),D.exports=B},3458:(D,V,f)=>{var R,B;R=[f(3994),f(8145),f(9424)],B=f.dj.d(R,function(d,N,_){if(d("ie")<=7)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(h){}var l={};d("ie")?l.byId=function(h,u){if(typeof h!="string")return h||null;var g=u||N.doc,p=h&&g.getElementById(h);if(p&&(p.attributes.id.value==h||p.id==h))return p;var y=g.all[h];(!y||y.nodeName)&&(y=[y]);for(var x=0;p=y[x++];)if(p.attributes&&p.attributes.id&&p.attributes.id.value==h||p.id==h)return p;return null}:l.byId=function(h,u){return(typeof h=="string"?(u||N.doc).getElementById(h):h)||null};var n=_.global.document||null;d.add("dom-contains",!!(n&&n.contains)),l.isDescendant=function(h,u){try{for(h=l.byId(h),u=l.byId(u);h;){if(h==u)return!0;h=h.parentNode}}catch(g){}return!1},d.add("css-user-select",function(h,u,g){if(!g)return!1;var p=g.style,y=["Khtml","O","Moz","Webkit"],x=y.length,w="userSelect",M;do if(typeof p[w]<"u")return w;while(x--&&(w=y[x]+"UserSelect"));return!1});var r=d("css-user-select");return l.setSelectable=r?function(h,u){l.byId(h).style[r]=u?"":"none"}:function(h,u){h=l.byId(h);var g=h.getElementsByTagName("*"),p=g.length;if(u)for(h.removeAttribute("unselectable");p--;)g[p].removeAttribute("unselectable");else for(h.setAttribute("unselectable","on");p--;)g[p].setAttribute("unselectable","on")},l},D,V),D.exports=B},7207:(D,V,f)=>{var R,B;R=[f(8455),f(9178)],B=f.dj.d(R,function(d,N){var _=document,l={loaded:1,complete:1},n=typeof _.readyState!="string",r=!!l[_.readyState],h=[],u;function g(A){h.push(A),r&&p()}g.load=function(A,C,z){g(z)},g._Q=h,g._onQEmpty=function(){},n&&(_.readyState="loading");function p(){if(!u){for(u=!0;h.length;)try{h.shift()(_)}catch(A){console.error(A,"in domReady callback",A.stack)}u=!1,g._onQEmpty()}}if(!r){var y=[],x=function(A){A=A||d.event,!(r||A.type=="readystatechange"&&!l[_.readyState])&&(n&&(_.readyState="complete"),r=1,p())},w=function(A,C){A.addEventListener(C,x,!1),h.push(function(){A.removeEventListener(C,x,!1)})};if(!N("dom-addeventlistener")){w=function(A,C){C="on"+C,A.attachEvent(C,x),h.push(function(){A.detachEvent(C,x)})};var M=_.createElement("div");try{M.doScroll&&d.frameElement===null&&y.push(function(){try{return M.doScroll("left"),1}catch(A){}})}catch(A){}}if(w(_,"DOMContentLoaded"),w(d,"load"),"onreadystatechange"in _?w(_,"readystatechange"):n||y.push(function(){return l[_.readyState]}),y.length){var T=function(){if(!r){for(var A=y.length;A--;)if(y[A]()){x("poller");return}setTimeout(T,30)}};T()}}return g},D,V),D.exports=B},7800:(D,V,f)=>{var R,B;R=[f(5062)],B=f.dj.d(R,function(d){return d("CancelError",null,null,{dojoType:"cancel",log:!1})},D,V),D.exports=B},5867:(D,V,f)=>{var R,B;R=[f(5062)],B=f.dj.d(R,function(d){return d("RequestError",function(N,_){this.response=_})},D,V),D.exports=B},6930:(D,V,f)=>{var R,B;R=[f(5062),f(5867)],B=f.dj.d(R,function(d,N){return d("RequestTimeoutError",null,N,{dojoType:"timeout"})},D,V),D.exports=B},5062:(D,V,f)=>{var R,B;R=[f(1873)],B=f.dj.d(R,function(d){return function(N,_,l,n){l=l||Error;var r=function(h){if(l===Error){Error.captureStackTrace&&Error.captureStackTrace(this,r);var u=Error.call(this,h),g;for(g in u)u.hasOwnProperty(g)&&(this[g]=u[g]);this.message=h,this.stack=u.stack}else l.apply(this,arguments);_&&_.apply(this,arguments)};return r.prototype=d.delegate(l.prototype,n),r.prototype.name=N,r.prototype.constructor=r,r}},D,V),D.exports=B},8455:(D,V,f)=>{var R;R=function(){return function(){return typeof global<"u"&&typeof global!="function"?global:typeof window<"u"?window:typeof self<"u"?self:this}()}.call(null,f,V,D),R!==void 0&&(D.exports=R)},9178:(D,V,f)=>{var R,B;R=[f(8455),f.dj.c(D),f.dj.m(D)],B=f.dj.d(R,function(d,N,_){var l=N.has||function(){};if(!l("dojo-has-api")){var n=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location==location&&window.document==document,r=n&&document,h=r&&r.createElement("DiV"),u=_.config&&_.config()||{};l=function(p){return typeof u[p]=="function"?u[p]=u[p](d,r,h):u[p]},l.cache=u,l.add=function(p,y,x,w){return(typeof u[p]>"u"||w)&&(u[p]=y),x&&l(p)},l.add("host-browser",n),l.add("host-node",typeof process=="object"&&process.versions&&process.versions.node&&process.versions.v8),l.add("host-rhino",typeof load=="function"&&(typeof Packages=="function"||typeof Packages=="object")),l.add("dom",n),l.add("dojo-dom-ready-api",1),l.add("dojo-sniff",1)}if(l("host-browser")){l.add("dom-addeventlistener",!!document.addEventListener),l.add("touch","ontouchstart"in document||"onpointerdown"in document&&navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints),l.add("touch-events","ontouchstart"in document),l.add("pointer-events","pointerEnabled"in window.navigator?window.navigator.pointerEnabled:"PointerEvent"in window),l.add("MSPointer",window.navigator.msPointerEnabled),l.add("touch-action",l("touch")&&l("pointer-events")),l.add("device-width",screen.availWidth||innerWidth);var g=document.createElement("form");l.add("dom-attributes-explicit",g.attributes.length==0),l.add("dom-attributes-specified-flag",g.attributes.length>0&&g.attributes.length<40)}return l.clearElement=function(p){return p.innerHTML="",p},l.normalize=function(p,y){var x=p.match(/[\?:]|[^:\?]*/g),w=0,M=function(T){var A=x[w++];return A==":"?0:x[w++]=="?"?!T&&l(A)?M():(M(!0),M(T)):A||0};return p=M(),p&&y(p)},l.load=function(p,y,x){p?y([p],x):x()},l},D,V),D.exports=B},7841:(D,V,f)=>{var R,B;R=[f(1873)],B=f.dj.d(R,function(d){var N={};return{objectToQuery:function(l){var n=encodeURIComponent,r=[];for(var h in l){var u=l[h];if(u!=N[h]){var g=n(h)+"=";if(d.isArray(u))for(var p=0,y=u.length;p<y;++p)r.push(g+n(u[p]));else r.push(g+n(u))}}return r.join("&")},queryToObject:function(l){for(var n=decodeURIComponent,r=l.split("&"),h={},u,g,p=0,y=r.length,x;p<y;++p)if(x=r[p],x.length){var w=x.indexOf("=");w<0?(u=n(x),g=""):(u=n(x.slice(0,w)),g=n(x.slice(w+1))),typeof h[u]=="string"&&(h[u]=[h[u]]),d.isArray(h[u])?h[u].push(g):h[u]=g}return h}}},D,V),D.exports=B},2570:(D,V,f)=>{var R,B;R=[f(9178)],B=f.dj.d(R,function(d){"use strict";var N=typeof JSON<"u";return d.add("json-parse",N),d.add("json-stringify",N&&JSON.stringify({a:0},function(_,l){return l||1})=='{"a":1}'),JSON},D,V),D.exports=B},3720:(D,V,f)=>{var R,B;R=[f(9424),f(3994)],B=f.dj.d(R,function(d,N){return d.keys={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,META:N("webkit")?91:224,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,HELP:47,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_PLUS:107,NUMPAD_ENTER:108,NUMPAD_MINUS:109,NUMPAD_PERIOD:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,NUM_LOCK:144,SCROLL_LOCK:145,UP_DPAD:175,DOWN_DPAD:176,LEFT_DPAD:177,RIGHT_DPAD:178,copyKey:N("mac")&&!N("air")?N("safari")?91:224:17}},D,V),D.exports=B},4905:(D,V,f)=>{var R,B;R=[f(9424),f(1929),f(9178),f(3458),f(8145)],B=f.dj.d(R,function(d,N,_,l,n){_.add("dom-quirks",n.doc&&n.doc.compatMode=="BackCompat"),_.add("events-mouseenter",n.doc&&"onmouseenter"in n.doc.createElement("div")),_.add("events-mousewheel",n.doc&&"onmousewheel"in n.doc);var r;_("dom-quirks")&&_("ie")||!_("dom-addeventlistener")?r={LEFT:1,MIDDLE:4,RIGHT:2,isButton:function(g,p){return g.button&p},isLeft:function(g){return g.button&1},isMiddle:function(g){return g.button&4},isRight:function(g){return g.button&2}}:r={LEFT:0,MIDDLE:1,RIGHT:2,isButton:function(g,p){return g.button==p},isLeft:function(g){return g.button==0},isMiddle:function(g){return g.button==1},isRight:function(g){return g.button==2}},d.mouseButtons=r;function h(g,p){var y=function(x,w){return N(x,g,function(M){if(p)return p(M,w);if(!l.isDescendant(M.relatedTarget,x))return w.call(this,M)})};return y.bubble=function(x){return h(g,function(w,M){var T=x(w.target),A=w.relatedTarget;if(T&&T!=(A&&A.nodeType==1&&x(A)))return M.call(T,w)})},y}var u;return _("events-mousewheel")?u="mousewheel":u=function(g,p){return N(g,"DOMMouseScroll",function(y){y.wheelDelta=-y.detail,p.call(this,y)})},{_eventHandler:h,enter:h("mouseover"),leave:h("mouseout"),wheel:u,isLeft:r.isLeft,isMiddle:r.isMiddle,isRight:r.isRight}},D,V),D.exports=B},1929:(D,V,f)=>{var R,B;R=[f.dj.h("dom-addeventlistener?:3660"),f(9424),f(3994)],B=f.dj.d(R,function(d,N,_){"use strict";if(_("dom")){var l=window.ScriptEngineMajorVersion;_.add("jscript",l&&l()+ScriptEngineMinorVersion()/10),_.add("event-orientationchange",_("touch")&&!_("android")),_.add("event-stopimmediatepropagation",window.Event&&!!window.Event.prototype&&!!window.Event.prototype.stopImmediatePropagation),_.add("event-focusin",function(k,ae,j){return"onfocusin"in j}),_("touch")&&_.add("touch-can-modify-event-delegate",function(){var k=function(){};k.prototype=document.createEvent("MouseEvents");try{var ae=new k;return ae.target=null,ae.target===null}catch(j){return!1}})}var n=function(k,ae,j,F){return typeof k.on=="function"&&typeof ae!="function"&&!k.nodeType?k.on(ae,j):n.parse(k,ae,j,h,F,this)};n.pausable=function(k,ae,j,F){var J,te=n(k,ae,function(){if(!J)return j.apply(this,arguments)},F);return te.pause=function(){J=!0},te.resume=function(){J=!1},te},n.once=function(k,ae,j,F){var J=n(k,ae,function(){return J.remove(),j.apply(this,arguments)});return J},n.parse=function(k,ae,j,F,J,te){var _e;if(ae.call)return ae.call(te,k,j);if(ae instanceof Array?_e=ae:ae.indexOf(",")>-1&&(_e=ae.split(/\s*,\s*/)),_e){for(var ne=[],le=0,be;be=_e[le++];)ne.push(n.parse(k,be,j,F,J,te));return ne.remove=function(){for(var je=0;je<ne.length;je++)ne[je].remove()},ne}return F(k,ae,j,J,te)};var r=/^touch/;function h(k,ae,j,F,J){var te=ae.match(/(.*):(.*)/);if(te)return ae=te[2],te=te[1],n.selector(te,ae).call(J,k,j);if(_("touch")&&(r.test(ae)&&(j=Y(j)),!_("event-orientationchange")&&ae=="orientationchange"&&(ae="resize",k=window,j=Y(j))),M&&(j=M(j)),k.addEventListener){var _e=ae in x,ne=_e?x[ae]:ae;return k.addEventListener(ne,j,_e),{remove:function(){k.removeEventListener(ne,j,_e)}}}if(ae="on"+ae,z&&k.attachEvent)return z(k,ae,j);throw new Error("Target must be an event emitter")}n.matches=function(k,ae,j,F,J){for(J=J&&typeof J.matches=="function"?J:N.query,F=F!==!1,k.nodeType!=1&&(k=k.parentNode);!J.matches(k,ae,j);)if(k==j||F===!1||!(k=k.parentNode)||k.nodeType!=1)return!1;return k},n.selector=function(k,ae,j){return function(F,J){var te=typeof k=="function"?{matches:k}:this,_e=ae.bubble;function ne(le){return n.matches(le,k,F,j,te)}return _e?n(F,_e(ne),J):n(F,ae,function(le){var be=ne(le.target);if(be)return le.selectorTarget=be,J.call(be,le)})}};function u(){this.cancelable=!1,this.defaultPrevented=!0}function g(){this.bubbles=!1}var p=[].slice,y=n.emit=function(k,ae,j){var F=p.call(arguments,2),J="on"+ae;if("parentNode"in k){var te=F[0]={};for(var _e in j)te[_e]=j[_e];te.preventDefault=u,te.stopPropagation=g,te.target=k,te.type=ae,j=te}do k[J]&&k[J].apply(k,F);while(j&&j.bubbles&&(k=k.parentNode));return j&&j.cancelable&&j},x=_("event-focusin")?{}:{focusin:"focus",focusout:"blur"};if(!_("event-stopimmediatepropagation"))var w=function(){this.immediatelyStopped=!0,this.modified=!0},M=function(k){return function(ae){if(!ae.immediatelyStopped)return ae.stopImmediatePropagation=w,k.apply(this,arguments)}};if(_("dom-addeventlistener"))n.emit=function(k,ae,j){if(k.dispatchEvent&&document.createEvent){var F=k.ownerDocument||document,J=F.createEvent("HTMLEvents");J.initEvent(ae,!!j.bubbles,!!j.cancelable);for(var te in j)te in J||(J[te]=j[te]);return k.dispatchEvent(J)&&J}return y.apply(n,arguments)};else{n._fixEvent=function(k,ae){if(!k){var j=ae&&(ae.ownerDocument||ae.document||ae).parentWindow||window;k=j.event}if(!k)return k;try{T&&k.type==T.type&&k.srcElement==T.target&&(k=T)}catch(J){}if(!k.target)switch(k.target=k.srcElement,k.currentTarget=ae||k.srcElement,k.type=="mouseover"&&(k.relatedTarget=k.fromElement),k.type=="mouseout"&&(k.relatedTarget=k.toElement),k.stopPropagation||(k.stopPropagation=q,k.preventDefault=P),k.type){case"keypress":var F="charCode"in k?k.charCode:k.keyCode;F==10?(F=0,k.keyCode=13):F==13||F==27?F=0:F==3&&(F=99),k.charCode=F,H(k);break}return k};var T,A=function(k){this.handle=k};A.prototype.remove=function(){delete _dojoIEListeners_[this.handle]};var C=function(k){return function(ae){ae=n._fixEvent(ae,this);var j=k.call(this,ae);return ae.modified&&(T||setTimeout(function(){T=null}),T=ae),j}},z=function(k,ae,j){if(j=C(j),((k.ownerDocument?k.ownerDocument.parentWindow:k.parentWindow||k.window||window)!=top||_("jscript")<5.8)&&!_("config-_allow_leaks")){typeof _dojoIEListeners_>"u"&&(_dojoIEListeners_=[]);var F=k[ae];if(!F||!F.listeners){var J=F;F=Function("event","var callee = arguments.callee; for(var i = 0; i<callee.listeners.length; i++){var listener = _dojoIEListeners_[callee.listeners[i]]; if(listener){listener.call(this,event);}}"),F.listeners=[],k[ae]=F,F.global=this,J&&F.listeners.push(_dojoIEListeners_.push(J)-1)}var te;return F.listeners.push(te=F.global._dojoIEListeners_.push(j)-1),new A(te)}return d.after(k,ae,j,!0)},H=function(k){k.keyChar=k.charCode?String.fromCharCode(k.charCode):"",k.charOrCode=k.keyChar||k.keyCode},q=function(){this.cancelBubble=!0},P=n._preventDefault=function(){if(this.bubbledKeyCode=this.keyCode,this.ctrlKey)try{this.keyCode=0}catch(k){}this.defaultPrevented=!0,this.returnValue=!1,this.modified=!0}}if(_("touch"))var Z=function(){},K=window.orientation,Y=function(k){return function(ae){var j=ae.corrected;if(!j){var F=ae.type;try{delete ae.type}catch(ne){}if(ae.type){if(_("touch-can-modify-event-delegate"))Z.prototype=ae,j=new Z;else{j={};for(var J in ae)j[J]=ae[J]}j.preventDefault=function(){ae.preventDefault()},j.stopPropagation=function(){ae.stopPropagation()}}else j=ae,j.type=F;if(ae.corrected=j,F=="resize")return K==window.orientation?null:(K=window.orientation,j.type="orientationchange",k.call(this,j));if("rotation"in j||(j.rotation=0,j.scale=1),window.TouchEvent&&ae instanceof TouchEvent){var te=j.changedTouches[0];for(var _e in te)delete j[_e],j[_e]=te[_e]}}return k.call(this,j)}};return n},D,V),D.exports=B},2749:(D,V,f)=>{var R,B;R=[f(1873)],B=f.dj.d(R,function(d){"use strict";function N(){throw new TypeError("abstract")}return d.extend(function(){},{then:function(_,l,n){N()},cancel:function(_,l){N()},isResolved:function(){N()},isRejected:function(){N()},isFulfilled:function(){N()},isCanceled:function(){N()},finally:function(_){return this.then(function(l){var n=_();return n&&typeof n.then=="function"?n.then(function(){return l}):l},function(l){var n=_();if(n&&typeof n.then=="function")return n.then(function(){throw l});throw l})},always:function(_){return this.then(_,_)},catch:function(_){return this.then(null,_)},otherwise:function(_){return this.then(null,_)},trace:function(){return this},traceRejected:function(){return this},toString:function(){return"[object Promise]"}})},D,V),D.exports=B},819:(D,V,f)=>{var R,B;R=[f(2570),f(9424),f(640),f(9178)],B=f.dj.d(R,function(d,N,_,l){l.add("activex",typeof ActiveXObject<"u"),l.add("dom-parser",function(g){return"DOMParser"in g});let n;if(l("activex")){const g=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML.DOMDocument"];let p;n=function(y){let x=y.data;const w=y.text;x&&!x.querySelectorAll&&l("dom-parser")&&(x=new DOMParser().parseFromString(w,"application/xml"));function M(T){try{const A=new ActiveXObject(T);A.async=!1,A.loadXML(w),x=A,p=T}catch(A){return!1}return!0}return(!x||!x.documentElement)&&(!p||!M(p))&&_.some(g,M),x}}const r=function(g){return!l("native-xhr2-blob")&&g.options.handleAs==="blob"&&typeof Blob<"u"?new Blob([g.xhr.response],{type:g.xhr.getResponseHeader("Content-Type")}):g.xhr.response},h={javascript:function(g){return N.eval(g.text||"")},json:function(g){return d.parse(g.text||null)},xml:n,blob:r,arraybuffer:r,document:r};function u(g){const p=h[g.options.handleAs];return g.data=p?p(g):g.data||g.text,g}return u.register=function(g,p){h[g]=p},u},D,V),D.exports=B},5665:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__.dj.m(module),__webpack_require__(1563),__webpack_require__(3638),__webpack_require__(9424),__webpack_require__(640),__webpack_require__(1873),__webpack_require__(1929),__webpack_require__(3458),__webpack_require__(2490),__webpack_require__(9178),__webpack_require__(8145)],__WEBPACK_AMD_DEFINE_RESULT__=__webpack_require__.dj.d(__WEBPACK_AMD_DEFINE_ARRAY__,function(module,watch,util,kernel,array,lang,on,dom,domConstruct,has,win){has.add("script-readystatechange",function(D,V){var f=V.createElement("script");return typeof f.onreadystatechange<"u"&&(typeof D.opera>"u"||D.opera.toString()!=="[object Opera]")});var mid=module.id.replace(/[\/\.\-]/g,"_"),counter=0,loadEvent=has("script-readystatechange")?"readystatechange":"load",readyRegExp=/complete|loaded/,callbacks=kernel.global[mid+"_callbacks"]={},deadScripts=[];function attach(D,V,f,R){var B=f||win.doc,d=B.createElement("script");R&&on.once(d,"error",R),d.type="text/javascript";try{d.src=V}catch(N){R&&R(d)}return d.id=D,d.async=!0,d.charset="utf-8",B.getElementsByTagName("head")[0].appendChild(d)}function remove(D,V,f){domConstruct.destroy(dom.byId(D,V)),callbacks[D]&&(f?callbacks[D]=function(){delete callbacks[D]}:delete callbacks[D])}function _addDeadScript(D){var V=D.response.options,f=V.ioArgs?V.ioArgs.frameDoc:V.frameDoc;deadScripts.push({id:D.id,frameDoc:f}),V.ioArgs&&(V.ioArgs.frameDoc=null),V.frameDoc=null}function canceler(D,V){D.canDelete&&script._remove(D.id,V.options.frameDoc,!0)}function isValid(D){return deadScripts&&deadScripts.length&&(array.forEach(deadScripts,function(V){script._remove(V.id,V.frameDoc),V.frameDoc=null}),deadScripts=[]),D.options.jsonp?!D.data:!0}function isReadyScript(D){return!!this.scriptLoaded}function isReadyCheckString(response){var checkString=response.options.checkString;return checkString&&eval("typeof("+checkString+') !== "undefined"')}function handleResponse(D,V){this.canDelete&&_addDeadScript(this),V?this.reject(V):this.resolve(D)}function script(D,V,f){var R=util.parseArgs(D,util.deepCopy({},V));D=R.url,V=R.options;var B=util.deferred(R,canceler,isValid,V.jsonp?null:V.checkString?isReadyCheckString:isReadyScript,handleResponse);if(lang.mixin(B,{id:mid+counter++,canDelete:!1}),V.jsonp){var d=new RegExp("[?&]"+V.jsonp+"=");d.test(D)||(D+=(~D.indexOf("?")?"&":"?")+V.jsonp+"="+(V.frameDoc?"parent.":"")+mid+"_callbacks."+B.id),B.canDelete=!0,callbacks[B.id]=function(l){R.data=l,B.handleResponse(R)}}if(util.notify&&util.notify.emit("send",R,B.promise.cancel),!V.canAttach||V.canAttach(B)){var N=script._attach(B.id,D,V.frameDoc,function(l){if(!(l instanceof Error)){var n=new Error("Error loading "+(l.target?l.target.src:"script"));n.source=l,l=n}B.reject(l),script._remove(B.id,V.frameDoc,!0)});if(!V.jsonp&&!V.checkString)var _=on(N,loadEvent,function(l){(l.type==="load"||readyRegExp.test(N.readyState))&&(_.remove(),B.scriptLoaded=l)})}return watch(B),f?B:B.promise}return script.get=script,script._attach=attach,script._remove=remove,script._callbacksProperty=mid+"_callbacks",script},module,exports),module.exports=__WEBPACK_AMD_DEFINE_RESULT__},3638:(D,V,f)=>{var R,B;R=[V,f(5867),f(7800),f(4371),f(7841),f(640),f(1873),f(2749),f(9178)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u,g){function p(z){return g("native-arraybuffer")&&z instanceof ArrayBuffer}function y(z){return g("native-blob")&&z instanceof Blob}function x(z){return typeof Element<"u"?z instanceof Element:z.nodeType===1}function w(z){return g("native-formdata")&&z instanceof FormData}function M(z){return z&&typeof z=="object"&&!w(z)&&!x(z)&&!y(z)&&!p(z)}d.deepCopy=function(z,H){for(var q in H){var P=z[q],Z=H[q];q!=="__proto__"&&P!==Z&&(M(Z)?Object.prototype.toString.call(Z)==="[object Date]"?z[q]=new Date(Z):h.isArray(Z)?z[q]=d.deepCopyArray(Z):P&&typeof P=="object"?d.deepCopy(P,Z):z[q]=d.deepCopy({},Z):z[q]=Z)}return z},d.deepCopyArray=function(z){for(var H=[],q=0,P=z.length;q<P;q++){var Z=z[q];typeof Z=="object"?H.push(d.deepCopy({},Z)):H.push(Z)}return H},d.deepCreate=function(H,q){q=q||{};var P=h.delegate(H),Z,K;for(Z in H)K=H[Z],K&&typeof K=="object"&&(P[Z]=d.deepCreate(K,q[Z]));return d.deepCopy(P,q)};var T=Object.freeze||function(z){return z};function A(z){return T(z)}function C(z){return z.data!==void 0?z.data:z.text}d.deferred=function(H,q,P,Z,K,Y){var k=new l(function(_e){return q&&q(k,H),!_e||!(_e instanceof N)&&!(_e instanceof _)?new _("Request canceled",H):_e});k.response=H,k.isValid=P,k.isReady=Z,k.handleResponse=K;function ae(_e){throw _e.response=H,_e}var j=k.then(A).otherwise(ae);d.notify&&j.then(h.hitch(d.notify,"emit","load"),h.hitch(d.notify,"emit","error"));var F=j.then(C),J=new u;for(var te in F)F.hasOwnProperty(te)&&(J[te]=F[te]);return J.response=j,T(J),Y&&k.then(function(_e){Y.call(k,_e)},function(_e){Y.call(k,H,_e)}),k.promise=J,k.then=J.then,k},d.addCommonMethods=function(H,q){r.forEach(q||["GET","POST","PUT","DELETE"],function(P){H[(P==="DELETE"?"DEL":P).toLowerCase()]=function(Z,K){return K=h.delegate(K||{}),K.method=P,H(Z,K)}})},d.parseArgs=function(H,q,P){var Z=q.data,K=q.query;return Z&&!P&&typeof Z=="object"&&(!g("native-xhr2")||!(p(Z)||y(Z)))&&(q.data=n.objectToQuery(Z)),K?(typeof K=="object"&&(K=n.objectToQuery(K)),q.preventCache&&(K+=(K?"&":"")+"request.preventCache="+ +new Date)):q.preventCache&&(K="request.preventCache="+ +new Date),H&&K&&(H+=(~H.indexOf("?")?"&":"?")+K),{url:H,options:q,getHeader:function(Y){return null}}},d.checkStatus=function(z){return z=z||0,z>=200&&z<300||z===304||z===1223||!z}},D,V),D.exports=B},1563:(D,V,f)=>{var R,B;R=[f(3638),f(6930),f(7800),f(640),f(8145)],B=f.dj.d(R,function(d,N,_,l,n){let r=null;const h=[];function u(){const p=+new Date;for(var y=0,x;y<h.length&&(x=h[y]);y++){const w=x.response,M=w.options;x.isCanceled&&x.isCanceled()||x.isValid&&!x.isValid(w)?(h.splice(y--,1),g._onAction&&g._onAction()):x.isReady&&x.isReady(w)?(h.splice(y--,1),x.handleResponse(w),g._onAction&&g._onAction()):x.startTime&&x.startTime+(M.timeout||0)<p&&(h.splice(y--,1),x.cancel(new N("Timeout exceeded",w)),g._onAction&&g._onAction())}g._onInFlight&&g._onInFlight(x),h.length||(clearInterval(r),r=null)}function g(p){p.response.options.timeout&&(p.startTime=+new Date),!p.isFulfilled()&&(h.push(p),r||(r=setInterval(u,50)),p.response.options.sync&&u())}return g.cancelAll=function(){try{l.forEach(h,function(y){try{y.cancel(new _("All requests canceled."))}catch(x){}})}catch(y){}},g},D,V),D.exports=B},9810:(D,V,f)=>{var R,B;R=[f(5867),f(1563),f(819),f(3638),f(9178)],B=f.dj.d(R,function(d,N,_,l,n){n.add("native-xhr",function(){return typeof XMLHttpRequest<"u"}),n.add("dojo-force-activex-xhr",function(){return n("activex")&&window.location.protocol==="file:"}),n.add("native-xhr2",function(){if(!(!n("native-xhr")||n("dojo-force-activex-xhr"))){var A=new XMLHttpRequest;return typeof A.addEventListener<"u"&&(typeof opera>"u"||typeof A.upload<"u")}}),n.add("native-formdata",function(){return typeof FormData<"u"}),n.add("native-blob",function(){return typeof Blob<"u"}),n.add("native-arraybuffer",function(){return typeof ArrayBuffer<"u"}),n.add("native-response-type",function(){return n("native-xhr")&&typeof new XMLHttpRequest().responseType<"u"}),n.add("native-xhr2-blob",function(){if(n("native-response-type"))return!0});var r={blob:n("native-xhr2-blob")?"blob":"arraybuffer",document:"document",arraybuffer:"arraybuffer"};function h(A,C){var z=A.xhr;A.status=A.xhr.status;try{A.text=z.responseText}catch(q){}A.options.handleAs==="xml"&&(A.data=z.responseXML);var H;if(C)this.reject(C);else{try{_(A)}catch(q){H=q}l.checkStatus(z.status)?H?this.reject(H):this.resolve(A):H?(C=new d("Unable to load "+A.url+" status: "+z.status+" and an error in handleAs: transformation of response",A),this.reject(C)):(C=new d("Unable to load "+A.url+" status: "+z.status,A),this.reject(C))}}var u,g,p,y;n("native-xhr2")?(u=function(A){return!this.isFulfilled()},y=function(A,C){C.xhr.abort()},p=function(A,C,z,H){function q(k){C.handleResponse(z)}function P(k){var ae=k.target,j=new d("Unable to load "+z.url+" status: "+ae.status,z);C.handleResponse(z,j)}function Z(k,ae){z.transferType=k,ae.lengthComputable?(z.loaded=ae.loaded,z.total=ae.total,C.progress(z)):z.xhr.readyState===3&&(z.loaded="loaded"in ae?ae.loaded:ae.position,C.progress(z))}function K(k){return Z("download",k)}function Y(k){return Z("upload",k)}return A.addEventListener("load",q,!1),A.addEventListener("error",P,!1),A.addEventListener("progress",K,!1),H&&A.upload&&A.upload.addEventListener("progress",Y,!1),function(){A.removeEventListener("load",q,!1),A.removeEventListener("error",P,!1),A.removeEventListener("progress",K,!1),A.upload.removeEventListener("progress",Y,!1),A=null}}):(u=function(A){return A.xhr.readyState},g=function(A){return A.xhr.readyState===4},y=function(A,C){var z=C.xhr,H=typeof z.abort;(H==="function"||H==="object"||H==="unknown")&&z.abort()});function x(A){return this.xhr.getResponseHeader(A)}var w,M={data:null,query:null,sync:!1,method:"GET"};function T(A,C,z){var H=n("native-formdata")&&C&&C.data&&C.data instanceof FormData,q=l.parseArgs(A,l.deepCreate(M,C),H);A=q.url,C=q.options;var P=!C.data&&C.method!=="POST"&&C.method!=="PUT";n("ie")<=10&&(A=A.split("#")[0]);var Z,K=function(){Z&&Z()},Y=l.deferred(q,y,u,g,h,K),k=q.xhr=T._create();if(!k)return Y.cancel(new d("XHR was not created")),z?Y:Y.promise;q.getHeader=x,p&&(Z=p(k,Y,q,C.uploadProgress));var ae=typeof C.data>"u"?null:C.data,j=!C.sync,F=C.method;try{k.open(F,A,j,C.user||w,C.password||w),C.withCredentials&&(k.withCredentials=C.withCredentials),n("native-response-type")&&C.handleAs in r&&(k.responseType=r[C.handleAs]);var J=C.headers,te=H||P?!1:"application/x-www-form-urlencoded";if(J)for(var _e in J)_e.toLowerCase()==="content-type"?te=J[_e]:J[_e]&&k.setRequestHeader(_e,J[_e]);te&&te!==!1&&k.setRequestHeader("Content-Type",te),(!J||!("X-Requested-With"in J))&&k.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.notify&&l.notify.emit("send",q,Y.promise.cancel),k.send(ae)}catch(ne){Y.reject(ne)}return N(Y),k=null,z?Y:Y.promise}if(T._create=function(){throw new Error("XMLHTTP not available")},n("native-xhr")&&!n("dojo-force-activex-xhr"))T._create=function(){return new XMLHttpRequest};else if(n("activex"))try{new ActiveXObject("Msxml2.XMLHTTP"),T._create=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(A){try{new ActiveXObject("Microsoft.XMLHTTP"),T._create=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(C){}}return l.addCommonMethods(T),T},D,V),D.exports=B},3994:(D,V,f)=>{var R,B;R=[f(9178)],B=f.dj.d(R,function(d){if(d("host-browser")){var N=navigator,_=N.userAgent,l=N.appVersion,n=parseFloat(l);if(d.add("air",_.indexOf("AdobeAIR")>=0),d.add("wp",parseFloat(_.split("Windows Phone")[1])||void 0),d.add("msapp",parseFloat(_.split("MSAppHost/")[1])||void 0),d.add("khtml",l.indexOf("Konqueror")>=0?n:void 0),d.add("edge",parseFloat(_.split("Edge/")[1])||void 0),d.add("opr",parseFloat(_.split("OPR/")[1])||void 0),d.add("webkit",!d("wp")&&!d("edge")&&parseFloat(_.split("WebKit/")[1])||void 0),d.add("chrome",!d("edge")&&!d("opr")&&parseFloat(_.split("Chrome/")[1])||void 0),d.add("android",!d("wp")&&parseFloat(_.split("Android ")[1])||void 0),d.add("safari",l.indexOf("Safari")>=0&&!d("wp")&&!d("chrome")&&!d("android")&&!d("edge")&&!d("opr")?parseFloat(l.split("Version/")[1]):void 0),d.add("mac",l.indexOf("Macintosh")>=0),d.add("quirks",document.compatMode=="BackCompat"),!d("wp")&&_.match(/(iPhone|iPod|iPad)/)){var r=RegExp.$1.replace(/P/,"p"),h=_.match(/OS ([\d_]+)/)?RegExp.$1:"1",u=parseFloat(h.replace(/_/,".").replace(/_/g,""));d.add(r,u),d.add("ios",u)}if(d.add("bb",(_.indexOf("BlackBerry")>=0||_.indexOf("BB10")>=0)&&parseFloat(_.split("Version/")[1])||void 0),d.add("trident",parseFloat(l.split("Trident/")[1])||void 0),d.add("svg",typeof SVGAngle<"u"),!d("webkit")){if(_.indexOf("Opera")>=0&&d.add("opera",n>=9.8&&parseFloat(_.split("Version/")[1])||n),_.indexOf("Gecko")>=0&&!d("wp")&&!d("khtml")&&!d("trident")&&!d("edge")&&d.add("mozilla",n),d("mozilla")&&d.add("ff",parseFloat(_.split("Firefox/")[1]||_.split("Minefield/")[1])||void 0),document.all&&!d("opera")){var g=parseFloat(l.split("MSIE ")[1])||void 0,p=document.documentMode;p&&p!=5&&Math.floor(g)!=p&&(g=p),d.add("ie",g)}d.add("wii",typeof opera<"u"&&opera.wiiremote)}}return d},D,V),D.exports=B},7505:(D,V,f)=>{var R,B;R=[f(3543)],B=f.dj.d(R,function(d){var N=new d;return{publish:function(_,l){return N.emit.apply(N,arguments)},subscribe:function(_,l){return N.on.apply(N,arguments)}}},D,V),D.exports=B},1636:(D,V,f)=>{var R,B;R=[f(4371),f(2749)],B=f.dj.d(R,function(d,N){"use strict";return function(l,n,r,h){var u=l&&typeof l.then=="function",g=u&&l instanceof N;if(u){if(!g){var p=new d(l.cancel);l.then(p.resolve,p.reject,p.progress),l=p.promise}}else return arguments.length>1?n?n(l):l:new d().resolve(l);return n||r||h?l.then(n,r,h):l}},D,V),D.exports=B},2012:D=>{D.exports=function(V,f,R,B){this.loaderVersion="1.17.1",function(d,N){var _=function(){return typeof A<"u"&&typeof A!="function"?A:typeof B<"u"?this&&this.dojoConfig&&!B.dojoConfig?this:B:typeof self<"u"?self:this}(),l=function(){},n=function(Fe){for(var it in Fe)return 0;return 1},r={}.toString,h=function(Fe){return r.call(Fe)=="[object Function]"},u=function(Fe){return r.call(Fe)=="[object String]"},g=function(Fe){return r.call(Fe)=="[object Array]"},p=function(Fe,it){if(Fe)for(var Ke=0;Ke<Fe.length;)it(Fe[Ke++])},y=function(Fe,it){for(var Ke in it)Fe[Ke]=it[Ke];return Fe},x=function(Fe,it){return y(new Error(Fe),{src:"dojoLoader",info:it})},w=1,M=function(){return"_"+w++},T=function(Fe,it,Ke){return ui(Fe,it,Ke,0,T)},A=_,C=A.document,z=C&&C.createElement("DiV"),H=T.has=function(Fe){return h(q[Fe])?q[Fe]=q[Fe](A,C,z):q[Fe]},q=H.cache=N.hasCache;if(h(d)&&(d=d(_)),H.add=function(Fe,it,Ke,vt){return(q[Fe]===void 0||vt)&&(q[Fe]=it),Ke&&H(Fe)},0)var P,Z,K,Y;for(var k in d.has)H.add(k,d.has[k],0,1);var ae=1,j=2,F=3,J=4,te=5,_e=0,ne="sync",le="xd",be=[],je=0,ze=l,Re=l,nt;if(0)var $e,_t,Y,Ut,Zt;else T.async=1;var oi=function(){};T.eval=function(Fe,it){return oi(Fe+`\r
//# sourceURL=`+it)};var Nt={},Vn="error",_i=T.signal=function(Fe,it){var Ke=Nt[Fe];p(Ke&&Ke.slice(0),function(vt){vt.apply(null,g(it)?it:[it])})},Wn=T.on=function(Fe,it){var Ke=Nt[Fe]||(Nt[Fe]=[]);return Ke.push(it),{remove:function(){for(var vt=0;vt<Ke.length;vt++)if(Ke[vt]===it){Ke.splice(vt,1);return}}}},Gn=[],ms={},In=[],bt={},Sn=T.map={},ji=[],un={},Vi="",Hn={},ks="url:",Vs={},gi={},Ne=0;if(0)var Wi;var bi=function(Fe){return Fe.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(it){return"\\"+it})},Kn=function(Fe,it){it.splice(0,it.length);for(var Ke in Fe)it.push([Ke,Fe[Ke],new RegExp("^"+bi(Ke)+"(/|$)"),Ke.length]);return it.sort(function(vt,$n){return $n[3]-vt[3]}),it},mr=function(Fe,it){p(Fe,function(Ke){it.push([u(Ke[0])?new RegExp("^"+bi(Ke[0])+"$"):Ke[0],Ke[1]])})},Si=function(Fe){var it=Fe.name;it||(it=Fe,Fe={name:it}),Fe=y({main:"main"},Fe),Fe.location=Fe.location?Fe.location:it,Fe.packageMap&&(Sn[it]=Fe.packageMap),Fe.main.indexOf("./")||(Fe.main=Fe.main.substring(2)),bt[it]=Fe},Tt=[],en=function(Fe,it,Ke){for(var vt in Fe){if(vt=="waitSeconds"&&(T.waitms=(Fe[vt]||0)*1e3),vt=="cacheBust"&&(Vi=Fe[vt]?u(Fe[vt])?Fe[vt]:new Date().getTime()+"":""),(vt=="baseUrl"||vt=="combo")&&(T[vt]=Fe[vt]),0)var $n;Fe[vt]!==q&&(T.rawConfig[vt]=Fe[vt],vt!="has"&&H.add("config-"+vt,Fe[vt],0,it))}T.baseUrl||(T.baseUrl="./"),/\/$/.test(T.baseUrl)||(T.baseUrl+="/");for(vt in Fe.has)H.add(vt,Fe.has[vt],0,it);p(Fe.packages,Si);for(var Nn in Fe.packagePaths)p(Fe.packagePaths[Nn],function(qt){var Fi=Nn+"/"+qt;u(qt)&&(qt={name:qt}),qt.location=Fi,Si(qt)});if(Kn(y(Sn,Fe.map),ji),p(ji,function(qt){qt[1]=Kn(qt[1],[]),qt[0]=="*"&&(ji.star=qt)}),Kn(y(ms,Fe.paths),In),mr(Fe.aliases,Gn),0)var Bi;_i("config",[Fe,T.rawConfig])};if(0)var Yn,Y,dt,He,Gi,Wt;if(0)var Hi;if(T.rawConfig={},en(N,1),en(d,1),en(gi,1),0)var pa,ui,_s,Ft,tn,Xn,ni,se,Zn,Ws,xi,Li;var li=function(Fe,it){if(it){for(var Ke=0;Ke<it.length;Ke++)if(it[Ke][2].test(Fe))return it[Ke]}return 0},On=function(Fe){var it=[],Ke,vt;for(Fe=Fe.replace(/\\/g,"/").split("/");Fe.length;)Ke=Fe.shift(),Ke==".."&&it.length&&vt!=".."?(it.pop(),vt=it[it.length-1]):Ke!="."&&it.push(vt=Ke);return it.join("/")},Ki=function(Fe,it,Ke,vt){if(0)var $n;else return{pid:Fe,mid:it,pack:Ke,url:vt,executed:0,def:0}},Yi=function(Fe,it,Ke,vt,$n,Nn,Bi,qt,Fi,vr){var Ai,Xi,Fn,Ci,ln,Cn,es,wi;if(wi=Fe,es=/^\./.test(Fe),/(^\/)|(\:)|(\.js$)/.test(Fe)||es&&!it)return Ki(0,Fe,0,Fe);if(Fe=On(es?it.mid+"/../"+Fe:Fe),/^\./.test(Fe))throw x("irrationalPath",Fe);!vr&&!es&&Nn.star&&(Ci=li(Fe,Nn.star[1])),!Ci&&it&&(Ci=li(it.mid,Nn),Ci=Ci&&li(Fe,Ci[1])),Ci&&(Fe=Ci[1]+Fe.substring(Ci[3])),Wt=Fe.match(/^([^\/]+)(\/(.+))?$/),Ai=Wt?Wt[1]:"",(Xi=Ke[Ai])?Fe=Ai+"/"+(Fn=Wt[3]||Xi.main):Ai="";var Ro=0,Gt=0;return p(qt,function(ts){var zi=Fe.match(ts[0]);zi&&zi.length>Ro&&(Gt=h(ts[1])?Fe.replace(ts[0],ts[1]):ts[1])}),Gt?Yi(Gt,0,Ke,vt,$n,Nn,Bi,qt,Fi):(Cn=vt[Fe],Cn?Fi?Ki(Cn.pid,Cn.mid,Cn.pack,Cn.url):vt[Fe]:(Ci=li(Fe,Bi),Ci?ln=Ci[1]+Fe.substring(Ci[3]):Ai?ln=(Xi.location.slice(-1)==="/"?Xi.location.slice(0,-1):Xi.location)+"/"+Fn:ln=Fe,/(^\/)|(\:)/.test(ln)||(ln=$n+ln),ln+=".js",Ki(Ai,Fe,Xi,On(ln))))},dn=function(Fe,it,Ke){return Yi(Fe,it,bt,un,T.baseUrl,ji,In,Gn,void 0,Ke)};if(0)var fn,nn,pn;var qn=T.toAbsMid=function(Fe,it){return dn(Fe,it).mid},gs=T.toUrl=function(Fe,it){var Ke=dn(Fe+"/x",it),vt=Ke.url;return Q(Ke.pid===0?Fe:vt.substring(0,vt.length-5))};if(0)var Qn,En,Gs,_r,mn,sn,vs,ys,_n,Jn,bs,Hs,rn,ht,An,Pi;var Q=typeof d.fixupUrl=="function"?d.fixupUrl:function(Fe){return Fe+="",Fe+(Vi?(/\?/.test(Fe)?"&":"?")+Vi:"")};if(0)var ge,Se,Be,Ge,Je,lt,ft,Ot;var Di=0,Ri=l,an=l;if(0)var Yn,Y,dt,Ei,gr;if(T.log=l,0)var Ks;else T.trace=l;if(0)var ma;else var ma=l;if(y(y(T,N.loaderPatch),d.loaderPatch),Wn(Vn,function(Fe){try{if(console.error(Fe),Fe instanceof Error){for(var it in Fe)console.log(it+":",Fe[it]);console.log(".")}}catch(Ke){}}),y(T,{uid:M,cache:Hn,packs:bt}),!A.define){if(A.define=ma,A.require=T,0)var Xl,Lo;if(0)var Po,Do}}.call(this,V,f)}},7342:D=>{D.exports=void 0},8161:(D,V,f)=>{var R,B;R=[f(7207),f(275),f(7342)],B=f.dj.d(R,function(d,N){return N(d,"",f.dj.c(),!0)},D,V),D.exports=B},245:(D,V,f)=>{var R,B;R=[f(3812),f(275),f(7342)],B=f.dj.d(R,function(d,N){return N(d,"",f.dj.c(),!0)},D,V),D.exports=B},275:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){return function(d,N,_,l){var n,r,h;if(d.load(N,_,function(u){r=u,h=!0,n&&n(u)},{isBuild:!0}),h)return r;if(!l)throw new Error(N+" unavailable");return r=new Promise(function(u){n=u}),r.__DOJO_WEBPACK_DEFINE_PROMISE__=!0,r}},D,V),D.exports=B},7723:(D,V,f)=>{var R,B;R=[f(3553)],B=f.dj.d(R,function(d){"use strict";var N={};return N.default=d.AckExtension=function(){let _,l=!1,n;function r(h,u){_._debug(h,u)}this.registered=(h,u)=>{_=u,r("AckExtension: executing registration callback")},this.unregistered=()=>{r("AckExtension: executing unregistration callback"),_=null},this.incoming=h=>{const u=h.channel,g=h.ext;if(u==="/meta/handshake"){if(g){const p=g.ack;if(typeof p=="object"){l=p.enabled===!0;const y=p.batch;typeof y=="number"&&(n=y)}else l=p===!0}r("AckExtension: server supports acknowledgements",l)}else u==="/meta/connect"&&h.successful&&l&&g&&typeof g.ack=="number"&&(n=g.ack,r("AckExtension: server sent batch",n));return h},this.outgoing=h=>{const u=h.channel;return h.ext||(h.ext={}),u==="/meta/handshake"?(h.ext.ack=_&&_.ackEnabled!==!1,l=!1,n=0):u==="/meta/connect"&&l&&(h.ext.ack=n,r("AckExtension: client sending batch",n)),h}},N.default},D,V),D.exports=B},3553:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};function N(){let T=0;const A={};this.register=C=>{const z=++T;return A[z]=C,z},this.unregister=C=>{const z=A[C];return delete A[C],z},this.setTimeout=(C,z)=>window.setTimeout(C,z),this.clearTimeout=C=>{window.clearTimeout(C)}}function _(){const T={};self.onmessage=A=>{const C=A.data,z=T[C.id];switch(C.type){case"setTimeout":T[C.id]=self.setTimeout(()=>{delete T[C.id],self.postMessage({id:C.id})},C.delay);break;case"clearTimeout":delete T[C.id],z&&self.clearTimeout(z);break;default:throw"Unknown command "+C.type}}}const l={isString:T=>T==null?!1:typeof T=="string"||T instanceof String};function n(){let T=[],A={};this.getTransportTypes=()=>T.slice(0),this.findTransportTypes=(C,z,H)=>{const q=[];for(let P=0;P<T.length;++P){const Z=T[P];A[Z].accept(C,z,H)===!0&&q.push(Z)}return q},this.negotiateTransport=(C,z,H,q)=>{for(let P=0;P<T.length;++P){const Z=T[P];for(let K=0;K<C.length;++K)if(Z===C[K]){const Y=A[Z];if(Y.accept(z,H,q)===!0)return Y}}return null},this.add=(C,z,H)=>{let q=!1;for(let P=0;P<T.length;++P)if(T[P]===C){q=!0;break}return q||(typeof H!="number"?T.push(C):T.splice(H,0,C),A[C]=z),!q},this.find=C=>{for(let z=0;z<T.length;++z)if(T[z]===C)return A[C];return null},this.remove=C=>{for(let z=0;z<T.length;++z)if(T[z]===C){T.splice(z,1);const H=A[C];return delete A[C],H}return null},this.clear=()=>{T=[],A={}},this.reset=C=>{for(let z=0;z<T.length;++z)A[T[z]].reset(C)}}function r(){let T,A,C;this.registered=(z,H)=>{T=z,A=H},this.unregistered=()=>{T=null,A=null},this._notifyTransportTimeout=function(z){const H=A._getTransportListeners("timeout");if(H)for(let q=0;q<H.length;++q){const P=H[q];try{const Z=P.call(this,z);if(typeof Z=="number"&&Z>0)return Z}catch(Z){this._info("Exception during execution of transport listener",P,Z)}}return 0},this._debug=function(){A._debug.apply(A,arguments)},this._info=function(){A._info.apply(A,arguments)},this._mixin=function(){return A._mixin.apply(A,arguments)},this.getConfiguration=()=>A.getConfiguration(),this.getAdvice=()=>A.getAdvice(),this.setTimeout=(z,H)=>A.setTimeout(z,H),this.clearTimeout=z=>{A.clearTimeout(z)},this.convertToJSON=function(z){const H=this.getConfiguration().maxSendBayeuxMessageSize;let q="[";for(let P=0;P<z.length;++P){P>0&&(q+=",");const Z=z[P],K=JSON.stringify(Z);if(K.length>H)throw"maxSendBayeuxMessageSize "+H+" exceeded";q+=K}return q+="]",q},this.convertToMessages=function(z){if(l.isString(z))try{return JSON.parse(z)}catch(H){throw this._debug("Could not convert to JSON the following string",'"'+z+'"'),H}if(Array.isArray(z))return z;if(z==null)return[];if(z instanceof Object)return[z];throw"Conversion Error "+z+", typeof "+typeof z},this.accept=(z,H,q)=>{throw"Abstract"},this.getType=()=>T,this.getURL=()=>C,this.setURL=z=>{C=z},this.send=(z,H)=>{throw"Abstract"},this.reset=function(z){this._debug("Transport",T,"reset",z?"initial":"retry")},this.abort=function(){this._debug("Transport",T,"aborted")},this.toString=function(){return this.getType()}}r.derive=T=>{function A(){}return A.prototype=T,new A};function h(){const T=new r,A=r.derive(T);let C=0,z=null,H=[],q=[];function P(F){for(;q.length>0;){const J=q[0],te=J[0],_e=J[1];if(te.url===F.url&&te.sync===F.sync){q.shift(),F.messages=F.messages.concat(te.messages),this._debug("Coalesced",te.messages.length,"messages from request",_e.id);continue}break}}function Z(F,J,te){const _e=this._notifyTransportTimeout(F.messages);if(_e>0)this._debug("Transport",this.getType(),"extended waiting for message replies of request",J.id,":",_e,"ms"),J.timeout=this.setTimeout(()=>{Z.call(this,F,J,te+_e)},_e);else{J.expired=!0;const ne="Transport "+this.getType()+" expired waiting for message replies of request "+J.id+": "+te+" ms",le={reason:ne},be=J.xhr;le.httpCode=this.xhrStatus(be),this.abortXHR(be),this._debug(ne),this.complete(J,!1,J.metaConnect),F.onFailure(be,F.messages,le)}}function K(F,J){if(this.transportSend(F,J)&&(J.expired=!1,!F.sync)){let te=this.getConfiguration().maxNetworkDelay;J.metaConnect===!0&&(te+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"started waiting for message replies of request",J.id,":",te,"ms"),J.timeout=this.setTimeout(()=>{Z.call(this,F,J,te)},te)}}function Y(F){const J=++C,te={id:J,metaConnect:!1,envelope:F};H.length<this.getConfiguration().maxConnections-1?(H.push(te),K.call(this,F,te)):(this._debug("Transport",this.getType(),"queueing request",J,"envelope",F),q.push([F,te]))}function k(F){const J=F.id;if(this._debug("Transport",this.getType(),"/meta/connect complete, request",J),z!==null&&z.id!==J)throw"/meta/connect request mismatch, completing request "+J;z=null}function ae(F,J){const te=H.indexOf(F);if(te>=0&&H.splice(te,1),q.length>0){const _e=q.shift(),ne=_e[0],le=_e[1];this._debug("Transport dequeued request",le.id),J?(this.getConfiguration().autoBatch&&P.call(this,ne),Y.call(this,ne),this._debug("Transport completed request",F.id,ne)):this.setTimeout(()=>{this.complete(le,!1,le.metaConnect);const be={reason:"Previous request failed"},je=le.xhr;be.httpCode=this.xhrStatus(je),ne.onFailure(je,ne.messages,be)},0)}}A.complete=function(F,J,te){te?k.call(this,F):ae.call(this,F,J)},A.transportSend=(F,J)=>{throw"Abstract"},A.transportSuccess=function(F,J,te){J.expired||(this.clearTimeout(J.timeout),this._debug("Transport",this.getType(),"cancelled waiting for message replies"),this.complete(J,!0,J.metaConnect),te&&te.length>0?F.onSuccess(te):F.onFailure(J.xhr,F.messages,{httpCode:204}))},A.transportFailure=function(F,J,te){J.expired||(this.clearTimeout(J.timeout),this._debug("Transport",this.getType(),"cancelled waiting for failed message replies"),this.complete(J,!1,J.metaConnect),F.onFailure(J.xhr,F.messages,te))};function j(F){if(z!==null)throw"Concurrent /meta/connect requests not allowed, request id="+z.id+" not yet completed";const J=++C;this._debug("Transport",this.getType(),"/meta/connect send, request",J,"envelope",F);const te={id:J,metaConnect:!0,envelope:F};K.call(this,F,te),z=te}return A.send=function(F,J){J?j.call(this,F):Y.call(this,F)},A.abort=function(){T.abort();for(let J=0;J<H.length;++J){const te=H[J];te&&(this._debug("Aborting request",te),this.abortXHR(te.xhr)||this.transportFailure(te.envelope,te,{reason:"abort"}))}const F=z;F&&(this._debug("Aborting /meta/connect request",F),this.abortXHR(F.xhr)||this.transportFailure(F.envelope,F,{reason:"abort"})),this.reset(!0)},A.reset=F=>{T.reset(F),z=null,H=[],q=[]},A.abortXHR=function(F){if(F)try{const J=F.readyState;return F.abort(),J!==window.XMLHttpRequest.UNSENT}catch(J){this._debug(J)}return!1},A.xhrStatus=function(F){if(F)try{return F.status}catch(J){this._debug(J)}return-1},A}function u(){const T=new h,A=r.derive(T);let C=!0;A.accept=(H,q,P)=>C||!q,A.newXMLHttpRequest=()=>new window.XMLHttpRequest;function z(H){try{H.context=A.context}catch(q){A._debug("Could not copy transport context into XHR",q)}}return A.xhrSend=H=>{const q=A.newXMLHttpRequest();z(q),q.withCredentials=!0,q.open("POST",H.url,H.sync!==!0);const P=H.headers;if(P)for(let Z in P)P.hasOwnProperty(Z)&&q.setRequestHeader(Z,P[Z]);return q.setRequestHeader("Content-Type","application/json;charset=UTF-8"),q.onload=()=>{q.status===200?H.onSuccess(q.responseText):H.onError(q.statusText)},q.onabort=q.onerror=()=>{H.onError(q.statusText)},q.send(H.body),q},A.transportSend=function(H,q){this._debug("Transport",this.getType(),"sending request",q.id,"envelope",H);try{let P=!0;return q.xhr=this.xhrSend({transport:this,url:H.url,sync:H.sync,headers:this.getConfiguration().requestHeaders,body:this.convertToJSON(H.messages),onSuccess:Z=>{this._debug("Transport",this.getType(),"received response",Z);let K=!1;try{const Y=this.convertToMessages(Z);Y.length===0?(C=!1,this.transportFailure(H,q,{httpCode:204})):(K=!0,this.transportSuccess(H,q,Y))}catch(Y){if(this._debug(Y),!K){C=!1;const k={exception:Y};k.httpCode=this.xhrStatus(q.xhr),this.transportFailure(H,q,k)}}},onError:(Z,K)=>{this._debug("Transport",this.getType(),"received error",Z,K),C=!1;const Y={reason:Z,exception:K};Y.httpCode=this.xhrStatus(q.xhr),P?this.setTimeout(()=>{this.transportFailure(H,q,Y)},0):this.transportFailure(H,q,Y)}}),P=!1,!0}catch(P){return this._debug("Transport",this.getType(),"exception:",P),C=!1,this.setTimeout(()=>{this.transportFailure(H,q,{exception:P})},0),!1}},A.reset=H=>{T.reset(H),C=!0},A}function g(){const T=new h,A=r.derive(T);let C=0;A.accept=(H,q,P)=>!0,A.jsonpSend=H=>{const q=document.getElementsByTagName("head")[0],P=document.createElement("script"),Z="_cometd_jsonp_"+C++;window[Z]=Y=>{q.removeChild(P),delete window[Z],H.onSuccess(Y)};let K=H.url;K+=K.indexOf("?")<0?"?":"&",K+="jsonp="+Z,K+="&message="+encodeURIComponent(H.body),P.src=K,P.async=H.sync!==!0,P.type="application/javascript",P.onerror=Y=>{H.onError("jsonp "+Y.type)},q.appendChild(P)};function z(H,q,P){return()=>{this.transportFailure(H,q,"error",P)}}return A.transportSend=function(H,q){let P=0,Z=H.messages.length;const K=[];for(;Z>0;){const k=JSON.stringify(H.messages.slice(P,P+Z)),ae=H.url.length+encodeURI(k).length,j=this.getConfiguration().maxURILength;if(ae>j){if(Z===1){const F="Bayeux message too big ("+ae+" bytes, max is "+j+") for transport "+this.getType();this.setTimeout(z.call(this,H,q,F),0);return}--Z;continue}K.push(Z),P+=Z,Z=H.messages.length-P}let Y=H;if(K.length>1){let k=0,ae=K[0];this._debug("Transport",this.getType(),"split",H.messages.length,"messages into",K.join(" + ")),Y=this._mixin(!1,{},H),Y.messages=H.messages.slice(k,ae),Y.onSuccess=H.onSuccess,Y.onFailure=H.onFailure;for(let j=1;j<K.length;++j){const F=this._mixin(!1,{},H);k=ae,ae+=K[j],F.messages=H.messages.slice(k,ae),F.onSuccess=H.onSuccess,F.onFailure=H.onFailure,this.send(F,q.metaConnect)}}this._debug("Transport",this.getType(),"sending request",q.id,"envelope",Y);try{let k=!0;return this.jsonpSend({transport:this,url:Y.url,sync:Y.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(Y.messages),onSuccess:ae=>{let j=!1;try{const F=this.convertToMessages(ae);F.length===0?this.transportFailure(Y,q,{httpCode:204}):(j=!0,this.transportSuccess(Y,q,F))}catch(F){this._debug(F),j||this.transportFailure(Y,q,{exception:F})}},onError:(ae,j)=>{const F={reason:ae,exception:j};k?this.setTimeout(()=>{this.transportFailure(Y,q,F)},0):this.transportFailure(Y,q,F)}}),k=!1,!0}catch(k){return this.setTimeout(()=>{this.transportFailure(Y,q,{exception:k})},0),!1}},A}function p(){const T=new r,A=r.derive(T);let C,z=!0,H=!1,q=!0,P=null,Z=null,K=!1,Y=null;A.reset=le=>{T.reset(le),z=!0,le&&(H=!1),q=!0,le&&(P=null),Z=null,K=!1};function k(le,be){le&&(this.webSocketClose(le,be.code,be.reason),this.onClose(le,be))}function ae(le){return le===Z||le===P}function j(le,be,je){const ze=[];for(let Re=0;Re<be.messages.length;++Re){const nt=be.messages[Re];nt.id&&ze.push(nt.id)}le.envelopes[ze.join(",")]=[be,je],this._debug("Transport",this.getType(),"stored envelope, envelopes",le.envelopes)}function F(le,be){let je=!1;const ze=le.envelopes;for(let Re=0;Re<be.length;++Re){const nt=be[Re];for(let $e in ze)if(ze.hasOwnProperty($e)){const _t=$e.split(","),Ut=_t.indexOf(nt);if(Ut>=0){je=!0,_t.splice(Ut,1);const Zt=ze[$e][0],oi=ze[$e][1];delete ze[$e],_t.length>0&&(ze[_t.join(",")]=[Zt,oi]);break}}}je&&this._debug("Transport",this.getType(),"removed envelope, envelopes",ze)}function J(le){if(Z)return;const be=C.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",be);try{const $e=C.getConfiguration().protocol;le.webSocket=$e?new window.WebSocket(be,$e):new window.WebSocket(be),Z=le}catch($e){throw z=!1,this._debug("Exception while creating WebSocket object",$e),$e}q=C.getConfiguration().stickyReconnect!==!1;const je=C.getConfiguration().connectTimeout;je>0&&(le.connectTimer=this.setTimeout(()=>{C._debug("Transport",this.getType(),"timed out while connecting to URL",be,":",je,"ms"),k.call(this,le,{code:1e3,reason:"Connect Timeout"})},je));const ze=()=>{C._debug("WebSocket onopen",le),le.connectTimer&&this.clearTimeout(le.connectTimer),ae(le)?(Z=null,P=le,H=!0,this.onOpen(le)):(C._warn("Closing extra WebSocket connection",this,"active connection",P),k.call(this,le,{code:1e3,reason:"Extra Connection"}))},Re=$e=>{$e=$e||{code:1e3},C._debug("WebSocket onclose",le,$e,"connecting",Z,"current",P),le.connectTimer&&this.clearTimeout(le.connectTimer),this.onClose(le,$e)},nt=$e=>{C._debug("WebSocket onmessage",$e,le),this.onMessage(le,$e)};le.webSocket.onopen=ze,le.webSocket.onclose=Re,le.webSocket.onerror=()=>{Re({code:1e3,reason:"Error"})},le.webSocket.onmessage=nt,this._debug("Transport",this.getType(),"configured callbacks on",le)}function te(le,be,je){const ze=this._notifyTransportTimeout([be]);ze>0?(this._debug("Transport",this.getType(),"extended waiting for message replies:",ze,"ms"),le.timeouts[be.id]=this.setTimeout(()=>{te.call(this,le,be,je+ze)},ze)):(this._debug("Transport",this.getType(),"expired waiting for message reply",be.id,":",je,"ms"),k.call(this,le,{code:1e3,reason:"Message Timeout"}))}function _e(le,be,je){let ze;try{ze=this.convertToJSON(be.messages)}catch($e){this._debug("Transport",this.getType(),"exception:",$e);const _t=[];for(let Ut=0;Ut<be.messages.length;++Ut){const Zt=be.messages[Ut];_t.push(Zt.id)}F.call(this,le,_t),this.setTimeout(()=>{this._notifyFailure(be.onFailure,le,be.messages,{exception:$e})},0);return}le.webSocket.send(ze),this._debug("Transport",this.getType(),"sent",be,"/meta/connect =",je);let Re=this.getConfiguration().maxNetworkDelay;je&&(Re+=this.getAdvice().timeout,K=!0);const nt=[];for(let $e=0;$e<be.messages.length;++$e){const _t=be.messages[$e];_t.id&&(nt.push(_t.id),le.timeouts[_t.id]=this.setTimeout(()=>{te.call(this,le,_t,Re)},Re))}this._debug("Transport",this.getType(),"started waiting for message replies",Re,"ms, messageIds:",nt,", timeouts:",le.timeouts)}A._notifySuccess=function(le,be){le.call(this,be)},A._notifyFailure=function(le,be,je,ze){le.call(this,be,je,ze)};function ne(le,be,je){try{le===null?(le=Z||{envelopes:{},timeouts:{}},j.call(this,le,be,je),J.call(this,le)):(j.call(this,le,be,je),_e.call(this,le,be,je))}catch(ze){this.setTimeout(()=>{k.call(this,le,{code:1e3,reason:"Exception",exception:ze})},0)}}return A.onOpen=function(le){const be=le.envelopes;this._debug("Transport",this.getType(),"opened",le,"pending messages",be);for(let je in be)if(be.hasOwnProperty(je)){const ze=be[je],Re=ze[0],nt=ze[1];Y=Re.onSuccess,_e.call(this,le,Re,nt)}},A.onMessage=function(le,be){this._debug("Transport",this.getType(),"received websocket message",be,le);let je=!1;const ze=this.convertToMessages(be.data),Re=[];for(let nt=0;nt<ze.length;++nt){const $e=ze[nt];if((/^\/meta\//.test($e.channel)||$e.data===void 0)&&$e.id){Re.push($e.id);const _t=le.timeouts[$e.id];_t&&(this.clearTimeout(_t),delete le.timeouts[$e.id],this._debug("Transport",this.getType(),"removed timeout for message",$e.id,", timeouts",le.timeouts))}$e.channel==="/meta/connect"&&(K=!1),$e.channel==="/meta/disconnect"&&!K&&(je=!0)}F.call(this,le,Re),this._notifySuccess(Y,ze),je&&this.webSocketClose(le,1e3,"Disconnect")},A.onClose=function(le,be){this._debug("Transport",this.getType(),"closed",le,be),ae(le)&&(z=q&&H,Z=null,P=null);const je=le.timeouts;le.timeouts={};for(let Re in je)je.hasOwnProperty(Re)&&this.clearTimeout(je[Re]);const ze=le.envelopes;le.envelopes={};for(let Re in ze)if(ze.hasOwnProperty(Re)){const nt=ze[Re][0];ze[Re][1]&&(K=!1);const _t={websocketCode:be.code,reason:be.reason};be.exception&&(_t.exception=be.exception),this._notifyFailure(nt.onFailure,le,nt.messages,_t)}},A.registered=(le,be)=>{T.registered(le,be),C=be},A.accept=function(le,be,je){return this._debug("Transport",this.getType(),"accept, supported:",z),z&&!!window.WebSocket&&C.websocketEnabled!==!1},A.send=function(le,be){this._debug("Transport",this.getType(),"sending",le,"/meta/connect =",be),ne.call(this,P,le,be)},A.webSocketClose=function(le,be,je){try{le.webSocket&&le.webSocket.close(be,je)}catch(ze){this._debug(ze)}},A.abort=function(){T.abort(),k.call(this,P,{code:1e3,reason:"Abort"}),this.reset(!0)},A}function y(T){const A=new N,C=this,z=T||"default";let H=!1;const q=new n;let P,Z="disconnected",K=0,Y=null,k=0,ae=[],j=!1,F=0,J={};const te={};let _e=0,ne=null;const le=[];let be={},je,ze;const Re={},nt={};let $e=!1,_t=!1,Ut=0,Zt=0,oi=null,Nt={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,maxSendBayeuxMessageSize:8192,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}};function Vn(Q,ge){try{return Q[ge]}catch(Se){return}}this._mixin=function(Q,ge,Se){const Be=ge||{};for(let Ge=2;Ge<arguments.length;++Ge){const Je=arguments[Ge];if(Je!=null){for(let lt in Je)if(Je.hasOwnProperty(lt)){const ft=Vn(Je,lt),Ot=Vn(Be,lt);if(ft===ge||ft===void 0)continue;if(Q&&typeof ft=="object"&&ft!==null)if(ft instanceof Array)Be[lt]=this._mixin(Q,Ot instanceof Array?Ot:[],ft);else{const Di=typeof Ot=="object"&&!(Ot instanceof Array)?Ot:{};Be[lt]=this._mixin(Q,Di,ft)}else Be[lt]=ft}}}return Be};function _i(Q){return l.isString(Q)}function Wn(Q){return Q>="A"&&Q<="Z"?!0:Q>="a"&&Q<="z"}function Gn(Q){return Q>="0"&&Q<="9"}function ms(Q){switch(Q){case" ":case"!":case"#":case"$":case"(":case")":case"*":case"+":case"-":case".":case"/":case"@":case"_":case"{":case"~":case"}":case":":case"\\":case",":return!0;default:return!1}}function In(Q){if(!_i(Q)||Q.length<2||Q.charAt(0)!=="/")return!1;for(let ge=1;ge<Q.length;++ge){const Se=Q.charAt(ge);if(!(Wn(Se)||Gn(Se)||ms(Se)))return!1}return!0}function bt(Q){return Q==null?!1:typeof Q=="function"}function Sn(Q,ge){let Se="";for(;--ge>0&&!(Q>=Math.pow(10,ge));)Se+="0";return Se+=Q,Se}function ji(Q,ge){if(window.console){const Se=window.console[Q];if(bt(Se)){const Be=new Date;[].splice.call(ge,0,0,Sn(Be.getHours(),2)+":"+Sn(Be.getMinutes(),2)+":"+Sn(Be.getSeconds(),2)+"."+Sn(Be.getMilliseconds(),3)),Se.apply(window.console,ge)}}}this._warn=function(){ji("warn",arguments)},this._info=function(){Nt.logLevel!=="warn"&&ji("info",arguments)},this._debug=function(){Nt.logLevel==="debug"&&ji("debug",arguments)};function un(Q){return new RegExp("(^https?://)?(((\\[[^\\]]+])|([^:/?#]+))(:(\\d+))?)?([^?#]*)(.*)?").exec(Q)}this._isCrossDomain=Q=>window.location&&window.location.host&&Q?Q!==window.location.host:!1;function Vi(Q){C._debug("Configuring cometd object with",Q),_i(Q)&&(Q={url:Q}),Q||(Q={}),Nt=C._mixin(!1,Nt,Q);const ge=C.getURL();if(!ge)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";const Se=un(ge),Be=Se[2],Ge=Se[8],Je=Se[9];if(H=C._isCrossDomain(Be),Nt.appendMessageTypeToURL)if(Je!==void 0&&Je.length>0)C._info("Appending message type to URI "+Ge+Je+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Nt.appendMessageTypeToURL=!1;else{const lt=Ge.split("/");let ft=lt.length-1;Ge.match(/\/$/)&&(ft-=1),lt[ft].indexOf(".")>=0&&(C._info("Appending message type to URI "+Ge+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Nt.appendMessageTypeToURL=!1)}if(window.Worker&&window.Blob&&window.URL&&Nt.useWorkerScheduler){let lt=_.toString();lt=lt.substring(lt.indexOf("{")+1,lt.lastIndexOf("}"));const ft=new window.Blob([lt],{type:"application/json"}),Ot=window.URL.createObjectURL(ft),Di=new window.Worker(Ot);A.setTimeout=(Ri,an)=>{const Ei=A.register(Ri);return Di.postMessage({id:Ei,type:"setTimeout",delay:an}),Ei},A.clearTimeout=Ri=>{A.unregister(Ri),Di.postMessage({id:Ri,type:"clearTimeout"})},Di.onmessage=Ri=>{const an=Ri.data.id,Ei=A.unregister(an);Ei&&Ei()}}}function Hn(Q){if(Q){const ge=J[Q.channel];ge&&ge[Q.id]&&(delete ge[Q.id],C._debug("Removed",Q.listener?"listener":"subscription",Q))}}function ks(Q){Q&&!Q.listener&&Hn(Q)}function Vs(){for(let Q in J)if(J.hasOwnProperty(Q)){const ge=J[Q];if(ge)for(let Se in ge)ge.hasOwnProperty(Se)&&ks(ge[Se])}}function gi(Q){Z!==Q&&(C._debug("Status",Z,"->",Q),Z=Q)}function Ne(){return Z==="disconnecting"||Z==="disconnected"}function Wi(){return""+ ++K}function bi(Q,ge,Se,Be,Ge){try{return ge.call(Q,Be)}catch(Je){const lt=C.onExtensionException;if(bt(lt)){C._debug("Invoking extension exception handler",Se,Je);try{lt.call(C,Je,Se,Ge,Be)}catch(ft){C._info("Exception during execution of extension exception handler",Se,ft)}}else C._info("Exception during execution of extension",Se,Je);return Be}}function Kn(Q){for(let ge=0;ge<le.length&&Q!=null;++ge){const Se=le[ge],Be=Se.extension.incoming;if(bt(Be)){const Ge=bi(Se.extension,Be,Se.name,Q,!1);Q=Ge===void 0?Q:Ge}}return Q}function mr(Q){for(let ge=le.length-1;ge>=0&&Q!=null;--ge){const Se=le[ge],Be=Se.extension.outgoing;if(bt(Be)){const Ge=bi(Se.extension,Be,Se.name,Q,!0);Q=Ge===void 0?Q:Ge}}return Q}function Si(Q,ge){const Se=J[Q];if(Se){for(let Be in Se)if(Se.hasOwnProperty(Be)){const Ge=Se[Be];if(Ge)try{Ge.callback.call(Ge.scope,ge)}catch(Je){const lt=C.onListenerException;if(bt(lt)){C._debug("Invoking listener exception handler",Ge,Je);try{lt.call(C,Je,Ge,Ge.listener,ge)}catch(ft){C._info("Exception during execution of listener exception handler",Ge,ft)}}else C._info("Exception during execution of listener",Ge,ge,Je)}}}}function Tt(Q,ge){Si(Q,ge);const Se=Q.split("/"),Be=Se.length-1;for(let Ge=Be;Ge>0;--Ge){let Je=Se.slice(0,Ge).join("/")+"/*";Ge===Be&&Si(Je,ge),Je+="*",Si(Je,ge)}}function en(){ne!==null&&C.clearTimeout(ne),ne=null}function Yn(Q,ge){en();const Se=be.interval+ge;C._debug("Function scheduled in",Se,"ms, interval =",be.interval,"backoff =",_e,Q),ne=C.setTimeout(Q,Se)}let dt,He;function Gi(Q,ge,Se){for(let Je=0;Je<Q.length;++Je){let lt=Q[Je];const ft=lt.id;Y&&(lt.clientId=Y),lt=mr(lt),lt!=null?(lt.id=ft,Q[Je]=lt):(delete Re[ft],Q.splice(Je--,1))}if(Q.length===0)return;ge&&(oi=Q[0]);let Be=C.getURL();Nt.appendMessageTypeToURL&&(Be.match(/\/$/)||(Be=Be+"/"),Se&&(Be=Be+Se));const Ge={url:Be,sync:!1,messages:Q,onSuccess:Je=>{try{dt.call(C,Je)}catch(lt){C._info("Exception during handling of messages",lt)}},onFailure:(Je,lt,ft)=>{try{const Ot=C.getTransport();ft.connectionType=Ot?Ot.getType():"unknown",He.call(C,Je,lt,ft)}catch(Ot){C._info("Exception during handling of failure",Ot)}}};C._debug("Send",Ge),P.send(Ge,ge)}function Wt(Q){k>0||j===!0?ae.push(Q):Gi([Q],!1)}this.send=Wt;function Hi(){_e=0}function pa(){return _e<Nt.maxBackoff&&(_e+=Nt.backoffIncrement),_e}function ui(){++k,C._debug("Starting batch, depth",k)}function _s(){const Q=ae;ae=[],Q.length>0&&Gi(Q,!1)}function Ft(){if(--k,C._debug("Ending batch, depth",k),k<0)throw"Calls to startBatch() and endBatch() are not paired";k===0&&!Ne()&&!j&&_s()}function tn(){if(!Ne()){const Q={id:Wi(),channel:"/meta/connect",connectionType:P.getType()};_t||(Q.advice={timeout:0}),gi("connecting"),C._debug("Connect sent",Q),Gi([Q],!0,"connect"),gi("connected")}}function Xn(Q){gi("connecting"),Yn(()=>{tn()},Q)}function ni(Q){Q&&(be=C._mixin(!1,{},Nt.advice,Q),C._debug("New advice",be))}function se(Q){if(en(),Q&&P&&P.abort(),H=!1,P=null,gi("disconnected"),Y=null,k=0,Hi(),$e=!1,_t=!1,Ut=0,oi=null,ae.length>0){const ge=ae;ae=[],He.call(C,void 0,ge,{reason:"Disconnected"})}}function Zn(Q,ge,Se){const Be=C.onTransportException;if(bt(Be)){C._debug("Invoking transport exception handler",Q,ge,Se);try{Be.call(C,Se,Q,ge)}catch(Ge){C._info("Exception during execution of transport exception handler",Ge)}}}function Ws(Q,ge){bt(Q)&&(ge=Q,Q=void 0),Y=null,Vs(),Ne()&&q.reset(!0),ni({}),k=0,j=!0,je=Q,ze=ge;const Se="1.0",Be=C.getURL(),Ge=q.findTransportTypes(Se,H,Be),Je={id:Wi(),version:Se,minimumVersion:Se,channel:"/meta/handshake",supportedConnectionTypes:Ge,advice:{timeout:be.timeout,interval:be.interval}},lt=C._mixin(!1,{},je,Je);if(C._putCallback(lt.id,ge),!P&&(P=q.negotiateTransport(Ge,Se,H,Be),!P)){const ft="Could not find initial transport among: "+q.getTransportTypes();throw C._warn(ft),ft}C._debug("Initial transport is",P.getType()),gi("handshaking"),C._debug("Handshake sent",lt),Gi([lt],!1,"handshake")}function xi(Q){gi("handshaking"),j=!0,Yn(()=>{Ws(je,ze)},Q)}function Li(Q,ge){try{Q.call(C,ge)}catch(Se){const Be=C.onCallbackException;if(bt(Be)){C._debug("Invoking callback exception handler",Se);try{Be.call(C,Se,ge)}catch(Ge){C._info("Exception during execution of callback exception handler",Ge)}}else C._info("Exception during execution of message callback",Se)}}this._getCallback=Q=>Re[Q],this._putCallback=function(Q,ge){const Se=this._getCallback(Q);return bt(ge)&&(Re[Q]=ge),Se};function li(Q){const ge=C._getCallback([Q.id]);bt(ge)&&(delete Re[Q.id],Li(ge,Q))}function On(Q){const ge=nt[Q.id];if(delete nt[Q.id],ge){C._debug("Handling remote call response for",Q,"with context",ge);const Se=ge.timeout;Se&&C.clearTimeout(Se);const Be=ge.callback;if(bt(Be))return Li(Be,Q),!0}return!1}this.onTransportFailure=function(Q,ge,Se){this._debug("Transport failure",ge,"for",Q);const Be=this.getTransportRegistry(),Ge=this.getURL(),Je=this._isCrossDomain(un(Ge)[2]),lt="1.0",ft=Be.findTransportTypes(lt,Je,Ge);if(ge.action==="none"){if(Q.channel==="/meta/handshake"&&!ge.transport){const Ot="Could not negotiate transport, client=["+ft+"], server=["+Q.supportedConnectionTypes+"]";this._warn(Ot),Zn(P.getType(),null,{reason:Ot,connectionType:P.getType(),transport:P})}}else if(ge.delay=this.getBackoffPeriod(),Q.channel==="/meta/handshake"){if(!ge.transport){const Ot=P?P.getType():null,Di=Be.negotiateTransport(ft,lt,Je,Ge);if(!Di)this._warn("Could not negotiate transport, client=["+ft+"]"),Zn(Ot,null,Q.failure),ge.action="none";else{const Ri=Di.getType();this._debug("Transport",Ot,"->",Ri),Zn(Ot,Ri,Q.failure),ge.action="handshake",ge.transport=Di}}ge.action!=="none"&&this.increaseBackoffPeriod()}else{const Ot=new Date().getTime();if(Ut===0&&(Ut=Ot),ge.action==="retry"){ge.delay=this.increaseBackoffPeriod();const Di=be.maxInterval;if(Di>0){const Ri=be.timeout+be.interval+Di;Ot-Ut+_e>Ri&&(ge.action="handshake")}}ge.action==="handshake"&&(ge.delay=0,Be.reset(!1),this.resetBackoffPeriod())}Se.call(C,ge)};function Ki(Q){C._debug("Transport failure handling",Q),Q.transport&&(P=Q.transport),Q.url&&P.setURL(Q.url);const ge=Q.action,Se=Q.delay||0;switch(ge){case"handshake":xi(Se);break;case"retry":Xn(Se);break;case"none":se(!0);break;default:throw"Unknown action "+ge}}function Yi(Q,ge){li(Q),Tt("/meta/handshake",Q),Tt("/meta/unsuccessful",Q),Ne()&&(ge.action="none"),C.onTransportFailure.call(C,Q,ge,Ki)}function dn(Q){const ge=C.getURL();if(Q.successful){const Se=C._isCrossDomain(un(ge)[2]),Be=q.negotiateTransport(Q.supportedConnectionTypes,Q.version,Se,ge);if(Be===null){Q.successful=!1,Yi(Q,{cause:"negotiation",action:"none",transport:null});return}else P!==Be&&(C._debug("Transport",P.getType(),"->",Be.getType()),P=Be);Y=Q.clientId,j=!1,_s(),Q.reestablish=$e,$e=!0,li(Q),Tt("/meta/handshake",Q),Zt=Q["x-messages"]||0;const Ge=Ne()?"none":be.reconnect||"retry";switch(Ge){case"retry":Hi(),Zt===0?Xn(0):C._debug("Processing",Zt,"handshake-delivered messages");break;case"none":se(!0);break;default:throw"Unrecognized advice action "+Ge}}else Yi(Q,{cause:"unsuccessful",action:be.reconnect||"handshake",transport:P})}function fn(Q){Yi(Q,{cause:"failure",action:"handshake",transport:null})}function nn(Q){return Z==="disconnected"?!0:oi&&oi.id===Q.id?(oi=null,!0):!1}function pn(Q,ge){Tt("/meta/connect",Q),Tt("/meta/unsuccessful",Q),Ne()&&(ge.action="none"),C.onTransportFailure.call(C,Q,ge,Ki)}function qn(Q){if(nn(Q))if(_t=Q.successful,_t){Tt("/meta/connect",Q);const ge=Ne()?"none":be.reconnect||"retry";switch(ge){case"retry":Hi(),Xn(_e);break;case"none":se(!1);break;default:throw"Unrecognized advice action "+ge}}else pn(Q,{cause:"unsuccessful",action:be.reconnect||"retry",transport:P});else C._debug("Mismatched /meta/connect reply",Q)}function gs(Q){nn(Q)?(_t=!1,pn(Q,{cause:"failure",action:"retry",transport:null})):C._debug("Mismatched /meta/connect failure",Q)}function Qn(Q){se(!0),li(Q),Tt("/meta/disconnect",Q),Tt("/meta/unsuccessful",Q)}function En(Q){Q.successful?(se(!1),li(Q),Tt("/meta/disconnect",Q)):Qn(Q)}function Gs(Q){Qn(Q)}function _r(Q){const ge=J[Q.subscription];if(ge){for(let Se in ge)if(ge.hasOwnProperty(Se)){const Be=ge[Se];Be&&!Be.listener&&(delete ge[Se],C._debug("Removed failed subscription",Be))}}li(Q),Tt("/meta/subscribe",Q),Tt("/meta/unsuccessful",Q)}function mn(Q){Q.successful?(li(Q),Tt("/meta/subscribe",Q)):_r(Q)}function sn(Q){_r(Q)}function vs(Q){li(Q),Tt("/meta/unsubscribe",Q),Tt("/meta/unsuccessful",Q)}function ys(Q){Q.successful?(li(Q),Tt("/meta/unsubscribe",Q)):vs(Q)}function _n(Q){vs(Q)}function Jn(Q){On(Q)||(li(Q),Tt("/meta/publish",Q),Tt("/meta/unsuccessful",Q))}function bs(Q){Q.data!==void 0?On(Q)||(Tt(Q.channel,Q),Zt>0&&(--Zt,Zt===0&&(C._debug("Processed last handshake-delivered message"),Xn(0)))):Q.successful===void 0?C._warn("Unknown Bayeux Message",Q):Q.successful?(li(Q),Tt("/meta/publish",Q)):Jn(Q)}function Hs(Q){Jn(Q)}function rn(Q){if(Ut=0,Q=Kn(Q),Q==null)return;switch(ni(Q.advice),Q.channel){case"/meta/handshake":dn(Q);break;case"/meta/connect":qn(Q);break;case"/meta/disconnect":En(Q);break;case"/meta/subscribe":mn(Q);break;case"/meta/unsubscribe":ys(Q);break;default:bs(Q);break}}this.receive=rn,dt=Q=>{C._debug("Received",Q);for(let ge=0;ge<Q.length;++ge){const Se=Q[ge];rn(Se)}},He=(Q,ge,Se)=>{C._debug("handleFailure",Q,ge,Se),Se.transport=Q;for(let Be=0;Be<ge.length;++Be){const Ge=ge[Be],Je={id:Ge.id,successful:!1,channel:Ge.channel,failure:Se};switch(Se.message=Ge,Ge.channel){case"/meta/handshake":fn(Je);break;case"/meta/connect":gs(Je);break;case"/meta/disconnect":Gs(Je);break;case"/meta/subscribe":Je.subscription=Ge.subscription,sn(Je);break;case"/meta/unsubscribe":Je.subscription=Ge.subscription,_n(Je);break;default:Hs(Je);break}}};function ht(Q){const ge=J[Q];if(ge){for(let Se in ge)if(ge.hasOwnProperty(Se)&&ge[Se])return!0}return!1}function An(Q,ge){const Se={scope:Q,method:ge};if(bt(Q))Se.scope=void 0,Se.method=Q;else if(_i(ge)){if(!Q)throw"Invalid scope "+Q;if(Se.method=Q[ge],!bt(Se.method))throw"Invalid callback "+ge+" for scope "+Q}else if(!bt(ge))throw"Invalid callback "+ge;return Se}function Pi(Q,ge,Se,Be){const Ge=An(ge,Se);C._debug("Adding",Be?"listener":"subscription","on",Q,"with scope",Ge.scope,"and callback",Ge.method);const Je=++F,lt={id:Je,channel:Q,scope:Ge.scope,callback:Ge.method,listener:Be};let ft=J[Q];return ft||(ft={},J[Q]=ft),ft[Je]=lt,C._debug("Added",Be?"listener":"subscription",lt),lt}this.registerTransport=function(Q,ge,Se){const Be=q.add(Q,ge,Se);return Be&&(this._debug("Registered transport",Q),bt(ge.registered)&&ge.registered(Q,this)),Be},this.unregisterTransport=function(Q){const ge=q.remove(Q);return ge!==null&&(this._debug("Unregistered transport",Q),bt(ge.unregistered)&&ge.unregistered()),ge},this.unregisterTransports=()=>{q.clear()},this.getTransportTypes=()=>q.getTransportTypes(),this.findTransport=Q=>q.find(Q),this.getTransportRegistry=()=>q,this.configure=function(Q){Vi.call(this,Q)},this.init=function(Q,ge){this.configure(Q),this.handshake(ge)},this.handshake=(Q,ge)=>{if(Z!=="disconnected")throw"Illegal state: handshaken";Ws(Q,ge)},this.disconnect=function(Q,ge){if(Ne())return;bt(Q)&&(ge=Q,Q=void 0);const Se={id:Wi(),channel:"/meta/disconnect"},Be=this._mixin(!1,{},Q,Se);C._putCallback(Be.id,ge),gi("disconnecting"),Gi([Be],!1,"disconnect")},this.startBatch=()=>{ui()},this.endBatch=()=>{Ft()},this.batch=function(Q,ge){const Se=An(Q,ge);this.startBatch();try{Se.method.call(Se.scope),this.endBatch()}catch(Be){throw this._info("Exception during execution of batch",Be),this.endBatch(),Be}},this.addTransportListener=(Q,ge)=>{if(Q!=="timeout")throw"Unsupported event "+Q;let Se=te[Q];Se||(te[Q]=Se=[]),Se.push(ge)},this.removeTransportListener=(Q,ge)=>{const Se=te[Q];if(Se){const Be=Se.indexOf(ge);if(Be>=0)return Se.splice(Be,1),!0}return!1},this._getTransportListeners=Q=>te[Q],this.addListener=function(Q,ge,Se){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!_i(Q))throw"Illegal argument type: channel must be a string";return Pi(Q,ge,Se,!0)},this.removeListener=Q=>{if(!Q||!Q.channel||!("id"in Q))throw"Invalid argument: expected subscription, not "+Q;Hn(Q)},this.clearListeners=()=>{J={}},this.subscribe=function(Q,ge,Se,Be,Ge){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!In(Q))throw"Illegal argument: invalid channel "+Q;if(Ne())throw"Illegal state: disconnected";bt(ge)&&(Ge=Be,Be=Se,Se=ge,ge=void 0),bt(Be)&&(Ge=Be,Be=void 0);const Je=!ht(Q),lt=Pi(Q,ge,Se,!1);if(Je){const ft={id:Wi(),channel:"/meta/subscribe",subscription:Q},Ot=this._mixin(!1,{},Be,ft);C._putCallback(Ot.id,Ge),Wt(Ot)}else bt(Ge)&&C.setTimeout(()=>{Li(Ge,{id:Wi(),successful:!0,channel:"/meta/subscribe",subscription:Q})},0);return lt},this.unsubscribe=function(Q,ge,Se){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(Ne())throw"Illegal state: disconnected";bt(ge)&&(Se=ge,ge=void 0),this.removeListener(Q);const Be=Q.channel;if(ht(Be))bt(Se)&&C.setTimeout(()=>{Li(Se,{id:Wi(),successful:!0,channel:"/meta/unsubscribe",subscription:Be})},0);else{const Ge={id:Wi(),channel:"/meta/unsubscribe",subscription:Be},Je=this._mixin(!1,{},ge,Ge);C._putCallback(Je.id,Se),Wt(Je)}},this.resubscribe=function(Q,ge){if(ks(Q),Q)return this.subscribe(Q.channel,Q.scope,Q.callback,ge)},this.clearSubscriptions=()=>{Vs()},this.publish=function(Q,ge,Se,Be){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!In(Q))throw"Illegal argument: invalid channel "+Q;if(/^\/meta\//.test(Q))throw"Illegal argument: cannot publish to meta channels";if(Ne())throw"Illegal state: disconnected";bt(ge)?(Be=ge,ge={},Se=void 0):bt(Se)&&(Be=Se,Se=void 0);const Ge={id:Wi(),channel:Q,data:ge},Je=this._mixin(!1,{},Se,Ge);C._putCallback(Je.id,Be),Wt(Je)},this.publishBinary=function(Q,ge,Se,Be,Ge,Je){bt(ge)?(Je=ge,ge=new ArrayBuffer(0),Se=!0,Be=void 0,Ge=void 0):bt(Se)?(Je=Se,Se=!0,Be=void 0,Ge=void 0):bt(Be)?(Je=Be,Be=void 0,Ge=void 0):bt(Ge)&&(Je=Ge,Ge=void 0);const lt={meta:Be,data:ge,last:Se},ft=this._mixin(!1,Ge,{ext:{binary:{}}});this.publish(Q,lt,ft,Je)},this.remoteCall=function(Q,ge,Se,Be,Ge){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!_i(Q))throw"Illegal argument type: target must be a string";if(Ne())throw"Illegal state: disconnected";if(bt(ge)?(Ge=ge,ge={},Se=Nt.maxNetworkDelay,Be=void 0):bt(Se)?(Ge=Se,Se=Nt.maxNetworkDelay,Be=void 0):bt(Be)&&(Ge=Be,Be=void 0),typeof Se!="number")throw"Illegal argument type: timeout must be a number";Q.match(/^\//)||(Q="/"+Q);const Je="/service"+Q;if(!In(Je))throw"Illegal argument: invalid target "+Q;const lt={id:Wi(),channel:Je,data:ge},ft=this._mixin(!1,{},Be,lt),Ot={callback:Ge};Se>0&&(Ot.timeout=C.setTimeout(()=>{C._debug("Timing out remote call",ft,"after",Se,"ms"),Jn({id:ft.id,error:"406::timeout",successful:!1,failure:{message:ft,reason:"Remote Call Timeout"}})},Se),C._debug("Scheduled remote call timeout",ft,"in",Se,"ms")),nt[ft.id]=Ot,Wt(ft)},this.remoteCallBinary=function(Q,ge,Se,Be,Ge,Je,lt){bt(ge)?(lt=ge,ge=new ArrayBuffer(0),Se=!0,Be=void 0,Ge=Nt.maxNetworkDelay,Je=void 0):bt(Se)?(lt=Se,Se=!0,Be=void 0,Ge=Nt.maxNetworkDelay,Je=void 0):bt(Be)?(lt=Be,Be=void 0,Ge=Nt.maxNetworkDelay,Je=void 0):bt(Ge)?(lt=Ge,Ge=Nt.maxNetworkDelay,Je=void 0):bt(Je)&&(lt=Je,Je=void 0);const ft={meta:Be,data:ge,last:Se},Ot=this._mixin(!1,Je,{ext:{binary:{}}});this.remoteCall(Q,ft,Ge,Ot,lt)},this.getStatus=()=>Z,this.isDisconnected=Ne,this.setBackoffIncrement=Q=>{Nt.backoffIncrement=Q},this.getBackoffIncrement=()=>Nt.backoffIncrement,this.getBackoffPeriod=()=>_e,this.increaseBackoffPeriod=()=>pa(),this.resetBackoffPeriod=()=>{Hi()},this.setLogLevel=Q=>{Nt.logLevel=Q},this.registerExtension=function(Q,ge){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!_i(Q))throw"Illegal argument type: extension name must be a string";let Se=!1;for(let Be=0;Be<le.length;++Be)if(le[Be].name===Q){Se=!0;break}return Se?(this._info("Could not register extension with name",Q,"since another extension with the same name already exists"),!1):(le.push({name:Q,extension:ge}),this._debug("Registered extension",Q),bt(ge.registered)&&ge.registered(Q,this),!0)},this.unregisterExtension=function(Q){if(!_i(Q))throw"Illegal argument type: extension name must be a string";let ge=!1;for(let Se=0;Se<le.length;++Se){const Be=le[Se];if(Be.name===Q){le.splice(Se,1),ge=!0,this._debug("Unregistered extension",Q);const Ge=Be.extension;bt(Ge.unregistered)&&Ge.unregistered();break}}return ge},this.getExtension=Q=>{for(let ge=0;ge<le.length;++ge){const Se=le[ge];if(Se.name===Q)return Se.extension}return null},this.getName=()=>z,this.getClientId=()=>Y,this.getURL=()=>{if(P){let Q=P.getURL();if(Q||(Q=Nt.urls[P.getType()],Q))return Q}return Nt.url},this.getTransport=()=>P,this.getConfiguration=function(){return this._mixin(!0,{},Nt)},this.getAdvice=function(){return this._mixin(!0,{},be)},this.setTimeout=(Q,ge)=>A.setTimeout(()=>{try{C._debug("Invoking timed function",Q),Q()}catch(Se){C._debug("Exception invoking timed function",Q,Se)}},ge),this.clearTimeout=Q=>{A.clearTimeout(Q)},window.WebSocket&&this.registerTransport("websocket",new p),this.registerTransport("long-polling",new u),this.registerTransport("callback-polling",new g)}const x=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],w=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0],M={encode:T=>{let A=null;if(T instanceof ArrayBuffer?A=T:T.buffer instanceof ArrayBuffer?A=T.buffer:Array.isArray(T)&&(A=new Uint8Array(T).buffer),A==null)throw"Cannot Z85 encode "+T;const C=A.byteLength,z=C%4,H=4-(z===0?4:z),q=new DataView(A);let P="",Z=0;for(let K=0;K<C+H;++K){const Y=K>=C;if(Z=Z*256+(Y?0:q.getUint8(K)),(K+1)%4===0){let k=52200625;for(let ae=5;ae>0;--ae){if(!Y||ae>H){const j=Math.floor(Z/k)%85;P+=x[j]}k/=85}Z=0}}return P},decode:T=>{const A=T.length%5,C=5-(A===0?5:A);for(let Y=0;Y<C;++Y)T+=x[x.length-1];const z=T.length,H=new ArrayBuffer(z*4/5-C),q=new DataView(H);let P=0,Z=0,K=0;for(let Y=0;Y<z;++Y){const k=T.charCodeAt(Z++)-32;if(P=P*85+w[k],Z%5===0){let ae=16777216;for(;ae>=1;)K<q.byteLength&&q.setUint8(K++,Math.floor(P/ae)%256),ae/=256;P=0}}return H}};return d.default={CometD:y,Transport:r,RequestTransport:h,LongPollingTransport:u,CallbackPollingTransport:g,WebSocketTransport:p,Utils:l,Z85:M},d.default},D,V),D.exports=B},3681:(D,V)=>{"use strict";(function(f,R){R(V)})(void 0,function(f){"use strict";var R=function(o){var i,t=Object.prototype,e=t.hasOwnProperty,s=typeof Symbol=="function"?Symbol:{},a=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",m=s.toStringTag||"@@toStringTag";function v(de,ve,Me){return Object.defineProperty(de,ve,{value:Me,enumerable:!0,configurable:!0,writable:!0}),de[ve]}try{v({},"")}catch(de){v=function(Me,we,ye){return Me[we]=ye}}function b(de,ve,Me,we){var ye=ve&&ve.prototype instanceof G?ve:G,Te=Object.create(ye.prototype),Ue=new Ce(we||[]);return Te._invoke=function(tt,ot,ue){var fe=S;return function(Oe,De){if(fe===I)throw new Error("Generator is already running");if(fe===O){if(Oe==="throw")throw De;return Pe()}for(ue.method=Oe,ue.arg=De;;){var Ve=ue.delegate;if(Ve){var Ae=me(Ve,ue);if(Ae){if(Ae===U)continue;return Ae}}if(ue.method==="next")ue.sent=ue._sent=ue.arg;else if(ue.method==="throw"){if(fe===S)throw fe=O,ue.arg;ue.dispatchException(ue.arg)}else ue.method==="return"&&ue.abrupt("return",ue.arg);fe=I;var Ee=E(tt,ot,ue);if(Ee.type==="normal"){if(fe=ue.done?O:L,Ee.arg===U)continue;return{value:Ee.arg,done:ue.done}}Ee.type==="throw"&&(fe=O,ue.method="throw",ue.arg=Ee.arg)}}}(de,Me,Ue),Te}function E(de,ve,Me){try{return{type:"normal",arg:de.call(ve,Me)}}catch(we){return{type:"throw",arg:we}}}o.wrap=b;var S="suspendedStart",L="suspendedYield",I="executing",O="completed",U={};function G(){}function W(){}function X(){}var ie={};ie[a]=function(){return this};var $=Object.getPrototypeOf,ee=$&&$($(Ie([])));ee&&ee!==t&&e.call(ee,a)&&(ie=ee);var he=X.prototype=G.prototype=Object.create(ie);function oe(de){["next","throw","return"].forEach(function(ve){v(de,ve,function(Me){return this._invoke(ve,Me)})})}function re(de,ve){function Me(ye,Te,Ue,tt){var ot=E(de[ye],de,Te);if(ot.type!=="throw"){var ue=ot.arg,fe=ue.value;return fe&&typeof fe=="object"&&e.call(fe,"__await")?ve.resolve(fe.__await).then(function(Oe){Me("next",Oe,Ue,tt)},function(Oe){Me("throw",Oe,Ue,tt)}):ve.resolve(fe).then(function(Oe){ue.value=Oe,Ue(ue)},function(Oe){return Me("throw",Oe,Ue,tt)})}tt(ot.arg)}var we;this._invoke=function(ye,Te){function Ue(){return new ve(function(tt,ot){Me(ye,Te,tt,ot)})}return we=we?we.then(Ue,Ue):Ue()}}function me(de,ve){var Me=de.iterator[ve.method];if(Me===i){if(ve.delegate=null,ve.method==="throw"){if(de.iterator.return&&(ve.method="return",ve.arg=i,me(de,ve),ve.method==="throw"))return U;ve.method="throw",ve.arg=new TypeError("The iterator does not provide a 'throw' method")}return U}var we=E(Me,de.iterator,ve.arg);if(we.type==="throw")return ve.method="throw",ve.arg=we.arg,ve.delegate=null,U;var ye=we.arg;return ye?ye.done?(ve[de.resultName]=ye.value,ve.next=de.nextLoc,ve.method!=="return"&&(ve.method="next",ve.arg=i),ve.delegate=null,U):ye:(ve.method="throw",ve.arg=new TypeError("iterator result is not an object"),ve.delegate=null,U)}function pe(de){var ve={tryLoc:de[0]};1 in de&&(ve.catchLoc=de[1]),2 in de&&(ve.finallyLoc=de[2],ve.afterLoc=de[3]),this.tryEntries.push(ve)}function xe(de){var ve=de.completion||{};ve.type="normal",delete ve.arg,de.completion=ve}function Ce(de){this.tryEntries=[{tryLoc:"root"}],de.forEach(pe,this),this.reset(!0)}function Ie(de){if(de){var ve=de[a];if(ve)return ve.call(de);if(typeof de.next=="function")return de;if(!isNaN(de.length)){var Me=-1,we=function ye(){for(;++Me<de.length;)if(e.call(de,Me))return ye.value=de[Me],ye.done=!1,ye;return ye.value=i,ye.done=!0,ye};return we.next=we}}return{next:Pe}}function Pe(){return{value:i,done:!0}}return W.prototype=he.constructor=X,X.constructor=W,W.displayName=v(X,m,"GeneratorFunction"),o.isGeneratorFunction=function(de){var ve=typeof de=="function"&&de.constructor;return!!ve&&(ve===W||(ve.displayName||ve.name)==="GeneratorFunction")},o.mark=function(de){return Object.setPrototypeOf?Object.setPrototypeOf(de,X):(de.__proto__=X,v(de,m,"GeneratorFunction")),de.prototype=Object.create(he),de},o.awrap=function(de){return{__await:de}},oe(re.prototype),re.prototype[c]=function(){return this},o.AsyncIterator=re,o.async=function(de,ve,Me,we,ye){ye===void 0&&(ye=Promise);var Te=new re(b(de,ve,Me,we),ye);return o.isGeneratorFunction(ve)?Te:Te.next().then(function(Ue){return Ue.done?Ue.value:Te.next()})},oe(he),v(he,m,"Generator"),he[a]=function(){return this},he.toString=function(){return"[object Generator]"},o.keys=function(de){var ve=[];for(var Me in de)ve.push(Me);return ve.reverse(),function we(){for(;ve.length;){var ye=ve.pop();if(ye in de)return we.value=ye,we.done=!1,we}return we.done=!0,we}},o.values=Ie,Ce.prototype={constructor:Ce,reset:function(ve){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(xe),!ve)for(var Me in this)Me.charAt(0)==="t"&&e.call(this,Me)&&!isNaN(+Me.slice(1))&&(this[Me]=i)},stop:function(){this.done=!0;var ve=this.tryEntries[0].completion;if(ve.type==="throw")throw ve.arg;return this.rval},dispatchException:function(ve){if(this.done)throw ve;var Me=this;function we(ue,fe){return Ue.type="throw",Ue.arg=ve,Me.next=ue,fe&&(Me.method="next",Me.arg=i),!!fe}for(var ye=this.tryEntries.length-1;ye>=0;--ye){var Te=this.tryEntries[ye],Ue=Te.completion;if(Te.tryLoc==="root")return we("end");if(Te.tryLoc<=this.prev){var tt=e.call(Te,"catchLoc"),ot=e.call(Te,"finallyLoc");if(tt&&ot){if(this.prev<Te.catchLoc)return we(Te.catchLoc,!0);if(this.prev<Te.finallyLoc)return we(Te.finallyLoc)}else if(tt){if(this.prev<Te.catchLoc)return we(Te.catchLoc,!0)}else{if(!ot)throw new Error("try statement without catch or finally");if(this.prev<Te.finallyLoc)return we(Te.finallyLoc)}}}},abrupt:function(ve,Me){for(var we=this.tryEntries.length-1;we>=0;--we){var ye=this.tryEntries[we];if(ye.tryLoc<=this.prev&&e.call(ye,"finallyLoc")&&this.prev<ye.finallyLoc){var Te=ye;break}}Te&&(ve==="break"||ve==="continue")&&Te.tryLoc<=Me&&Me<=Te.finallyLoc&&(Te=null);var Ue=Te?Te.completion:{};return Ue.type=ve,Ue.arg=Me,Te?(this.method="next",this.next=Te.finallyLoc,U):this.complete(Ue)},complete:function(ve,Me){if(ve.type==="throw")throw ve.arg;return ve.type==="break"||ve.type==="continue"?this.next=ve.arg:ve.type==="return"?(this.rval=this.arg=ve.arg,this.method="return",this.next="end"):ve.type==="normal"&&Me&&(this.next=Me),U},finish:function(ve){for(var Me=this.tryEntries.length-1;Me>=0;--Me){var we=this.tryEntries[Me];if(we.finallyLoc===ve)return this.complete(we.completion,we.afterLoc),xe(we),U}},catch:function(ve){for(var Me=this.tryEntries.length-1;Me>=0;--Me){var we=this.tryEntries[Me];if(we.tryLoc===ve){var ye=we.completion;if(ye.type==="throw"){var Te=ye.arg;xe(we)}return Te}}throw new Error("illegal catch attempt")},delegateYield:function(ve,Me,we){return this.delegate={iterator:Ie(ve),resultName:Me,nextLoc:we},this.method==="next"&&(this.arg=i),U}},o}(D.exports);try{regeneratorRuntime=R}catch(o){Function("r","regeneratorRuntime = r")(R)}var B="126",d=100,N=300,_=301,l=302,n=303,r=304,h=306,u=307,g=1e3,p=1001,y=1002,x=1003,w=1004,M=1005,T=1006,A=1007,C=1008,z=1009,H=1012,q=1014,P=1015,Z=1016,K=1020,Y=1022,k=1023,ae=1026,j=1027,F=33776,J=33777,te=33778,_e=33779,ne=35840,le=35841,be=35842,je=35843,ze=37492,Re=37496,nt=2300,$e=2301,_t=2302,Ut=2400,Zt=2401,oi=2402,Nt=2500,Vn=2501,_i=3e3,Wn=3001,Gn=3007,ms=3002,In=3004,bt=3005,Sn=3006,ji=7680,un=35044,Vi=35048,Hn="300 es";function ks(o,i,t,e,s,a,c){try{var m=o[a](c),v=m.value}catch(b){return void t(b)}m.done?i(v):Promise.resolve(v).then(e,s)}function Vs(o,i){for(var t=0;t<i.length;t++){var e=i[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,e.key,e)}}function gi(o,i,t){return i&&Vs(o.prototype,i),t&&Vs(o,t),o}function Ne(o,i){o.prototype=Object.create(i.prototype),o.prototype.constructor=o,Wi(o,i)}function Wi(o,i){return(Wi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(o,i)}function bi(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function Kn(o,i){(i==null||i>o.length)&&(i=o.length);for(var t=0,e=new Array(i);t<i;t++)e[t]=o[t];return e}function mr(o,i){var t;if(typeof Symbol>"u"||o[Symbol.iterator]==null){if(Array.isArray(o)||(t=function(s,a){if(s){if(typeof s=="string")return Kn(s,a);var c=Object.prototype.toString.call(s).slice(8,-1);return c==="Object"&&s.constructor&&(c=s.constructor.name),c==="Map"||c==="Set"?Array.from(s):c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?Kn(s,a):void 0}}(o))||i&&o&&typeof o.length=="number"){t&&(o=t);var e=0;return function(){return e>=o.length?{done:!0}:{done:!1,value:o[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(t=o[Symbol.iterator]()).next.bind(t)}function Si(){}Object.assign(Si.prototype,{addEventListener:function(i,t){this._listeners===void 0&&(this._listeners={});var e=this._listeners;e[i]===void 0&&(e[i]=[]),e[i].indexOf(t)===-1&&e[i].push(t)},hasEventListener:function(i,t){if(this._listeners===void 0)return!1;var e=this._listeners;return e[i]!==void 0&&e[i].indexOf(t)!==-1},removeEventListener:function(i,t){if(this._listeners!==void 0){var e=this._listeners[i];if(e!==void 0){var s=e.indexOf(t);s!==-1&&e.splice(s,1)}}},dispatchEvent:function(i){if(this._listeners!==void 0){var t=this._listeners[i.type];if(t!==void 0){i.target=this;for(var e=t.slice(0),s=0,a=e.length;s<a;s++)e[s].call(this,i)}}}});for(var Tt=[],en=0;en<256;en++)Tt[en]=(en<16?"0":"")+en.toString(16);var Yn=1234567,dt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var i=4294967295*Math.random()|0,t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(Tt[255&i]+Tt[i>>8&255]+Tt[i>>16&255]+Tt[i>>24&255]+"-"+Tt[255&t]+Tt[t>>8&255]+"-"+Tt[t>>16&15|64]+Tt[t>>24&255]+"-"+Tt[63&e|128]+Tt[e>>8&255]+"-"+Tt[e>>16&255]+Tt[e>>24&255]+Tt[255&s]+Tt[s>>8&255]+Tt[s>>16&255]+Tt[s>>24&255]).toUpperCase()},clamp:function(i,t,e){return Math.max(t,Math.min(e,i))},euclideanModulo:function(i,t){return(i%t+t)%t},mapLinear:function(i,t,e,s,a){return s+(i-t)*(a-s)/(e-t)},lerp:function(i,t,e){return(1-e)*i+e*t},damp:function(i,t,e,s){return dt.lerp(i,t,1-Math.exp(-e*s))},pingpong:function(i,t){return t===void 0&&(t=1),t-Math.abs(dt.euclideanModulo(i,2*t)-t)},smoothstep:function(i,t,e){return i<=t?0:i>=e?1:(i=(i-t)/(e-t))*i*(3-2*i)},smootherstep:function(i,t,e){return i<=t?0:i>=e?1:(i=(i-t)/(e-t))*i*i*(i*(6*i-15)+10)},randInt:function(i,t){return i+Math.floor(Math.random()*(t-i+1))},randFloat:function(i,t){return i+Math.random()*(t-i)},randFloatSpread:function(i){return i*(.5-Math.random())},seededRandom:function(i){return i!==void 0&&(Yn=i%2147483647),((Yn=16807*Yn%2147483647)-1)/2147483646},degToRad:function(i){return i*dt.DEG2RAD},radToDeg:function(i){return i*dt.RAD2DEG},isPowerOfTwo:function(i){return(i&i-1)==0&&i!==0},ceilPowerOfTwo:function(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},floorPowerOfTwo:function(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},setQuaternionFromProperEuler:function(i,t,e,s,a){var c=Math.cos,m=Math.sin,v=c(e/2),b=m(e/2),E=c((t+s)/2),S=m((t+s)/2),L=c((t-s)/2),I=m((t-s)/2),O=c((s-t)/2),U=m((s-t)/2);switch(a){case"XYX":i.set(v*S,b*L,b*I,v*E);break;case"YZY":i.set(b*I,v*S,b*L,v*E);break;case"ZXZ":i.set(b*L,b*I,v*S,v*E);break;case"XZX":i.set(v*S,b*U,b*O,v*E);break;case"YXY":i.set(b*O,v*S,b*U,v*E);break;case"ZYZ":i.set(b*U,b*O,v*S,v*E);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}}},He=function(){function o(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=t,this.y=e}var i=o.prototype;return i.set=function(t,e){return this.x=t,this.y=e,this},i.setScalar=function(t){return this.x=t,this.y=t,this},i.setX=function(t){return this.x=t,this},i.setY=function(t){return this.y=t,this},i.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},i.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},i.clone=function(){return new this.constructor(this.x,this.y)},i.copy=function(t){return this.x=t.x,this.y=t.y,this},i.add=function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},i.addScalar=function(t){return this.x+=t,this.y+=t,this},i.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},i.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},i.sub=function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},i.subScalar=function(t){return this.x-=t,this.y-=t,this},i.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},i.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},i.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},i.divide=function(t){return this.x/=t.x,this.y/=t.y,this},i.divideScalar=function(t){return this.multiplyScalar(1/t)},i.applyMatrix3=function(t){var e=this.x,s=this.y,a=t.elements;return this.x=a[0]*e+a[3]*s+a[6],this.y=a[1]*e+a[4]*s+a[7],this},i.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},i.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},i.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},i.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},i.clampLength=function(t,e){var s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))},i.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},i.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},i.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},i.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.dot=function(t){return this.x*t.x+this.y*t.y},i.cross=function(t){return this.x*t.y-this.y*t.x},i.lengthSq=function(){return this.x*this.x+this.y*this.y},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)},i.normalize=function(){return this.divideScalar(this.length()||1)},i.angle=function(){var t=Math.atan2(-this.y,-this.x)+Math.PI;return t},i.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},i.distanceToSquared=function(t){var e=this.x-t.x,s=this.y-t.y;return e*e+s*s},i.manhattanDistanceTo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},i.setLength=function(t){return this.normalize().multiplyScalar(t)},i.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},i.lerpVectors=function(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this},i.equals=function(t){return t.x===this.x&&t.y===this.y},i.fromArray=function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t},i.fromBufferAttribute=function(t,e,s){return s!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},i.rotateAround=function(t,e){var s=Math.cos(e),a=Math.sin(e),c=this.x-t.x,m=this.y-t.y;return this.x=c*s-m*a+t.x,this.y=c*a+m*s+t.y,this},i.random=function(){return this.x=Math.random(),this.y=Math.random(),this},gi(o,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}]),o}();He.prototype.isVector2=!0;var Gi,Wt=function(){function o(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}var i=o.prototype;return i.set=function(t,e,s,a,c,m,v,b,E){var S=this.elements;return S[0]=t,S[1]=a,S[2]=v,S[3]=e,S[4]=c,S[5]=b,S[6]=s,S[7]=m,S[8]=E,this},i.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},i.copy=function(t){var e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this},i.extractBasis=function(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this},i.setFromMatrix4=function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},i.multiply=function(t){return this.multiplyMatrices(this,t)},i.premultiply=function(t){return this.multiplyMatrices(t,this)},i.multiplyMatrices=function(t,e){var s=t.elements,a=e.elements,c=this.elements,m=s[0],v=s[3],b=s[6],E=s[1],S=s[4],L=s[7],I=s[2],O=s[5],U=s[8],G=a[0],W=a[3],X=a[6],ie=a[1],$=a[4],ee=a[7],he=a[2],oe=a[5],re=a[8];return c[0]=m*G+v*ie+b*he,c[3]=m*W+v*$+b*oe,c[6]=m*X+v*ee+b*re,c[1]=E*G+S*ie+L*he,c[4]=E*W+S*$+L*oe,c[7]=E*X+S*ee+L*re,c[2]=I*G+O*ie+U*he,c[5]=I*W+O*$+U*oe,c[8]=I*X+O*ee+U*re,this},i.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},i.determinant=function(){var t=this.elements,e=t[0],s=t[1],a=t[2],c=t[3],m=t[4],v=t[5],b=t[6],E=t[7],S=t[8];return e*m*S-e*v*E-s*c*S+s*v*b+a*c*E-a*m*b},i.invert=function(){var t=this.elements,e=t[0],s=t[1],a=t[2],c=t[3],m=t[4],v=t[5],b=t[6],E=t[7],S=t[8],L=S*m-v*E,I=v*b-S*c,O=E*c-m*b,U=e*L+s*I+a*O;if(U===0)return this.set(0,0,0,0,0,0,0,0,0);var G=1/U;return t[0]=L*G,t[1]=(a*E-S*s)*G,t[2]=(v*s-a*m)*G,t[3]=I*G,t[4]=(S*e-a*b)*G,t[5]=(a*c-v*e)*G,t[6]=O*G,t[7]=(s*b-E*e)*G,t[8]=(m*e-s*c)*G,this},i.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},i.getNormalMatrix=function(t){return this.setFromMatrix4(t).invert().transpose()},i.transposeIntoArray=function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},i.setUvTransform=function(t,e,s,a,c,m,v){var b=Math.cos(c),E=Math.sin(c);return this.set(s*b,s*E,-s*(b*m+E*v)+m+t,-a*E,a*b,-a*(-E*m+b*v)+v+e,0,0,1),this},i.scale=function(t,e){var s=this.elements;return s[0]*=t,s[3]*=t,s[6]*=t,s[1]*=e,s[4]*=e,s[7]*=e,this},i.rotate=function(t){var e=Math.cos(t),s=Math.sin(t),a=this.elements,c=a[0],m=a[3],v=a[6],b=a[1],E=a[4],S=a[7];return a[0]=e*c+s*b,a[3]=e*m+s*E,a[6]=e*v+s*S,a[1]=-s*c+e*b,a[4]=-s*m+e*E,a[7]=-s*v+e*S,this},i.translate=function(t,e){var s=this.elements;return s[0]+=t*s[2],s[3]+=t*s[5],s[6]+=t*s[8],s[1]+=e*s[2],s[4]+=e*s[5],s[7]+=e*s[8],this},i.equals=function(t){for(var e=this.elements,s=t.elements,a=0;a<9;a++)if(e[a]!==s[a])return!1;return!0},i.fromArray=function(t,e){e===void 0&&(e=0);for(var s=0;s<9;s++)this.elements[s]=t[s+e];return this},i.toArray=function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t},i.clone=function(){return new this.constructor().fromArray(this.elements)},o}();Wt.prototype.isMatrix3=!0;var Hi={getDataURL:function(i){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;var t;if(i instanceof HTMLCanvasElement)t=i;else{Gi===void 0&&(Gi=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Gi.width=i.width,Gi.height=i.height;var e=Gi.getContext("2d");i instanceof ImageData?e.putImageData(i,0,0):e.drawImage(i,0,0,i.width,i.height),t=Gi}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},pa=0,ui=function(o){function i(e,s,a,c,m,v,b,E,S,L){var I;return e===void 0&&(e=i.DEFAULT_IMAGE),s===void 0&&(s=i.DEFAULT_MAPPING),a===void 0&&(a=p),c===void 0&&(c=p),m===void 0&&(m=T),v===void 0&&(v=C),b===void 0&&(b=k),E===void 0&&(E=z),S===void 0&&(S=1),L===void 0&&(L=_i),I=o.call(this)||this,Object.defineProperty(bi(I),"id",{value:pa++}),I.uuid=dt.generateUUID(),I.name="",I.image=e,I.mipmaps=[],I.mapping=s,I.wrapS=a,I.wrapT=c,I.magFilter=m,I.minFilter=v,I.anisotropy=S,I.format=b,I.internalFormat=null,I.type=E,I.offset=new He(0,0),I.repeat=new He(1,1),I.center=new He(0,0),I.rotation=0,I.matrixAutoUpdate=!0,I.matrix=new Wt,I.generateMipmaps=!0,I.premultiplyAlpha=!1,I.flipY=!0,I.unpackAlignment=4,I.encoding=L,I.version=0,I.onUpdate=null,I}Ne(i,o);var t=i.prototype;return t.updateMatrix=function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},t.clone=function(){return new this.constructor().copy(this)},t.copy=function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},t.toJSON=function(e){var s=e===void 0||typeof e=="string";if(!s&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];var a={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var c=this.image;if(c.uuid===void 0&&(c.uuid=dt.generateUUID()),!s&&e.images[c.uuid]===void 0){var m;if(Array.isArray(c)){m=[];for(var v=0,b=c.length;v<b;v++)c[v].isDataTexture?m.push(_s(c[v].image)):m.push(_s(c[v]))}else m=_s(c);e.images[c.uuid]={uuid:c.uuid,url:m}}a.image=c.uuid}return s||(e.textures[this.uuid]=a),a},t.dispose=function(){this.dispatchEvent({type:"dispose"})},t.transformUv=function(e){if(this.mapping!==N)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case g:e.x=e.x-Math.floor(e.x);break;case p:e.x=e.x<0?0:1;break;case y:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case g:e.y=e.y-Math.floor(e.y);break;case p:e.y=e.y<0?0:1;break;case y:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e},gi(i,[{key:"needsUpdate",set:function(s){s===!0&&this.version++}}]),i}(Si);function _s(o){return typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap?Hi.getDataURL(o):o.data?{data:Array.prototype.slice.call(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}ui.DEFAULT_IMAGE=void 0,ui.DEFAULT_MAPPING=N,ui.prototype.isTexture=!0;var Ft=function(){function o(t,e,s,a){t===void 0&&(t=0),e===void 0&&(e=0),s===void 0&&(s=0),a===void 0&&(a=1),this.x=t,this.y=e,this.z=s,this.w=a}var i=o.prototype;return i.set=function(t,e,s,a){return this.x=t,this.y=e,this.z=s,this.w=a,this},i.setScalar=function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},i.setX=function(t){return this.x=t,this},i.setY=function(t){return this.y=t,this},i.setZ=function(t){return this.z=t,this},i.setW=function(t){return this.w=t,this},i.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},i.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},i.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},i.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this},i.add=function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},i.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},i.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},i.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},i.sub=function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},i.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},i.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},i.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.applyMatrix4=function(t){var e=this.x,s=this.y,a=this.z,c=this.w,m=t.elements;return this.x=m[0]*e+m[4]*s+m[8]*a+m[12]*c,this.y=m[1]*e+m[5]*s+m[9]*a+m[13]*c,this.z=m[2]*e+m[6]*s+m[10]*a+m[14]*c,this.w=m[3]*e+m[7]*s+m[11]*a+m[15]*c,this},i.divideScalar=function(t){return this.multiplyScalar(1/t)},i.setAxisAngleFromQuaternion=function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},i.setAxisAngleFromRotationMatrix=function(t){var e,s,a,c,m=.01,v=.1,b=t.elements,E=b[0],S=b[4],L=b[8],I=b[1],O=b[5],U=b[9],G=b[2],W=b[6],X=b[10];if(Math.abs(S-I)<m&&Math.abs(L-G)<m&&Math.abs(U-W)<m){if(Math.abs(S+I)<v&&Math.abs(L+G)<v&&Math.abs(U+W)<v&&Math.abs(E+O+X-3)<v)return this.set(1,0,0,0),this;e=Math.PI;var ie=(E+1)/2,$=(O+1)/2,ee=(X+1)/2,he=(S+I)/4,oe=(L+G)/4,re=(U+W)/4;return ie>$&&ie>ee?ie<m?(s=0,a=.707106781,c=.707106781):(a=he/(s=Math.sqrt(ie)),c=oe/s):$>ee?$<m?(s=.707106781,a=0,c=.707106781):(s=he/(a=Math.sqrt($)),c=re/a):ee<m?(s=.707106781,a=.707106781,c=0):(s=oe/(c=Math.sqrt(ee)),a=re/c),this.set(s,a,c,e),this}var me=Math.sqrt((W-U)*(W-U)+(L-G)*(L-G)+(I-S)*(I-S));return Math.abs(me)<.001&&(me=1),this.x=(W-U)/me,this.y=(L-G)/me,this.z=(I-S)/me,this.w=Math.acos((E+O+X-1)/2),this},i.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},i.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},i.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},i.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},i.clampLength=function(t,e){var s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))},i.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},i.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},i.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},i.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},i.normalize=function(){return this.divideScalar(this.length()||1)},i.setLength=function(t){return this.normalize().multiplyScalar(t)},i.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},i.lerpVectors=function(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this},i.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},i.fromArray=function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},i.fromBufferAttribute=function(t,e,s){return s!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},i.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this},gi(o,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}}]),o}();Ft.prototype.isVector4=!0;var tn=function(o){function i(e,s,a){var c;return(c=o.call(this)||this).width=e,c.height=s,c.depth=1,c.scissor=new Ft(0,0,e,s),c.scissorTest=!1,c.viewport=new Ft(0,0,e,s),a=a||{},c.texture=new ui(void 0,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),c.texture.image={},c.texture.image.width=e,c.texture.image.height=s,c.texture.image.depth=1,c.texture.generateMipmaps=a.generateMipmaps!==void 0&&a.generateMipmaps,c.texture.minFilter=a.minFilter!==void 0?a.minFilter:T,c.depthBuffer=a.depthBuffer===void 0||a.depthBuffer,c.stencilBuffer=a.stencilBuffer!==void 0&&a.stencilBuffer,c.depthTexture=a.depthTexture!==void 0?a.depthTexture:null,c}Ne(i,o);var t=i.prototype;return t.setTexture=function(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e},t.setSize=function(e,s,a){a===void 0&&(a=1),this.width===e&&this.height===s&&this.depth===a||(this.width=e,this.height=s,this.depth=a,this.texture.image.width=e,this.texture.image.height=s,this.texture.image.depth=a,this.dispose()),this.viewport.set(0,0,e,s),this.scissor.set(0,0,e,s)},t.clone=function(){return new this.constructor().copy(this)},t.copy=function(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},t.dispose=function(){this.dispatchEvent({type:"dispose"})},i}(Si);tn.prototype.isWebGLRenderTarget=!0;var Xn=function(o){function i(t,e,s){var a;return(a=o.call(this,t,e,s)||this).samples=4,a}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.samples=t.samples,this},i}(tn);Xn.prototype.isWebGLMultisampleRenderTarget=!0;var ni=function(){function o(t,e,s,a){t===void 0&&(t=0),e===void 0&&(e=0),s===void 0&&(s=0),a===void 0&&(a=1),this._x=t,this._y=e,this._z=s,this._w=a}o.slerp=function(t,e,s,a){return s.copy(t).slerp(e,a)},o.slerpFlat=function(t,e,s,a,c,m,v){var b=s[a+0],E=s[a+1],S=s[a+2],L=s[a+3],I=c[m+0],O=c[m+1],U=c[m+2],G=c[m+3];if(v===0)return t[e+0]=b,t[e+1]=E,t[e+2]=S,void(t[e+3]=L);if(v===1)return t[e+0]=I,t[e+1]=O,t[e+2]=U,void(t[e+3]=G);if(L!==G||b!==I||E!==O||S!==U){var W=1-v,X=b*I+E*O+S*U+L*G,ie=X>=0?1:-1,$=1-X*X;if($>Number.EPSILON){var ee=Math.sqrt($),he=Math.atan2(ee,X*ie);W=Math.sin(W*he)/ee,v=Math.sin(v*he)/ee}var oe=v*ie;if(b=b*W+I*oe,E=E*W+O*oe,S=S*W+U*oe,L=L*W+G*oe,W===1-v){var re=1/Math.sqrt(b*b+E*E+S*S+L*L);b*=re,E*=re,S*=re,L*=re}}t[e]=b,t[e+1]=E,t[e+2]=S,t[e+3]=L},o.multiplyQuaternionsFlat=function(t,e,s,a,c,m){var v=s[a],b=s[a+1],E=s[a+2],S=s[a+3],L=c[m],I=c[m+1],O=c[m+2],U=c[m+3];return t[e]=v*U+S*L+b*O-E*I,t[e+1]=b*U+S*I+E*L-v*O,t[e+2]=E*U+S*O+v*I-b*L,t[e+3]=S*U-v*L-b*I-E*O,t};var i=o.prototype;return i.set=function(t,e,s,a){return this._x=t,this._y=e,this._z=s,this._w=a,this._onChangeCallback(),this},i.clone=function(){return new this.constructor(this._x,this._y,this._z,this._w)},i.copy=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},i.setFromEuler=function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var s=t._x,a=t._y,c=t._z,m=t._order,v=Math.cos,b=Math.sin,E=v(s/2),S=v(a/2),L=v(c/2),I=b(s/2),O=b(a/2),U=b(c/2);switch(m){case"XYZ":this._x=I*S*L+E*O*U,this._y=E*O*L-I*S*U,this._z=E*S*U+I*O*L,this._w=E*S*L-I*O*U;break;case"YXZ":this._x=I*S*L+E*O*U,this._y=E*O*L-I*S*U,this._z=E*S*U-I*O*L,this._w=E*S*L+I*O*U;break;case"ZXY":this._x=I*S*L-E*O*U,this._y=E*O*L+I*S*U,this._z=E*S*U+I*O*L,this._w=E*S*L-I*O*U;break;case"ZYX":this._x=I*S*L-E*O*U,this._y=E*O*L+I*S*U,this._z=E*S*U-I*O*L,this._w=E*S*L+I*O*U;break;case"YZX":this._x=I*S*L+E*O*U,this._y=E*O*L+I*S*U,this._z=E*S*U-I*O*L,this._w=E*S*L-I*O*U;break;case"XZY":this._x=I*S*L-E*O*U,this._y=E*O*L-I*S*U,this._z=E*S*U+I*O*L,this._w=E*S*L+I*O*U;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+m)}return e!==!1&&this._onChangeCallback(),this},i.setFromAxisAngle=function(t,e){var s=e/2,a=Math.sin(s);return this._x=t.x*a,this._y=t.y*a,this._z=t.z*a,this._w=Math.cos(s),this._onChangeCallback(),this},i.setFromRotationMatrix=function(t){var e=t.elements,s=e[0],a=e[4],c=e[8],m=e[1],v=e[5],b=e[9],E=e[2],S=e[6],L=e[10],I=s+v+L;if(I>0){var O=.5/Math.sqrt(I+1);this._w=.25/O,this._x=(S-b)*O,this._y=(c-E)*O,this._z=(m-a)*O}else if(s>v&&s>L){var U=2*Math.sqrt(1+s-v-L);this._w=(S-b)/U,this._x=.25*U,this._y=(a+m)/U,this._z=(c+E)/U}else if(v>L){var G=2*Math.sqrt(1+v-s-L);this._w=(c-E)/G,this._x=(a+m)/G,this._y=.25*G,this._z=(b+S)/G}else{var W=2*Math.sqrt(1+L-s-v);this._w=(m-a)/W,this._x=(c+E)/W,this._y=(b+S)/W,this._z=.25*W}return this._onChangeCallback(),this},i.setFromUnitVectors=function(t,e){var s=t.dot(e)+1;return s<1e-6?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()},i.angleTo=function(t){return 2*Math.acos(Math.abs(dt.clamp(this.dot(t),-1,1)))},i.rotateTowards=function(t,e){var s=this.angleTo(t);if(s===0)return this;var a=Math.min(1,e/s);return this.slerp(t,a),this},i.identity=function(){return this.set(0,0,0,1)},i.invert=function(){return this.conjugate()},i.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},i.dot=function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},i.lengthSq=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},i.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},i.normalize=function(){var t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},i.multiply=function(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},i.premultiply=function(t){return this.multiplyQuaternions(t,this)},i.multiplyQuaternions=function(t,e){var s=t._x,a=t._y,c=t._z,m=t._w,v=e._x,b=e._y,E=e._z,S=e._w;return this._x=s*S+m*v+a*E-c*b,this._y=a*S+m*b+c*v-s*E,this._z=c*S+m*E+s*b-a*v,this._w=m*S-s*v-a*b-c*E,this._onChangeCallback(),this},i.slerp=function(t,e){if(e===0)return this;if(e===1)return this.copy(t);var s=this._x,a=this._y,c=this._z,m=this._w,v=m*t._w+s*t._x+a*t._y+c*t._z;if(v<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,v=-v):this.copy(t),v>=1)return this._w=m,this._x=s,this._y=a,this._z=c,this;var b=1-v*v;if(b<=Number.EPSILON){var E=1-e;return this._w=E*m+e*this._w,this._x=E*s+e*this._x,this._y=E*a+e*this._y,this._z=E*c+e*this._z,this.normalize(),this._onChangeCallback(),this}var S=Math.sqrt(b),L=Math.atan2(S,v),I=Math.sin((1-e)*L)/S,O=Math.sin(e*L)/S;return this._w=m*I+this._w*O,this._x=s*I+this._x*O,this._y=a*I+this._y*O,this._z=c*I+this._z*O,this._onChangeCallback(),this},i.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},i.fromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},i.fromBufferAttribute=function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},i._onChange=function(t){return this._onChangeCallback=t,this},i._onChangeCallback=function(){},gi(o,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}]),o}();ni.prototype.isQuaternion=!0;var se=function(){function o(t,e,s){t===void 0&&(t=0),e===void 0&&(e=0),s===void 0&&(s=0),this.x=t,this.y=e,this.z=s}var i=o.prototype;return i.set=function(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this},i.setScalar=function(t){return this.x=t,this.y=t,this.z=t,this},i.setX=function(t){return this.x=t,this},i.setY=function(t){return this.y=t,this},i.setZ=function(t){return this.z=t,this},i.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},i.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},i.clone=function(){return new this.constructor(this.x,this.y,this.z)},i.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.add=function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},i.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this},i.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},i.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},i.sub=function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},i.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this},i.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},i.multiply=function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},i.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.multiplyVectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},i.applyEuler=function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Ws.setFromEuler(t))},i.applyAxisAngle=function(t,e){return this.applyQuaternion(Ws.setFromAxisAngle(t,e))},i.applyMatrix3=function(t){var e=this.x,s=this.y,a=this.z,c=t.elements;return this.x=c[0]*e+c[3]*s+c[6]*a,this.y=c[1]*e+c[4]*s+c[7]*a,this.z=c[2]*e+c[5]*s+c[8]*a,this},i.applyNormalMatrix=function(t){return this.applyMatrix3(t).normalize()},i.applyMatrix4=function(t){var e=this.x,s=this.y,a=this.z,c=t.elements,m=1/(c[3]*e+c[7]*s+c[11]*a+c[15]);return this.x=(c[0]*e+c[4]*s+c[8]*a+c[12])*m,this.y=(c[1]*e+c[5]*s+c[9]*a+c[13])*m,this.z=(c[2]*e+c[6]*s+c[10]*a+c[14])*m,this},i.applyQuaternion=function(t){var e=this.x,s=this.y,a=this.z,c=t.x,m=t.y,v=t.z,b=t.w,E=b*e+m*a-v*s,S=b*s+v*e-c*a,L=b*a+c*s-m*e,I=-c*e-m*s-v*a;return this.x=E*b+I*-c+S*-v-L*-m,this.y=S*b+I*-m+L*-c-E*-v,this.z=L*b+I*-v+E*-m-S*-c,this},i.project=function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},i.unproject=function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},i.transformDirection=function(t){var e=this.x,s=this.y,a=this.z,c=t.elements;return this.x=c[0]*e+c[4]*s+c[8]*a,this.y=c[1]*e+c[5]*s+c[9]*a,this.z=c[2]*e+c[6]*s+c[10]*a,this.normalize()},i.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},i.divideScalar=function(t){return this.multiplyScalar(1/t)},i.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},i.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},i.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},i.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},i.clampLength=function(t,e){var s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))},i.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},i.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},i.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},i.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},i.normalize=function(){return this.divideScalar(this.length()||1)},i.setLength=function(t){return this.normalize().multiplyScalar(t)},i.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},i.lerpVectors=function(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this},i.cross=function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},i.crossVectors=function(t,e){var s=t.x,a=t.y,c=t.z,m=e.x,v=e.y,b=e.z;return this.x=a*b-c*v,this.y=c*m-s*b,this.z=s*v-a*m,this},i.projectOnVector=function(t){var e=t.lengthSq();if(e===0)return this.set(0,0,0);var s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)},i.projectOnPlane=function(t){return Zn.copy(this).projectOnVector(t),this.sub(Zn)},i.reflect=function(t){return this.sub(Zn.copy(t).multiplyScalar(2*this.dot(t)))},i.angleTo=function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;var s=this.dot(t)/e;return Math.acos(dt.clamp(s,-1,1))},i.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},i.distanceToSquared=function(t){var e=this.x-t.x,s=this.y-t.y,a=this.z-t.z;return e*e+s*s+a*a},i.manhattanDistanceTo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},i.setFromSpherical=function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},i.setFromSphericalCoords=function(t,e,s){var a=Math.sin(e)*t;return this.x=a*Math.sin(s),this.y=Math.cos(e)*t,this.z=a*Math.cos(s),this},i.setFromCylindrical=function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},i.setFromCylindricalCoords=function(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this},i.setFromMatrixPosition=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},i.setFromMatrixScale=function(t){var e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),a=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=a,this},i.setFromMatrixColumn=function(t,e){return this.fromArray(t.elements,4*e)},i.setFromMatrix3Column=function(t,e){return this.fromArray(t.elements,3*e)},i.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},i.fromArray=function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},i.fromBufferAttribute=function(t,e,s){return s!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},i.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this},o}();se.prototype.isVector3=!0;var Zn=new se,Ws=new ni,xi=function(){function o(t,e){t===void 0&&(t=new se(1/0,1/0,1/0)),e===void 0&&(e=new se(-1/0,-1/0,-1/0)),this.min=t,this.max=e}var i=o.prototype;return i.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},i.setFromArray=function(t){for(var e=1/0,s=1/0,a=1/0,c=-1/0,m=-1/0,v=-1/0,b=0,E=t.length;b<E;b+=3){var S=t[b],L=t[b+1],I=t[b+2];S<e&&(e=S),L<s&&(s=L),I<a&&(a=I),S>c&&(c=S),L>m&&(m=L),I>v&&(v=I)}return this.min.set(e,s,a),this.max.set(c,m,v),this},i.setFromBufferAttribute=function(t){for(var e=1/0,s=1/0,a=1/0,c=-1/0,m=-1/0,v=-1/0,b=0,E=t.count;b<E;b++){var S=t.getX(b),L=t.getY(b),I=t.getZ(b);S<e&&(e=S),L<s&&(s=L),I<a&&(a=I),S>c&&(c=S),L>m&&(m=L),I>v&&(v=I)}return this.min.set(e,s,a),this.max.set(c,m,v),this},i.setFromPoints=function(t){this.makeEmpty();for(var e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this},i.setFromCenterAndSize=function(t,e){var s=li.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this},i.setFromObject=function(t){return this.makeEmpty(),this.expandByObject(t)},i.clone=function(){return new this.constructor().copy(this)},i.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},i.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},i.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},i.getCenter=function(t){return t===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new se),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},i.getSize=function(t){return t===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new se),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},i.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},i.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},i.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},i.expandByObject=function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;e!==void 0&&(e.boundingBox===null&&e.computeBoundingBox(),On.copy(e.boundingBox),On.applyMatrix4(t.matrixWorld),this.union(On));for(var s=t.children,a=0,c=s.length;a<c;a++)this.expandByObject(s[a]);return this},i.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},i.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},i.getParameter=function(t,e){return e===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new se),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},i.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},i.intersectsSphere=function(t){return this.clampPoint(t.center,li),li.distanceToSquared(t.center)<=t.radius*t.radius},i.intersectsPlane=function(t){var e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant},i.intersectsTriangle=function(t){if(this.isEmpty())return!1;this.getCenter(qn),gs.subVectors(this.max,qn),Ki.subVectors(t.a,qn),Yi.subVectors(t.b,qn),dn.subVectors(t.c,qn),fn.subVectors(Yi,Ki),nn.subVectors(dn,Yi),pn.subVectors(Ki,dn);var e=[0,-fn.z,fn.y,0,-nn.z,nn.y,0,-pn.z,pn.y,fn.z,0,-fn.x,nn.z,0,-nn.x,pn.z,0,-pn.x,-fn.y,fn.x,0,-nn.y,nn.x,0,-pn.y,pn.x,0];return!!Gs(e,Ki,Yi,dn,gs)&&!!Gs(e=[1,0,0,0,1,0,0,0,1],Ki,Yi,dn,gs)&&(Qn.crossVectors(fn,nn),Gs(e=[Qn.x,Qn.y,Qn.z],Ki,Yi,dn,gs))},i.clampPoint=function(t,e){return e===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new se),e.copy(t).clamp(this.min,this.max)},i.distanceToPoint=function(t){return li.copy(t).clamp(this.min,this.max).sub(t).length()},i.getBoundingSphere=function(t){return t===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(li).length(),t},i.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},i.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},i.applyMatrix4=function(t){return this.isEmpty()||(Li[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Li[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Li[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Li[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Li[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Li[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Li[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Li[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Li)),this},i.translate=function(t){return this.min.add(t),this.max.add(t),this},i.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},o}();xi.prototype.isBox3=!0;var Li=[new se,new se,new se,new se,new se,new se,new se,new se],li=new se,On=new xi,Ki=new se,Yi=new se,dn=new se,fn=new se,nn=new se,pn=new se,qn=new se,gs=new se,Qn=new se,En=new se;function Gs(o,i,t,e,s){for(var a=0,c=o.length-3;a<=c;a+=3){En.fromArray(o,a);var m=s.x*Math.abs(En.x)+s.y*Math.abs(En.y)+s.z*Math.abs(En.z),v=i.dot(En),b=t.dot(En),E=e.dot(En);if(Math.max(-Math.max(v,b,E),Math.min(v,b,E))>m)return!1}return!0}var _r=new xi,mn=function(){function o(t,e){t===void 0&&(t=new se),e===void 0&&(e=-1),this.center=t,this.radius=e}var i=o.prototype;return i.set=function(t,e){return this.center.copy(t),this.radius=e,this},i.setFromPoints=function(t,e){var s=this.center;e!==void 0?s.copy(e):_r.setFromPoints(t).getCenter(s);for(var a=0,c=0,m=t.length;c<m;c++)a=Math.max(a,s.distanceToSquared(t[c]));return this.radius=Math.sqrt(a),this},i.copy=function(t){return this.center.copy(t.center),this.radius=t.radius,this},i.isEmpty=function(){return this.radius<0},i.makeEmpty=function(){return this.center.set(0,0,0),this.radius=-1,this},i.containsPoint=function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},i.distanceToPoint=function(t){return t.distanceTo(this.center)-this.radius},i.intersectsSphere=function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},i.intersectsBox=function(t){return t.intersectsSphere(this)},i.intersectsPlane=function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},i.clampPoint=function(t,e){var s=this.center.distanceToSquared(t);return e===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new se),e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},i.getBoundingBox=function(t){return t===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new xi),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},i.applyMatrix4=function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},i.translate=function(t){return this.center.add(t),this},i.equals=function(t){return t.center.equals(this.center)&&t.radius===this.radius},i.clone=function(){return new this.constructor().copy(this)},o}(),sn=new se,vs=new se,ys=new se,_n=new se,Jn=new se,bs=new se,Hs=new se,rn=function(){function o(t,e){t===void 0&&(t=new se),e===void 0&&(e=new se(0,0,-1)),this.origin=t,this.direction=e}var i=o.prototype;return i.set=function(t,e){return this.origin.copy(t),this.direction.copy(e),this},i.copy=function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},i.at=function(t,e){return e===void 0&&(console.warn("THREE.Ray: .at() target is now required"),e=new se),e.copy(this.direction).multiplyScalar(t).add(this.origin)},i.lookAt=function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},i.recast=function(t){return this.origin.copy(this.at(t,sn)),this},i.closestPointToPoint=function(t,e){e===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new se),e.subVectors(t,this.origin);var s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(s).add(this.origin)},i.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},i.distanceSqToPoint=function(t){var e=sn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(sn.copy(this.direction).multiplyScalar(e).add(this.origin),sn.distanceToSquared(t))},i.distanceSqToSegment=function(t,e,s,a){vs.copy(t).add(e).multiplyScalar(.5),ys.copy(e).sub(t).normalize(),_n.copy(this.origin).sub(vs);var c,m,v,b,E=.5*t.distanceTo(e),S=-this.direction.dot(ys),L=_n.dot(this.direction),I=-_n.dot(ys),O=_n.lengthSq(),U=Math.abs(1-S*S);if(U>0)if(m=S*L-I,b=E*U,(c=S*I-L)>=0)if(m>=-b)if(m<=b){var G=1/U;v=(c*=G)*(c+S*(m*=G)+2*L)+m*(S*c+m+2*I)+O}else m=E,v=-(c=Math.max(0,-(S*m+L)))*c+m*(m+2*I)+O;else m=-E,v=-(c=Math.max(0,-(S*m+L)))*c+m*(m+2*I)+O;else m<=-b?v=-(c=Math.max(0,-(-S*E+L)))*c+(m=c>0?-E:Math.min(Math.max(-E,-I),E))*(m+2*I)+O:m<=b?(c=0,v=(m=Math.min(Math.max(-E,-I),E))*(m+2*I)+O):v=-(c=Math.max(0,-(S*E+L)))*c+(m=c>0?E:Math.min(Math.max(-E,-I),E))*(m+2*I)+O;else m=S>0?-E:E,v=-(c=Math.max(0,-(S*m+L)))*c+m*(m+2*I)+O;return s&&s.copy(this.direction).multiplyScalar(c).add(this.origin),a&&a.copy(ys).multiplyScalar(m).add(vs),v},i.intersectSphere=function(t,e){sn.subVectors(t.center,this.origin);var s=sn.dot(this.direction),a=sn.dot(sn)-s*s,c=t.radius*t.radius;if(a>c)return null;var m=Math.sqrt(c-a),v=s-m,b=s+m;return v<0&&b<0?null:v<0?this.at(b,e):this.at(v,e)},i.intersectsSphere=function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},i.distanceToPlane=function(t){var e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;var s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null},i.intersectPlane=function(t,e){var s=this.distanceToPlane(t);return s===null?null:this.at(s,e)},i.intersectsPlane=function(t){var e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0},i.intersectBox=function(t,e){var s,a,c,m,v,b,E=1/this.direction.x,S=1/this.direction.y,L=1/this.direction.z,I=this.origin;return E>=0?(s=(t.min.x-I.x)*E,a=(t.max.x-I.x)*E):(s=(t.max.x-I.x)*E,a=(t.min.x-I.x)*E),S>=0?(c=(t.min.y-I.y)*S,m=(t.max.y-I.y)*S):(c=(t.max.y-I.y)*S,m=(t.min.y-I.y)*S),s>m||c>a?null:((c>s||s!=s)&&(s=c),(m<a||a!=a)&&(a=m),L>=0?(v=(t.min.z-I.z)*L,b=(t.max.z-I.z)*L):(v=(t.max.z-I.z)*L,b=(t.min.z-I.z)*L),s>b||v>a?null:((v>s||s!=s)&&(s=v),(b<a||a!=a)&&(a=b),a<0?null:this.at(s>=0?s:a,e)))},i.intersectsBox=function(t){return this.intersectBox(t,sn)!==null},i.intersectTriangle=function(t,e,s,a,c){Jn.subVectors(e,t),bs.subVectors(s,t),Hs.crossVectors(Jn,bs);var m,v=this.direction.dot(Hs);if(v>0){if(a)return null;m=1}else{if(!(v<0))return null;m=-1,v=-v}_n.subVectors(this.origin,t);var b=m*this.direction.dot(bs.crossVectors(_n,bs));if(b<0)return null;var E=m*this.direction.dot(Jn.cross(_n));if(E<0||b+E>v)return null;var S=-m*_n.dot(Hs);return S<0?null:this.at(S/v,c)},i.applyMatrix4=function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},i.equals=function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},i.clone=function(){return new this.constructor().copy(this)},o}(),ht=function(){function o(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}var i=o.prototype;return i.set=function(t,e,s,a,c,m,v,b,E,S,L,I,O,U,G,W){var X=this.elements;return X[0]=t,X[4]=e,X[8]=s,X[12]=a,X[1]=c,X[5]=m,X[9]=v,X[13]=b,X[2]=E,X[6]=S,X[10]=L,X[14]=I,X[3]=O,X[7]=U,X[11]=G,X[15]=W,this},i.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},i.clone=function(){return new o().fromArray(this.elements)},i.copy=function(t){var e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this},i.copyPosition=function(t){var e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this},i.setFromMatrix3=function(t){var e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this},i.extractBasis=function(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this},i.makeBasis=function(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this},i.extractRotation=function(t){var e=this.elements,s=t.elements,a=1/An.setFromMatrixColumn(t,0).length(),c=1/An.setFromMatrixColumn(t,1).length(),m=1/An.setFromMatrixColumn(t,2).length();return e[0]=s[0]*a,e[1]=s[1]*a,e[2]=s[2]*a,e[3]=0,e[4]=s[4]*c,e[5]=s[5]*c,e[6]=s[6]*c,e[7]=0,e[8]=s[8]*m,e[9]=s[9]*m,e[10]=s[10]*m,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},i.makeRotationFromEuler=function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,s=t.x,a=t.y,c=t.z,m=Math.cos(s),v=Math.sin(s),b=Math.cos(a),E=Math.sin(a),S=Math.cos(c),L=Math.sin(c);if(t.order==="XYZ"){var I=m*S,O=m*L,U=v*S,G=v*L;e[0]=b*S,e[4]=-b*L,e[8]=E,e[1]=O+U*E,e[5]=I-G*E,e[9]=-v*b,e[2]=G-I*E,e[6]=U+O*E,e[10]=m*b}else if(t.order==="YXZ"){var W=b*S,X=b*L,ie=E*S,$=E*L;e[0]=W+$*v,e[4]=ie*v-X,e[8]=m*E,e[1]=m*L,e[5]=m*S,e[9]=-v,e[2]=X*v-ie,e[6]=$+W*v,e[10]=m*b}else if(t.order==="ZXY"){var ee=b*S,he=b*L,oe=E*S,re=E*L;e[0]=ee-re*v,e[4]=-m*L,e[8]=oe+he*v,e[1]=he+oe*v,e[5]=m*S,e[9]=re-ee*v,e[2]=-m*E,e[6]=v,e[10]=m*b}else if(t.order==="ZYX"){var me=m*S,pe=m*L,xe=v*S,Ce=v*L;e[0]=b*S,e[4]=xe*E-pe,e[8]=me*E+Ce,e[1]=b*L,e[5]=Ce*E+me,e[9]=pe*E-xe,e[2]=-E,e[6]=v*b,e[10]=m*b}else if(t.order==="YZX"){var Ie=m*b,Pe=m*E,de=v*b,ve=v*E;e[0]=b*S,e[4]=ve-Ie*L,e[8]=de*L+Pe,e[1]=L,e[5]=m*S,e[9]=-v*S,e[2]=-E*S,e[6]=Pe*L+de,e[10]=Ie-ve*L}else if(t.order==="XZY"){var Me=m*b,we=m*E,ye=v*b,Te=v*E;e[0]=b*S,e[4]=-L,e[8]=E*S,e[1]=Me*L+Te,e[5]=m*S,e[9]=we*L-ye,e[2]=ye*L-we,e[6]=v*S,e[10]=Te*L+Me}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},i.makeRotationFromQuaternion=function(t){return this.compose(Q,t,ge)},i.lookAt=function(t,e,s){var a=this.elements;return Ge.subVectors(t,e),Ge.lengthSq()===0&&(Ge.z=1),Ge.normalize(),Se.crossVectors(s,Ge),Se.lengthSq()===0&&(Math.abs(s.z)===1?Ge.x+=1e-4:Ge.z+=1e-4,Ge.normalize(),Se.crossVectors(s,Ge)),Se.normalize(),Be.crossVectors(Ge,Se),a[0]=Se.x,a[4]=Be.x,a[8]=Ge.x,a[1]=Se.y,a[5]=Be.y,a[9]=Ge.y,a[2]=Se.z,a[6]=Be.z,a[10]=Ge.z,this},i.multiply=function(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},i.premultiply=function(t){return this.multiplyMatrices(t,this)},i.multiplyMatrices=function(t,e){var s=t.elements,a=e.elements,c=this.elements,m=s[0],v=s[4],b=s[8],E=s[12],S=s[1],L=s[5],I=s[9],O=s[13],U=s[2],G=s[6],W=s[10],X=s[14],ie=s[3],$=s[7],ee=s[11],he=s[15],oe=a[0],re=a[4],me=a[8],pe=a[12],xe=a[1],Ce=a[5],Ie=a[9],Pe=a[13],de=a[2],ve=a[6],Me=a[10],we=a[14],ye=a[3],Te=a[7],Ue=a[11],tt=a[15];return c[0]=m*oe+v*xe+b*de+E*ye,c[4]=m*re+v*Ce+b*ve+E*Te,c[8]=m*me+v*Ie+b*Me+E*Ue,c[12]=m*pe+v*Pe+b*we+E*tt,c[1]=S*oe+L*xe+I*de+O*ye,c[5]=S*re+L*Ce+I*ve+O*Te,c[9]=S*me+L*Ie+I*Me+O*Ue,c[13]=S*pe+L*Pe+I*we+O*tt,c[2]=U*oe+G*xe+W*de+X*ye,c[6]=U*re+G*Ce+W*ve+X*Te,c[10]=U*me+G*Ie+W*Me+X*Ue,c[14]=U*pe+G*Pe+W*we+X*tt,c[3]=ie*oe+$*xe+ee*de+he*ye,c[7]=ie*re+$*Ce+ee*ve+he*Te,c[11]=ie*me+$*Ie+ee*Me+he*Ue,c[15]=ie*pe+$*Pe+ee*we+he*tt,this},i.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},i.determinant=function(){var t=this.elements,e=t[0],s=t[4],a=t[8],c=t[12],m=t[1],v=t[5],b=t[9],E=t[13],S=t[2],L=t[6],I=t[10],O=t[14];return t[3]*(+c*b*L-a*E*L-c*v*I+s*E*I+a*v*O-s*b*O)+t[7]*(+e*b*O-e*E*I+c*m*I-a*m*O+a*E*S-c*b*S)+t[11]*(+e*E*L-e*v*O-c*m*L+s*m*O+c*v*S-s*E*S)+t[15]*(-a*v*S-e*b*L+e*v*I+a*m*L-s*m*I+s*b*S)},i.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},i.setPosition=function(t,e,s){var a=this.elements;return t.isVector3?(a[12]=t.x,a[13]=t.y,a[14]=t.z):(a[12]=t,a[13]=e,a[14]=s),this},i.invert=function(){var t=this.elements,e=t[0],s=t[1],a=t[2],c=t[3],m=t[4],v=t[5],b=t[6],E=t[7],S=t[8],L=t[9],I=t[10],O=t[11],U=t[12],G=t[13],W=t[14],X=t[15],ie=L*W*E-G*I*E+G*b*O-v*W*O-L*b*X+v*I*X,$=U*I*E-S*W*E-U*b*O+m*W*O+S*b*X-m*I*X,ee=S*G*E-U*L*E+U*v*O-m*G*O-S*v*X+m*L*X,he=U*L*b-S*G*b-U*v*I+m*G*I+S*v*W-m*L*W,oe=e*ie+s*$+a*ee+c*he;if(oe===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var re=1/oe;return t[0]=ie*re,t[1]=(G*I*c-L*W*c-G*a*O+s*W*O+L*a*X-s*I*X)*re,t[2]=(v*W*c-G*b*c+G*a*E-s*W*E-v*a*X+s*b*X)*re,t[3]=(L*b*c-v*I*c-L*a*E+s*I*E+v*a*O-s*b*O)*re,t[4]=$*re,t[5]=(S*W*c-U*I*c+U*a*O-e*W*O-S*a*X+e*I*X)*re,t[6]=(U*b*c-m*W*c-U*a*E+e*W*E+m*a*X-e*b*X)*re,t[7]=(m*I*c-S*b*c+S*a*E-e*I*E-m*a*O+e*b*O)*re,t[8]=ee*re,t[9]=(U*L*c-S*G*c-U*s*O+e*G*O+S*s*X-e*L*X)*re,t[10]=(m*G*c-U*v*c+U*s*E-e*G*E-m*s*X+e*v*X)*re,t[11]=(S*v*c-m*L*c-S*s*E+e*L*E+m*s*O-e*v*O)*re,t[12]=he*re,t[13]=(S*G*a-U*L*a+U*s*I-e*G*I-S*s*W+e*L*W)*re,t[14]=(U*v*a-m*G*a-U*s*b+e*G*b+m*s*W-e*v*W)*re,t[15]=(m*L*a-S*v*a+S*s*b-e*L*b-m*s*I+e*v*I)*re,this},i.scale=function(t){var e=this.elements,s=t.x,a=t.y,c=t.z;return e[0]*=s,e[4]*=a,e[8]*=c,e[1]*=s,e[5]*=a,e[9]*=c,e[2]*=s,e[6]*=a,e[10]*=c,e[3]*=s,e[7]*=a,e[11]*=c,this},i.getMaxScaleOnAxis=function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],a=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,a))},i.makeTranslation=function(t,e,s){return this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this},i.makeRotationX=function(t){var e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this},i.makeRotationY=function(t){var e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this},i.makeRotationZ=function(t){var e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this},i.makeRotationAxis=function(t,e){var s=Math.cos(e),a=Math.sin(e),c=1-s,m=t.x,v=t.y,b=t.z,E=c*m,S=c*v;return this.set(E*m+s,E*v-a*b,E*b+a*v,0,E*v+a*b,S*v+s,S*b-a*m,0,E*b-a*v,S*b+a*m,c*b*b+s,0,0,0,0,1),this},i.makeScale=function(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this},i.makeShear=function(t,e,s){return this.set(1,e,s,0,t,1,s,0,t,e,1,0,0,0,0,1),this},i.compose=function(t,e,s){var a=this.elements,c=e._x,m=e._y,v=e._z,b=e._w,E=c+c,S=m+m,L=v+v,I=c*E,O=c*S,U=c*L,G=m*S,W=m*L,X=v*L,ie=b*E,$=b*S,ee=b*L,he=s.x,oe=s.y,re=s.z;return a[0]=(1-(G+X))*he,a[1]=(O+ee)*he,a[2]=(U-$)*he,a[3]=0,a[4]=(O-ee)*oe,a[5]=(1-(I+X))*oe,a[6]=(W+ie)*oe,a[7]=0,a[8]=(U+$)*re,a[9]=(W-ie)*re,a[10]=(1-(I+G))*re,a[11]=0,a[12]=t.x,a[13]=t.y,a[14]=t.z,a[15]=1,this},i.decompose=function(t,e,s){var a=this.elements,c=An.set(a[0],a[1],a[2]).length(),m=An.set(a[4],a[5],a[6]).length(),v=An.set(a[8],a[9],a[10]).length();this.determinant()<0&&(c=-c),t.x=a[12],t.y=a[13],t.z=a[14],Pi.copy(this);var b=1/c,E=1/m,S=1/v;return Pi.elements[0]*=b,Pi.elements[1]*=b,Pi.elements[2]*=b,Pi.elements[4]*=E,Pi.elements[5]*=E,Pi.elements[6]*=E,Pi.elements[8]*=S,Pi.elements[9]*=S,Pi.elements[10]*=S,e.setFromRotationMatrix(Pi),s.x=c,s.y=m,s.z=v,this},i.makePerspective=function(t,e,s,a,c,m){m===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var v=this.elements,b=2*c/(e-t),E=2*c/(s-a),S=(e+t)/(e-t),L=(s+a)/(s-a),I=-(m+c)/(m-c),O=-2*m*c/(m-c);return v[0]=b,v[4]=0,v[8]=S,v[12]=0,v[1]=0,v[5]=E,v[9]=L,v[13]=0,v[2]=0,v[6]=0,v[10]=I,v[14]=O,v[3]=0,v[7]=0,v[11]=-1,v[15]=0,this},i.makeOrthographic=function(t,e,s,a,c,m){var v=this.elements,b=1/(e-t),E=1/(s-a),S=1/(m-c),L=(e+t)*b,I=(s+a)*E,O=(m+c)*S;return v[0]=2*b,v[4]=0,v[8]=0,v[12]=-L,v[1]=0,v[5]=2*E,v[9]=0,v[13]=-I,v[2]=0,v[6]=0,v[10]=-2*S,v[14]=-O,v[3]=0,v[7]=0,v[11]=0,v[15]=1,this},i.equals=function(t){for(var e=this.elements,s=t.elements,a=0;a<16;a++)if(e[a]!==s[a])return!1;return!0},i.fromArray=function(t,e){e===void 0&&(e=0);for(var s=0;s<16;s++)this.elements[s]=t[s+e];return this},i.toArray=function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t},o}();ht.prototype.isMatrix4=!0;var An=new se,Pi=new ht,Q=new se(0,0,0),ge=new se(1,1,1),Se=new se,Be=new se,Ge=new se,Je=new ht,lt=new ni,ft=function(){function o(t,e,s,a){t===void 0&&(t=0),e===void 0&&(e=0),s===void 0&&(s=0),a===void 0&&(a=o.DefaultOrder),this._x=t,this._y=e,this._z=s,this._order=a}var i=o.prototype;return i.set=function(t,e,s,a){return this._x=t,this._y=e,this._z=s,this._order=a||this._order,this._onChangeCallback(),this},i.clone=function(){return new this.constructor(this._x,this._y,this._z,this._order)},i.copy=function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},i.setFromRotationMatrix=function(t,e,s){var a=dt.clamp,c=t.elements,m=c[0],v=c[4],b=c[8],E=c[1],S=c[5],L=c[9],I=c[2],O=c[6],U=c[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(a(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(-L,U),this._z=Math.atan2(-v,m)):(this._x=Math.atan2(O,S),this._z=0);break;case"YXZ":this._x=Math.asin(-a(L,-1,1)),Math.abs(L)<.9999999?(this._y=Math.atan2(b,U),this._z=Math.atan2(E,S)):(this._y=Math.atan2(-I,m),this._z=0);break;case"ZXY":this._x=Math.asin(a(O,-1,1)),Math.abs(O)<.9999999?(this._y=Math.atan2(-I,U),this._z=Math.atan2(-v,S)):(this._y=0,this._z=Math.atan2(E,m));break;case"ZYX":this._y=Math.asin(-a(I,-1,1)),Math.abs(I)<.9999999?(this._x=Math.atan2(O,U),this._z=Math.atan2(E,m)):(this._x=0,this._z=Math.atan2(-v,S));break;case"YZX":this._z=Math.asin(a(E,-1,1)),Math.abs(E)<.9999999?(this._x=Math.atan2(-L,S),this._y=Math.atan2(-I,m)):(this._x=0,this._y=Math.atan2(b,U));break;case"XZY":this._z=Math.asin(-a(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(O,S),this._y=Math.atan2(b,m)):(this._x=Math.atan2(-L,U),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s!==!1&&this._onChangeCallback(),this},i.setFromQuaternion=function(t,e,s){return Je.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Je,e,s)},i.setFromVector3=function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},i.reorder=function(t){return lt.setFromEuler(this),this.setFromQuaternion(lt,t)},i.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},i.fromArray=function(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},i.toVector3=function(t){return t?t.set(this._x,this._y,this._z):new se(this._x,this._y,this._z)},i._onChange=function(t){return this._onChangeCallback=t,this},i._onChangeCallback=function(){},gi(o,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}]),o}();ft.prototype.isEuler=!0,ft.DefaultOrder="XYZ",ft.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Ot=function(){function o(){this.mask=1}var i=o.prototype;return i.set=function(t){this.mask=1<<t|0},i.enable=function(t){this.mask|=1<<t|0},i.enableAll=function(){this.mask=-1},i.toggle=function(t){this.mask^=1<<t|0},i.disable=function(t){this.mask&=~(1<<t|0)},i.disableAll=function(){this.mask=0},i.test=function(t){return(this.mask&t.mask)!=0},o}(),Di=0,Ri=new se,an=new ni,Ei=new ht,gr=new se,Ks=new se,ma=new se,Xl=new ni,Lo=new se(1,0,0),Po=new se(0,1,0),Do=new se(0,0,1),Fe={type:"added"},it={type:"removed"};function Ke(){Object.defineProperty(this,"id",{value:Di++}),this.uuid=dt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ke.DefaultUp.clone();var o=new se,i=new ft,t=new ni,e=new se(1,1,1);i._onChange(function(){t.setFromEuler(i,!1)}),t._onChange(function(){i.setFromQuaternion(t,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:o},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:t},scale:{configurable:!0,enumerable:!0,value:e},modelViewMatrix:{value:new ht},normalMatrix:{value:new Wt}}),this.matrix=new ht,this.matrixWorld=new ht,this.matrixAutoUpdate=Ke.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ot,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Ke.DefaultUp=new se(0,1,0),Ke.DefaultMatrixAutoUpdate=!0,Ke.prototype=Object.assign(Object.create(Si.prototype),{constructor:Ke,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(i){return this.quaternion.premultiply(i),this},setRotationFromAxisAngle:function(i,t){this.quaternion.setFromAxisAngle(i,t)},setRotationFromEuler:function(i){this.quaternion.setFromEuler(i,!0)},setRotationFromMatrix:function(i){this.quaternion.setFromRotationMatrix(i)},setRotationFromQuaternion:function(i){this.quaternion.copy(i)},rotateOnAxis:function(i,t){return an.setFromAxisAngle(i,t),this.quaternion.multiply(an),this},rotateOnWorldAxis:function(i,t){return an.setFromAxisAngle(i,t),this.quaternion.premultiply(an),this},rotateX:function(i){return this.rotateOnAxis(Lo,i)},rotateY:function(i){return this.rotateOnAxis(Po,i)},rotateZ:function(i){return this.rotateOnAxis(Do,i)},translateOnAxis:function(i,t){return Ri.copy(i).applyQuaternion(this.quaternion),this.position.add(Ri.multiplyScalar(t)),this},translateX:function(i){return this.translateOnAxis(Lo,i)},translateY:function(i){return this.translateOnAxis(Po,i)},translateZ:function(i){return this.translateOnAxis(Do,i)},localToWorld:function(i){return i.applyMatrix4(this.matrixWorld)},worldToLocal:function(i){return i.applyMatrix4(Ei.copy(this.matrixWorld).invert())},lookAt:function(i,t,e){i.isVector3?gr.copy(i):gr.set(i,t,e);var s=this.parent;this.updateWorldMatrix(!0,!1),Ks.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ei.lookAt(Ks,gr,this.up):Ei.lookAt(gr,Ks,this.up),this.quaternion.setFromRotationMatrix(Ei),s&&(Ei.extractRotation(s.matrixWorld),an.setFromRotationMatrix(Ei),this.quaternion.premultiply(an.invert()))},add:function(i){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return i===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(i.parent!==null&&i.parent.remove(i),i.parent=this,this.children.push(i),i.dispatchEvent(Fe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",i),this)},remove:function(i){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var e=this.children.indexOf(i);return e!==-1&&(i.parent=null,this.children.splice(e,1),i.dispatchEvent(it)),this},clear:function(){for(var i=0;i<this.children.length;i++){var t=this.children[i];t.parent=null,t.dispatchEvent(it)}return this.children.length=0,this},attach:function(i){return this.updateWorldMatrix(!0,!1),Ei.copy(this.matrixWorld).invert(),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),Ei.multiply(i.parent.matrixWorld)),i.applyMatrix4(Ei),this.add(i),i.updateWorldMatrix(!1,!0),this},getObjectById:function(i){return this.getObjectByProperty("id",i)},getObjectByName:function(i){return this.getObjectByProperty("name",i)},getObjectByProperty:function(i,t){if(this[i]===t)return this;for(var e=0,s=this.children.length;e<s;e++){var a=this.children[e].getObjectByProperty(i,t);if(a!==void 0)return a}},getWorldPosition:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),i=new se),this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),i=new ni),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ks,i,ma),i},getWorldScale:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new se),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ks,Xl,i),i},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),i=new se),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return i.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(i){i(this);for(var t=this.children,e=0,s=t.length;e<s;e++)t[e].traverse(i)},traverseVisible:function(i){if(this.visible!==!1){i(this);for(var t=this.children,e=0,s=t.length;e<s;e++)t[e].traverseVisible(i)}},traverseAncestors:function(i){var t=this.parent;t!==null&&(i(t),t.traverseAncestors(i))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);for(var t=this.children,e=0,s=t.length;e<s;e++)t[e].updateMatrixWorld(i)},updateWorldMatrix:function(i,t){var e=this.parent;if(i===!0&&e!==null&&e.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0)for(var s=this.children,a=0,c=s.length;a<c;a++)s[a].updateWorldMatrix(!1,!0)},toJSON:function(i){var t=i===void 0||typeof i=="string",e={};t&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},e.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var s={};function a(me,pe){return me[pe.uuid]===void 0&&(me[pe.uuid]=pe.toJSON(i)),pe.uuid}if(s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){s.geometry=a(i.geometries,this.geometry);var c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){var m=c.shapes;if(Array.isArray(m))for(var v=0,b=m.length;v<b;v++){var E=m[v];a(i.shapes,E)}else a(i.shapes,m)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(i.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){for(var S=[],L=0,I=this.material.length;L<I;L++)S.push(a(i.materials,this.material[L]));s.material=S}else s.material=a(i.materials,this.material);if(this.children.length>0){s.children=[];for(var O=0;O<this.children.length;O++)s.children.push(this.children[O].toJSON(i).object)}if(this.animations.length>0){s.animations=[];for(var U=0;U<this.animations.length;U++){var G=this.animations[U];s.animations.push(a(i.animations,G))}}if(t){var W=re(i.geometries),X=re(i.materials),ie=re(i.textures),$=re(i.images),ee=re(i.shapes),he=re(i.skeletons),oe=re(i.animations);W.length>0&&(e.geometries=W),X.length>0&&(e.materials=X),ie.length>0&&(e.textures=ie),$.length>0&&(e.images=$),ee.length>0&&(e.shapes=ee),he.length>0&&(e.skeletons=he),oe.length>0&&(e.animations=oe)}return e.object=s,e;function re(me){var pe=[];for(var xe in me){var Ce=me[xe];delete Ce.metadata,pe.push(Ce)}return pe}},clone:function(i){return new this.constructor().copy(this,i)},copy:function(i,t){if(t===void 0&&(t=!0),this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.userData=JSON.parse(JSON.stringify(i.userData)),t===!0)for(var e=0;e<i.children.length;e++){var s=i.children[e];this.add(s.clone())}return this}});var vt=new se,$n=new se,Nn=new Wt,Bi=function(){function o(t,e){t===void 0&&(t=new se(1,0,0)),e===void 0&&(e=0),this.normal=t,this.constant=e}var i=o.prototype;return i.set=function(t,e){return this.normal.copy(t),this.constant=e,this},i.setComponents=function(t,e,s,a){return this.normal.set(t,e,s),this.constant=a,this},i.setFromNormalAndCoplanarPoint=function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},i.setFromCoplanarPoints=function(t,e,s){var a=vt.subVectors(s,e).cross($n.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(a,t),this},i.copy=function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},i.normalize=function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},i.negate=function(){return this.constant*=-1,this.normal.negate(),this},i.distanceToPoint=function(t){return this.normal.dot(t)+this.constant},i.distanceToSphere=function(t){return this.distanceToPoint(t.center)-t.radius},i.projectPoint=function(t,e){return e===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new se),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},i.intersectLine=function(t,e){e===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new se);var s=t.delta(vt),a=this.normal.dot(s);if(a===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):void 0;var c=-(t.start.dot(this.normal)+this.constant)/a;return c<0||c>1?void 0:e.copy(s).multiplyScalar(c).add(t.start)},i.intersectsLine=function(t){var e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0},i.intersectsBox=function(t){return t.intersectsPlane(this)},i.intersectsSphere=function(t){return t.intersectsPlane(this)},i.coplanarPoint=function(t){return t===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new se),t.copy(this.normal).multiplyScalar(-this.constant)},i.applyMatrix4=function(t,e){var s=e||Nn.getNormalMatrix(t),a=this.coplanarPoint(vt).applyMatrix4(t),c=this.normal.applyMatrix3(s).normalize();return this.constant=-a.dot(c),this},i.translate=function(t){return this.constant-=t.dot(this.normal),this},i.equals=function(t){return t.normal.equals(this.normal)&&t.constant===this.constant},i.clone=function(){return new this.constructor().copy(this)},o}();Bi.prototype.isPlane=!0;var qt=new se,Fi=new se,vr=new se,Ai=new se,Xi=new se,Fn=new se,Ci=new se,ln=new se,Cn=new se,es=new se,wi=function(){function o(t,e,s){t===void 0&&(t=new se),e===void 0&&(e=new se),s===void 0&&(s=new se),this.a=t,this.b=e,this.c=s}o.getNormal=function(t,e,s,a){a===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),a=new se),a.subVectors(s,e),qt.subVectors(t,e),a.cross(qt);var c=a.lengthSq();return c>0?a.multiplyScalar(1/Math.sqrt(c)):a.set(0,0,0)},o.getBarycoord=function(t,e,s,a,c){qt.subVectors(a,e),Fi.subVectors(s,e),vr.subVectors(t,e);var m=qt.dot(qt),v=qt.dot(Fi),b=qt.dot(vr),E=Fi.dot(Fi),S=Fi.dot(vr),L=m*E-v*v;if(c===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),c=new se),L===0)return c.set(-2,-1,-1);var I=1/L,O=(E*b-v*S)*I,U=(m*S-v*b)*I;return c.set(1-O-U,U,O)},o.containsPoint=function(t,e,s,a){return this.getBarycoord(t,e,s,a,Ai),Ai.x>=0&&Ai.y>=0&&Ai.x+Ai.y<=1},o.getUV=function(t,e,s,a,c,m,v,b){return this.getBarycoord(t,e,s,a,Ai),b.set(0,0),b.addScaledVector(c,Ai.x),b.addScaledVector(m,Ai.y),b.addScaledVector(v,Ai.z),b},o.isFrontFacing=function(t,e,s,a){return qt.subVectors(s,e),Fi.subVectors(t,e),qt.cross(Fi).dot(a)<0};var i=o.prototype;return i.set=function(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this},i.setFromPointsAndIndices=function(t,e,s,a){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[a]),this},i.clone=function(){return new this.constructor().copy(this)},i.copy=function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},i.getArea=function(){return qt.subVectors(this.c,this.b),Fi.subVectors(this.a,this.b),.5*qt.cross(Fi).length()},i.getMidpoint=function(t){return t===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new se),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},i.getNormal=function(t){return o.getNormal(this.a,this.b,this.c,t)},i.getPlane=function(t){return t===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Bi),t.setFromCoplanarPoints(this.a,this.b,this.c)},i.getBarycoord=function(t,e){return o.getBarycoord(t,this.a,this.b,this.c,e)},i.getUV=function(t,e,s,a,c){return o.getUV(t,this.a,this.b,this.c,e,s,a,c)},i.containsPoint=function(t){return o.containsPoint(t,this.a,this.b,this.c)},i.isFrontFacing=function(t){return o.isFrontFacing(this.a,this.b,this.c,t)},i.intersectsBox=function(t){return t.intersectsTriangle(this)},i.closestPointToPoint=function(t,e){e===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new se);var s,a,c=this.a,m=this.b,v=this.c;Xi.subVectors(m,c),Fn.subVectors(v,c),ln.subVectors(t,c);var b=Xi.dot(ln),E=Fn.dot(ln);if(b<=0&&E<=0)return e.copy(c);Cn.subVectors(t,m);var S=Xi.dot(Cn),L=Fn.dot(Cn);if(S>=0&&L<=S)return e.copy(m);var I=b*L-S*E;if(I<=0&&b>=0&&S<=0)return s=b/(b-S),e.copy(c).addScaledVector(Xi,s);es.subVectors(t,v);var O=Xi.dot(es),U=Fn.dot(es);if(U>=0&&O<=U)return e.copy(v);var G=O*E-b*U;if(G<=0&&E>=0&&U<=0)return a=E/(E-U),e.copy(c).addScaledVector(Fn,a);var W=S*U-O*L;if(W<=0&&L-S>=0&&O-U>=0)return Ci.subVectors(v,m),a=(L-S)/(L-S+(O-U)),e.copy(m).addScaledVector(Ci,a);var X=1/(W+G+I);return s=G*X,a=I*X,e.copy(c).addScaledVector(Xi,s).addScaledVector(Fn,a)},i.equals=function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)},o}(),Ro=0;function Gt(){Object.defineProperty(this,"id",{value:Ro++}),this.uuid=dt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=d,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ji,this.stencilZFail=ji,this.stencilZPass=ji,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Gt.prototype=Object.assign(Object.create(Si.prototype),{constructor:Gt,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(i){if(i!==void 0)for(var t in i){var e=i[t];if(e!==void 0)if(t!=="shading"){var s=this[t];s!==void 0?s&&s.isColor?s.set(e):s&&s.isVector3&&e&&e.isVector3?s.copy(e):this[t]=e:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===1;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(i){var t=i===void 0||typeof i=="string";t&&(i={textures:{},images:{}});var e={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function s(m){var v=[];for(var b in m){var E=m[b];delete E.metadata,v.push(E)}return v}if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.color&&this.color.isColor&&(e.color=this.color.getHex()),this.roughness!==void 0&&(e.roughness=this.roughness),this.metalness!==void 0&&(e.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(e.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(e.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(e.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(e.specular=this.specular.getHex()),this.shininess!==void 0&&(e.shininess=this.shininess),this.clearcoat!==void 0&&(e.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(e.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(e.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(e.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(e.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,e.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(e.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(e.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(e.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(e.lightMap=this.lightMap.toJSON(i).uuid,e.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(e.aoMap=this.aoMap.toJSON(i).uuid,e.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(e.bumpMap=this.bumpMap.toJSON(i).uuid,e.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(e.normalMap=this.normalMap.toJSON(i).uuid,e.normalMapType=this.normalMapType,e.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(e.displacementMap=this.displacementMap.toJSON(i).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(e.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(e.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(e.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(e.specularMap=this.specularMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(e.envMap=this.envMap.toJSON(i).uuid,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,this.combine!==void 0&&(e.combine=this.combine),this.envMapIntensity!==void 0&&(e.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(e.gradientMap=this.gradientMap.toJSON(i).uuid),this.size!==void 0&&(e.size=this.size),this.sizeAttenuation!==void 0&&(e.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(e.blending=this.blending),this.side!==0&&(e.side=this.side),this.vertexColors&&(e.vertexColors=!0),this.opacity<1&&(e.opacity=this.opacity),this.transparent===!0&&(e.transparent=this.transparent),e.depthFunc=this.depthFunc,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.stencilWrite=this.stencilWrite,e.stencilWriteMask=this.stencilWriteMask,e.stencilFunc=this.stencilFunc,e.stencilRef=this.stencilRef,e.stencilFuncMask=this.stencilFuncMask,e.stencilFail=this.stencilFail,e.stencilZFail=this.stencilZFail,e.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(e.rotation=this.rotation),this.polygonOffset===!0&&(e.polygonOffset=!0),this.polygonOffsetFactor!==0&&(e.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(e.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(e.linewidth=this.linewidth),this.dashSize!==void 0&&(e.dashSize=this.dashSize),this.gapSize!==void 0&&(e.gapSize=this.gapSize),this.scale!==void 0&&(e.scale=this.scale),this.dithering===!0&&(e.dithering=!0),this.alphaTest>0&&(e.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(e.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(e.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(e.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(e.morphTargets=!0),this.morphNormals===!0&&(e.morphNormals=!0),this.skinning===!0&&(e.skinning=!0),this.flatShading===!0&&(e.flatShading=this.flatShading),this.visible===!1&&(e.visible=!1),this.toneMapped===!1&&(e.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(e.userData=this.userData),t){var a=s(i.textures),c=s(i.images);a.length>0&&(e.textures=a),c.length>0&&(e.images=c)}return e},clone:function(){return new this.constructor().copy(this)},copy:function(i){this.name=i.name,this.fog=i.fog,this.blending=i.blending,this.side=i.side,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;var t=i.clippingPlanes,e=null;if(t!==null){var s=t.length;e=new Array(s);for(var a=0;a!==s;++a)e[a]=t[a].clone()}return this.clippingPlanes=e,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.premultipliedAlpha=i.premultipliedAlpha,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData=JSON.parse(JSON.stringify(i.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Gt.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});var ts={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},zi={h:0,s:0,l:0},_a={h:0,s:0,l:0};function Bo(o,i,t){return t<0&&(t+=1),t>1&&(t-=1),t<.16666666666666666?o+6*(i-o)*t:t<.5?i:t<.6666666666666666?o+6*(i-o)*(.6666666666666666-t):o}function Io(o){return o<.04045?.0773993808*o:Math.pow(.9478672986*o+.0521327014,2.4)}function Oo(o){return o<.0031308?12.92*o:1.055*Math.pow(o,.41666)-.055}var st=function(){function o(t,e,s){return e===void 0&&s===void 0?this.set(t):this.setRGB(t,e,s)}var i=o.prototype;return i.set=function(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this},i.setScalar=function(t){return this.r=t,this.g=t,this.b=t,this},i.setHex=function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},i.setRGB=function(t,e,s){return this.r=t,this.g=e,this.b=s,this},i.setHSL=function(t,e,s){if(t=dt.euclideanModulo(t,1),e=dt.clamp(e,0,1),s=dt.clamp(s,0,1),e===0)this.r=this.g=this.b=s;else{var a=s<=.5?s*(1+e):s+e-s*e,c=2*s-a;this.r=Bo(c,a,t+1/3),this.g=Bo(c,a,t),this.b=Bo(c,a,t-1/3)}return this},i.setStyle=function(t){function e(I){I!==void 0&&parseFloat(I)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){var a,c=s[1],m=s[2];switch(c){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(m))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,e(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(m))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,e(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(m)){var v=parseFloat(a[1])/360,b=parseInt(a[2],10)/100,E=parseInt(a[3],10)/100;return e(a[4]),this.setHSL(v,b,E)}}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){var S=s[1],L=S.length;if(L===3)return this.r=parseInt(S.charAt(0)+S.charAt(0),16)/255,this.g=parseInt(S.charAt(1)+S.charAt(1),16)/255,this.b=parseInt(S.charAt(2)+S.charAt(2),16)/255,this;if(L===6)return this.r=parseInt(S.charAt(0)+S.charAt(1),16)/255,this.g=parseInt(S.charAt(2)+S.charAt(3),16)/255,this.b=parseInt(S.charAt(4)+S.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},i.setColorName=function(t){var e=ts[t];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},i.clone=function(){return new this.constructor(this.r,this.g,this.b)},i.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},i.copyGammaToLinear=function(t,e){return e===void 0&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},i.copyLinearToGamma=function(t,e){e===void 0&&(e=2);var s=e>0?1/e:1;return this.r=Math.pow(t.r,s),this.g=Math.pow(t.g,s),this.b=Math.pow(t.b,s),this},i.convertGammaToLinear=function(t){return this.copyGammaToLinear(this,t),this},i.convertLinearToGamma=function(t){return this.copyLinearToGamma(this,t),this},i.copySRGBToLinear=function(t){return this.r=Io(t.r),this.g=Io(t.g),this.b=Io(t.b),this},i.copyLinearToSRGB=function(t){return this.r=Oo(t.r),this.g=Oo(t.g),this.b=Oo(t.b),this},i.convertSRGBToLinear=function(){return this.copySRGBToLinear(this),this},i.convertLinearToSRGB=function(){return this.copyLinearToSRGB(this),this},i.getHex=function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},i.getHexString=function(){return("000000"+this.getHex().toString(16)).slice(-6)},i.getHSL=function(t){t===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,s,a=this.r,c=this.g,m=this.b,v=Math.max(a,c,m),b=Math.min(a,c,m),E=(b+v)/2;if(b===v)e=0,s=0;else{var S=v-b;switch(s=E<=.5?S/(v+b):S/(2-v-b),v){case a:e=(c-m)/S+(c<m?6:0);break;case c:e=(m-a)/S+2;break;case m:e=(a-c)/S+4}e/=6}return t.h=e,t.s=s,t.l=E,t},i.getStyle=function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},i.offsetHSL=function(t,e,s){return this.getHSL(zi),zi.h+=t,zi.s+=e,zi.l+=s,this.setHSL(zi.h,zi.s,zi.l),this},i.add=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},i.addColors=function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},i.addScalar=function(t){return this.r+=t,this.g+=t,this.b+=t,this},i.sub=function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},i.multiply=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},i.multiplyScalar=function(t){return this.r*=t,this.g*=t,this.b*=t,this},i.lerp=function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},i.lerpColors=function(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this},i.lerpHSL=function(t,e){this.getHSL(zi),t.getHSL(_a);var s=dt.lerp(zi.h,_a.h,e),a=dt.lerp(zi.s,_a.s,e),c=dt.lerp(zi.l,_a.l,e);return this.setHSL(s,a,c),this},i.equals=function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},i.fromArray=function(t,e){return e===void 0&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},i.toArray=function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},i.fromBufferAttribute=function(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this},i.toJSON=function(){return this.getHex()},o}();st.NAMES=ts,st.prototype.isColor=!0,st.prototype.r=1,st.prototype.g=1,st.prototype.b=1;var zn=function(o){function i(t){var e;return(e=o.call(this)||this).type="MeshBasicMaterial",e.color=new st(16777215),e.map=null,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=null,e.aoMapIntensity=1,e.specularMap=null,e.alphaMap=null,e.envMap=null,e.combine=0,e.reflectivity=1,e.refractionRatio=.98,e.wireframe=!1,e.wireframeLinewidth=1,e.wireframeLinecap="round",e.wireframeLinejoin="round",e.skinning=!1,e.morphTargets=!1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},i}(Gt);zn.prototype.isMeshBasicMaterial=!0;var Qt=new se,ga=new He;function pt(o,i,t){if(Array.isArray(o))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=o,this.itemSize=i,this.count=o!==void 0?o.length/i:0,this.normalized=t===!0,this.usage=un,this.updateRange={offset:0,count:-1},this.version=0}function yr(o,i,t){pt.call(this,new Int8Array(o),i,t)}function br(o,i,t){pt.call(this,new Uint8Array(o),i,t)}function xr(o,i,t){pt.call(this,new Uint8ClampedArray(o),i,t)}function wr(o,i,t){pt.call(this,new Int16Array(o),i,t)}function xs(o,i,t){pt.call(this,new Uint16Array(o),i,t)}function Sr(o,i,t){pt.call(this,new Int32Array(o),i,t)}function ws(o,i,t){pt.call(this,new Uint32Array(o),i,t)}function Er(o,i,t){pt.call(this,new Uint16Array(o),i,t)}function at(o,i,t){pt.call(this,new Float32Array(o),i,t)}function Ar(o,i,t){pt.call(this,new Float64Array(o),i,t)}function Zl(o){if(o.length===0)return-1/0;for(var i=o[0],t=1,e=o.length;t<e;++t)o[t]>i&&(i=o[t]);return i}Object.defineProperty(pt.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),Object.assign(pt.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this},copyAt:function(i,t,e){i*=this.itemSize,e*=t.itemSize;for(var s=0,a=this.itemSize;s<a;s++)this.array[i+s]=t.array[e+s];return this},copyArray:function(i){return this.array.set(i),this},copyColorsArray:function(i){for(var t=this.array,e=0,s=0,a=i.length;s<a;s++){var c=i[s];c===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",s),c=new st),t[e++]=c.r,t[e++]=c.g,t[e++]=c.b}return this},copyVector2sArray:function(i){for(var t=this.array,e=0,s=0,a=i.length;s<a;s++){var c=i[s];c===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",s),c=new He),t[e++]=c.x,t[e++]=c.y}return this},copyVector3sArray:function(i){for(var t=this.array,e=0,s=0,a=i.length;s<a;s++){var c=i[s];c===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",s),c=new se),t[e++]=c.x,t[e++]=c.y,t[e++]=c.z}return this},copyVector4sArray:function(i){for(var t=this.array,e=0,s=0,a=i.length;s<a;s++){var c=i[s];c===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",s),c=new Ft),t[e++]=c.x,t[e++]=c.y,t[e++]=c.z,t[e++]=c.w}return this},applyMatrix3:function(i){if(this.itemSize===2)for(var t=0,e=this.count;t<e;t++)ga.fromBufferAttribute(this,t),ga.applyMatrix3(i),this.setXY(t,ga.x,ga.y);else if(this.itemSize===3)for(var s=0,a=this.count;s<a;s++)Qt.fromBufferAttribute(this,s),Qt.applyMatrix3(i),this.setXYZ(s,Qt.x,Qt.y,Qt.z);return this},applyMatrix4:function(i){for(var t=0,e=this.count;t<e;t++)Qt.x=this.getX(t),Qt.y=this.getY(t),Qt.z=this.getZ(t),Qt.applyMatrix4(i),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this},applyNormalMatrix:function(i){for(var t=0,e=this.count;t<e;t++)Qt.x=this.getX(t),Qt.y=this.getY(t),Qt.z=this.getZ(t),Qt.applyNormalMatrix(i),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this},transformDirection:function(i){for(var t=0,e=this.count;t<e;t++)Qt.x=this.getX(t),Qt.y=this.getY(t),Qt.z=this.getZ(t),Qt.transformDirection(i),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this},set:function(i,t){return t===void 0&&(t=0),this.array.set(i,t),this},getX:function(i){return this.array[i*this.itemSize]},setX:function(i,t){return this.array[i*this.itemSize]=t,this},getY:function(i){return this.array[i*this.itemSize+1]},setY:function(i,t){return this.array[i*this.itemSize+1]=t,this},getZ:function(i){return this.array[i*this.itemSize+2]},setZ:function(i,t){return this.array[i*this.itemSize+2]=t,this},getW:function(i){return this.array[i*this.itemSize+3]},setW:function(i,t){return this.array[i*this.itemSize+3]=t,this},setXY:function(i,t,e){return i*=this.itemSize,this.array[i+0]=t,this.array[i+1]=e,this},setXYZ:function(i,t,e,s){return i*=this.itemSize,this.array[i+0]=t,this.array[i+1]=e,this.array[i+2]=s,this},setXYZW:function(i,t,e,s,a){return i*=this.itemSize,this.array[i+0]=t,this.array[i+1]=e,this.array[i+2]=s,this.array[i+3]=a,this},onUpload:function(i){return this.onUploadCallback=i,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),yr.prototype=Object.create(pt.prototype),yr.prototype.constructor=yr,br.prototype=Object.create(pt.prototype),br.prototype.constructor=br,xr.prototype=Object.create(pt.prototype),xr.prototype.constructor=xr,wr.prototype=Object.create(pt.prototype),wr.prototype.constructor=wr,xs.prototype=Object.create(pt.prototype),xs.prototype.constructor=xs,Sr.prototype=Object.create(pt.prototype),Sr.prototype.constructor=Sr,ws.prototype=Object.create(pt.prototype),ws.prototype.constructor=ws,Er.prototype=Object.create(pt.prototype),Er.prototype.constructor=Er,Er.prototype.isFloat16BufferAttribute=!0,at.prototype=Object.create(pt.prototype),at.prototype.constructor=at,Ar.prototype=Object.create(pt.prototype),Ar.prototype.constructor=Ar;var ou={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Cr(o,i){return new ou[o](i)}var lu=0,Mn=new ht,No=new Ke,Ys=new se,Zi=new xi,Mr=new xi,vi=new se;function ct(){Object.defineProperty(this,"id",{value:lu++}),this.uuid=dt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}ct.prototype=Object.assign(Object.create(Si.prototype),{constructor:ct,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(i){return Array.isArray(i)?this.index=new(Zl(i)>65535?ws:xs)(i,1):this.index=i,this},getAttribute:function(i){return this.attributes[i]},setAttribute:function(i,t){return this.attributes[i]=t,this},deleteAttribute:function(i){return delete this.attributes[i],this},hasAttribute:function(i){return this.attributes[i]!==void 0},addGroup:function(i,t,e){e===void 0&&(e=0),this.groups.push({start:i,count:t,materialIndex:e})},clearGroups:function(){this.groups=[]},setDrawRange:function(i,t){this.drawRange.start=i,this.drawRange.count=t},applyMatrix4:function(i){var t=this.attributes.position;t!==void 0&&(t.applyMatrix4(i),t.needsUpdate=!0);var e=this.attributes.normal;if(e!==void 0){var s=new Wt().getNormalMatrix(i);e.applyNormalMatrix(s),e.needsUpdate=!0}var a=this.attributes.tangent;return a!==void 0&&(a.transformDirection(i),a.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(i){return Mn.makeRotationX(i),this.applyMatrix4(Mn),this},rotateY:function(i){return Mn.makeRotationY(i),this.applyMatrix4(Mn),this},rotateZ:function(i){return Mn.makeRotationZ(i),this.applyMatrix4(Mn),this},translate:function(i,t,e){return Mn.makeTranslation(i,t,e),this.applyMatrix4(Mn),this},scale:function(i,t,e){return Mn.makeScale(i,t,e),this.applyMatrix4(Mn),this},lookAt:function(i){return No.lookAt(i),No.updateMatrix(),this.applyMatrix4(No.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ys).negate(),this.translate(Ys.x,Ys.y,Ys.z),this},setFromPoints:function(i){for(var t=[],e=0,s=i.length;e<s;e++){var a=i[e];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new at(t,3)),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new xi);var i=this.attributes.position,t=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new se(-1/0,-1/0,-1/0),new se(1/0,1/0,1/0));if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),t)for(var e=0,s=t.length;e<s;e++){var a=t[e];Zi.setFromBufferAttribute(a),this.morphTargetsRelative?(vi.addVectors(this.boundingBox.min,Zi.min),this.boundingBox.expandByPoint(vi),vi.addVectors(this.boundingBox.max,Zi.max),this.boundingBox.expandByPoint(vi)):(this.boundingBox.expandByPoint(Zi.min),this.boundingBox.expandByPoint(Zi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new mn);var i=this.attributes.position,t=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new se,1/0);if(i){var e=this.boundingSphere.center;if(Zi.setFromBufferAttribute(i),t)for(var s=0,a=t.length;s<a;s++){var c=t[s];Mr.setFromBufferAttribute(c),this.morphTargetsRelative?(vi.addVectors(Zi.min,Mr.min),Zi.expandByPoint(vi),vi.addVectors(Zi.max,Mr.max),Zi.expandByPoint(vi)):(Zi.expandByPoint(Mr.min),Zi.expandByPoint(Mr.max))}Zi.getCenter(e);for(var m=0,v=0,b=i.count;v<b;v++)vi.fromBufferAttribute(i,v),m=Math.max(m,e.distanceToSquared(vi));if(t)for(var E=0,S=t.length;E<S;E++)for(var L=t[E],I=this.morphTargetsRelative,O=0,U=L.count;O<U;O++)vi.fromBufferAttribute(L,O),I&&(Ys.fromBufferAttribute(i,O),vi.add(Ys)),m=Math.max(m,e.distanceToSquared(vi));this.boundingSphere.radius=Math.sqrt(m),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){var i=this.index,t=this.attributes;if(i!==null&&t.position!==void 0&&t.normal!==void 0&&t.uv!==void 0){var e=i.array,s=t.position.array,a=t.normal.array,c=t.uv.array,m=s.length/3;t.tangent===void 0&&this.setAttribute("tangent",new pt(new Float32Array(4*m),4));for(var v=t.tangent.array,b=[],E=[],S=0;S<m;S++)b[S]=new se,E[S]=new se;var L=new se,I=new se,O=new se,U=new He,G=new He,W=new He,X=new se,ie=new se,$=this.groups;$.length===0&&($=[{start:0,count:e.length}]);for(var ee=0,he=$.length;ee<he;++ee)for(var oe=$[ee],re=oe.start,me=re,pe=re+oe.count;me<pe;me+=3)Ue(e[me+0],e[me+1],e[me+2]);for(var xe=new se,Ce=new se,Ie=new se,Pe=new se,de=0,ve=$.length;de<ve;++de)for(var Me=$[de],we=Me.start,ye=we,Te=we+Me.count;ye<Te;ye+=3)tt(e[ye+0]),tt(e[ye+1]),tt(e[ye+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function Ue(ot,ue,fe){L.fromArray(s,3*ot),I.fromArray(s,3*ue),O.fromArray(s,3*fe),U.fromArray(c,2*ot),G.fromArray(c,2*ue),W.fromArray(c,2*fe),I.sub(L),O.sub(L),G.sub(U),W.sub(U);var Oe=1/(G.x*W.y-W.x*G.y);isFinite(Oe)&&(X.copy(I).multiplyScalar(W.y).addScaledVector(O,-G.y).multiplyScalar(Oe),ie.copy(O).multiplyScalar(G.x).addScaledVector(I,-W.x).multiplyScalar(Oe),b[ot].add(X),b[ue].add(X),b[fe].add(X),E[ot].add(ie),E[ue].add(ie),E[fe].add(ie))}function tt(ot){Ie.fromArray(a,3*ot),Pe.copy(Ie);var ue=b[ot];xe.copy(ue),xe.sub(Ie.multiplyScalar(Ie.dot(ue))).normalize(),Ce.crossVectors(Pe,ue);var fe=Ce.dot(E[ot])<0?-1:1;v[4*ot]=xe.x,v[4*ot+1]=xe.y,v[4*ot+2]=xe.z,v[4*ot+3]=fe}},computeVertexNormals:function(){var i=this.index,t=this.getAttribute("position");if(t!==void 0){var e=this.getAttribute("normal");if(e===void 0)e=new pt(new Float32Array(3*t.count),3),this.setAttribute("normal",e);else for(var s=0,a=e.count;s<a;s++)e.setXYZ(s,0,0,0);var c=new se,m=new se,v=new se,b=new se,E=new se,S=new se,L=new se,I=new se;if(i)for(var O=0,U=i.count;O<U;O+=3){var G=i.getX(O+0),W=i.getX(O+1),X=i.getX(O+2);c.fromBufferAttribute(t,G),m.fromBufferAttribute(t,W),v.fromBufferAttribute(t,X),L.subVectors(v,m),I.subVectors(c,m),L.cross(I),b.fromBufferAttribute(e,G),E.fromBufferAttribute(e,W),S.fromBufferAttribute(e,X),b.add(L),E.add(L),S.add(L),e.setXYZ(G,b.x,b.y,b.z),e.setXYZ(W,E.x,E.y,E.z),e.setXYZ(X,S.x,S.y,S.z)}else for(var ie=0,$=t.count;ie<$;ie+=3)c.fromBufferAttribute(t,ie+0),m.fromBufferAttribute(t,ie+1),v.fromBufferAttribute(t,ie+2),L.subVectors(v,m),I.subVectors(c,m),L.cross(I),e.setXYZ(ie+0,L.x,L.y,L.z),e.setXYZ(ie+1,L.x,L.y,L.z),e.setXYZ(ie+2,L.x,L.y,L.z);this.normalizeNormals(),e.needsUpdate=!0}},merge:function(i,t){if(i&&i.isBufferGeometry){t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var e=this.attributes;for(var s in e)if(i.attributes[s]!==void 0)for(var a=e[s].array,c=i.attributes[s],m=c.array,v=c.itemSize*t,b=Math.min(m.length,a.length-v),E=0,S=v;E<b;E++,S++)a[S]=m[E];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",i)},normalizeNormals:function(){for(var i=this.attributes.normal,t=0,e=i.count;t<e;t++)vi.fromBufferAttribute(i,t),vi.normalize(),i.setXYZ(t,vi.x,vi.y,vi.z)},toNonIndexed:function(){function i(X,ie){for(var $=X.array,ee=X.itemSize,he=X.normalized,oe=new $.constructor(ie.length*ee),re=0,me=0,pe=0,xe=ie.length;pe<xe;pe++){re=ie[pe]*ee;for(var Ce=0;Ce<ee;Ce++)oe[me++]=$[re++]}return new pt(oe,ee,he)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new ct,e=this.index.array,s=this.attributes;for(var a in s){var c=i(s[a],e);t.setAttribute(a,c)}var m=this.morphAttributes;for(var v in m){for(var b=[],E=m[v],S=0,L=E.length;S<L;S++){var I=i(E[S],e);b.push(I)}t.morphAttributes[v]=b}t.morphTargetsRelative=this.morphTargetsRelative;for(var O=this.groups,U=0,G=O.length;U<G;U++){var W=O[U];t.addGroup(W.start,W.count,W.materialIndex)}return t},toJSON:function(){var i={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),this.parameters!==void 0){var t=this.parameters;for(var e in t)t[e]!==void 0&&(i[e]=t[e]);return i}i.data={attributes:{}};var s=this.index;s!==null&&(i.data.index={type:s.array.constructor.name,array:Array.prototype.slice.call(s.array)});var a=this.attributes;for(var c in a){var m=a[c],v=m.toJSON(i.data);m.name!==""&&(v.name=m.name),i.data.attributes[c]=v}var b={},E=!1;for(var S in this.morphAttributes){for(var L=this.morphAttributes[S],I=[],O=0,U=L.length;O<U;O++){var G=L[O],W=G.toJSON(i.data);G.name!==""&&(W.name=G.name),I.push(W)}I.length>0&&(b[S]=I,E=!0)}E&&(i.data.morphAttributes=b,i.data.morphTargetsRelative=this.morphTargetsRelative);var X=this.groups;X.length>0&&(i.data.groups=JSON.parse(JSON.stringify(X)));var ie=this.boundingSphere;return ie!==null&&(i.data.boundingSphere={center:ie.center.toArray(),radius:ie.radius}),i},clone:function(){return new ct().copy(this)},copy:function(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=i.name;var e=i.index;e!==null&&this.setIndex(e.clone(t));var s=i.attributes;for(var a in s){var c=s[a];this.setAttribute(a,c.clone(t))}var m=i.morphAttributes;for(var v in m){for(var b=[],E=m[v],S=0,L=E.length;S<L;S++)b.push(E[S].clone(t));this.morphAttributes[v]=b}this.morphTargetsRelative=i.morphTargetsRelative;for(var I=i.groups,O=0,U=I.length;O<U;O++){var G=I[O];this.addGroup(G.start,G.count,G.materialIndex)}var W=i.boundingBox;W!==null&&(this.boundingBox=W.clone());var X=i.boundingSphere;return X!==null&&(this.boundingSphere=X.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ql=new ht,Xs=new rn,Fo=new mn,is=new se,ns=new se,ss=new se,zo=new se,Uo=new se,ko=new se,va=new se,ya=new se,ba=new se,xa=new He,wa=new He,Sa=new He,jo=new se,Ea=new se;function Jt(o,i){o===void 0&&(o=new ct),i===void 0&&(i=new zn),Ke.call(this),this.type="Mesh",this.geometry=o,this.material=i,this.updateMorphTargets()}function Aa(o,i,t,e,s,a,c,m,v,b,E,S){is.fromBufferAttribute(s,b),ns.fromBufferAttribute(s,E),ss.fromBufferAttribute(s,S);var L=o.morphTargetInfluences;if(i.morphTargets&&a&&L){va.set(0,0,0),ya.set(0,0,0),ba.set(0,0,0);for(var I=0,O=a.length;I<O;I++){var U=L[I],G=a[I];U!==0&&(zo.fromBufferAttribute(G,b),Uo.fromBufferAttribute(G,E),ko.fromBufferAttribute(G,S),c?(va.addScaledVector(zo,U),ya.addScaledVector(Uo,U),ba.addScaledVector(ko,U)):(va.addScaledVector(zo.sub(is),U),ya.addScaledVector(Uo.sub(ns),U),ba.addScaledVector(ko.sub(ss),U)))}is.add(va),ns.add(ya),ss.add(ba)}o.isSkinnedMesh&&i.skinning&&(o.boneTransform(b,is),o.boneTransform(E,ns),o.boneTransform(S,ss));var W=function(ie,$,ee,he,oe,re,me,pe){if(($.side===1?he.intersectTriangle(me,re,oe,!0,pe):he.intersectTriangle(oe,re,me,$.side!==2,pe))===null)return null;Ea.copy(pe),Ea.applyMatrix4(ie.matrixWorld);var xe=ee.ray.origin.distanceTo(Ea);return xe<ee.near||xe>ee.far?null:{distance:xe,point:Ea.clone(),object:ie}}(o,i,t,e,is,ns,ss,jo);if(W){m&&(xa.fromBufferAttribute(m,b),wa.fromBufferAttribute(m,E),Sa.fromBufferAttribute(m,S),W.uv=wi.getUV(jo,is,ns,ss,xa,wa,Sa,new He)),v&&(xa.fromBufferAttribute(v,b),wa.fromBufferAttribute(v,E),Sa.fromBufferAttribute(v,S),W.uv2=wi.getUV(jo,is,ns,ss,xa,wa,Sa,new He));var X={a:b,b:E,c:S,normal:new se,materialIndex:0};wi.getNormal(is,ns,ss,X.normal),W.face=X}return W}Jt.prototype=Object.assign(Object.create(Ke.prototype),{constructor:Jt,isMesh:!0,copy:function(i){return Ke.prototype.copy.call(this,i),i.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),i.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},i.morphTargetDictionary)),this.material=i.material,this.geometry=i.geometry,this},updateMorphTargets:function(){var i=this.geometry;if(i.isBufferGeometry){var t=i.morphAttributes,e=Object.keys(t);if(e.length>0){var s=t[e[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,c=s.length;a<c;a++){var m=s[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[m]=a}}}}else{var v=i.morphTargets;v!==void 0&&v.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(i,t){var e,s=this.geometry,a=this.material,c=this.matrixWorld;if(a!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),Fo.copy(s.boundingSphere),Fo.applyMatrix4(c),i.ray.intersectsSphere(Fo)!==!1&&(ql.copy(c).invert(),Xs.copy(i.ray).applyMatrix4(ql),s.boundingBox===null||Xs.intersectsBox(s.boundingBox)!==!1)))if(s.isBufferGeometry){var m=s.index,v=s.attributes.position,b=s.morphAttributes.position,E=s.morphTargetsRelative,S=s.attributes.uv,L=s.attributes.uv2,I=s.groups,O=s.drawRange;if(m!==null)if(Array.isArray(a))for(var U=0,G=I.length;U<G;U++)for(var W=I[U],X=a[W.materialIndex],ie=Math.max(W.start,O.start),$=Math.min(W.start+W.count,O.start+O.count);ie<$;ie+=3){var ee=m.getX(ie),he=m.getX(ie+1),oe=m.getX(ie+2);(e=Aa(this,X,i,Xs,v,b,E,S,L,ee,he,oe))&&(e.faceIndex=Math.floor(ie/3),e.face.materialIndex=W.materialIndex,t.push(e))}else for(var re=Math.max(0,O.start),me=Math.min(m.count,O.start+O.count);re<me;re+=3){var pe=m.getX(re),xe=m.getX(re+1),Ce=m.getX(re+2);(e=Aa(this,a,i,Xs,v,b,E,S,L,pe,xe,Ce))&&(e.faceIndex=Math.floor(re/3),t.push(e))}else if(v!==void 0)if(Array.isArray(a))for(var Ie=0,Pe=I.length;Ie<Pe;Ie++)for(var de=I[Ie],ve=a[de.materialIndex],Me=Math.max(de.start,O.start),we=Math.min(de.start+de.count,O.start+O.count);Me<we;Me+=3)(e=Aa(this,ve,i,Xs,v,b,E,S,L,Me,Me+1,Me+2))&&(e.faceIndex=Math.floor(Me/3),e.face.materialIndex=de.materialIndex,t.push(e));else for(var ye=Math.max(0,O.start),Te=Math.min(v.count,O.start+O.count);ye<Te;ye+=3)(e=Aa(this,a,i,Xs,v,b,E,S,L,ye,ye+1,ye+2))&&(e.faceIndex=Math.floor(ye/3),t.push(e))}else s.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});var Ss=function(o){function i(t,e,s,a,c,m){var v;t===void 0&&(t=1),e===void 0&&(e=1),s===void 0&&(s=1),a===void 0&&(a=1),c===void 0&&(c=1),m===void 0&&(m=1),(v=o.call(this)||this).type="BoxGeometry",v.parameters={width:t,height:e,depth:s,widthSegments:a,heightSegments:c,depthSegments:m};var b=bi(v);a=Math.floor(a),c=Math.floor(c),m=Math.floor(m);var E=[],S=[],L=[],I=[],O=0,U=0;function G(W,X,ie,$,ee,he,oe,re,me,pe,xe){for(var Ce=he/me,Ie=oe/pe,Pe=he/2,de=oe/2,ve=re/2,Me=me+1,we=pe+1,ye=0,Te=0,Ue=new se,tt=0;tt<we;tt++)for(var ot=tt*Ie-de,ue=0;ue<Me;ue++){var fe=ue*Ce-Pe;Ue[W]=fe*$,Ue[X]=ot*ee,Ue[ie]=ve,S.push(Ue.x,Ue.y,Ue.z),Ue[W]=0,Ue[X]=0,Ue[ie]=re>0?1:-1,L.push(Ue.x,Ue.y,Ue.z),I.push(ue/me),I.push(1-tt/pe),ye+=1}for(var Oe=0;Oe<pe;Oe++)for(var De=0;De<me;De++){var Ve=O+De+Me*Oe,Ae=O+De+Me*(Oe+1),Ee=O+(De+1)+Me*(Oe+1),Ze=O+(De+1)+Me*Oe;E.push(Ve,Ae,Ze),E.push(Ae,Ee,Ze),Te+=6}b.addGroup(U,Te,xe),U+=Te,O+=ye}return G("z","y","x",-1,-1,s,e,t,m,c,0),G("z","y","x",1,-1,s,e,-t,m,c,1),G("x","z","y",1,1,t,s,e,a,m,2),G("x","z","y",1,-1,t,s,-e,a,m,3),G("x","y","z",1,-1,t,e,s,a,c,4),G("x","y","z",-1,-1,t,e,-s,a,c,5),v.setIndex(E),v.setAttribute("position",new at(S,3)),v.setAttribute("normal",new at(L,3)),v.setAttribute("uv",new at(I,2)),v}return Ne(i,o),i}(ct);function Zs(o){var i={};for(var t in o)for(var e in i[t]={},o[t]){var s=o[t][e];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?i[t][e]=s.clone():Array.isArray(s)?i[t][e]=s.slice():i[t][e]=s}return i}function Mi(o){for(var i={},t=0;t<o.length;t++){var e=Zs(o[t]);for(var s in e)i[s]=e[s]}return i}var Ql={clone:Zs,merge:Mi};function Ui(o){Gt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,o!==void 0&&(o.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(o))}function rs(){Ke.call(this),this.type="Camera",this.matrixWorldInverse=new ht,this.projectionMatrix=new ht,this.projectionMatrixInverse=new ht}function di(o,i,t,e){o===void 0&&(o=50),i===void 0&&(i=1),t===void 0&&(t=.1),e===void 0&&(e=2e3),rs.call(this),this.type="PerspectiveCamera",this.fov=o,this.zoom=1,this.near=t,this.far=e,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Ui.prototype=Object.create(Gt.prototype),Ui.prototype.constructor=Ui,Ui.prototype.isShaderMaterial=!0,Ui.prototype.copy=function(o){return Gt.prototype.copy.call(this,o),this.fragmentShader=o.fragmentShader,this.vertexShader=o.vertexShader,this.uniforms=Zs(o.uniforms),this.defines=Object.assign({},o.defines),this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.lights=o.lights,this.clipping=o.clipping,this.skinning=o.skinning,this.morphTargets=o.morphTargets,this.morphNormals=o.morphNormals,this.extensions=Object.assign({},o.extensions),this.glslVersion=o.glslVersion,this},Ui.prototype.toJSON=function(o){var i=Gt.prototype.toJSON.call(this,o);for(var t in i.glslVersion=this.glslVersion,i.uniforms={},this.uniforms){var e=this.uniforms[t].value;e&&e.isTexture?i.uniforms[t]={type:"t",value:e.toJSON(o).uuid}:e&&e.isColor?i.uniforms[t]={type:"c",value:e.getHex()}:e&&e.isVector2?i.uniforms[t]={type:"v2",value:e.toArray()}:e&&e.isVector3?i.uniforms[t]={type:"v3",value:e.toArray()}:e&&e.isVector4?i.uniforms[t]={type:"v4",value:e.toArray()}:e&&e.isMatrix3?i.uniforms[t]={type:"m3",value:e.toArray()}:e&&e.isMatrix4?i.uniforms[t]={type:"m4",value:e.toArray()}:i.uniforms[t]={value:e}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;var s={};for(var a in this.extensions)this.extensions[a]===!0&&(s[a]=!0);return Object.keys(s).length>0&&(i.extensions=s),i},rs.prototype=Object.assign(Object.create(Ke.prototype),{constructor:rs,isCamera:!0,copy:function(i,t){return Ke.prototype.copy.call(this,i,t),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),i=new se),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return i.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(i){Ke.prototype.updateMatrixWorld.call(this,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(i,t){Ke.prototype.updateWorldMatrix.call(this,i,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return new this.constructor().copy(this)}}),di.prototype=Object.assign(Object.create(rs.prototype),{constructor:di,isPerspectiveCamera:!0,copy:function(i,t){return rs.prototype.copy.call(this,i,t),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=i.view===null?null:Object.assign({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this},setFocalLength:function(i){var t=.5*this.getFilmHeight()/i;this.fov=2*dt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var i=Math.tan(.5*dt.DEG2RAD*this.fov);return .5*this.getFilmHeight()/i},getEffectiveFOV:function(){return 2*dt.RAD2DEG*Math.atan(Math.tan(.5*dt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(i,t,e,s,a,c){this.aspect=i/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=t,this.view.offsetX=e,this.view.offsetY=s,this.view.width=a,this.view.height=c,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var i=this.near,t=i*Math.tan(.5*dt.DEG2RAD*this.fov)/this.zoom,e=2*t,s=this.aspect*e,a=-.5*s,c=this.view;if(this.view!==null&&this.view.enabled){var m=c.fullWidth,v=c.fullHeight;a+=c.offsetX*s/m,t-=c.offsetY*e/v,s*=c.width/m,e*=c.height/v}var b=this.filmOffset;b!==0&&(a+=i*b/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+s,t,t-e,i,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(i){var t=Ke.prototype.toJSON.call(this,i);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var qs=90,Ca=function(o){function i(t,e,s){var a;if((a=o.call(this)||this).type="CubeCamera",s.isWebGLCubeRenderTarget!==!0)return console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."),bi(a);a.renderTarget=s;var c=new di(qs,1,t,e);c.layers=a.layers,c.up.set(0,-1,0),c.lookAt(new se(1,0,0)),a.add(c);var m=new di(qs,1,t,e);m.layers=a.layers,m.up.set(0,-1,0),m.lookAt(new se(-1,0,0)),a.add(m);var v=new di(qs,1,t,e);v.layers=a.layers,v.up.set(0,0,1),v.lookAt(new se(0,1,0)),a.add(v);var b=new di(qs,1,t,e);b.layers=a.layers,b.up.set(0,0,-1),b.lookAt(new se(0,-1,0)),a.add(b);var E=new di(qs,1,t,e);E.layers=a.layers,E.up.set(0,-1,0),E.lookAt(new se(0,0,1)),a.add(E);var S=new di(qs,1,t,e);return S.layers=a.layers,S.up.set(0,-1,0),S.lookAt(new se(0,0,-1)),a.add(S),a}return Ne(i,o),i.prototype.update=function(t,e){this.parent===null&&this.updateMatrixWorld();var s=this.renderTarget,a=this.children,c=a[0],m=a[1],v=a[2],b=a[3],E=a[4],S=a[5],L=t.xr.enabled,I=t.getRenderTarget();t.xr.enabled=!1;var O=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,t.setRenderTarget(s,0),t.render(e,c),t.setRenderTarget(s,1),t.render(e,m),t.setRenderTarget(s,2),t.render(e,v),t.setRenderTarget(s,3),t.render(e,b),t.setRenderTarget(s,4),t.render(e,E),s.texture.generateMipmaps=O,t.setRenderTarget(s,5),t.render(e,S),t.setRenderTarget(I),t.xr.enabled=L},i}(Ke),Qs=function(o){function i(t,e,s,a,c,m,v,b,E,S){var L;return t=t!==void 0?t:[],e=e!==void 0?e:_,v=v!==void 0?v:Y,(L=o.call(this,t,e,s,a,c,m,v,b,E,S)||this)._needsFlipEnvMap=!0,L.flipY=!1,L}return Ne(i,o),gi(i,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),i}(ui);Qs.prototype.isCubeTexture=!0;var Ma=function(o){function i(e,s,a){var c;return Number.isInteger(s)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),s=a),c=o.call(this,e,e,s)||this,s=s||{},c.texture=new Qs(void 0,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.encoding),c.texture.generateMipmaps=s.generateMipmaps!==void 0&&s.generateMipmaps,c.texture.minFilter=s.minFilter!==void 0?s.minFilter:T,c.texture._needsFlipEnvMap=!1,c}Ne(i,o);var t=i.prototype;return t.fromEquirectangularTexture=function(e,s){this.texture.type=s.type,this.texture.format=k,this.texture.encoding=s.encoding,this.texture.generateMipmaps=s.generateMipmaps,this.texture.minFilter=s.minFilter,this.texture.magFilter=s.magFilter;var a={tEquirect:{value:null}},c=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,m=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,v=new Ss(5,5,5),b=new Ui({name:"CubemapFromEquirect",uniforms:Zs(a),vertexShader:c,fragmentShader:m,side:1,blending:0});b.uniforms.tEquirect.value=s;var E=new Jt(v,b),S=s.minFilter;return s.minFilter===C&&(s.minFilter=T),new Ca(1,10,this).update(e,E),s.minFilter=S,E.geometry.dispose(),E.material.dispose(),this},t.clear=function(e,s,a,c){for(var m=e.getRenderTarget(),v=0;v<6;v++)e.setRenderTarget(this,v),e.clear(s,a,c);e.setRenderTarget(m)},i}(tn);Ma.prototype.isWebGLCubeRenderTarget=!0;var Js=function(o){function i(t,e,s,a,c,m,v,b,E,S,L,I){var O;return(O=o.call(this,null,m,v,b,E,S,a,c,L,I)||this).image={data:t||null,width:e||1,height:s||1},O.magFilter=E!==void 0?E:x,O.minFilter=S!==void 0?S:x,O.generateMipmaps=!1,O.flipY=!1,O.unpackAlignment=1,O.needsUpdate=!0,O}return Ne(i,o),i}(ui);Js.prototype.isDataTexture=!0;var $s=new mn,Ta=new se,Tr=function(){function o(t,e,s,a,c,m){t===void 0&&(t=new Bi),e===void 0&&(e=new Bi),s===void 0&&(s=new Bi),a===void 0&&(a=new Bi),c===void 0&&(c=new Bi),m===void 0&&(m=new Bi),this.planes=[t,e,s,a,c,m]}var i=o.prototype;return i.set=function(t,e,s,a,c,m){var v=this.planes;return v[0].copy(t),v[1].copy(e),v[2].copy(s),v[3].copy(a),v[4].copy(c),v[5].copy(m),this},i.copy=function(t){for(var e=this.planes,s=0;s<6;s++)e[s].copy(t.planes[s]);return this},i.setFromProjectionMatrix=function(t){var e=this.planes,s=t.elements,a=s[0],c=s[1],m=s[2],v=s[3],b=s[4],E=s[5],S=s[6],L=s[7],I=s[8],O=s[9],U=s[10],G=s[11],W=s[12],X=s[13],ie=s[14],$=s[15];return e[0].setComponents(v-a,L-b,G-I,$-W).normalize(),e[1].setComponents(v+a,L+b,G+I,$+W).normalize(),e[2].setComponents(v+c,L+E,G+O,$+X).normalize(),e[3].setComponents(v-c,L-E,G-O,$-X).normalize(),e[4].setComponents(v-m,L-S,G-U,$-ie).normalize(),e[5].setComponents(v+m,L+S,G+U,$+ie).normalize(),this},i.intersectsObject=function(t){var e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),$s.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere($s)},i.intersectsSprite=function(t){return $s.center.set(0,0,0),$s.radius=.7071067811865476,$s.applyMatrix4(t.matrixWorld),this.intersectsSphere($s)},i.intersectsSphere=function(t){for(var e=this.planes,s=t.center,a=-t.radius,c=0;c<6;c++)if(e[c].distanceToPoint(s)<a)return!1;return!0},i.intersectsBox=function(t){for(var e=this.planes,s=0;s<6;s++){var a=e[s];if(Ta.x=a.normal.x>0?t.max.x:t.min.x,Ta.y=a.normal.y>0?t.max.y:t.min.y,Ta.z=a.normal.z>0?t.max.z:t.min.z,a.distanceToPoint(Ta)<0)return!1}return!0},i.containsPoint=function(t){for(var e=this.planes,s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0},i.clone=function(){return new this.constructor().copy(this)},o}();function Jl(){var o=null,i=!1,t=null,e=null;function s(a,c){t(a,c),e=o.requestAnimationFrame(s)}return{start:function(){i!==!0&&t!==null&&(e=o.requestAnimationFrame(s),i=!0)},stop:function(){o.cancelAnimationFrame(e),i=!1},setAnimationLoop:function(c){t=c},setContext:function(c){o=c}}}function hu(o,i){var t=i.isWebGL2,e=new WeakMap;return{get:function(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)},remove:function(a){a.isInterleavedBufferAttribute&&(a=a.data);var c=e.get(a);c&&(o.deleteBuffer(c.buffer),e.delete(a))},update:function(a,c){if(a.isGLBufferAttribute){var m=e.get(a);(!m||m.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version})}else{a.isInterleavedBufferAttribute&&(a=a.data);var v=e.get(a);v===void 0?e.set(a,function(b,E){var S=b.array,L=b.usage,I=o.createBuffer();o.bindBuffer(E,I),o.bufferData(E,S,L),b.onUploadCallback();var O=5126;return S instanceof Float32Array?O=5126:S instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):S instanceof Uint16Array?b.isFloat16BufferAttribute?t?O=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):O=5123:S instanceof Int16Array?O=5122:S instanceof Uint32Array?O=5125:S instanceof Int32Array?O=5124:S instanceof Int8Array?O=5120:S instanceof Uint8Array&&(O=5121),{buffer:I,type:O,bytesPerElement:S.BYTES_PER_ELEMENT,version:b.version}}(a,c)):v.version<a.version&&(function(b,E,S){var L=E.array,I=E.updateRange;o.bindBuffer(S,b),I.count===-1?o.bufferSubData(S,0,L):(t?o.bufferSubData(S,I.offset*L.BYTES_PER_ELEMENT,L,I.offset,I.count):o.bufferSubData(S,I.offset*L.BYTES_PER_ELEMENT,L.subarray(I.offset,I.offset+I.count)),I.count=-1)}(v.buffer,a,c),v.version=a.version)}}}}var Lr=function(o){function i(t,e,s,a){var c;t===void 0&&(t=1),e===void 0&&(e=1),s===void 0&&(s=1),a===void 0&&(a=1),(c=o.call(this)||this).type="PlaneGeometry",c.parameters={width:t,height:e,widthSegments:s,heightSegments:a};for(var m=t/2,v=e/2,b=Math.floor(s),E=Math.floor(a),S=b+1,L=E+1,I=t/b,O=e/E,U=[],G=[],W=[],X=[],ie=0;ie<L;ie++)for(var $=ie*O-v,ee=0;ee<S;ee++){var he=ee*I-m;G.push(he,-$,0),W.push(0,0,1),X.push(ee/b),X.push(1-ie/E)}for(var oe=0;oe<E;oe++)for(var re=0;re<b;re++){var me=re+S*oe,pe=re+S*(oe+1),xe=re+1+S*(oe+1),Ce=re+1+S*oe;U.push(me,pe,Ce),U.push(pe,xe,Ce)}return c.setIndex(U),c.setAttribute("position",new at(G,3)),c.setAttribute("normal",new at(W,3)),c.setAttribute("uv",new at(X,2)),c}return Ne(i,o),i}(ct),Lt={alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor.xyz *= color.xyz;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float fogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex:`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(		0, 1,		0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
							f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
							f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(	1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,	1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,	1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmissionmap_fragment:`#ifdef USE_TRANSMISSIONMAP
	totalTransmission *= texture2D( transmissionMap, vUv ).r;
#endif`,transmissionmap_pars_fragment:`#ifdef USE_TRANSMISSIONMAP
	uniform sampler2D transmissionMap;
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSMISSION
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSMISSION
	uniform float transmission;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <transmissionmap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#ifdef TRANSMISSION
		float totalTransmission = transmission;
	#endif
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <transmissionmap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSMISSION
		diffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,normal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,normal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`},et={common:{diffuse:{value:new st(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Wt},uv2Transform:{value:new Wt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new He(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new st(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new st(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Wt}},sprite:{diffuse:{value:new st(15658734)},opacity:{value:1},center:{value:new He(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Wt}}},gn={basic:{uniforms:Mi([et.common,et.specularmap,et.envmap,et.aomap,et.lightmap,et.fog]),vertexShader:Lt.meshbasic_vert,fragmentShader:Lt.meshbasic_frag},lambert:{uniforms:Mi([et.common,et.specularmap,et.envmap,et.aomap,et.lightmap,et.emissivemap,et.fog,et.lights,{emissive:{value:new st(0)}}]),vertexShader:Lt.meshlambert_vert,fragmentShader:Lt.meshlambert_frag},phong:{uniforms:Mi([et.common,et.specularmap,et.envmap,et.aomap,et.lightmap,et.emissivemap,et.bumpmap,et.normalmap,et.displacementmap,et.fog,et.lights,{emissive:{value:new st(0)},specular:{value:new st(1118481)},shininess:{value:30}}]),vertexShader:Lt.meshphong_vert,fragmentShader:Lt.meshphong_frag},standard:{uniforms:Mi([et.common,et.envmap,et.aomap,et.lightmap,et.emissivemap,et.bumpmap,et.normalmap,et.displacementmap,et.roughnessmap,et.metalnessmap,et.fog,et.lights,{emissive:{value:new st(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Lt.meshphysical_vert,fragmentShader:Lt.meshphysical_frag},toon:{uniforms:Mi([et.common,et.aomap,et.lightmap,et.emissivemap,et.bumpmap,et.normalmap,et.displacementmap,et.gradientmap,et.fog,et.lights,{emissive:{value:new st(0)}}]),vertexShader:Lt.meshtoon_vert,fragmentShader:Lt.meshtoon_frag},matcap:{uniforms:Mi([et.common,et.bumpmap,et.normalmap,et.displacementmap,et.fog,{matcap:{value:null}}]),vertexShader:Lt.meshmatcap_vert,fragmentShader:Lt.meshmatcap_frag},points:{uniforms:Mi([et.points,et.fog]),vertexShader:Lt.points_vert,fragmentShader:Lt.points_frag},dashed:{uniforms:Mi([et.common,et.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Lt.linedashed_vert,fragmentShader:Lt.linedashed_frag},depth:{uniforms:Mi([et.common,et.displacementmap]),vertexShader:Lt.depth_vert,fragmentShader:Lt.depth_frag},normal:{uniforms:Mi([et.common,et.bumpmap,et.normalmap,et.displacementmap,{opacity:{value:1}}]),vertexShader:Lt.normal_vert,fragmentShader:Lt.normal_frag},sprite:{uniforms:Mi([et.sprite,et.fog]),vertexShader:Lt.sprite_vert,fragmentShader:Lt.sprite_frag},background:{uniforms:{uvTransform:{value:new Wt},t2D:{value:null}},vertexShader:Lt.background_vert,fragmentShader:Lt.background_frag},cube:{uniforms:Mi([et.envmap,{opacity:{value:1}}]),vertexShader:Lt.cube_vert,fragmentShader:Lt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Lt.equirect_vert,fragmentShader:Lt.equirect_frag},distanceRGBA:{uniforms:Mi([et.common,et.displacementmap,{referencePosition:{value:new se},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Lt.distanceRGBA_vert,fragmentShader:Lt.distanceRGBA_frag},shadow:{uniforms:Mi([et.lights,et.fog,{color:{value:new st(0)},opacity:{value:1}}]),vertexShader:Lt.shadow_vert,fragmentShader:Lt.shadow_frag}};function cu(o,i,t,e,s){var a,c,m=new st(0),v=0,b=null,E=0,S=null;function L(I,O){t.buffers.color.setClear(I.r,I.g,I.b,O,s)}return{getClearColor:function(){return m},setClearColor:function(O,U){U===void 0&&(U=1),m.set(O),L(m,v=U)},getClearAlpha:function(){return v},setClearAlpha:function(O){L(m,v=O)},render:function(O,U,G,W){var X=U.isScene===!0?U.background:null;X&&X.isTexture&&(X=i.get(X));var ie=o.xr,$=ie.getSession&&ie.getSession();$&&$.environmentBlendMode==="additive"&&(X=null),X===null?L(m,v):X&&X.isColor&&(L(X,1),W=!0),(o.autoClear||W)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),X&&(X.isCubeTexture||X.isWebGLCubeRenderTarget||X.mapping===h)?(c===void 0&&((c=new Jt(new Ss(1,1,1),new Ui({name:"BackgroundCubeMaterial",uniforms:Zs(gn.cube.uniforms),vertexShader:gn.cube.vertexShader,fragmentShader:gn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(ee,he,oe){this.matrixWorld.copyPosition(oe.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),e.update(c)),X.isWebGLCubeRenderTarget&&(X=X.texture),c.material.uniforms.envMap.value=X,c.material.uniforms.flipEnvMap.value=X.isCubeTexture&&X._needsFlipEnvMap?-1:1,b===X&&E===X.version&&S===o.toneMapping||(c.material.needsUpdate=!0,b=X,E=X.version,S=o.toneMapping),O.unshift(c,c.geometry,c.material,0,0,null)):X&&X.isTexture&&(a===void 0&&((a=new Jt(new Lr(2,2),new Ui({name:"BackgroundMaterial",uniforms:Zs(gn.background.uniforms),vertexShader:gn.background.vertexShader,fragmentShader:gn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),e.update(a)),a.material.uniforms.t2D.value=X,X.matrixAutoUpdate===!0&&X.updateMatrix(),a.material.uniforms.uvTransform.value.copy(X.matrix),b===X&&E===X.version&&S===o.toneMapping||(a.material.needsUpdate=!0,b=X,E=X.version,S=o.toneMapping),O.unshift(a,a.geometry,a.material,0,0,null))}}}function uu(o,i,t,e){var s=o.getParameter(34921),a=e.isWebGL2?null:i.get("OES_vertex_array_object"),c=e.isWebGL2||a!==null,m={},v=L(null),b=v;function E($){return e.isWebGL2?o.bindVertexArray($):a.bindVertexArrayOES($)}function S($){return e.isWebGL2?o.deleteVertexArray($):a.deleteVertexArrayOES($)}function L($){for(var ee=[],he=[],oe=[],re=0;re<s;re++)ee[re]=0,he[re]=0,oe[re]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ee,enabledAttributes:he,attributeDivisors:oe,object:$,attributes:{},index:null}}function I(){for(var $=b.newAttributes,ee=0,he=$.length;ee<he;ee++)$[ee]=0}function O($){U($,0)}function U($,ee){var he=b.newAttributes,oe=b.enabledAttributes,re=b.attributeDivisors;he[$]=1,oe[$]===0&&(o.enableVertexAttribArray($),oe[$]=1),re[$]!==ee&&((e.isWebGL2?o:i.get("ANGLE_instanced_arrays"))[e.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"]($,ee),re[$]=ee)}function G(){for(var $=b.newAttributes,ee=b.enabledAttributes,he=0,oe=ee.length;he<oe;he++)ee[he]!==$[he]&&(o.disableVertexAttribArray(he),ee[he]=0)}function W($,ee,he,oe,re,me){e.isWebGL2!==!0||he!==5124&&he!==5125?o.vertexAttribPointer($,ee,he,oe,re,me):o.vertexAttribIPointer($,ee,he,re,me)}function X(){ie(),b!==v&&E((b=v).object)}function ie(){v.geometry=null,v.program=null,v.wireframe=!1}return{setup:function(ee,he,oe,re,me){var pe=!1;if(c){var xe=function(Ie,Pe,de){var ve=de.wireframe===!0,Me=m[Ie.id];Me===void 0&&(Me={},m[Ie.id]=Me);var we=Me[Pe.id];we===void 0&&(we={},Me[Pe.id]=we);var ye=we[ve];return ye===void 0&&(ye=L(e.isWebGL2?o.createVertexArray():a.createVertexArrayOES()),we[ve]=ye),ye}(re,oe,he);b!==xe&&E((b=xe).object),(pe=function(Ie,Pe){var de=b.attributes,ve=Ie.attributes,Me=0;for(var we in ve){var ye=de[we],Te=ve[we];if(ye===void 0||ye.attribute!==Te||ye.data!==Te.data)return!0;Me++}return b.attributesNum!==Me||b.index!==Pe}(re,me))&&function(Ie,Pe){var de={},ve=Ie.attributes,Me=0;for(var we in ve){var ye=ve[we],Te={};Te.attribute=ye,ye.data&&(Te.data=ye.data),de[we]=Te,Me++}b.attributes=de,b.attributesNum=Me,b.index=Pe}(re,me)}else{var Ce=he.wireframe===!0;b.geometry===re.id&&b.program===oe.id&&b.wireframe===Ce||(b.geometry=re.id,b.program=oe.id,b.wireframe=Ce,pe=!0)}ee.isInstancedMesh===!0&&(pe=!0),me!==null&&t.update(me,34963),pe&&(function(Ie,Pe,de,ve){if(!(e.isWebGL2===!1&&(Ie.isInstancedMesh||ve.isInstancedBufferGeometry)&&i.get("ANGLE_instanced_arrays")===null)){I();var Me=ve.attributes,we=de.getAttributes(),ye=Pe.defaultAttributeValues;for(var Te in we){var Ue=we[Te];if(Ue>=0){var tt=Me[Te];if(tt!==void 0){var ot=tt.normalized,ue=tt.itemSize,fe=t.get(tt);if(fe===void 0)continue;var Oe=fe.buffer,De=fe.type,Ve=fe.bytesPerElement;if(tt.isInterleavedBufferAttribute){var Ae=tt.data,Ee=Ae.stride,Ze=tt.offset;Ae&&Ae.isInstancedInterleavedBuffer?(U(Ue,Ae.meshPerAttribute),ve._maxInstanceCount===void 0&&(ve._maxInstanceCount=Ae.meshPerAttribute*Ae.count)):O(Ue),o.bindBuffer(34962,Oe),W(Ue,ue,De,ot,Ee*Ve,Ze*Ve)}else tt.isInstancedBufferAttribute?(U(Ue,tt.meshPerAttribute),ve._maxInstanceCount===void 0&&(ve._maxInstanceCount=tt.meshPerAttribute*tt.count)):O(Ue),o.bindBuffer(34962,Oe),W(Ue,ue,De,ot,0,0)}else if(Te==="instanceMatrix"){var qe=t.get(Ie.instanceMatrix);if(qe===void 0)continue;var rt=qe.buffer,Xe=qe.type;U(Ue+0,1),U(Ue+1,1),U(Ue+2,1),U(Ue+3,1),o.bindBuffer(34962,rt),o.vertexAttribPointer(Ue+0,4,Xe,!1,64,0),o.vertexAttribPointer(Ue+1,4,Xe,!1,64,16),o.vertexAttribPointer(Ue+2,4,Xe,!1,64,32),o.vertexAttribPointer(Ue+3,4,Xe,!1,64,48)}else if(Te==="instanceColor"){var gt=t.get(Ie.instanceColor);if(gt===void 0)continue;var Rt=gt.buffer,Bt=gt.type;U(Ue,1),o.bindBuffer(34962,Rt),o.vertexAttribPointer(Ue,3,Bt,!1,12,0)}else if(ye!==void 0){var wt=ye[Te];if(wt!==void 0)switch(wt.length){case 2:o.vertexAttrib2fv(Ue,wt);break;case 3:o.vertexAttrib3fv(Ue,wt);break;case 4:o.vertexAttrib4fv(Ue,wt);break;default:o.vertexAttrib1fv(Ue,wt)}}}}G()}}(ee,he,oe,re),me!==null&&o.bindBuffer(34963,t.get(me).buffer))},reset:X,resetDefaultState:ie,dispose:function(){for(var ee in X(),m){var he=m[ee];for(var oe in he){var re=he[oe];for(var me in re)S(re[me].object),delete re[me];delete he[oe]}delete m[ee]}},releaseStatesOfGeometry:function(ee){if(m[ee.id]!==void 0){var he=m[ee.id];for(var oe in he){var re=he[oe];for(var me in re)S(re[me].object),delete re[me];delete he[oe]}delete m[ee.id]}},releaseStatesOfProgram:function(ee){for(var he in m){var oe=m[he];if(oe[ee.id]!==void 0){var re=oe[ee.id];for(var me in re)S(re[me].object),delete re[me];delete oe[ee.id]}}},initAttributes:I,enableAttribute:O,disableUnusedAttributes:G}}function du(o,i,t,e){var s,a=e.isWebGL2;this.setMode=function(c){s=c},this.render=function(c,m){o.drawArrays(s,c,m),t.update(m,s,1)},this.renderInstances=function(c,m,v){if(v!==0){var b,E;if(a)b=o,E="drawArraysInstanced";else if(E="drawArraysInstancedANGLE",(b=i.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");b[E](s,c,m,v),t.update(m,s,v)}}}function fu(o,i,t){var e;function s(ie){if(ie==="highp"){if(o.getShaderPrecisionFormat(35633,36338).precision>0&&o.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";ie="mediump"}return ie==="mediump"&&o.getShaderPrecisionFormat(35633,36337).precision>0&&o.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a=typeof WebGL2RenderingContext<"u"&&o instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&o instanceof WebGL2ComputeRenderingContext,c=t.precision!==void 0?t.precision:"highp",m=s(c);m!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",m,"instead."),c=m);var v=t.logarithmicDepthBuffer===!0,b=o.getParameter(34930),E=o.getParameter(35660),S=o.getParameter(3379),L=o.getParameter(34076),I=o.getParameter(34921),O=o.getParameter(36347),U=o.getParameter(36348),G=o.getParameter(36349),W=E>0,X=a||i.has("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(e!==void 0)return e;if(i.has("EXT_texture_filter_anisotropic")===!0){var $=i.get("EXT_texture_filter_anisotropic");e=o.getParameter($.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else e=0;return e},getMaxPrecision:s,precision:c,logarithmicDepthBuffer:v,maxTextures:b,maxVertexTextures:E,maxTextureSize:S,maxCubemapSize:L,maxAttributes:I,maxVertexUniforms:O,maxVaryings:U,maxFragmentUniforms:G,vertexTextures:W,floatFragmentTextures:X,floatVertexTextures:W&&X,maxSamples:a?o.getParameter(36183):0}}function pu(o){var i=this,t=null,e=0,s=!1,a=!1,c=new Bi,m=new Wt,v={value:null,needsUpdate:!1};function b(){v.value!==t&&(v.value=t,v.needsUpdate=e>0),i.numPlanes=e,i.numIntersection=0}function E(S,L,I,O){var U=S!==null?S.length:0,G=null;if(U!==0){if(G=v.value,O!==!0||G===null){var W=I+4*U,X=L.matrixWorldInverse;m.getNormalMatrix(X),(G===null||G.length<W)&&(G=new Float32Array(W));for(var ie=0,$=I;ie!==U;++ie,$+=4)c.copy(S[ie]).applyMatrix4(X,m),c.normal.toArray(G,$),G[$+3]=c.constant}v.value=G,v.needsUpdate=!0}return i.numPlanes=U,i.numIntersection=0,G}this.uniform=v,this.numPlanes=0,this.numIntersection=0,this.init=function(S,L,I){var O=S.length!==0||L||e!==0||s;return s=L,t=E(S,I,0),e=S.length,O},this.beginShadows=function(){a=!0,E(null)},this.endShadows=function(){a=!1,b()},this.setState=function(S,L,I){var O=S.clippingPlanes,U=S.clipIntersection,G=S.clipShadows,W=o.get(S);if(!s||O===null||O.length===0||a&&!G)a?E(null):b();else{var X=a?0:e,ie=4*X,$=W.clippingState||null;v.value=$,$=E(O,L,ie,I);for(var ee=0;ee!==ie;++ee)$[ee]=t[ee];W.clippingState=$,this.numIntersection=U?this.numPlanes:0,this.numPlanes+=X}}}function mu(o){var i=new WeakMap;function t(s,a){return a===n?s.mapping=_:a===r&&(s.mapping=l),s}function e(s){var a=s.target;a.removeEventListener("dispose",e);var c=i.get(a);c!==void 0&&(i.delete(a),c.dispose())}return{get:function(a){if(a&&a.isTexture){var c=a.mapping;if(c===n||c===r){if(i.has(a))return t(i.get(a).texture,a.mapping);var m=a.image;if(m&&m.height>0){var v=o.getRenderTarget(),b=new Ma(m.height/2);return b.fromEquirectangularTexture(o,a),i.set(a,b),o.setRenderTarget(v),a.addEventListener("dispose",e),t(b.texture,a.mapping)}return null}}return a},dispose:function(){i=new WeakMap}}}function _u(o){var i={};function t(e){if(i[e]!==void 0)return i[e];var s;switch(e){case"WEBGL_depth_texture":s=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=o.getExtension(e)}return i[e]=s,s}return{has:function(s){return t(s)!==null},init:function(s){s.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(s){var a=t(s);return a===null&&console.warn("THREE.WebGLRenderer: "+s+" extension not supported."),a}}}function gu(o,i,t,e){var s={},a=new WeakMap;function c(v){var b=v.target;for(var E in b.index!==null&&i.remove(b.index),b.attributes)i.remove(b.attributes[E]);b.removeEventListener("dispose",c),delete s[b.id];var S=a.get(b);S&&(i.remove(S),a.delete(b)),e.releaseStatesOfGeometry(b),b.isInstancedBufferGeometry===!0&&delete b._maxInstanceCount,t.memory.geometries--}function m(v){var b=[],E=v.index,S=v.attributes.position,L=0;if(E!==null){var I=E.array;L=E.version;for(var O=0,U=I.length;O<U;O+=3){var G=I[O+0],W=I[O+1],X=I[O+2];b.push(G,W,W,X,X,G)}}else{var ie=S.array;L=S.version;for(var $=0,ee=ie.length/3-1;$<ee;$+=3){var he=$+0,oe=$+1,re=$+2;b.push(he,oe,oe,re,re,he)}}var me=new(Zl(b)>65535?ws:xs)(b,1);me.version=L;var pe=a.get(v);pe&&i.remove(pe),a.set(v,me)}return{get:function(b,E){return s[E.id]===!0||(E.addEventListener("dispose",c),s[E.id]=!0,t.memory.geometries++),E},update:function(b){var E=b.attributes;for(var S in E)i.update(E[S],34962);var L=b.morphAttributes;for(var I in L)for(var O=L[I],U=0,G=O.length;U<G;U++)i.update(O[U],34962)},getWireframeAttribute:function(b){var E=a.get(b);if(E){var S=b.index;S!==null&&E.version<S.version&&m(b)}else m(b);return a.get(b)}}}function vu(o,i,t,e){var s,a,c,m=e.isWebGL2;this.setMode=function(v){s=v},this.setIndex=function(v){a=v.type,c=v.bytesPerElement},this.render=function(v,b){o.drawElements(s,b,a,v*c),t.update(b,s,1)},this.renderInstances=function(v,b,E){if(E!==0){var S,L;if(m)S=o,L="drawElementsInstanced";else if(L="drawElementsInstancedANGLE",(S=i.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");S[L](s,b,a,v*c,E),t.update(b,s,E)}}}function yu(o){var i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(e,s,a){switch(i.calls++,s){case 4:i.triangles+=a*(e/3);break;case 1:i.lines+=a*(e/2);break;case 3:i.lines+=a*(e-1);break;case 2:i.lines+=a*e;break;case 0:i.points+=a*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s)}}}}function bu(o,i){return o[0]-i[0]}function xu(o,i){return Math.abs(i[1])-Math.abs(o[1])}function wu(o){for(var i={},t=new Float32Array(8),e=[],s=0;s<8;s++)e[s]=[s,0];return{update:function(c,m,v,b){var E=c.morphTargetInfluences,S=E===void 0?0:E.length,L=i[m.id];if(L===void 0){L=[];for(var I=0;I<S;I++)L[I]=[I,0];i[m.id]=L}for(var O=0;O<S;O++){var U=L[O];U[0]=O,U[1]=E[O]}L.sort(xu);for(var G=0;G<8;G++)G<S&&L[G][1]?(e[G][0]=L[G][0],e[G][1]=L[G][1]):(e[G][0]=Number.MAX_SAFE_INTEGER,e[G][1]=0);e.sort(bu);for(var W=v.morphTargets&&m.morphAttributes.position,X=v.morphNormals&&m.morphAttributes.normal,ie=0,$=0;$<8;$++){var ee=e[$],he=ee[0],oe=ee[1];he!==Number.MAX_SAFE_INTEGER&&oe?(W&&m.getAttribute("morphTarget"+$)!==W[he]&&m.setAttribute("morphTarget"+$,W[he]),X&&m.getAttribute("morphNormal"+$)!==X[he]&&m.setAttribute("morphNormal"+$,X[he]),t[$]=oe,ie+=oe):(W&&m.hasAttribute("morphTarget"+$)===!0&&m.deleteAttribute("morphTarget"+$),X&&m.hasAttribute("morphNormal"+$)===!0&&m.deleteAttribute("morphNormal"+$),t[$]=0)}var re=m.morphTargetsRelative?1:1-ie;b.getUniforms().setValue(o,"morphTargetBaseInfluence",re),b.getUniforms().setValue(o,"morphTargetInfluences",t)}}}function Su(o,i,t,e){var s=new WeakMap;function a(c){var m=c.target;m.removeEventListener("dispose",a),t.remove(m.instanceMatrix),m.instanceColor!==null&&t.remove(m.instanceColor)}return{update:function(m){var v=e.render.frame,b=m.geometry,E=i.get(m,b);return s.get(E)!==v&&(i.update(E),s.set(E,v)),m.isInstancedMesh&&(m.hasEventListener("dispose",a)===!1&&m.addEventListener("dispose",a),t.update(m.instanceMatrix,34962),m.instanceColor!==null&&t.update(m.instanceColor,34962)),E},dispose:function(){s=new WeakMap}}}gn.physical={uniforms:Mi([gn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new He(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new st(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Lt.meshphysical_vert,fragmentShader:Lt.meshphysical_frag};var Vo=function(o){function i(t,e,s,a){var c;return t===void 0&&(t=null),e===void 0&&(e=1),s===void 0&&(s=1),a===void 0&&(a=1),(c=o.call(this,null)||this).image={data:t,width:e,height:s,depth:a},c.magFilter=x,c.minFilter=x,c.wrapR=p,c.generateMipmaps=!1,c.flipY=!1,c.needsUpdate=!0,c}return Ne(i,o),i}(ui);Vo.prototype.isDataTexture2DArray=!0;var Wo=function(o){function i(t,e,s,a){var c;return t===void 0&&(t=null),e===void 0&&(e=1),s===void 0&&(s=1),a===void 0&&(a=1),(c=o.call(this,null)||this).image={data:t,width:e,height:s,depth:a},c.magFilter=x,c.minFilter=x,c.wrapR=p,c.generateMipmaps=!1,c.flipY=!1,c.needsUpdate=!0,c}return Ne(i,o),i}(ui);Wo.prototype.isDataTexture3D=!0;var $l=new ui,Eu=new Vo,Au=new Wo,eh=new Qs,th=[],ih=[],nh=new Float32Array(16),sh=new Float32Array(9),rh=new Float32Array(4);function er(o,i,t){var e=o[0];if(e<=0||e>0)return o;var s=i*t,a=th[s];if(a===void 0&&(a=new Float32Array(s),th[s]=a),i!==0){e.toArray(a,0);for(var c=1,m=0;c!==i;++c)m+=t,o[c].toArray(a,m)}return a}function hn(o,i){if(o.length!==i.length)return!1;for(var t=0,e=o.length;t<e;t++)if(o[t]!==i[t])return!1;return!0}function qi(o,i){for(var t=0,e=i.length;t<e;t++)o[t]=i[t]}function ah(o,i){var t=ih[i];t===void 0&&(t=new Int32Array(i),ih[i]=t);for(var e=0;e!==i;++e)t[e]=o.allocateTextureUnit();return t}function Cu(o,i){var t=this.cache;t[0]!==i&&(o.uniform1f(this.addr,i),t[0]=i)}function Mu(o,i){var t=this.cache;if(i.x!==void 0)t[0]===i.x&&t[1]===i.y||(o.uniform2f(this.addr,i.x,i.y),t[0]=i.x,t[1]=i.y);else{if(hn(t,i))return;o.uniform2fv(this.addr,i),qi(t,i)}}function Tu(o,i){var t=this.cache;if(i.x!==void 0)t[0]===i.x&&t[1]===i.y&&t[2]===i.z||(o.uniform3f(this.addr,i.x,i.y,i.z),t[0]=i.x,t[1]=i.y,t[2]=i.z);else if(i.r!==void 0)t[0]===i.r&&t[1]===i.g&&t[2]===i.b||(o.uniform3f(this.addr,i.r,i.g,i.b),t[0]=i.r,t[1]=i.g,t[2]=i.b);else{if(hn(t,i))return;o.uniform3fv(this.addr,i),qi(t,i)}}function Lu(o,i){var t=this.cache;if(i.x!==void 0)t[0]===i.x&&t[1]===i.y&&t[2]===i.z&&t[3]===i.w||(o.uniform4f(this.addr,i.x,i.y,i.z,i.w),t[0]=i.x,t[1]=i.y,t[2]=i.z,t[3]=i.w);else{if(hn(t,i))return;o.uniform4fv(this.addr,i),qi(t,i)}}function Pu(o,i){var t=this.cache,e=i.elements;if(e===void 0){if(hn(t,i))return;o.uniformMatrix2fv(this.addr,!1,i),qi(t,i)}else{if(hn(t,e))return;rh.set(e),o.uniformMatrix2fv(this.addr,!1,rh),qi(t,e)}}function Du(o,i){var t=this.cache,e=i.elements;if(e===void 0){if(hn(t,i))return;o.uniformMatrix3fv(this.addr,!1,i),qi(t,i)}else{if(hn(t,e))return;sh.set(e),o.uniformMatrix3fv(this.addr,!1,sh),qi(t,e)}}function Ru(o,i){var t=this.cache,e=i.elements;if(e===void 0){if(hn(t,i))return;o.uniformMatrix4fv(this.addr,!1,i),qi(t,i)}else{if(hn(t,e))return;nh.set(e),o.uniformMatrix4fv(this.addr,!1,nh),qi(t,e)}}function Bu(o,i,t){var e=this.cache,s=t.allocateTextureUnit();e[0]!==s&&(o.uniform1i(this.addr,s),e[0]=s),t.safeSetTexture2D(i||$l,s)}function Iu(o,i,t){var e=this.cache,s=t.allocateTextureUnit();e[0]!==s&&(o.uniform1i(this.addr,s),e[0]=s),t.setTexture2DArray(i||Eu,s)}function Ou(o,i,t){var e=this.cache,s=t.allocateTextureUnit();e[0]!==s&&(o.uniform1i(this.addr,s),e[0]=s),t.setTexture3D(i||Au,s)}function Nu(o,i,t){var e=this.cache,s=t.allocateTextureUnit();e[0]!==s&&(o.uniform1i(this.addr,s),e[0]=s),t.safeSetTextureCube(i||eh,s)}function Fu(o,i){var t=this.cache;t[0]!==i&&(o.uniform1i(this.addr,i),t[0]=i)}function zu(o,i){var t=this.cache;hn(t,i)||(o.uniform2iv(this.addr,i),qi(t,i))}function Uu(o,i){var t=this.cache;hn(t,i)||(o.uniform3iv(this.addr,i),qi(t,i))}function ku(o,i){var t=this.cache;hn(t,i)||(o.uniform4iv(this.addr,i),qi(t,i))}function ju(o,i){var t=this.cache;t[0]!==i&&(o.uniform1ui(this.addr,i),t[0]=i)}function Vu(o,i){o.uniform1fv(this.addr,i)}function Wu(o,i){o.uniform1iv(this.addr,i)}function Gu(o,i){o.uniform2iv(this.addr,i)}function Hu(o,i){o.uniform3iv(this.addr,i)}function Ku(o,i){o.uniform4iv(this.addr,i)}function Yu(o,i){var t=er(i,this.size,2);o.uniform2fv(this.addr,t)}function Xu(o,i){var t=er(i,this.size,3);o.uniform3fv(this.addr,t)}function Zu(o,i){var t=er(i,this.size,4);o.uniform4fv(this.addr,t)}function qu(o,i){var t=er(i,this.size,4);o.uniformMatrix2fv(this.addr,!1,t)}function Qu(o,i){var t=er(i,this.size,9);o.uniformMatrix3fv(this.addr,!1,t)}function Ju(o,i){var t=er(i,this.size,16);o.uniformMatrix4fv(this.addr,!1,t)}function $u(o,i,t){var e=i.length,s=ah(t,e);o.uniform1iv(this.addr,s);for(var a=0;a!==e;++a)t.safeSetTexture2D(i[a]||$l,s[a])}function ed(o,i,t){var e=i.length,s=ah(t,e);o.uniform1iv(this.addr,s);for(var a=0;a!==e;++a)t.safeSetTextureCube(i[a]||eh,s[a])}function td(o,i,t){this.id=o,this.addr=t,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Cu;case 35664:return Mu;case 35665:return Tu;case 35666:return Lu;case 35674:return Pu;case 35675:return Du;case 35676:return Ru;case 5124:case 35670:return Fu;case 35667:case 35671:return zu;case 35668:case 35672:return Uu;case 35669:case 35673:return ku;case 5125:return ju;case 35678:case 36198:case 36298:case 36306:case 35682:return Bu;case 35679:case 36299:case 36307:return Ou;case 35680:case 36300:case 36308:case 36293:return Nu;case 36289:case 36303:case 36311:case 36292:return Iu}}(i.type)}function oh(o,i,t){this.id=o,this.addr=t,this.cache=[],this.size=i.size,this.setValue=function(e){switch(e){case 5126:return Vu;case 35664:return Yu;case 35665:return Xu;case 35666:return Zu;case 35674:return qu;case 35675:return Qu;case 35676:return Ju;case 5124:case 35670:return Wu;case 35667:case 35671:return Gu;case 35668:case 35672:return Hu;case 35669:case 35673:return Ku;case 35678:case 36198:case 36298:case 36306:case 35682:return $u;case 35680:case 36300:case 36308:case 36293:return ed}}(i.type)}function lh(o){this.id=o,this.seq=[],this.map={}}oh.prototype.updateCache=function(o){var i=this.cache;o instanceof Float32Array&&i.length!==o.length&&(this.cache=new Float32Array(o.length)),qi(i,o)},lh.prototype.setValue=function(o,i,t){for(var e=this.seq,s=0,a=e.length;s!==a;++s){var c=e[s];c.setValue(o,i[c.id],t)}};var Go=/(\w+)(\])?(\[|\.)?/g;function hh(o,i){o.seq.push(i),o.map[i.id]=i}function id(o,i,t){var e=o.name,s=e.length;for(Go.lastIndex=0;;){var a=Go.exec(e),c=Go.lastIndex,m=a[1],v=a[2]==="]",b=a[3];if(v&&(m|=0),b===void 0||b==="["&&c+2===s){hh(t,b===void 0?new td(m,o,i):new oh(m,o,i));break}var E=t.map[m];E===void 0&&hh(t,E=new lh(m)),t=E}}function as(o,i){this.seq=[],this.map={};for(var t=o.getProgramParameter(i,35718),e=0;e<t;++e){var s=o.getActiveUniform(i,e);id(s,o.getUniformLocation(i,s.name),this)}}function ch(o,i,t){var e=o.createShader(i);return o.shaderSource(e,t),o.compileShader(e),e}as.prototype.setValue=function(o,i,t,e){var s=this.map[i];s!==void 0&&s.setValue(o,t,e)},as.prototype.setOptional=function(o,i,t){var e=i[t];e!==void 0&&this.setValue(o,t,e)},as.upload=function(o,i,t,e){for(var s=0,a=i.length;s!==a;++s){var c=i[s],m=t[c.id];m.needsUpdate!==!1&&c.setValue(o,m.value,e)}},as.seqWithValue=function(o,i){for(var t=[],e=0,s=o.length;e!==s;++e){var a=o[e];a.id in i&&t.push(a)}return t};var nd=0;function uh(o){switch(o){case _i:return["Linear","( value )"];case Wn:return["sRGB","( value )"];case ms:return["RGBE","( value )"];case In:return["RGBM","( value, 7.0 )"];case bt:return["RGBM","( value, 16.0 )"];case Sn:return["RGBD","( value, 256.0 )"];case Gn:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",o),["Linear","( value )"]}}function dh(o,i,t){var e=o.getShaderParameter(i,35713),s=o.getShaderInfoLog(i).trim();return e&&s===""?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+t+`
`+s+function(a){for(var c=a.split(`
`),m=0;m<c.length;m++)c[m]=m+1+": "+c[m];return c.join(`
`)}(o.getShaderSource(i))}function Pr(o,i){var t=uh(i);return"vec4 "+o+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function sd(o,i){var t;switch(i){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",i),t="Linear"}return"vec3 "+o+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Dr(o){return o!==""}function fh(o,i){return o.replace(/NUM_DIR_LIGHTS/g,i.numDirLights).replace(/NUM_SPOT_LIGHTS/g,i.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,i.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,i.numPointLights).replace(/NUM_HEMI_LIGHTS/g,i.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,i.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,i.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,i.numPointLightShadows)}function ph(o,i){return o.replace(/NUM_CLIPPING_PLANES/g,i.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,i.numClippingPlanes-i.numClipIntersection)}var rd=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ho(o){return o.replace(rd,ad)}function ad(o,i){var t=Lt[i];if(t===void 0)throw new Error("Can not resolve #include <"+i+">");return Ho(t)}var od=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ld=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function mh(o){return o.replace(ld,_h).replace(od,hd)}function hd(o,i,t,e){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),_h(o,i,t,e)}function _h(o,i,t,e){for(var s="",a=parseInt(i);a<parseInt(t);a++)s+=e.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return s}function gh(o){var i="precision "+o.precision+` float;
precision `+o.precision+" int;";return o.precision==="highp"?i+=`
#define HIGH_PRECISION`:o.precision==="mediump"?i+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(i+=`
#define LOW_PRECISION`),i}function cd(o,i,t,e){var s,a,c,m,v,b=o.getContext(),E=t.defines,S=t.vertexShader,L=t.fragmentShader,I=function(we){var ye="SHADOWMAP_TYPE_BASIC";return we.shadowMapType===1?ye="SHADOWMAP_TYPE_PCF":we.shadowMapType===2?ye="SHADOWMAP_TYPE_PCF_SOFT":we.shadowMapType===3&&(ye="SHADOWMAP_TYPE_VSM"),ye}(t),O=function(we){var ye="ENVMAP_TYPE_CUBE";if(we.envMap)switch(we.envMapMode){case _:case l:ye="ENVMAP_TYPE_CUBE";break;case h:case u:ye="ENVMAP_TYPE_CUBE_UV"}return ye}(t),U=function(we){var ye="ENVMAP_MODE_REFLECTION";if(we.envMap)switch(we.envMapMode){case l:case u:ye="ENVMAP_MODE_REFRACTION"}return ye}(t),G=function(we){var ye="ENVMAP_BLENDING_NONE";if(we.envMap)switch(we.combine){case 0:ye="ENVMAP_BLENDING_MULTIPLY";break;case 1:ye="ENVMAP_BLENDING_MIX";break;case 2:ye="ENVMAP_BLENDING_ADD"}return ye}(t),W=o.gammaFactor>0?o.gammaFactor:1,X=t.isWebGL2?"":function(we){return[we.extensionDerivatives||we.envMapCubeUV||we.bumpMap||we.tangentSpaceNormalMap||we.clearcoatNormalMap||we.flatShading||we.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(we.extensionFragDepth||we.logarithmicDepthBuffer)&&we.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",we.extensionDrawBuffers&&we.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(we.extensionShaderTextureLOD||we.envMap)&&we.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Dr).join(`
`)}(t),ie=function(we){var ye=[];for(var Te in we){var Ue=we[Te];Ue!==!1&&ye.push("#define "+Te+" "+Ue)}return ye.join(`
`)}(E),$=b.createProgram(),ee=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?((s=[ie].filter(Dr).join(`
`)).length>0&&(s+=`
`),(a=[X,ie].filter(Dr).join(`
`)).length>0&&(a+=`
`)):(s=[gh(t),"#define SHADER_NAME "+t.shaderName,ie,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+W,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+U:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+I:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Dr).join(`
`),a=[X,gh(t),"#define SHADER_NAME "+t.shaderName,ie,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+W,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+O:"",t.envMap?"#define "+U:"",t.envMap?"#define "+G:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+I:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==0?"#define TONE_MAPPING":"",t.toneMapping!==0?Lt.tonemapping_pars_fragment:"",t.toneMapping!==0?sd("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",Lt.encodings_pars_fragment,t.map?Pr("mapTexelToLinear",t.mapEncoding):"",t.matcap?Pr("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?Pr("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?Pr("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.lightMap?Pr("lightMapTexelToLinear",t.lightMapEncoding):"",(c="linearToOutputTexel",m=t.outputEncoding,v=uh(m),"vec4 "+c+"( vec4 value ) { return LinearTo"+v[0]+v[1]+"; }"),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Dr).join(`
`)),S=ph(S=fh(S=Ho(S),t),t),L=ph(L=fh(L=Ho(L),t),t),S=mh(S),L=mh(L),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(ee=`#version 300 es
`,s=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+s,a=["#define varying in",t.glslVersion===Hn?"":"out highp vec4 pc_fragColor;",t.glslVersion===Hn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+a);var he,oe,re=ee+a+L,me=ch(b,35633,ee+s+S),pe=ch(b,35632,re);if(b.attachShader($,me),b.attachShader($,pe),t.index0AttributeName!==void 0?b.bindAttribLocation($,0,t.index0AttributeName):t.morphTargets===!0&&b.bindAttribLocation($,0,"position"),b.linkProgram($),o.debug.checkShaderErrors){var xe=b.getProgramInfoLog($).trim(),Ce=b.getShaderInfoLog(me).trim(),Ie=b.getShaderInfoLog(pe).trim(),Pe=!0,de=!0;if(b.getProgramParameter($,35714)===!1){Pe=!1;var ve=dh(b,me,"vertex"),Me=dh(b,pe,"fragment");console.error("THREE.WebGLProgram: shader error: ",b.getError(),"35715",b.getProgramParameter($,35715),"gl.getProgramInfoLog",xe,ve,Me)}else xe!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",xe):Ce!==""&&Ie!==""||(de=!1);de&&(this.diagnostics={runnable:Pe,programLog:xe,vertexShader:{log:Ce,prefix:s},fragmentShader:{log:Ie,prefix:a}})}return b.deleteShader(me),b.deleteShader(pe),this.getUniforms=function(){return he===void 0&&(he=new as(b,$)),he},this.getAttributes=function(){return oe===void 0&&(oe=function(we,ye){for(var Te={},Ue=we.getProgramParameter(ye,35721),tt=0;tt<Ue;tt++){var ot=we.getActiveAttrib(ye,tt).name;Te[ot]=we.getAttribLocation(ye,ot)}return Te}(b,$)),oe},this.destroy=function(){e.releaseStatesOfProgram(this),b.deleteProgram($),this.program=void 0},this.name=t.shaderName,this.id=nd++,this.cacheKey=i,this.usedTimes=1,this.program=$,this.vertexShader=me,this.fragmentShader=pe,this}function ud(o,i,t,e,s,a){var c=[],m=e.isWebGL2,v=e.logarithmicDepthBuffer,b=e.floatVertexTextures,E=e.maxVertexUniforms,S=e.vertexTextures,L=e.precision,I={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},O=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function U(G){var W;return G&&G.isTexture?W=G.encoding:G&&G.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),W=G.texture.encoding):W=_i,W}return{getParameters:function(W,X,ie,$,ee){var he,oe,re=$.fog,me=W.isMeshStandardMaterial?$.environment:null,pe=i.get(W.envMap||me),xe=I[W.type],Ce=ee.isSkinnedMesh?function(de){var ve=de.skeleton.bones;if(b)return 1024;var Me=E,we=Math.floor((Me-20)/4),ye=Math.min(we,ve.length);return ye<ve.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+ve.length+" bones. This GPU supports "+ye+"."),0):ye}(ee):0;if(W.precision!==null&&(L=e.getMaxPrecision(W.precision))!==W.precision&&console.warn("THREE.WebGLProgram.getParameters:",W.precision,"not supported, using",L,"instead."),xe){var Ie=gn[xe];he=Ie.vertexShader,oe=Ie.fragmentShader}else he=W.vertexShader,oe=W.fragmentShader;var Pe=o.getRenderTarget();return{isWebGL2:m,shaderID:xe,shaderName:W.type,vertexShader:he,fragmentShader:oe,defines:W.defines,isRawShaderMaterial:W.isRawShaderMaterial===!0,glslVersion:W.glslVersion,precision:L,instancing:ee.isInstancedMesh===!0,instancingColor:ee.isInstancedMesh===!0&&ee.instanceColor!==null,supportsVertexTextures:S,outputEncoding:Pe!==null?U(Pe.texture):o.outputEncoding,map:!!W.map,mapEncoding:U(W.map),matcap:!!W.matcap,matcapEncoding:U(W.matcap),envMap:!!pe,envMapMode:pe&&pe.mapping,envMapEncoding:U(pe),envMapCubeUV:!!pe&&(pe.mapping===h||pe.mapping===u),lightMap:!!W.lightMap,lightMapEncoding:U(W.lightMap),aoMap:!!W.aoMap,emissiveMap:!!W.emissiveMap,emissiveMapEncoding:U(W.emissiveMap),bumpMap:!!W.bumpMap,normalMap:!!W.normalMap,objectSpaceNormalMap:W.normalMapType===1,tangentSpaceNormalMap:W.normalMapType===0,clearcoatMap:!!W.clearcoatMap,clearcoatRoughnessMap:!!W.clearcoatRoughnessMap,clearcoatNormalMap:!!W.clearcoatNormalMap,displacementMap:!!W.displacementMap,roughnessMap:!!W.roughnessMap,metalnessMap:!!W.metalnessMap,specularMap:!!W.specularMap,alphaMap:!!W.alphaMap,gradientMap:!!W.gradientMap,sheen:!!W.sheen,transmissionMap:!!W.transmissionMap,combine:W.combine,vertexTangents:W.normalMap&&W.vertexTangents,vertexColors:W.vertexColors,vertexUvs:!!(W.map||W.bumpMap||W.normalMap||W.specularMap||W.alphaMap||W.emissiveMap||W.roughnessMap||W.metalnessMap||W.clearcoatMap||W.clearcoatRoughnessMap||W.clearcoatNormalMap||W.displacementMap||W.transmissionMap),uvsVertexOnly:!(W.map||W.bumpMap||W.normalMap||W.specularMap||W.alphaMap||W.emissiveMap||W.roughnessMap||W.metalnessMap||W.clearcoatNormalMap||W.transmissionMap||!W.displacementMap),fog:!!re,useFog:W.fog,fogExp2:re&&re.isFogExp2,flatShading:!!W.flatShading,sizeAttenuation:W.sizeAttenuation,logarithmicDepthBuffer:v,skinning:W.skinning&&Ce>0,maxBones:Ce,useVertexTexture:b,morphTargets:W.morphTargets,morphNormals:W.morphNormals,maxMorphTargets:o.maxMorphTargets,maxMorphNormals:o.maxMorphNormals,numDirLights:X.directional.length,numPointLights:X.point.length,numSpotLights:X.spot.length,numRectAreaLights:X.rectArea.length,numHemiLights:X.hemi.length,numDirLightShadows:X.directionalShadowMap.length,numPointLightShadows:X.pointShadowMap.length,numSpotLightShadows:X.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:W.dithering,shadowMapEnabled:o.shadowMap.enabled&&ie.length>0,shadowMapType:o.shadowMap.type,toneMapping:W.toneMapped?o.toneMapping:0,physicallyCorrectLights:o.physicallyCorrectLights,premultipliedAlpha:W.premultipliedAlpha,alphaTest:W.alphaTest,doubleSided:W.side===2,flipSided:W.side===1,depthPacking:W.depthPacking!==void 0&&W.depthPacking,index0AttributeName:W.index0AttributeName,extensionDerivatives:W.extensions&&W.extensions.derivatives,extensionFragDepth:W.extensions&&W.extensions.fragDepth,extensionDrawBuffers:W.extensions&&W.extensions.drawBuffers,extensionShaderTextureLOD:W.extensions&&W.extensions.shaderTextureLOD,rendererExtensionFragDepth:m||t.has("EXT_frag_depth"),rendererExtensionDrawBuffers:m||t.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:m||t.has("EXT_shader_texture_lod"),customProgramCacheKey:W.customProgramCacheKey()}},getProgramCacheKey:function(W){var X=[];if(W.shaderID?X.push(W.shaderID):(X.push(W.fragmentShader),X.push(W.vertexShader)),W.defines!==void 0)for(var ie in W.defines)X.push(ie),X.push(W.defines[ie]);if(W.isRawShaderMaterial===!1){for(var $=0;$<O.length;$++)X.push(W[O[$]]);X.push(o.outputEncoding),X.push(o.gammaFactor)}return X.push(W.customProgramCacheKey),X.join()},getUniforms:function(W){var X,ie=I[W.type];if(ie){var $=gn[ie];X=Ql.clone($.uniforms)}else X=W.uniforms;return X},acquireProgram:function(W,X){for(var ie,$=0,ee=c.length;$<ee;$++){var he=c[$];if(he.cacheKey===X){++(ie=he).usedTimes;break}}return ie===void 0&&(ie=new cd(o,X,W,s),c.push(ie)),ie},releaseProgram:function(W){if(--W.usedTimes==0){var X=c.indexOf(W);c[X]=c[c.length-1],c.pop(),W.destroy()}},programs:c}}function dd(){var o=new WeakMap;return{get:function(t){var e=o.get(t);return e===void 0&&(e={},o.set(t,e)),e},remove:function(t){o.delete(t)},update:function(t,e,s){o.get(t)[e]=s},dispose:function(){o=new WeakMap}}}function fd(o,i){return o.groupOrder!==i.groupOrder?o.groupOrder-i.groupOrder:o.renderOrder!==i.renderOrder?o.renderOrder-i.renderOrder:o.program!==i.program?o.program.id-i.program.id:o.material.id!==i.material.id?o.material.id-i.material.id:o.z!==i.z?o.z-i.z:o.id-i.id}function pd(o,i){return o.groupOrder!==i.groupOrder?o.groupOrder-i.groupOrder:o.renderOrder!==i.renderOrder?o.renderOrder-i.renderOrder:o.z!==i.z?i.z-o.z:o.id-i.id}function vh(o){var i=[],t=0,e=[],s=[],a={id:-1};function c(m,v,b,E,S,L){var I=i[t],O=o.get(b);return I===void 0?(I={id:m.id,object:m,geometry:v,material:b,program:O.program||a,groupOrder:E,renderOrder:m.renderOrder,z:S,group:L},i[t]=I):(I.id=m.id,I.object=m,I.geometry=v,I.material=b,I.program=O.program||a,I.groupOrder=E,I.renderOrder=m.renderOrder,I.z=S,I.group=L),t++,I}return{opaque:e,transparent:s,init:function(){t=0,e.length=0,s.length=0},push:function(v,b,E,S,L,I){var O=c(v,b,E,S,L,I);(E.transparent===!0?s:e).push(O)},unshift:function(v,b,E,S,L,I){var O=c(v,b,E,S,L,I);(E.transparent===!0?s:e).unshift(O)},finish:function(){for(var v=t,b=i.length;v<b;v++){var E=i[v];if(E.id===null)break;E.id=null,E.object=null,E.geometry=null,E.material=null,E.program=null,E.group=null}},sort:function(v,b){e.length>1&&e.sort(v||fd),s.length>1&&s.sort(b||pd)}}}function md(o){var i=new WeakMap;return{get:function(e,s){var a;return i.has(e)===!1?(a=new vh(o),i.set(e,[a])):s>=i.get(e).length?(a=new vh(o),i.get(e).push(a)):a=i.get(e)[s],a},dispose:function(){i=new WeakMap}}}function _d(){var o={};return{get:function(t){if(o[t.id]!==void 0)return o[t.id];var e;switch(t.type){case"DirectionalLight":e={direction:new se,color:new st};break;case"SpotLight":e={position:new se,direction:new se,color:new st,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new se,color:new st,distance:0,decay:0};break;case"HemisphereLight":e={direction:new se,skyColor:new st,groundColor:new st};break;case"RectAreaLight":e={color:new st,position:new se,halfWidth:new se,halfHeight:new se}}return o[t.id]=e,e}}}var gd=0;function vd(o,i){return(i.castShadow?1:0)-(o.castShadow?1:0)}function yd(o,i){for(var t,e=new _d,s=(t={},{get:function(S){if(t[S.id]!==void 0)return t[S.id];var L;switch(S.type){case"DirectionalLight":case"SpotLight":L={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new He};break;case"PointLight":L={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new He,shadowCameraNear:1,shadowCameraFar:1e3}}return t[S.id]=L,L}}),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},c=0;c<9;c++)a.probe.push(new se);var m=new se,v=new ht,b=new ht;return{setup:function(S){for(var L=0,I=0,O=0,U=0;U<9;U++)a.probe[U].set(0,0,0);var G=0,W=0,X=0,ie=0,$=0,ee=0,he=0,oe=0;S.sort(vd);for(var re=0,me=S.length;re<me;re++){var pe=S[re],xe=pe.color,Ce=pe.intensity,Ie=pe.distance,Pe=pe.shadow&&pe.shadow.map?pe.shadow.map.texture:null;if(pe.isAmbientLight)L+=xe.r*Ce,I+=xe.g*Ce,O+=xe.b*Ce;else if(pe.isLightProbe)for(var de=0;de<9;de++)a.probe[de].addScaledVector(pe.sh.coefficients[de],Ce);else if(pe.isDirectionalLight){var ve=e.get(pe);if(ve.color.copy(pe.color).multiplyScalar(pe.intensity),pe.castShadow){var Me=pe.shadow,we=s.get(pe);we.shadowBias=Me.bias,we.shadowNormalBias=Me.normalBias,we.shadowRadius=Me.radius,we.shadowMapSize=Me.mapSize,a.directionalShadow[G]=we,a.directionalShadowMap[G]=Pe,a.directionalShadowMatrix[G]=pe.shadow.matrix,ee++}a.directional[G]=ve,G++}else if(pe.isSpotLight){var ye=e.get(pe);if(ye.position.setFromMatrixPosition(pe.matrixWorld),ye.color.copy(xe).multiplyScalar(Ce),ye.distance=Ie,ye.coneCos=Math.cos(pe.angle),ye.penumbraCos=Math.cos(pe.angle*(1-pe.penumbra)),ye.decay=pe.decay,pe.castShadow){var Te=pe.shadow,Ue=s.get(pe);Ue.shadowBias=Te.bias,Ue.shadowNormalBias=Te.normalBias,Ue.shadowRadius=Te.radius,Ue.shadowMapSize=Te.mapSize,a.spotShadow[X]=Ue,a.spotShadowMap[X]=Pe,a.spotShadowMatrix[X]=pe.shadow.matrix,oe++}a.spot[X]=ye,X++}else if(pe.isRectAreaLight){var tt=e.get(pe);tt.color.copy(xe).multiplyScalar(Ce),tt.halfWidth.set(.5*pe.width,0,0),tt.halfHeight.set(0,.5*pe.height,0),a.rectArea[ie]=tt,ie++}else if(pe.isPointLight){var ot=e.get(pe);if(ot.color.copy(pe.color).multiplyScalar(pe.intensity),ot.distance=pe.distance,ot.decay=pe.decay,pe.castShadow){var ue=pe.shadow,fe=s.get(pe);fe.shadowBias=ue.bias,fe.shadowNormalBias=ue.normalBias,fe.shadowRadius=ue.radius,fe.shadowMapSize=ue.mapSize,fe.shadowCameraNear=ue.camera.near,fe.shadowCameraFar=ue.camera.far,a.pointShadow[W]=fe,a.pointShadowMap[W]=Pe,a.pointShadowMatrix[W]=pe.shadow.matrix,he++}a.point[W]=ot,W++}else if(pe.isHemisphereLight){var Oe=e.get(pe);Oe.skyColor.copy(pe.color).multiplyScalar(Ce),Oe.groundColor.copy(pe.groundColor).multiplyScalar(Ce),a.hemi[$]=Oe,$++}}ie>0&&(i.isWebGL2||o.has("OES_texture_float_linear")===!0?(a.rectAreaLTC1=et.LTC_FLOAT_1,a.rectAreaLTC2=et.LTC_FLOAT_2):o.has("OES_texture_half_float_linear")===!0?(a.rectAreaLTC1=et.LTC_HALF_1,a.rectAreaLTC2=et.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=L,a.ambient[1]=I,a.ambient[2]=O;var De=a.hash;De.directionalLength===G&&De.pointLength===W&&De.spotLength===X&&De.rectAreaLength===ie&&De.hemiLength===$&&De.numDirectionalShadows===ee&&De.numPointShadows===he&&De.numSpotShadows===oe||(a.directional.length=G,a.spot.length=X,a.rectArea.length=ie,a.point.length=W,a.hemi.length=$,a.directionalShadow.length=ee,a.directionalShadowMap.length=ee,a.pointShadow.length=he,a.pointShadowMap.length=he,a.spotShadow.length=oe,a.spotShadowMap.length=oe,a.directionalShadowMatrix.length=ee,a.pointShadowMatrix.length=he,a.spotShadowMatrix.length=oe,De.directionalLength=G,De.pointLength=W,De.spotLength=X,De.rectAreaLength=ie,De.hemiLength=$,De.numDirectionalShadows=ee,De.numPointShadows=he,De.numSpotShadows=oe,a.version=gd++)},setupView:function(S,L){for(var I=0,O=0,U=0,G=0,W=0,X=L.matrixWorldInverse,ie=0,$=S.length;ie<$;ie++){var ee=S[ie];if(ee.isDirectionalLight){var he=a.directional[I];he.direction.setFromMatrixPosition(ee.matrixWorld),m.setFromMatrixPosition(ee.target.matrixWorld),he.direction.sub(m),he.direction.transformDirection(X),I++}else if(ee.isSpotLight){var oe=a.spot[U];oe.position.setFromMatrixPosition(ee.matrixWorld),oe.position.applyMatrix4(X),oe.direction.setFromMatrixPosition(ee.matrixWorld),m.setFromMatrixPosition(ee.target.matrixWorld),oe.direction.sub(m),oe.direction.transformDirection(X),U++}else if(ee.isRectAreaLight){var re=a.rectArea[G];re.position.setFromMatrixPosition(ee.matrixWorld),re.position.applyMatrix4(X),b.identity(),v.copy(ee.matrixWorld),v.premultiply(X),b.extractRotation(v),re.halfWidth.set(.5*ee.width,0,0),re.halfHeight.set(0,.5*ee.height,0),re.halfWidth.applyMatrix4(b),re.halfHeight.applyMatrix4(b),G++}else if(ee.isPointLight){var me=a.point[O];me.position.setFromMatrixPosition(ee.matrixWorld),me.position.applyMatrix4(X),O++}else if(ee.isHemisphereLight){var pe=a.hemi[W];pe.direction.setFromMatrixPosition(ee.matrixWorld),pe.direction.transformDirection(X),pe.direction.normalize(),W++}}},state:a}}function yh(o,i){var t=new yd(o,i),e=[],s=[];return{init:function(){e.length=0,s.length=0},state:{lightsArray:e,shadowsArray:s,lights:t},setupLights:function(){t.setup(e)},setupLightsView:function(c){t.setupView(e,c)},pushLight:function(c){e.push(c)},pushShadow:function(c){s.push(c)}}}function bd(o,i){var t=new WeakMap;return{get:function(s,a){var c;return a===void 0&&(a=0),t.has(s)===!1?(c=new yh(o,i),t.set(s,[c])):a>=t.get(s).length?(c=new yh(o,i),t.get(s).push(c)):c=t.get(s)[a],c},dispose:function(){t=new WeakMap}}}var La=function(o){function i(t){var e;return(e=o.call(this)||this).type="MeshDepthMaterial",e.depthPacking=3200,e.skinning=!1,e.morphTargets=!1,e.map=null,e.alphaMap=null,e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.wireframe=!1,e.wireframeLinewidth=1,e.fog=!1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},i}(Gt);La.prototype.isMeshDepthMaterial=!0;var Pa=function(o){function i(t){var e;return(e=o.call(this)||this).type="MeshDistanceMaterial",e.referencePosition=new se,e.nearDistance=1,e.farDistance=1e3,e.skinning=!1,e.morphTargets=!1,e.map=null,e.alphaMap=null,e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.fog=!1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},i}(Gt);Pa.prototype.isMeshDistanceMaterial=!0;function bh(o,i,t){var e=new Tr,s=new He,a=new He,c=new Ft,m=[],v=[],b={},E={0:1,1:0,2:2},S=new Ui({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new He},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),L=S.clone();L.defines.HORIZONTAL_PASS=1;var I=new ct;I.setAttribute("position",new pt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var O=new Jt(I,S),U=this;function G(ee,he){var oe=i.update(O);S.uniforms.shadow_pass.value=ee.map.texture,S.uniforms.resolution.value=ee.mapSize,S.uniforms.radius.value=ee.radius,o.setRenderTarget(ee.mapPass),o.clear(),o.renderBufferDirect(he,null,oe,S,O,null),L.uniforms.shadow_pass.value=ee.mapPass.texture,L.uniforms.resolution.value=ee.mapSize,L.uniforms.radius.value=ee.radius,o.setRenderTarget(ee.map),o.clear(),o.renderBufferDirect(he,null,oe,L,O,null)}function W(ee,he,oe){var re=ee<<0|he<<1|oe<<2,me=m[re];return me===void 0&&(me=new La({depthPacking:3201,morphTargets:ee,skinning:he}),m[re]=me),me}function X(ee,he,oe){var re=ee<<0|he<<1|oe<<2,me=v[re];return me===void 0&&(me=new Pa({morphTargets:ee,skinning:he}),v[re]=me),me}function ie(ee,he,oe,re,me,pe,xe){var Ce=null,Ie=W,Pe=ee.customDepthMaterial;if(re.isPointLight===!0&&(Ie=X,Pe=ee.customDistanceMaterial),Pe===void 0){var de=!1;oe.morphTargets===!0&&(de=he.morphAttributes&&he.morphAttributes.position&&he.morphAttributes.position.length>0);var ve=!1;ee.isSkinnedMesh===!0&&(oe.skinning===!0?ve=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",ee)),Ce=Ie(de,ve,ee.isInstancedMesh===!0)}else Ce=Pe;if(o.localClippingEnabled&&oe.clipShadows===!0&&oe.clippingPlanes.length!==0){var Me=Ce.uuid,we=oe.uuid,ye=b[Me];ye===void 0&&(ye={},b[Me]=ye);var Te=ye[we];Te===void 0&&(Te=Ce.clone(),ye[we]=Te),Ce=Te}return Ce.visible=oe.visible,Ce.wireframe=oe.wireframe,Ce.side=xe===3?oe.shadowSide!==null?oe.shadowSide:oe.side:oe.shadowSide!==null?oe.shadowSide:E[oe.side],Ce.clipShadows=oe.clipShadows,Ce.clippingPlanes=oe.clippingPlanes,Ce.clipIntersection=oe.clipIntersection,Ce.wireframeLinewidth=oe.wireframeLinewidth,Ce.linewidth=oe.linewidth,re.isPointLight===!0&&Ce.isMeshDistanceMaterial===!0&&(Ce.referencePosition.setFromMatrixPosition(re.matrixWorld),Ce.nearDistance=me,Ce.farDistance=pe),Ce}function $(ee,he,oe,re,me){if(ee.visible!==!1){if(ee.layers.test(he.layers)&&(ee.isMesh||ee.isLine||ee.isPoints)&&(ee.castShadow||ee.receiveShadow&&me===3)&&(!ee.frustumCulled||e.intersectsObject(ee))){ee.modelViewMatrix.multiplyMatrices(oe.matrixWorldInverse,ee.matrixWorld);var pe=i.update(ee),xe=ee.material;if(Array.isArray(xe))for(var Ce=pe.groups,Ie=0,Pe=Ce.length;Ie<Pe;Ie++){var de=Ce[Ie],ve=xe[de.materialIndex];if(ve&&ve.visible){var Me=ie(ee,pe,ve,re,oe.near,oe.far,me);o.renderBufferDirect(oe,null,pe,Me,ee,de)}}else if(xe.visible){var we=ie(ee,pe,xe,re,oe.near,oe.far,me);o.renderBufferDirect(oe,null,pe,we,ee,null)}}for(var ye=ee.children,Te=0,Ue=ye.length;Te<Ue;Te++)$(ye[Te],he,oe,re,me)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(ee,he,oe){if(U.enabled!==!1&&(U.autoUpdate!==!1||U.needsUpdate!==!1)&&ee.length!==0){var re=o.getRenderTarget(),me=o.getActiveCubeFace(),pe=o.getActiveMipmapLevel(),xe=o.state;xe.setBlending(0),xe.buffers.color.setClear(1,1,1,1),xe.buffers.depth.setTest(!0),xe.setScissorTest(!1);for(var Ce=0,Ie=ee.length;Ce<Ie;Ce++){var Pe=ee[Ce],de=Pe.shadow;if(de!==void 0){if(de.autoUpdate!==!1||de.needsUpdate!==!1){s.copy(de.mapSize);var ve=de.getFrameExtents();if(s.multiply(ve),a.copy(de.mapSize),(s.x>t||s.y>t)&&(s.x>t&&(a.x=Math.floor(t/ve.x),s.x=a.x*ve.x,de.mapSize.x=a.x),s.y>t&&(a.y=Math.floor(t/ve.y),s.y=a.y*ve.y,de.mapSize.y=a.y)),de.map===null&&!de.isPointLightShadow&&this.type===3){var Me={minFilter:T,magFilter:T,format:k};de.map=new tn(s.x,s.y,Me),de.map.texture.name=Pe.name+".shadowMap",de.mapPass=new tn(s.x,s.y,Me),de.camera.updateProjectionMatrix()}if(de.map===null){var we={minFilter:x,magFilter:x,format:k};de.map=new tn(s.x,s.y,we),de.map.texture.name=Pe.name+".shadowMap",de.camera.updateProjectionMatrix()}o.setRenderTarget(de.map),o.clear();for(var ye=de.getViewportCount(),Te=0;Te<ye;Te++){var Ue=de.getViewport(Te);c.set(a.x*Ue.x,a.y*Ue.y,a.x*Ue.z,a.y*Ue.w),xe.viewport(c),de.updateMatrices(Pe,Te),e=de.getFrustum(),$(he,oe,de.camera,Pe,this.type)}de.isPointLightShadow||this.type!==3||G(de,oe),de.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",Pe,"has no shadow.")}U.needsUpdate=!1,o.setRenderTarget(re,me,pe)}}}function xd(o,i,t){var e,s,a=t.isWebGL2,c=new function(){var Ae=!1,Ee=new Ft,Ze=null,qe=new Ft(0,0,0,0);return{setMask:function(Xe){Ze===Xe||Ae||(o.colorMask(Xe,Xe,Xe,Xe),Ze=Xe)},setLocked:function(Xe){Ae=Xe},setClear:function(Xe,gt,Rt,Bt,wt){wt===!0&&(Xe*=Bt,gt*=Bt,Rt*=Bt),Ee.set(Xe,gt,Rt,Bt),qe.equals(Ee)===!1&&(o.clearColor(Xe,gt,Rt,Bt),qe.copy(Ee))},reset:function(){Ae=!1,Ze=null,qe.set(-1,0,0,0)}}},m=new function(){var Ae=!1,Ee=null,Ze=null,qe=null;return{setTest:function(Xe){Xe?ye(2929):Te(2929)},setMask:function(Xe){Ee===Xe||Ae||(o.depthMask(Xe),Ee=Xe)},setFunc:function(Xe){if(Ze!==Xe){if(Xe)switch(Xe){case 0:o.depthFunc(512);break;case 1:o.depthFunc(519);break;case 2:o.depthFunc(513);break;case 3:o.depthFunc(515);break;case 4:o.depthFunc(514);break;case 5:o.depthFunc(518);break;case 6:o.depthFunc(516);break;case 7:o.depthFunc(517);break;default:o.depthFunc(515)}else o.depthFunc(515);Ze=Xe}},setLocked:function(Xe){Ae=Xe},setClear:function(Xe){qe!==Xe&&(o.clearDepth(Xe),qe=Xe)},reset:function(){Ae=!1,Ee=null,Ze=null,qe=null}}},v=new function(){var Ae=!1,Ee=null,Ze=null,qe=null,rt=null,Xe=null,gt=null,Rt=null,Bt=null;return{setTest:function(At){Ae||(At?ye(2960):Te(2960))},setMask:function(At){Ee===At||Ae||(o.stencilMask(At),Ee=At)},setFunc:function(At,Yt,kt){Ze===At&&qe===Yt&&rt===kt||(o.stencilFunc(At,Yt,kt),Ze=At,qe=Yt,rt=kt)},setOp:function(At,Yt,kt){Xe===At&&gt===Yt&&Rt===kt||(o.stencilOp(At,Yt,kt),Xe=At,gt=Yt,Rt=kt)},setLocked:function(At){Ae=At},setClear:function(At){Bt!==At&&(o.clearStencil(At),Bt=At)},reset:function(){Ae=!1,Ee=null,Ze=null,qe=null,rt=null,Xe=null,gt=null,Rt=null,Bt=null}}},b={},E=null,S=!1,L=null,I=null,O=null,U=null,G=null,W=null,X=null,ie=!1,$=null,ee=null,he=null,oe=null,re=null,me=o.getParameter(35661),pe=!1,xe=0,Ce=o.getParameter(7938);Ce.indexOf("WebGL")!==-1?(xe=parseFloat(/^WebGL (\d)/.exec(Ce)[1]),pe=xe>=1):Ce.indexOf("OpenGL ES")!==-1&&(xe=parseFloat(/^OpenGL ES (\d)/.exec(Ce)[1]),pe=xe>=2);var Ie=null,Pe={},de=new Ft,ve=new Ft;function Me(Ae,Ee,Ze){var qe=new Uint8Array(4),rt=o.createTexture();o.bindTexture(Ae,rt),o.texParameteri(Ae,10241,9728),o.texParameteri(Ae,10240,9728);for(var Xe=0;Xe<Ze;Xe++)o.texImage2D(Ee+Xe,0,6408,1,1,0,6408,5121,qe);return rt}var we={};function ye(Ae){b[Ae]!==!0&&(o.enable(Ae),b[Ae]=!0)}function Te(Ae){b[Ae]!==!1&&(o.disable(Ae),b[Ae]=!1)}we[3553]=Me(3553,3553,1),we[34067]=Me(34067,34069,6),c.setClear(0,0,0,1),m.setClear(1),v.setClear(0),ye(2929),m.setFunc(3),fe(!1),Oe(1),ye(2884),ue(0);var Ue=((e={})[100]=32774,e[101]=32778,e[102]=32779,e);if(a)Ue[103]=32775,Ue[104]=32776;else{var tt=i.get("EXT_blend_minmax");tt!==null&&(Ue[103]=tt.MIN_EXT,Ue[104]=tt.MAX_EXT)}var ot=((s={})[200]=0,s[201]=1,s[202]=768,s[204]=770,s[210]=776,s[208]=774,s[206]=772,s[203]=769,s[205]=771,s[209]=775,s[207]=773,s);function ue(Ae,Ee,Ze,qe,rt,Xe,gt,Rt){if(Ae!==0){if(S===!1&&(ye(3042),S=!0),Ae===5)rt=rt||Ee,Xe=Xe||Ze,gt=gt||qe,Ee===I&&rt===G||(o.blendEquationSeparate(Ue[Ee],Ue[rt]),I=Ee,G=rt),Ze===O&&qe===U&&Xe===W&&gt===X||(o.blendFuncSeparate(ot[Ze],ot[qe],ot[Xe],ot[gt]),O=Ze,U=qe,W=Xe,X=gt),L=Ae,ie=null;else if(Ae!==L||Rt!==ie){if(I===d&&G===d||(o.blendEquation(32774),I=d,G=d),Rt)switch(Ae){case 1:o.blendFuncSeparate(1,771,1,771);break;case 2:o.blendFunc(1,1);break;case 3:o.blendFuncSeparate(0,0,769,771);break;case 4:o.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ae)}else switch(Ae){case 1:o.blendFuncSeparate(770,771,1,771);break;case 2:o.blendFunc(770,1);break;case 3:o.blendFunc(0,769);break;case 4:o.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ae)}O=null,U=null,W=null,X=null,L=Ae,ie=Rt}}else S===!0&&(Te(3042),S=!1)}function fe(Ae){$!==Ae&&(Ae?o.frontFace(2304):o.frontFace(2305),$=Ae)}function Oe(Ae){Ae!==0?(ye(2884),Ae!==ee&&(Ae===1?o.cullFace(1029):Ae===2?o.cullFace(1028):o.cullFace(1032))):Te(2884),ee=Ae}function De(Ae,Ee,Ze){Ae?(ye(32823),oe===Ee&&re===Ze||(o.polygonOffset(Ee,Ze),oe=Ee,re=Ze)):Te(32823)}function Ve(Ae){Ae===void 0&&(Ae=33984+me-1),Ie!==Ae&&(o.activeTexture(Ae),Ie=Ae)}return{buffers:{color:c,depth:m,stencil:v},enable:ye,disable:Te,useProgram:function(Ee){return E!==Ee&&(o.useProgram(Ee),E=Ee,!0)},setBlending:ue,setMaterial:function(Ee,Ze){Ee.side===2?Te(2884):ye(2884);var qe=Ee.side===1;Ze&&(qe=!qe),fe(qe),Ee.blending===1&&Ee.transparent===!1?ue(0):ue(Ee.blending,Ee.blendEquation,Ee.blendSrc,Ee.blendDst,Ee.blendEquationAlpha,Ee.blendSrcAlpha,Ee.blendDstAlpha,Ee.premultipliedAlpha),m.setFunc(Ee.depthFunc),m.setTest(Ee.depthTest),m.setMask(Ee.depthWrite),c.setMask(Ee.colorWrite);var rt=Ee.stencilWrite;v.setTest(rt),rt&&(v.setMask(Ee.stencilWriteMask),v.setFunc(Ee.stencilFunc,Ee.stencilRef,Ee.stencilFuncMask),v.setOp(Ee.stencilFail,Ee.stencilZFail,Ee.stencilZPass)),De(Ee.polygonOffset,Ee.polygonOffsetFactor,Ee.polygonOffsetUnits)},setFlipSided:fe,setCullFace:Oe,setLineWidth:function(Ee){Ee!==he&&(pe&&o.lineWidth(Ee),he=Ee)},setPolygonOffset:De,setScissorTest:function(Ee){Ee?ye(3089):Te(3089)},activeTexture:Ve,bindTexture:function(Ee,Ze){Ie===null&&Ve();var qe=Pe[Ie];qe===void 0&&(qe={type:void 0,texture:void 0},Pe[Ie]=qe),qe.type===Ee&&qe.texture===Ze||(o.bindTexture(Ee,Ze||we[Ee]),qe.type=Ee,qe.texture=Ze)},unbindTexture:function(){var Ee=Pe[Ie];Ee!==void 0&&Ee.type!==void 0&&(o.bindTexture(Ee.type,null),Ee.type=void 0,Ee.texture=void 0)},compressedTexImage2D:function(){try{o.compressedTexImage2D.apply(o,arguments)}catch(Ee){console.error("THREE.WebGLState:",Ee)}},texImage2D:function(){try{o.texImage2D.apply(o,arguments)}catch(Ee){console.error("THREE.WebGLState:",Ee)}},texImage3D:function(){try{o.texImage3D.apply(o,arguments)}catch(Ee){console.error("THREE.WebGLState:",Ee)}},scissor:function(Ee){de.equals(Ee)===!1&&(o.scissor(Ee.x,Ee.y,Ee.z,Ee.w),de.copy(Ee))},viewport:function(Ee){ve.equals(Ee)===!1&&(o.viewport(Ee.x,Ee.y,Ee.z,Ee.w),ve.copy(Ee))},reset:function(){o.disable(3042),o.disable(2884),o.disable(2929),o.disable(32823),o.disable(3089),o.disable(2960),o.blendEquation(32774),o.blendFunc(1,0),o.blendFuncSeparate(1,0,1,0),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(513),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(519,0,4294967295),o.stencilOp(7680,7680,7680),o.clearStencil(0),o.cullFace(1029),o.frontFace(2305),o.polygonOffset(0,0),o.activeTexture(33984),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),b={},Ie=null,Pe={},E=null,S=!1,L=null,I=null,O=null,U=null,G=null,W=null,X=null,ie=!1,$=null,ee=null,he=null,oe=null,re=null,c.reset(),m.reset(),v.reset()}}}function wd(o,i,t,e,s,a,c){var m,v,b,E=s.isWebGL2,S=s.maxTextures,L=s.maxCubemapSize,I=s.maxTextureSize,O=s.maxSamples,U=new WeakMap,G=!1;try{G=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(ue){}function W(ue,fe){return G?new OffscreenCanvas(ue,fe):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function X(ue,fe,Oe,De){var Ve=1;if((ue.width>De||ue.height>De)&&(Ve=De/Math.max(ue.width,ue.height)),Ve<1||fe===!0){if(typeof HTMLImageElement<"u"&&ue instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ue instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ue instanceof ImageBitmap){var Ae=fe?dt.floorPowerOfTwo:Math.floor,Ee=Ae(Ve*ue.width),Ze=Ae(Ve*ue.height);b===void 0&&(b=W(Ee,Ze));var qe=Oe?W(Ee,Ze):b;return qe.width=Ee,qe.height=Ze,qe.getContext("2d").drawImage(ue,0,0,Ee,Ze),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ue.width+"x"+ue.height+") to ("+Ee+"x"+Ze+")."),qe}return"data"in ue&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ue.width+"x"+ue.height+")."),ue}return ue}function ie(ue){return dt.isPowerOfTwo(ue.width)&&dt.isPowerOfTwo(ue.height)}function $(ue,fe){return ue.generateMipmaps&&fe&&ue.minFilter!==x&&ue.minFilter!==T}function ee(ue,fe,Oe,De){o.generateMipmap(ue),e.get(fe).__maxMipLevel=Math.log2(Math.max(Oe,De))}function he(ue,fe,Oe){if(E===!1)return fe;if(ue!==null){if(o[ue]!==void 0)return o[ue];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ue+"'")}var De=fe;return fe===6403&&(Oe===5126&&(De=33326),Oe===5131&&(De=33325),Oe===5121&&(De=33321)),fe===6407&&(Oe===5126&&(De=34837),Oe===5131&&(De=34843),Oe===5121&&(De=32849)),fe===6408&&(Oe===5126&&(De=34836),Oe===5131&&(De=34842),Oe===5121&&(De=32856)),De!==33325&&De!==33326&&De!==34842&&De!==34836||i.get("EXT_color_buffer_float"),De}function oe(ue){return ue===x||ue===w||ue===M?9728:9729}function re(ue){var fe=ue.target;fe.removeEventListener("dispose",re),function(Oe){var De=e.get(Oe);De.__webglInit!==void 0&&(o.deleteTexture(De.__webglTexture),e.remove(Oe))}(fe),fe.isVideoTexture&&U.delete(fe),c.memory.textures--}function me(ue){var fe=ue.target;fe.removeEventListener("dispose",me),function(Oe){var De=Oe.texture,Ve=e.get(Oe),Ae=e.get(De);if(Oe){if(Ae.__webglTexture!==void 0&&o.deleteTexture(Ae.__webglTexture),Oe.depthTexture&&Oe.depthTexture.dispose(),Oe.isWebGLCubeRenderTarget)for(var Ee=0;Ee<6;Ee++)o.deleteFramebuffer(Ve.__webglFramebuffer[Ee]),Ve.__webglDepthbuffer&&o.deleteRenderbuffer(Ve.__webglDepthbuffer[Ee]);else o.deleteFramebuffer(Ve.__webglFramebuffer),Ve.__webglDepthbuffer&&o.deleteRenderbuffer(Ve.__webglDepthbuffer),Ve.__webglMultisampledFramebuffer&&o.deleteFramebuffer(Ve.__webglMultisampledFramebuffer),Ve.__webglColorRenderbuffer&&o.deleteRenderbuffer(Ve.__webglColorRenderbuffer),Ve.__webglDepthRenderbuffer&&o.deleteRenderbuffer(Ve.__webglDepthRenderbuffer);e.remove(De),e.remove(Oe)}}(fe),c.memory.textures--}var pe=0;function xe(ue,fe){var Oe=e.get(ue);if(ue.isVideoTexture&&function(Ve){var Ae=c.render.frame;U.get(Ve)!==Ae&&(U.set(Ve,Ae),Ve.update())}(ue),ue.version>0&&Oe.__version!==ue.version){var De=ue.image;if(De===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(De.complete!==!1)return void Me(Oe,ue,fe);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.activeTexture(33984+fe),t.bindTexture(3553,Oe.__webglTexture)}function Ce(ue,fe){var Oe=e.get(ue);ue.version>0&&Oe.__version!==ue.version?function(De,Ve,Ae){if(Ve.image.length===6){ve(De,Ve),t.activeTexture(33984+Ae),t.bindTexture(34067,De.__webglTexture),o.pixelStorei(37440,Ve.flipY),o.pixelStorei(37441,Ve.premultiplyAlpha),o.pixelStorei(3317,Ve.unpackAlignment),o.pixelStorei(37443,0);for(var Ee=Ve&&(Ve.isCompressedTexture||Ve.image[0].isCompressedTexture),Ze=Ve.image[0]&&Ve.image[0].isDataTexture,qe=[],rt=0;rt<6;rt++)qe[rt]=Ee||Ze?Ze?Ve.image[rt].image:Ve.image[rt]:X(Ve.image[rt],!1,!0,L);var Xe,gt=qe[0],Rt=ie(gt)||E,Bt=a.convert(Ve.format),wt=a.convert(Ve.type),At=he(Ve.internalFormat,Bt,wt);if(de(34067,Ve,Rt),Ee){for(var Yt=0;Yt<6;Yt++){Xe=qe[Yt].mipmaps;for(var kt=0;kt<Xe.length;kt++){var ei=Xe[kt];Ve.format!==k&&Ve.format!==Y?Bt!==null?t.compressedTexImage2D(34069+Yt,kt,At,ei.width,ei.height,0,ei.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+Yt,kt,At,ei.width,ei.height,0,Bt,wt,ei.data)}}De.__maxMipLevel=Xe.length-1}else{Xe=Ve.mipmaps;for(var fi=0;fi<6;fi++)if(Ze){t.texImage2D(34069+fi,0,At,qe[fi].width,qe[fi].height,0,Bt,wt,qe[fi].data);for(var Dn=0;Dn<Xe.length;Dn++){var jn=Xe[Dn].image[fi].image;t.texImage2D(34069+fi,Dn+1,At,jn.width,jn.height,0,Bt,wt,jn.data)}}else{t.texImage2D(34069+fi,0,At,Bt,wt,qe[fi]);for(var pi=0;pi<Xe.length;pi++){var ci=Xe[pi];t.texImage2D(34069+fi,pi+1,At,Bt,wt,ci.image[fi])}}De.__maxMipLevel=Xe.length}$(Ve,Rt)&&ee(34067,Ve,gt.width,gt.height),De.__version=Ve.version,Ve.onUpdate&&Ve.onUpdate(Ve)}}(Oe,ue,fe):(t.activeTexture(33984+fe),t.bindTexture(34067,Oe.__webglTexture))}var Ie=((m={})[1e3]=10497,m[1001]=33071,m[1002]=33648,m),Pe=((v={})[1003]=9728,v[1004]=9984,v[1005]=9986,v[1006]=9729,v[1007]=9985,v[1008]=9987,v);function de(ue,fe,Oe){if(Oe?(o.texParameteri(ue,10242,Ie[fe.wrapS]),o.texParameteri(ue,10243,Ie[fe.wrapT]),ue!==32879&&ue!==35866||o.texParameteri(ue,32882,Ie[fe.wrapR]),o.texParameteri(ue,10240,Pe[fe.magFilter]),o.texParameteri(ue,10241,Pe[fe.minFilter])):(o.texParameteri(ue,10242,33071),o.texParameteri(ue,10243,33071),ue!==32879&&ue!==35866||o.texParameteri(ue,32882,33071),fe.wrapS===p&&fe.wrapT===p||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),o.texParameteri(ue,10240,oe(fe.magFilter)),o.texParameteri(ue,10241,oe(fe.minFilter)),fe.minFilter!==x&&fe.minFilter!==T&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),i.has("EXT_texture_filter_anisotropic")===!0){var De=i.get("EXT_texture_filter_anisotropic");if(fe.type===P&&i.has("OES_texture_float_linear")===!1||E===!1&&fe.type===Z&&i.has("OES_texture_half_float_linear")===!1)return;(fe.anisotropy>1||e.get(fe).__currentAnisotropy)&&(o.texParameterf(ue,De.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(fe.anisotropy,s.getMaxAnisotropy())),e.get(fe).__currentAnisotropy=fe.anisotropy)}}function ve(ue,fe){ue.__webglInit===void 0&&(ue.__webglInit=!0,fe.addEventListener("dispose",re),ue.__webglTexture=o.createTexture(),c.memory.textures++)}function Me(ue,fe,Oe){var De=3553;fe.isDataTexture2DArray&&(De=35866),fe.isDataTexture3D&&(De=32879),ve(ue,fe),t.activeTexture(33984+Oe),t.bindTexture(De,ue.__webglTexture),o.pixelStorei(37440,fe.flipY),o.pixelStorei(37441,fe.premultiplyAlpha),o.pixelStorei(3317,fe.unpackAlignment),o.pixelStorei(37443,0);var Ve,Ae=function(ei){return!E&&(ei.wrapS!==p||ei.wrapT!==p||ei.minFilter!==x&&ei.minFilter!==T)}(fe)&&ie(fe.image)===!1,Ee=X(fe.image,Ae,!1,I),Ze=ie(Ee)||E,qe=a.convert(fe.format),rt=a.convert(fe.type),Xe=he(fe.internalFormat,qe,rt);de(De,fe,Ze);var gt=fe.mipmaps;if(fe.isDepthTexture)Xe=6402,E?Xe=fe.type===P?36012:fe.type===q?33190:fe.type===K?35056:33189:fe.type===P&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),fe.format===ae&&Xe===6402&&fe.type!==H&&fe.type!==q&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),fe.type=H,rt=a.convert(fe.type)),fe.format===j&&Xe===6402&&(Xe=34041,fe.type!==K&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),fe.type=K,rt=a.convert(fe.type))),t.texImage2D(3553,0,Xe,Ee.width,Ee.height,0,qe,rt,null);else if(fe.isDataTexture)if(gt.length>0&&Ze){for(var Rt=0,Bt=gt.length;Rt<Bt;Rt++)Ve=gt[Rt],t.texImage2D(3553,Rt,Xe,Ve.width,Ve.height,0,qe,rt,Ve.data);fe.generateMipmaps=!1,ue.__maxMipLevel=gt.length-1}else t.texImage2D(3553,0,Xe,Ee.width,Ee.height,0,qe,rt,Ee.data),ue.__maxMipLevel=0;else if(fe.isCompressedTexture){for(var wt=0,At=gt.length;wt<At;wt++)Ve=gt[wt],fe.format!==k&&fe.format!==Y?qe!==null?t.compressedTexImage2D(3553,wt,Xe,Ve.width,Ve.height,0,Ve.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,wt,Xe,Ve.width,Ve.height,0,qe,rt,Ve.data);ue.__maxMipLevel=gt.length-1}else if(fe.isDataTexture2DArray)t.texImage3D(35866,0,Xe,Ee.width,Ee.height,Ee.depth,0,qe,rt,Ee.data),ue.__maxMipLevel=0;else if(fe.isDataTexture3D)t.texImage3D(32879,0,Xe,Ee.width,Ee.height,Ee.depth,0,qe,rt,Ee.data),ue.__maxMipLevel=0;else if(gt.length>0&&Ze){for(var Yt=0,kt=gt.length;Yt<kt;Yt++)Ve=gt[Yt],t.texImage2D(3553,Yt,Xe,qe,rt,Ve);fe.generateMipmaps=!1,ue.__maxMipLevel=gt.length-1}else t.texImage2D(3553,0,Xe,qe,rt,Ee),ue.__maxMipLevel=0;$(fe,Ze)&&ee(De,fe,Ee.width,Ee.height),ue.__version=fe.version,fe.onUpdate&&fe.onUpdate(fe)}function we(ue,fe,Oe,De){var Ve=fe.texture,Ae=a.convert(Ve.format),Ee=a.convert(Ve.type),Ze=he(Ve.internalFormat,Ae,Ee);De===32879||De===35866?t.texImage3D(De,0,Ze,fe.width,fe.height,fe.depth,0,Ae,Ee,null):t.texImage2D(De,0,Ze,fe.width,fe.height,0,Ae,Ee,null),o.bindFramebuffer(36160,ue),o.framebufferTexture2D(36160,Oe,De,e.get(Ve).__webglTexture,0),o.bindFramebuffer(36160,null)}function ye(ue,fe,Oe){if(o.bindRenderbuffer(36161,ue),fe.depthBuffer&&!fe.stencilBuffer){var De=33189;if(Oe){var Ve=fe.depthTexture;Ve&&Ve.isDepthTexture&&(Ve.type===P?De=36012:Ve.type===q&&(De=33190));var Ae=Ue(fe);o.renderbufferStorageMultisample(36161,Ae,De,fe.width,fe.height)}else o.renderbufferStorage(36161,De,fe.width,fe.height);o.framebufferRenderbuffer(36160,36096,36161,ue)}else if(fe.depthBuffer&&fe.stencilBuffer){if(Oe){var Ee=Ue(fe);o.renderbufferStorageMultisample(36161,Ee,35056,fe.width,fe.height)}else o.renderbufferStorage(36161,34041,fe.width,fe.height);o.framebufferRenderbuffer(36160,33306,36161,ue)}else{var Ze=fe.texture,qe=a.convert(Ze.format),rt=a.convert(Ze.type),Xe=he(Ze.internalFormat,qe,rt);if(Oe){var gt=Ue(fe);o.renderbufferStorageMultisample(36161,gt,Xe,fe.width,fe.height)}else o.renderbufferStorage(36161,Xe,fe.width,fe.height)}o.bindRenderbuffer(36161,null)}function Te(ue){var fe=e.get(ue),Oe=ue.isWebGLCubeRenderTarget===!0;if(ue.depthTexture){if(Oe)throw new Error("target.depthTexture not supported in Cube render targets");(function(Ve,Ae){if(Ae&&Ae.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(o.bindFramebuffer(36160,Ve),!Ae.depthTexture||!Ae.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");e.get(Ae.depthTexture).__webglTexture&&Ae.depthTexture.image.width===Ae.width&&Ae.depthTexture.image.height===Ae.height||(Ae.depthTexture.image.width=Ae.width,Ae.depthTexture.image.height=Ae.height,Ae.depthTexture.needsUpdate=!0),xe(Ae.depthTexture,0);var Ee=e.get(Ae.depthTexture).__webglTexture;if(Ae.depthTexture.format===ae)o.framebufferTexture2D(36160,36096,3553,Ee,0);else{if(Ae.depthTexture.format!==j)throw new Error("Unknown depthTexture format");o.framebufferTexture2D(36160,33306,3553,Ee,0)}})(fe.__webglFramebuffer,ue)}else if(Oe){fe.__webglDepthbuffer=[];for(var De=0;De<6;De++)o.bindFramebuffer(36160,fe.__webglFramebuffer[De]),fe.__webglDepthbuffer[De]=o.createRenderbuffer(),ye(fe.__webglDepthbuffer[De],ue,!1)}else o.bindFramebuffer(36160,fe.__webglFramebuffer),fe.__webglDepthbuffer=o.createRenderbuffer(),ye(fe.__webglDepthbuffer,ue,!1);o.bindFramebuffer(36160,null)}function Ue(ue){return E&&ue.isWebGLMultisampleRenderTarget?Math.min(O,ue.samples):0}var tt=!1,ot=!1;this.allocateTextureUnit=function(){var ue=pe;return ue>=S&&console.warn("THREE.WebGLTextures: Trying to use "+ue+" texture units while this GPU supports only "+S),pe+=1,ue},this.resetTextureUnits=function(){pe=0},this.setTexture2D=xe,this.setTexture2DArray=function(ue,fe){var Oe=e.get(ue);ue.version>0&&Oe.__version!==ue.version?Me(Oe,ue,fe):(t.activeTexture(33984+fe),t.bindTexture(35866,Oe.__webglTexture))},this.setTexture3D=function(ue,fe){var Oe=e.get(ue);ue.version>0&&Oe.__version!==ue.version?Me(Oe,ue,fe):(t.activeTexture(33984+fe),t.bindTexture(32879,Oe.__webglTexture))},this.setTextureCube=Ce,this.setupRenderTarget=function(ue){var fe=ue.texture,Oe=e.get(ue),De=e.get(fe);ue.addEventListener("dispose",me),De.__webglTexture=o.createTexture(),c.memory.textures++;var Ve=ue.isWebGLCubeRenderTarget===!0,Ae=ue.isWebGLMultisampleRenderTarget===!0,Ee=fe.isDataTexture3D||fe.isDataTexture2DArray,Ze=ie(ue)||E;if(!E||fe.format!==Y||fe.type!==P&&fe.type!==Z||(fe.format=k,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Ve){Oe.__webglFramebuffer=[];for(var qe=0;qe<6;qe++)Oe.__webglFramebuffer[qe]=o.createFramebuffer()}else if(Oe.__webglFramebuffer=o.createFramebuffer(),Ae)if(E){Oe.__webglMultisampledFramebuffer=o.createFramebuffer(),Oe.__webglColorRenderbuffer=o.createRenderbuffer(),o.bindRenderbuffer(36161,Oe.__webglColorRenderbuffer);var rt=a.convert(fe.format),Xe=a.convert(fe.type),gt=he(fe.internalFormat,rt,Xe),Rt=Ue(ue);o.renderbufferStorageMultisample(36161,Rt,gt,ue.width,ue.height),o.bindFramebuffer(36160,Oe.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(36160,36064,36161,Oe.__webglColorRenderbuffer),o.bindRenderbuffer(36161,null),ue.depthBuffer&&(Oe.__webglDepthRenderbuffer=o.createRenderbuffer(),ye(Oe.__webglDepthRenderbuffer,ue,!0)),o.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Ve){t.bindTexture(34067,De.__webglTexture),de(34067,fe,Ze);for(var Bt=0;Bt<6;Bt++)we(Oe.__webglFramebuffer[Bt],ue,36064,34069+Bt);$(fe,Ze)&&ee(34067,fe,ue.width,ue.height),t.bindTexture(34067,null)}else{var wt=3553;Ee&&(E?wt=fe.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(wt,De.__webglTexture),de(wt,fe,Ze),we(Oe.__webglFramebuffer,ue,36064,wt),$(fe,Ze)&&ee(3553,fe,ue.width,ue.height),t.bindTexture(3553,null)}ue.depthBuffer&&Te(ue)},this.updateRenderTargetMipmap=function(ue){var fe=ue.texture;if($(fe,ie(ue)||E)){var Oe=ue.isWebGLCubeRenderTarget?34067:3553,De=e.get(fe).__webglTexture;t.bindTexture(Oe,De),ee(Oe,fe,ue.width,ue.height),t.bindTexture(Oe,null)}},this.updateMultisampleRenderTarget=function(ue){if(ue.isWebGLMultisampleRenderTarget)if(E){var fe=e.get(ue);o.bindFramebuffer(36008,fe.__webglMultisampledFramebuffer),o.bindFramebuffer(36009,fe.__webglFramebuffer);var Oe=ue.width,De=ue.height,Ve=16384;ue.depthBuffer&&(Ve|=256),ue.stencilBuffer&&(Ve|=1024),o.blitFramebuffer(0,0,Oe,De,0,0,Oe,De,Ve,9728),o.bindFramebuffer(36160,fe.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(ue,fe){ue&&ue.isWebGLRenderTarget&&(tt===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),tt=!0),ue=ue.texture),xe(ue,fe)},this.safeSetTextureCube=function(ue,fe){ue&&ue.isWebGLCubeRenderTarget&&(ot===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ot=!0),ue=ue.texture),Ce(ue,fe)}}function xh(o,i,t){var e=t.isWebGL2;return{convert:function(a){var c;if(a===z)return 5121;if(a===1017)return 32819;if(a===1018)return 32820;if(a===1019)return 33635;if(a===1010)return 5120;if(a===1011)return 5122;if(a===H)return 5123;if(a===1013)return 5124;if(a===q)return 5125;if(a===P)return 5126;if(a===Z)return e?5131:(c=i.get("OES_texture_half_float"))!==null?c.HALF_FLOAT_OES:null;if(a===1021)return 6406;if(a===Y)return 6407;if(a===k)return 6408;if(a===1024)return 6409;if(a===1025)return 6410;if(a===ae)return 6402;if(a===j)return 34041;if(a===1028)return 6403;if(a===1029)return 36244;if(a===1030)return 33319;if(a===1031)return 33320;if(a===1032)return 36248;if(a===1033)return 36249;if(a===F||a===J||a===te||a===_e){if((c=i.get("WEBGL_compressed_texture_s3tc"))===null)return null;if(a===F)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===J)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===te)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===_e)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(a===ne||a===le||a===be||a===je){if((c=i.get("WEBGL_compressed_texture_pvrtc"))===null)return null;if(a===ne)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===le)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===be)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===je)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(a===36196)return(c=i.get("WEBGL_compressed_texture_etc1"))!==null?c.COMPRESSED_RGB_ETC1_WEBGL:null;if((a===ze||a===Re)&&(c=i.get("WEBGL_compressed_texture_etc"))!==null){if(a===ze)return c.COMPRESSED_RGB8_ETC2;if(a===Re)return c.COMPRESSED_RGBA8_ETC2_EAC}return a===37808||a===37809||a===37810||a===37811||a===37812||a===37813||a===37814||a===37815||a===37816||a===37817||a===37818||a===37819||a===37820||a===37821||a===37840||a===37841||a===37842||a===37843||a===37844||a===37845||a===37846||a===37847||a===37848||a===37849||a===37850||a===37851||a===37852||a===37853?(c=i.get("WEBGL_compressed_texture_astc"))!==null?a:null:a===36492?(c=i.get("EXT_texture_compression_bptc"))!==null?a:null:a===K?e?34042:(c=i.get("WEBGL_depth_texture"))!==null?c.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Da(o){o===void 0&&(o=[]),di.call(this),this.cameras=o}Da.prototype=Object.assign(Object.create(di.prototype),{constructor:Da,isArrayCamera:!0});var Es=function(o){function i(){var t;return(t=o.call(this)||this).type="Group",t}return Ne(i,o),i}(Ke);function Rr(){this._targetRay=null,this._grip=null,this._hand=null}function wh(o,i){var t=this,e=null,s=1,a=null,c="local-floor",m=null,v=[],b=new Map,E=new di;E.layers.enable(1),E.viewport=new Ft;var S=new di;S.layers.enable(2),S.viewport=new Ft;var L=[E,S],I=new Da;I.layers.enable(1),I.layers.enable(2);var O=null,U=null;function G(re){var me=b.get(re.inputSource);me&&me.dispatchEvent({type:re.type,data:re.inputSource})}function W(){b.forEach(function(re,me){re.disconnect(me)}),b.clear(),O=null,U=null,o.setFramebuffer(null),o.setRenderTarget(o.getRenderTarget()),oe.stop(),t.isPresenting=!1,t.dispatchEvent({type:"sessionend"})}function X(re){for(var me=e.inputSources,pe=0;pe<v.length;pe++)b.set(me[pe],v[pe]);for(var xe=0;xe<re.removed.length;xe++){var Ce=re.removed[xe],Ie=b.get(Ce);Ie&&(Ie.dispatchEvent({type:"disconnected",data:Ce}),b.delete(Ce))}for(var Pe=0;Pe<re.added.length;Pe++){var de=re.added[Pe],ve=b.get(de);ve&&ve.dispatchEvent({type:"connected",data:de})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(re){var me=v[re];return me===void 0&&(me=new Rr,v[re]=me),me.getTargetRaySpace()},this.getControllerGrip=function(re){var me=v[re];return me===void 0&&(me=new Rr,v[re]=me),me.getGripSpace()},this.getHand=function(re){var me=v[re];return me===void 0&&(me=new Rr,v[re]=me),me.getHandSpace()},this.setFramebufferScaleFactor=function(re){s=re,t.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(re){c=re,t.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return e},this.setSession=function(){var re,me=(re=regeneratorRuntime.mark(function pe(xe){var Ce,Ie,Pe;return regeneratorRuntime.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if((e=xe)===null){de.next=24;break}if(e.addEventListener("select",G),e.addEventListener("selectstart",G),e.addEventListener("selectend",G),e.addEventListener("squeeze",G),e.addEventListener("squeezestart",G),e.addEventListener("squeezeend",G),e.addEventListener("end",W),e.addEventListener("inputsourceschange",X),(Ce=i.getContextAttributes()).xrCompatible===!0){de.next=14;break}return de.next=14,i.makeXRCompatible();case 14:return Ie={antialias:Ce.antialias,alpha:Ce.alpha,depth:Ce.depth,stencil:Ce.stencil,framebufferScaleFactor:s},Pe=new XRWebGLLayer(e,i,Ie),e.updateRenderState({baseLayer:Pe}),de.next=19,e.requestReferenceSpace(c);case 19:a=de.sent,oe.setContext(e),oe.start(),t.isPresenting=!0,t.dispatchEvent({type:"sessionstart"});case 24:case"end":return de.stop()}},pe)}),function(){var pe=this,xe=arguments;return new Promise(function(Ce,Ie){var Pe=re.apply(pe,xe);function de(Me){ks(Pe,Ce,Ie,de,ve,"next",Me)}function ve(Me){ks(Pe,Ce,Ie,de,ve,"throw",Me)}de(void 0)})});return function(pe){return me.apply(this,arguments)}}();var ie=new se,$=new se;function ee(re,me){me===null?re.matrixWorld.copy(re.matrix):re.matrixWorld.multiplyMatrices(me.matrixWorld,re.matrix),re.matrixWorldInverse.copy(re.matrixWorld).invert()}this.getCamera=function(re){I.near=S.near=E.near=re.near,I.far=S.far=E.far=re.far,O===I.near&&U===I.far||(e.updateRenderState({depthNear:I.near,depthFar:I.far}),O=I.near,U=I.far);var me=re.parent,pe=I.cameras;ee(I,me);for(var xe=0;xe<pe.length;xe++)ee(pe[xe],me);re.matrixWorld.copy(I.matrixWorld),re.matrix.copy(I.matrix),re.matrix.decompose(re.position,re.quaternion,re.scale);for(var Ce=re.children,Ie=0,Pe=Ce.length;Ie<Pe;Ie++)Ce[Ie].updateMatrixWorld(!0);return pe.length===2?function(de,ve,Me){ie.setFromMatrixPosition(ve.matrixWorld),$.setFromMatrixPosition(Me.matrixWorld);var we=ie.distanceTo($),ye=ve.projectionMatrix.elements,Te=Me.projectionMatrix.elements,Ue=ye[14]/(ye[10]-1),tt=ye[14]/(ye[10]+1),ot=(ye[9]+1)/ye[5],ue=(ye[9]-1)/ye[5],fe=(ye[8]-1)/ye[0],Oe=(Te[8]+1)/Te[0],De=Ue*fe,Ve=Ue*Oe,Ae=we/(-fe+Oe),Ee=Ae*-fe;ve.matrixWorld.decompose(de.position,de.quaternion,de.scale),de.translateX(Ee),de.translateZ(Ae),de.matrixWorld.compose(de.position,de.quaternion,de.scale),de.matrixWorldInverse.copy(de.matrixWorld).invert();var Ze=Ue+Ae,qe=tt+Ae,rt=De-Ee,Xe=Ve+(we-Ee),gt=ot*tt/qe*Ze,Rt=ue*tt/qe*Ze;de.projectionMatrix.makePerspective(rt,Xe,gt,Rt,Ze,qe)}(I,E,S):I.projectionMatrix.copy(E.projectionMatrix),I};var he=null,oe=new Jl;oe.setAnimationLoop(function(re,me){if((m=me.getViewerPose(a))!==null){var pe=m.views,xe=e.renderState.baseLayer;o.setFramebuffer(xe.framebuffer);var Ce=!1;pe.length!==I.cameras.length&&(I.cameras.length=0,Ce=!0);for(var Ie=0;Ie<pe.length;Ie++){var Pe=pe[Ie],de=xe.getViewport(Pe),ve=L[Ie];ve.matrix.fromArray(Pe.transform.matrix),ve.projectionMatrix.fromArray(Pe.projectionMatrix),ve.viewport.set(de.x,de.y,de.width,de.height),Ie===0&&I.matrix.copy(ve.matrix),Ce===!0&&I.cameras.push(ve)}}for(var Me=e.inputSources,we=0;we<v.length;we++){var ye=v[we],Te=Me[we];ye.update(Te,me,a)}he&&he(re,me)}),this.setAnimationLoop=function(re){he=re},this.dispose=function(){}}function Sd(o){function i(e,s){e.opacity.value=s.opacity,s.color&&e.diffuse.value.copy(s.color),s.emissive&&e.emissive.value.copy(s.emissive).multiplyScalar(s.emissiveIntensity),s.map&&(e.map.value=s.map),s.alphaMap&&(e.alphaMap.value=s.alphaMap),s.specularMap&&(e.specularMap.value=s.specularMap);var a,c,m=o.get(s).envMap;if(m){e.envMap.value=m,e.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,e.reflectivity.value=s.reflectivity,e.refractionRatio.value=s.refractionRatio;var v=o.get(m).__maxMipLevel;v!==void 0&&(e.maxMipLevel.value=v)}s.lightMap&&(e.lightMap.value=s.lightMap,e.lightMapIntensity.value=s.lightMapIntensity),s.aoMap&&(e.aoMap.value=s.aoMap,e.aoMapIntensity.value=s.aoMapIntensity),s.map?a=s.map:s.specularMap?a=s.specularMap:s.displacementMap?a=s.displacementMap:s.normalMap?a=s.normalMap:s.bumpMap?a=s.bumpMap:s.roughnessMap?a=s.roughnessMap:s.metalnessMap?a=s.metalnessMap:s.alphaMap?a=s.alphaMap:s.emissiveMap?a=s.emissiveMap:s.clearcoatMap?a=s.clearcoatMap:s.clearcoatNormalMap?a=s.clearcoatNormalMap:s.clearcoatRoughnessMap&&(a=s.clearcoatRoughnessMap),a!==void 0&&(a.isWebGLRenderTarget&&(a=a.texture),a.matrixAutoUpdate===!0&&a.updateMatrix(),e.uvTransform.value.copy(a.matrix)),s.aoMap?c=s.aoMap:s.lightMap&&(c=s.lightMap),c!==void 0&&(c.isWebGLRenderTarget&&(c=c.texture),c.matrixAutoUpdate===!0&&c.updateMatrix(),e.uv2Transform.value.copy(c.matrix))}function t(e,s){e.roughness.value=s.roughness,e.metalness.value=s.metalness,s.roughnessMap&&(e.roughnessMap.value=s.roughnessMap),s.metalnessMap&&(e.metalnessMap.value=s.metalnessMap),s.emissiveMap&&(e.emissiveMap.value=s.emissiveMap),s.bumpMap&&(e.bumpMap.value=s.bumpMap,e.bumpScale.value=s.bumpScale,s.side===1&&(e.bumpScale.value*=-1)),s.normalMap&&(e.normalMap.value=s.normalMap,e.normalScale.value.copy(s.normalScale),s.side===1&&e.normalScale.value.negate()),s.displacementMap&&(e.displacementMap.value=s.displacementMap,e.displacementScale.value=s.displacementScale,e.displacementBias.value=s.displacementBias),o.get(s).envMap&&(e.envMapIntensity.value=s.envMapIntensity)}return{refreshFogUniforms:function(s,a){s.fogColor.value.copy(a.color),a.isFog?(s.fogNear.value=a.near,s.fogFar.value=a.far):a.isFogExp2&&(s.fogDensity.value=a.density)},refreshMaterialUniforms:function(s,a,c,m){a.isMeshBasicMaterial?i(s,a):a.isMeshLambertMaterial?(i(s,a),function(v,b){b.emissiveMap&&(v.emissiveMap.value=b.emissiveMap)}(s,a)):a.isMeshToonMaterial?(i(s,a),function(v,b){b.gradientMap&&(v.gradientMap.value=b.gradientMap),b.emissiveMap&&(v.emissiveMap.value=b.emissiveMap),b.bumpMap&&(v.bumpMap.value=b.bumpMap,v.bumpScale.value=b.bumpScale,b.side===1&&(v.bumpScale.value*=-1)),b.normalMap&&(v.normalMap.value=b.normalMap,v.normalScale.value.copy(b.normalScale),b.side===1&&v.normalScale.value.negate()),b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias)}(s,a)):a.isMeshPhongMaterial?(i(s,a),function(v,b){v.specular.value.copy(b.specular),v.shininess.value=Math.max(b.shininess,1e-4),b.emissiveMap&&(v.emissiveMap.value=b.emissiveMap),b.bumpMap&&(v.bumpMap.value=b.bumpMap,v.bumpScale.value=b.bumpScale,b.side===1&&(v.bumpScale.value*=-1)),b.normalMap&&(v.normalMap.value=b.normalMap,v.normalScale.value.copy(b.normalScale),b.side===1&&v.normalScale.value.negate()),b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias)}(s,a)):a.isMeshStandardMaterial?(i(s,a),a.isMeshPhysicalMaterial?function(v,b){t(v,b),v.reflectivity.value=b.reflectivity,v.clearcoat.value=b.clearcoat,v.clearcoatRoughness.value=b.clearcoatRoughness,b.sheen&&v.sheen.value.copy(b.sheen),b.clearcoatMap&&(v.clearcoatMap.value=b.clearcoatMap),b.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap),b.clearcoatNormalMap&&(v.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),v.clearcoatNormalMap.value=b.clearcoatNormalMap,b.side===1&&v.clearcoatNormalScale.value.negate()),v.transmission.value=b.transmission,b.transmissionMap&&(v.transmissionMap.value=b.transmissionMap)}(s,a):t(s,a)):a.isMeshMatcapMaterial?(i(s,a),function(v,b){b.matcap&&(v.matcap.value=b.matcap),b.bumpMap&&(v.bumpMap.value=b.bumpMap,v.bumpScale.value=b.bumpScale,b.side===1&&(v.bumpScale.value*=-1)),b.normalMap&&(v.normalMap.value=b.normalMap,v.normalScale.value.copy(b.normalScale),b.side===1&&v.normalScale.value.negate()),b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias)}(s,a)):a.isMeshDepthMaterial?(i(s,a),function(v,b){b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias)}(s,a)):a.isMeshDistanceMaterial?(i(s,a),function(v,b){b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias),v.referencePosition.value.copy(b.referencePosition),v.nearDistance.value=b.nearDistance,v.farDistance.value=b.farDistance}(s,a)):a.isMeshNormalMaterial?(i(s,a),function(v,b){b.bumpMap&&(v.bumpMap.value=b.bumpMap,v.bumpScale.value=b.bumpScale,b.side===1&&(v.bumpScale.value*=-1)),b.normalMap&&(v.normalMap.value=b.normalMap,v.normalScale.value.copy(b.normalScale),b.side===1&&v.normalScale.value.negate()),b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias)}(s,a)):a.isLineBasicMaterial?(function(v,b){v.diffuse.value.copy(b.color),v.opacity.value=b.opacity}(s,a),a.isLineDashedMaterial&&function(v,b){v.dashSize.value=b.dashSize,v.totalSize.value=b.dashSize+b.gapSize,v.scale.value=b.scale}(s,a)):a.isPointsMaterial?function(v,b,E,S){v.diffuse.value.copy(b.color),v.opacity.value=b.opacity,v.size.value=b.size*E,v.scale.value=.5*S,b.map&&(v.map.value=b.map),b.alphaMap&&(v.alphaMap.value=b.alphaMap);var L;b.map?L=b.map:b.alphaMap&&(L=b.alphaMap),L!==void 0&&(L.matrixAutoUpdate===!0&&L.updateMatrix(),v.uvTransform.value.copy(L.matrix))}(s,a,c,m):a.isSpriteMaterial?function(v,b){v.diffuse.value.copy(b.color),v.opacity.value=b.opacity,v.rotation.value=b.rotation,b.map&&(v.map.value=b.map),b.alphaMap&&(v.alphaMap.value=b.alphaMap);var E;b.map?E=b.map:b.alphaMap&&(E=b.alphaMap),E!==void 0&&(E.matrixAutoUpdate===!0&&E.updateMatrix(),v.uvTransform.value.copy(E.matrix))}(s,a):a.isShadowMaterial?(s.color.value.copy(a.color),s.opacity.value=a.opacity):a.isShaderMaterial&&(a.uniformsNeedUpdate=!1)}}}function Kt(o){var i,t=(o=o||{}).canvas!==void 0?o.canvas:((i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).style.display="block",i),e=o.context!==void 0?o.context:null,s=o.alpha!==void 0&&o.alpha,a=o.depth===void 0||o.depth,c=o.stencil===void 0||o.stencil,m=o.antialias!==void 0&&o.antialias,v=o.premultipliedAlpha===void 0||o.premultipliedAlpha,b=o.preserveDrawingBuffer!==void 0&&o.preserveDrawingBuffer,E=o.powerPreference!==void 0?o.powerPreference:"default",S=o.failIfMajorPerformanceCaveat!==void 0&&o.failIfMajorPerformanceCaveat,L=null,I=null,O=[],U=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=_i,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var G=this,W=!1,X=null,ie=0,$=0,ee=null,he=null,oe=-1,re=null,me=new Ft,pe=new Ft,xe=null,Ce=t.width,Ie=t.height,Pe=1,de=null,ve=null,Me=new Ft(0,0,Ce,Ie),we=new Ft(0,0,Ce,Ie),ye=!1,Te=new Tr,Ue=!1,tt=!1,ot=new ht,ue=new se,fe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Oe(){return ee===null?Pe:1}var De,Ve,Ae,Ee,Ze,qe,rt,Xe,gt,Rt,Bt,wt,At,Yt,kt,ei,fi,Dn,jn,pi,ci,Ye=e;function oa(ce,We){for(var Le=0;Le<ce.length;Le++){var ke=ce[Le],Qe=t.getContext(ke,We);if(Qe!==null)return Qe}return null}try{var fr={alpha:s,depth:a,stencil:c,antialias:m,premultipliedAlpha:v,preserveDrawingBuffer:b,powerPreference:E,failIfMajorPerformanceCaveat:S};if(t.addEventListener("webglcontextlost",ca,!1),t.addEventListener("webglcontextrestored",ua,!1),Ye===null){var la=["webgl2","webgl","experimental-webgl"];if(G.isWebGL1Renderer===!0&&la.shift(),(Ye=oa(la,fr))===null)throw oa(la)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Ye.getShaderPrecisionFormat===void 0&&(Ye.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ce){throw console.error("THREE.WebGLRenderer: "+ce.message),ce}function ha(){De=new _u(Ye),Ve=new fu(Ye,De,o),De.init(Ve),pi=new xh(Ye,De,Ve),(Ae=new xd(Ye,De,Ve)).scissor(pe.copy(we).multiplyScalar(Pe).floor()),Ae.viewport(me.copy(Me).multiplyScalar(Pe).floor()),Ee=new yu(Ye),Ze=new dd,qe=new wd(Ye,De,Ae,Ze,Ve,pi,Ee),rt=new mu(G),Xe=new hu(Ye,Ve),ci=new uu(Ye,De,Xe,Ve),gt=new gu(Ye,Xe,Ee,ci),Rt=new Su(Ye,gt,Xe,Ee),fi=new wu(Ye),kt=new pu(Ze),Bt=new ud(G,rt,De,Ve,ci,kt),wt=new Sd(Ze),At=new md(Ze),Yt=new bd(De,Ve),ei=new cu(G,rt,Ae,Rt,v),Dn=new du(Ye,De,Ee,Ve),jn=new vu(Ye,De,Ee,Ve),Ee.programs=Bt.programs,G.capabilities=Ve,G.extensions=De,G.properties=Ze,G.renderLists=At,G.state=Ae,G.info=Ee}ha();var Ji=new wh(G,Ye);this.xr=Ji;var Mo=new bh(G,Rt,Ve.maxTextureSize);function ca(ce){ce.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),W=!0}function ua(){console.log("THREE.WebGLRenderer: Context Restored."),W=!1,ha()}function ps(ce){var We=ce.target;We.removeEventListener("dispose",ps),function(Le){Fs(Le),Ze.remove(Le)}(We)}function Fs(ce){var We=Ze.get(ce).program;We!==void 0&&Bt.releaseProgram(We)}this.shadowMap=Mo,this.getContext=function(){return Ye},this.getContextAttributes=function(){return Ye.getContextAttributes()},this.forceContextLoss=function(){var ce=De.get("WEBGL_lose_context");ce&&ce.loseContext()},this.forceContextRestore=function(){var ce=De.get("WEBGL_lose_context");ce&&ce.restoreContext()},this.getPixelRatio=function(){return Pe},this.setPixelRatio=function(ce){ce!==void 0&&(Pe=ce,this.setSize(Ce,Ie,!1))},this.getSize=function(ce){return ce===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),ce=new He),ce.set(Ce,Ie)},this.setSize=function(ce,We,Le){Ji.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Ce=ce,Ie=We,t.width=Math.floor(ce*Pe),t.height=Math.floor(We*Pe),Le!==!1&&(t.style.width=ce+"px",t.style.height=We+"px"),this.setViewport(0,0,ce,We))},this.getDrawingBufferSize=function(ce){return ce===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),ce=new He),ce.set(Ce*Pe,Ie*Pe).floor()},this.setDrawingBufferSize=function(ce,We,Le){Ce=ce,Ie=We,Pe=Le,t.width=Math.floor(ce*Le),t.height=Math.floor(We*Le),this.setViewport(0,0,ce,We)},this.getCurrentViewport=function(ce){return ce===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),ce=new Ft),ce.copy(me)},this.getViewport=function(ce){return ce.copy(Me)},this.setViewport=function(ce,We,Le,ke){ce.isVector4?Me.set(ce.x,ce.y,ce.z,ce.w):Me.set(ce,We,Le,ke),Ae.viewport(me.copy(Me).multiplyScalar(Pe).floor())},this.getScissor=function(ce){return ce.copy(we)},this.setScissor=function(ce,We,Le,ke){ce.isVector4?we.set(ce.x,ce.y,ce.z,ce.w):we.set(ce,We,Le,ke),Ae.scissor(pe.copy(we).multiplyScalar(Pe).floor())},this.getScissorTest=function(){return ye},this.setScissorTest=function(ce){Ae.setScissorTest(ye=ce)},this.setOpaqueSort=function(ce){de=ce},this.setTransparentSort=function(ce){ve=ce},this.getClearColor=function(ce){return ce===void 0&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),ce=new st),ce.copy(ei.getClearColor())},this.setClearColor=function(){ei.setClearColor.apply(ei,arguments)},this.getClearAlpha=function(){return ei.getClearAlpha()},this.setClearAlpha=function(){ei.setClearAlpha.apply(ei,arguments)},this.clear=function(ce,We,Le){var ke=0;(ce===void 0||ce)&&(ke|=16384),(We===void 0||We)&&(ke|=256),(Le===void 0||Le)&&(ke|=1024),Ye.clear(ke)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ca,!1),t.removeEventListener("webglcontextrestored",ua,!1),At.dispose(),Yt.dispose(),Ze.dispose(),rt.dispose(),Rt.dispose(),ci.dispose(),Ji.dispose(),wn.stop()},this.renderBufferImmediate=function(ce,We){ci.initAttributes();var Le=Ze.get(ce);ce.hasPositions&&!Le.position&&(Le.position=Ye.createBuffer()),ce.hasNormals&&!Le.normal&&(Le.normal=Ye.createBuffer()),ce.hasUvs&&!Le.uv&&(Le.uv=Ye.createBuffer()),ce.hasColors&&!Le.color&&(Le.color=Ye.createBuffer());var ke=We.getAttributes();ce.hasPositions&&(Ye.bindBuffer(34962,Le.position),Ye.bufferData(34962,ce.positionArray,35048),ci.enableAttribute(ke.position),Ye.vertexAttribPointer(ke.position,3,5126,!1,0,0)),ce.hasNormals&&(Ye.bindBuffer(34962,Le.normal),Ye.bufferData(34962,ce.normalArray,35048),ci.enableAttribute(ke.normal),Ye.vertexAttribPointer(ke.normal,3,5126,!1,0,0)),ce.hasUvs&&(Ye.bindBuffer(34962,Le.uv),Ye.bufferData(34962,ce.uvArray,35048),ci.enableAttribute(ke.uv),Ye.vertexAttribPointer(ke.uv,2,5126,!1,0,0)),ce.hasColors&&(Ye.bindBuffer(34962,Le.color),Ye.bufferData(34962,ce.colorArray,35048),ci.enableAttribute(ke.color),Ye.vertexAttribPointer(ke.color,3,5126,!1,0,0)),ci.disableUnusedAttributes(),Ye.drawArrays(4,0,ce.count),ce.count=0},this.renderBufferDirect=function(ce,We,Le,ke,Qe,St){We===null&&(We=fe);var xt=Qe.isMesh&&Qe.matrixWorld.determinant()<0,Ct=fa(ce,We,ke,Qe);Ae.setMaterial(ke,xt);var mt=Le.index,Ht=Le.attributes.position;if(mt===null){if(Ht===void 0||Ht.count===0)return}else if(mt.count===0)return;var Vt,ut=1;ke.wireframe===!0&&(mt=gt.getWireframeAttribute(Le),ut=2),(ke.morphTargets||ke.morphNormals)&&fi.update(Qe,Le,ke,Ct),ci.setup(Qe,ke,Ct,Le,mt);var Mt=Dn;mt!==null&&(Vt=Xe.get(mt),(Mt=jn).setIndex(Vt));var ii=mt!==null?mt.count:Ht.count,Pt=Le.drawRange.start*ut,Et=Le.drawRange.count*ut,It=St!==null?St.start*ut:0,yt=St!==null?St.count*ut:1/0,zt=Math.max(Pt,It),jt=Math.min(ii,Pt+Et,It+yt)-1,Dt=Math.max(0,jt-zt+1);if(Dt!==0){if(Qe.isMesh)ke.wireframe===!0?(Ae.setLineWidth(ke.wireframeLinewidth*Oe()),Mt.setMode(1)):Mt.setMode(4);else if(Qe.isLine){var ai=ke.linewidth;ai===void 0&&(ai=1),Ae.setLineWidth(ai*Oe()),Qe.isLineSegments?Mt.setMode(1):Qe.isLineLoop?Mt.setMode(2):Mt.setMode(3)}else Qe.isPoints?Mt.setMode(0):Qe.isSprite&&Mt.setMode(4);if(Qe.isInstancedMesh)Mt.renderInstances(zt,Dt,Qe.count);else if(Le.isInstancedBufferGeometry){var Xt=Math.min(Le.instanceCount,Le._maxInstanceCount);Mt.renderInstances(zt,Dt,Xt)}else Mt.render(zt,Dt)}},this.compile=function(ce,We){(I=Yt.get(ce)).init(),ce.traverseVisible(function(ke){ke.isLight&&ke.layers.test(We.layers)&&(I.pushLight(ke),ke.castShadow&&I.pushShadow(ke))}),I.setupLights();var Le=new WeakMap;ce.traverse(function(ke){var Qe=ke.material;if(Qe)if(Array.isArray(Qe))for(var St=0;St<Qe.length;St++){var xt=Qe[St];Le.has(xt)===!1&&(Bn(xt,ce,ke),Le.set(xt))}else Le.has(Qe)===!1&&(Bn(Qe,ce,ke),Le.set(Qe))})};var Rn=null,wn=new Jl;function zs(ce,We,Le,ke){if(ce.visible!==!1){if(ce.layers.test(We.layers)){if(ce.isGroup)Le=ce.renderOrder;else if(ce.isLOD)ce.autoUpdate===!0&&ce.update(We);else if(ce.isLight)I.pushLight(ce),ce.castShadow&&I.pushShadow(ce);else if(ce.isSprite){if(!ce.frustumCulled||Te.intersectsSprite(ce)){ke&&ue.setFromMatrixPosition(ce.matrixWorld).applyMatrix4(ot);var Qe=Rt.update(ce),St=ce.material;St.visible&&L.push(ce,Qe,St,Le,ue.z,null)}}else if(ce.isImmediateRenderObject)ke&&ue.setFromMatrixPosition(ce.matrixWorld).applyMatrix4(ot),L.push(ce,null,ce.material,Le,ue.z,null);else if((ce.isMesh||ce.isLine||ce.isPoints)&&(ce.isSkinnedMesh&&ce.skeleton.frame!==Ee.render.frame&&(ce.skeleton.update(),ce.skeleton.frame=Ee.render.frame),!ce.frustumCulled||Te.intersectsObject(ce))){ke&&ue.setFromMatrixPosition(ce.matrixWorld).applyMatrix4(ot);var xt=Rt.update(ce),Ct=ce.material;if(Array.isArray(Ct))for(var mt=xt.groups,Ht=0,Vt=mt.length;Ht<Vt;Ht++){var ut=mt[Ht],Mt=Ct[ut.materialIndex];Mt&&Mt.visible&&L.push(ce,xt,Mt,Le,ue.z,ut)}else Ct.visible&&L.push(ce,xt,Ct,Le,ue.z,null)}}for(var ii=ce.children,Pt=0,Et=ii.length;Pt<Et;Pt++)zs(ii[Pt],We,Le,ke)}}function pr(ce,We,Le){for(var ke=We.isScene===!0?We.overrideMaterial:null,Qe=0,St=ce.length;Qe<St;Qe++){var xt=ce[Qe],Ct=xt.object,mt=xt.geometry,Ht=ke===null?xt.material:ke,Vt=xt.group;if(Le.isArrayCamera)for(var ut=Le.cameras,Mt=0,ii=ut.length;Mt<ii;Mt++){var Pt=ut[Mt];Ct.layers.test(Pt.layers)&&(Ae.viewport(me.copy(Pt.viewport)),I.setupLightsView(Pt),da(Ct,We,Pt,mt,Ht,Vt))}else da(Ct,We,Le,mt,Ht,Vt)}}function da(ce,We,Le,ke,Qe,St){if(ce.onBeforeRender(G,We,Le,ke,Qe,St),ce.modelViewMatrix.multiplyMatrices(Le.matrixWorldInverse,ce.matrixWorld),ce.normalMatrix.getNormalMatrix(ce.modelViewMatrix),ce.isImmediateRenderObject){var xt=fa(Le,We,Qe,ce);Ae.setMaterial(Qe),ci.reset(),function(Ct,mt){Ct.render(function(Ht){G.renderBufferImmediate(Ht,mt)})}(ce,xt)}else G.renderBufferDirect(Le,We,ke,Qe,ce,St);ce.onAfterRender(G,We,Le,ke,Qe,St)}function Bn(ce,We,Le){We.isScene!==!0&&(We=fe);var ke=Ze.get(ce),Qe=I.state.lights,St=I.state.shadowsArray,xt=Qe.state.version,Ct=Bt.getParameters(ce,Qe.state,St,We,Le),mt=Bt.getProgramCacheKey(Ct),Ht=ke.program,Vt=!0;if(ke.environment=ce.isMeshStandardMaterial?We.environment:null,ke.fog=We.fog,ke.envMap=rt.get(ce.envMap||ke.environment),Ht===void 0)ce.addEventListener("dispose",ps);else if(Ht.cacheKey!==mt)Fs(ce);else if(ke.lightsStateVersion!==xt)Vt=!1;else{if(Ct.shaderID!==void 0)return;Vt=!1}Vt&&(Ct.uniforms=Bt.getUniforms(ce),ce.onBeforeCompile(Ct,G),Ht=Bt.acquireProgram(Ct,mt),ke.program=Ht,ke.uniforms=Ct.uniforms,ke.outputEncoding=Ct.outputEncoding);var ut=ke.uniforms;(ce.isShaderMaterial||ce.isRawShaderMaterial)&&ce.clipping!==!0||(ke.numClippingPlanes=kt.numPlanes,ke.numIntersection=kt.numIntersection,ut.clippingPlanes=kt.uniform),ke.needsLights=function(Pt){return Pt.isMeshLambertMaterial||Pt.isMeshToonMaterial||Pt.isMeshPhongMaterial||Pt.isMeshStandardMaterial||Pt.isShadowMaterial||Pt.isShaderMaterial&&Pt.lights===!0}(ce),ke.lightsStateVersion=xt,ke.needsLights&&(ut.ambientLightColor.value=Qe.state.ambient,ut.lightProbe.value=Qe.state.probe,ut.directionalLights.value=Qe.state.directional,ut.directionalLightShadows.value=Qe.state.directionalShadow,ut.spotLights.value=Qe.state.spot,ut.spotLightShadows.value=Qe.state.spotShadow,ut.rectAreaLights.value=Qe.state.rectArea,ut.ltc_1.value=Qe.state.rectAreaLTC1,ut.ltc_2.value=Qe.state.rectAreaLTC2,ut.pointLights.value=Qe.state.point,ut.pointLightShadows.value=Qe.state.pointShadow,ut.hemisphereLights.value=Qe.state.hemi,ut.directionalShadowMap.value=Qe.state.directionalShadowMap,ut.directionalShadowMatrix.value=Qe.state.directionalShadowMatrix,ut.spotShadowMap.value=Qe.state.spotShadowMap,ut.spotShadowMatrix.value=Qe.state.spotShadowMatrix,ut.pointShadowMap.value=Qe.state.pointShadowMap,ut.pointShadowMatrix.value=Qe.state.pointShadowMatrix);var Mt=ke.program.getUniforms(),ii=as.seqWithValue(Mt.seq,ut);ke.uniformsList=ii}function fa(ce,We,Le,ke){We.isScene!==!0&&(We=fe),qe.resetTextureUnits();var Qe=We.fog,St=Le.isMeshStandardMaterial?We.environment:null,xt=ee===null?G.outputEncoding:ee.texture.encoding,Ct=rt.get(Le.envMap||St),mt=Ze.get(Le),Ht=I.state.lights;if(Ue===!0&&(tt===!0||ce!==re)){var Vt=ce===re&&Le.id===oe;kt.setState(Le,ce,Vt)}Le.version===mt.__version?Le.fog&&mt.fog!==Qe||mt.environment!==St||mt.needsLights&&mt.lightsStateVersion!==Ht.state.version?Bn(Le,We,ke):mt.numClippingPlanes===void 0||mt.numClippingPlanes===kt.numPlanes&&mt.numIntersection===kt.numIntersection?(mt.outputEncoding!==xt||mt.envMap!==Ct)&&Bn(Le,We,ke):Bn(Le,We,ke):(Bn(Le,We,ke),mt.__version=Le.version);var ut,Mt,ii=!1,Pt=!1,Et=!1,It=mt.program,yt=It.getUniforms(),zt=mt.uniforms;if(Ae.useProgram(It.program)&&(ii=!0,Pt=!0,Et=!0),Le.id!==oe&&(oe=Le.id,Pt=!0),ii||re!==ce){if(yt.setValue(Ye,"projectionMatrix",ce.projectionMatrix),Ve.logarithmicDepthBuffer&&yt.setValue(Ye,"logDepthBufFC",2/(Math.log(ce.far+1)/Math.LN2)),re!==ce&&(re=ce,Pt=!0,Et=!0),Le.isShaderMaterial||Le.isMeshPhongMaterial||Le.isMeshToonMaterial||Le.isMeshStandardMaterial||Le.envMap){var jt=yt.map.cameraPosition;jt!==void 0&&jt.setValue(Ye,ue.setFromMatrixPosition(ce.matrixWorld))}(Le.isMeshPhongMaterial||Le.isMeshToonMaterial||Le.isMeshLambertMaterial||Le.isMeshBasicMaterial||Le.isMeshStandardMaterial||Le.isShaderMaterial)&&yt.setValue(Ye,"isOrthographic",ce.isOrthographicCamera===!0),(Le.isMeshPhongMaterial||Le.isMeshToonMaterial||Le.isMeshLambertMaterial||Le.isMeshBasicMaterial||Le.isMeshStandardMaterial||Le.isShaderMaterial||Le.isShadowMaterial||Le.skinning)&&yt.setValue(Ye,"viewMatrix",ce.matrixWorldInverse)}if(Le.skinning){yt.setOptional(Ye,ke,"bindMatrix"),yt.setOptional(Ye,ke,"bindMatrixInverse");var Dt=ke.skeleton;if(Dt){var ai=Dt.bones;if(Ve.floatVertexTextures){if(Dt.boneTexture===null){var Xt=Math.sqrt(4*ai.length);Xt=dt.ceilPowerOfTwo(Xt),Xt=Math.max(Xt,4);var mi=new Float32Array(Xt*Xt*4);mi.set(Dt.boneMatrices);var $i=new Js(mi,Xt,Xt,k,P);Dt.boneMatrices=mi,Dt.boneTexture=$i,Dt.boneTextureSize=Xt}yt.setValue(Ye,"boneTexture",Dt.boneTexture,qe),yt.setValue(Ye,"boneTextureSize",Dt.boneTextureSize)}else yt.setOptional(Ye,Dt,"boneMatrices")}}return(Pt||mt.receiveShadow!==ke.receiveShadow)&&(mt.receiveShadow=ke.receiveShadow,yt.setValue(Ye,"receiveShadow",ke.receiveShadow)),Pt&&(yt.setValue(Ye,"toneMappingExposure",G.toneMappingExposure),mt.needsLights&&(Mt=Et,(ut=zt).ambientLightColor.needsUpdate=Mt,ut.lightProbe.needsUpdate=Mt,ut.directionalLights.needsUpdate=Mt,ut.directionalLightShadows.needsUpdate=Mt,ut.pointLights.needsUpdate=Mt,ut.pointLightShadows.needsUpdate=Mt,ut.spotLights.needsUpdate=Mt,ut.spotLightShadows.needsUpdate=Mt,ut.rectAreaLights.needsUpdate=Mt,ut.hemisphereLights.needsUpdate=Mt),Qe&&Le.fog&&wt.refreshFogUniforms(zt,Qe),wt.refreshMaterialUniforms(zt,Le,Pe,Ie),as.upload(Ye,mt.uniformsList,zt,qe)),Le.isShaderMaterial&&Le.uniformsNeedUpdate===!0&&(as.upload(Ye,mt.uniformsList,zt,qe),Le.uniformsNeedUpdate=!1),Le.isSpriteMaterial&&yt.setValue(Ye,"center",ke.center),yt.setValue(Ye,"modelViewMatrix",ke.modelViewMatrix),yt.setValue(Ye,"normalMatrix",ke.normalMatrix),yt.setValue(Ye,"modelMatrix",ke.matrixWorld),It}wn.setAnimationLoop(function(ce){Ji.isPresenting||Rn&&Rn(ce)}),typeof window<"u"&&wn.setContext(window),this.setAnimationLoop=function(ce){Rn=ce,Ji.setAnimationLoop(ce),ce===null?wn.stop():wn.start()},this.render=function(ce,We){var Le,ke;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Le=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),ke=arguments[3]),We===void 0||We.isCamera===!0){if(W!==!0){ci.resetDefaultState(),oe=-1,re=null,ce.autoUpdate===!0&&ce.updateMatrixWorld(),We.parent===null&&We.updateMatrixWorld(),Ji.enabled===!0&&Ji.isPresenting===!0&&(We=Ji.getCamera(We)),ce.isScene===!0&&ce.onBeforeRender(G,ce,We,Le||ee),(I=Yt.get(ce,U.length)).init(),U.push(I),ot.multiplyMatrices(We.projectionMatrix,We.matrixWorldInverse),Te.setFromProjectionMatrix(ot),tt=this.localClippingEnabled,Ue=kt.init(this.clippingPlanes,tt,We),(L=At.get(ce,O.length)).init(),O.push(L),zs(ce,We,0,G.sortObjects),L.finish(),G.sortObjects===!0&&L.sort(de,ve),Ue===!0&&kt.beginShadows();var Qe=I.state.shadowsArray;Mo.render(Qe,ce,We),I.setupLights(),I.setupLightsView(We),Ue===!0&&kt.endShadows(),this.info.autoReset===!0&&this.info.reset(),Le!==void 0&&this.setRenderTarget(Le),ei.render(L,ce,We,ke);var St=L.opaque,xt=L.transparent;St.length>0&&pr(St,ce,We),xt.length>0&&pr(xt,ce,We),ce.isScene===!0&&ce.onAfterRender(G,ce,We),ee!==null&&(qe.updateRenderTargetMipmap(ee),qe.updateMultisampleRenderTarget(ee)),Ae.buffers.depth.setTest(!0),Ae.buffers.depth.setMask(!0),Ae.buffers.color.setMask(!0),Ae.setPolygonOffset(!1),U.pop(),I=U.length>0?U[U.length-1]:null,O.pop(),L=O.length>0?O[O.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(ce){X!==ce&&ee===null&&Ye.bindFramebuffer(36160,ce),X=ce},this.getActiveCubeFace=function(){return ie},this.getActiveMipmapLevel=function(){return $},this.getRenderTarget=function(){return ee},this.setRenderTarget=function(ce,We,Le){We===void 0&&(We=0),Le===void 0&&(Le=0),ee=ce,ie=We,$=Le,ce&&Ze.get(ce).__webglFramebuffer===void 0&&qe.setupRenderTarget(ce);var ke=X,Qe=!1,St=!1;if(ce){var xt=ce.texture;(xt.isDataTexture3D||xt.isDataTexture2DArray)&&(St=!0);var Ct=Ze.get(ce).__webglFramebuffer;ce.isWebGLCubeRenderTarget?(ke=Ct[We],Qe=!0):ke=ce.isWebGLMultisampleRenderTarget?Ze.get(ce).__webglMultisampledFramebuffer:Ct,me.copy(ce.viewport),pe.copy(ce.scissor),xe=ce.scissorTest}else me.copy(Me).multiplyScalar(Pe).floor(),pe.copy(we).multiplyScalar(Pe).floor(),xe=ye;if(he!==ke&&(Ye.bindFramebuffer(36160,ke),he=ke),Ae.viewport(me),Ae.scissor(pe),Ae.setScissorTest(xe),Qe){var mt=Ze.get(ce.texture);Ye.framebufferTexture2D(36160,36064,34069+We,mt.__webglTexture,Le)}else if(St){var Ht=Ze.get(ce.texture),Vt=We||0;Ye.framebufferTextureLayer(36160,36064,Ht.__webglTexture,Le||0,Vt)}},this.readRenderTargetPixels=function(ce,We,Le,ke,Qe,St,xt){if(ce&&ce.isWebGLRenderTarget){var Ct=Ze.get(ce).__webglFramebuffer;if(ce.isWebGLCubeRenderTarget&&xt!==void 0&&(Ct=Ct[xt]),Ct){var mt=!1;Ct!==he&&(Ye.bindFramebuffer(36160,Ct),mt=!0);try{var Ht=ce.texture,Vt=Ht.format,ut=Ht.type;if(Vt!==k&&pi.convert(Vt)!==Ye.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var Mt=ut===Z&&(De.has("EXT_color_buffer_half_float")||Ve.isWebGL2&&De.has("EXT_color_buffer_float"));if(!(ut===z||pi.convert(ut)===Ye.getParameter(35738)||ut===P&&(Ve.isWebGL2||De.has("OES_texture_float")||De.has("WEBGL_color_buffer_float"))||Mt))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ye.checkFramebufferStatus(36160)===36053?We>=0&&We<=ce.width-ke&&Le>=0&&Le<=ce.height-Qe&&Ye.readPixels(We,Le,ke,Qe,pi.convert(Vt),pi.convert(ut),St):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{mt&&Ye.bindFramebuffer(36160,he)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(ce,We,Le){Le===void 0&&(Le=0);var ke=Math.pow(2,-Le),Qe=Math.floor(We.image.width*ke),St=Math.floor(We.image.height*ke),xt=pi.convert(We.format);qe.setTexture2D(We,0),Ye.copyTexImage2D(3553,Le,xt,ce.x,ce.y,Qe,St,0),Ae.unbindTexture()},this.copyTextureToTexture=function(ce,We,Le,ke){ke===void 0&&(ke=0);var Qe=We.image.width,St=We.image.height,xt=pi.convert(Le.format),Ct=pi.convert(Le.type);qe.setTexture2D(Le,0),Ye.pixelStorei(37440,Le.flipY),Ye.pixelStorei(37441,Le.premultiplyAlpha),Ye.pixelStorei(3317,Le.unpackAlignment),We.isDataTexture?Ye.texSubImage2D(3553,ke,ce.x,ce.y,Qe,St,xt,Ct,We.image.data):We.isCompressedTexture?Ye.compressedTexSubImage2D(3553,ke,ce.x,ce.y,We.mipmaps[0].width,We.mipmaps[0].height,xt,We.mipmaps[0].data):Ye.texSubImage2D(3553,ke,ce.x,ce.y,xt,Ct,We.image),ke===0&&Le.generateMipmaps&&Ye.generateMipmap(3553),Ae.unbindTexture()},this.copyTextureToTexture3D=function(ce,We,Le,ke,Qe){if(Qe===void 0&&(Qe=0),G.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var St,xt=Le.image,Ct=xt.width,mt=xt.height,Ht=xt.data,Vt=pi.convert(ke.format),ut=pi.convert(ke.type);if(ke.isDataTexture3D)qe.setTexture3D(ke,0),St=32879;else{if(!ke.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");qe.setTexture2DArray(ke,0),St=35866}Ye.pixelStorei(37440,ke.flipY),Ye.pixelStorei(37441,ke.premultiplyAlpha),Ye.pixelStorei(3317,ke.unpackAlignment);var Mt=Ye.getParameter(3314),ii=Ye.getParameter(32878),Pt=Ye.getParameter(3316),Et=Ye.getParameter(3315),It=Ye.getParameter(32877);Ye.pixelStorei(3314,Ct),Ye.pixelStorei(32878,mt),Ye.pixelStorei(3316,ce.min.x),Ye.pixelStorei(3315,ce.min.y),Ye.pixelStorei(32877,ce.min.z),Ye.texSubImage3D(St,Qe,We.x,We.y,We.z,ce.max.x-ce.min.x+1,ce.max.y-ce.min.y+1,ce.max.z-ce.min.z+1,Vt,ut,Ht),Ye.pixelStorei(3314,Mt),Ye.pixelStorei(32878,ii),Ye.pixelStorei(3316,Pt),Ye.pixelStorei(3315,Et),Ye.pixelStorei(32877,It),Qe===0&&ke.generateMipmaps&&Ye.generateMipmap(St),Ae.unbindTexture()}},this.initTexture=function(ce){qe.setTexture2D(ce,0),Ae.unbindTexture()},this.resetState=function(){Ae.reset(),ci.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Es.prototype.isGroup=!0,Object.assign(Rr.prototype,{constructor:Rr,getHandSpace:function(){return this._hand===null&&(this._hand=new Es,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new Es,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new Es,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(i){return this._targetRay!==null&&this._targetRay.dispatchEvent(i),this._grip!==null&&this._grip.dispatchEvent(i),this._hand!==null&&this._hand.dispatchEvent(i),this},disconnect:function(i){return this.dispatchEvent({type:"disconnected",data:i}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this},update:function(i,t,e){var s=null,a=null,c=null,m=this._targetRay,v=this._grip,b=this._hand;if(i&&t.session.visibilityState!=="visible-blurred")if(b&&i.hand){c=!0;for(var E,S=mr(i.hand.values());!(E=S()).done;){var L=E.value,I=t.getJointPose(L,e);if(b.joints[L.jointName]===void 0){var O=new Es;O.matrixAutoUpdate=!1,O.visible=!1,b.joints[L.jointName]=O,b.add(O)}var U=b.joints[L.jointName];I!==null&&(U.matrix.fromArray(I.transform.matrix),U.matrix.decompose(U.position,U.rotation,U.scale),U.jointRadius=I.radius),U.visible=I!==null}var G=b.joints["index-finger-tip"],W=b.joints["thumb-tip"],X=G.position.distanceTo(W.position);b.inputState.pinching&&X>.025?(b.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!b.inputState.pinching&&X<=.015&&(b.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else m!==null&&(s=t.getPose(i.targetRaySpace,e))!==null&&(m.matrix.fromArray(s.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale)),v!==null&&i.gripSpace&&(a=t.getPose(i.gripSpace,e))!==null&&(v.matrix.fromArray(a.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale));return m!==null&&(m.visible=s!==null),v!==null&&(v.visible=a!==null),b!==null&&(b.visible=c!==null),this}}),Object.assign(wh.prototype,Si.prototype);var Sh=function(o){function i(){return o.apply(this,arguments)||this}return Ne(i,o),i}(Kt);Sh.prototype.isWebGL1Renderer=!0;var Ko=function(){function o(t,e){this.name="",this.color=new st(t),this.density=e!==void 0?e:25e-5}var i=o.prototype;return i.clone=function(){return new o(this.color,this.density)},i.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},o}();Ko.prototype.isFogExp2=!0;var Yo=function(){function o(t,e,s){this.name="",this.color=new st(t),this.near=e!==void 0?e:1,this.far=s!==void 0?s:1e3}var i=o.prototype;return i.clone=function(){return new o(this.color,this.near,this.far)},i.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},o}();Yo.prototype.isFog=!0;var Ra=function(o){function i(){var e;return(e=o.call(this)||this).type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:bi(e)})),e}Ne(i,o);var t=i.prototype;return t.copy=function(e,s){return o.prototype.copy.call(this,e,s),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},t.toJSON=function(e){var s=o.prototype.toJSON.call(this,e);return this.background!==null&&(s.object.background=this.background.toJSON(e)),this.environment!==null&&(s.object.environment=this.environment.toJSON(e)),this.fog!==null&&(s.object.fog=this.fog.toJSON()),s},i}(Ke);function ki(o,i){this.array=o,this.stride=i,this.count=o!==void 0?o.length/i:0,this.usage=un,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=dt.generateUUID()}Ra.prototype.isScene=!0,Object.defineProperty(ki.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),Object.assign(ki.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.array=new i.array.constructor(i.array),this.count=i.count,this.stride=i.stride,this.usage=i.usage,this},copyAt:function(i,t,e){i*=this.stride,e*=t.stride;for(var s=0,a=this.stride;s<a;s++)this.array[i+s]=t.array[e+s];return this},set:function(i,t){return t===void 0&&(t=0),this.array.set(i,t),this},clone:function(i){i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=dt.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new ki(new this.array.constructor(i.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(i){return this.onUploadCallback=i,this},toJSON:function(i){return i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=dt.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var As=new se;function os(o,i,t,e){this.name="",this.data=o,this.itemSize=i,this.offset=t,this.normalized=e===!0}Object.defineProperties(os.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(i){this.data.needsUpdate=i}}}),Object.assign(os.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(i){for(var t=0,e=this.data.count;t<e;t++)As.x=this.getX(t),As.y=this.getY(t),As.z=this.getZ(t),As.applyMatrix4(i),this.setXYZ(t,As.x,As.y,As.z);return this},setX:function(i,t){return this.data.array[i*this.data.stride+this.offset]=t,this},setY:function(i,t){return this.data.array[i*this.data.stride+this.offset+1]=t,this},setZ:function(i,t){return this.data.array[i*this.data.stride+this.offset+2]=t,this},setW:function(i,t){return this.data.array[i*this.data.stride+this.offset+3]=t,this},getX:function(i){return this.data.array[i*this.data.stride+this.offset]},getY:function(i){return this.data.array[i*this.data.stride+this.offset+1]},getZ:function(i){return this.data.array[i*this.data.stride+this.offset+2]},getW:function(i){return this.data.array[i*this.data.stride+this.offset+3]},setXY:function(i,t,e){return i=i*this.data.stride+this.offset,this.data.array[i+0]=t,this.data.array[i+1]=e,this},setXYZ:function(i,t,e,s){return i=i*this.data.stride+this.offset,this.data.array[i+0]=t,this.data.array[i+1]=e,this.data.array[i+2]=s,this},setXYZW:function(i,t,e,s,a){return i=i*this.data.stride+this.offset,this.data.array[i+0]=t,this.data.array[i+1]=e,this.data.array[i+2]=s,this.data.array[i+3]=a,this},clone:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var s=e*this.data.stride+this.offset,a=0;a<this.itemSize;a++)t.push(this.data.array[s+a]);return new pt(new this.array.constructor(t),this.itemSize,this.normalized)}return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.clone(i)),new os(i.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var s=e*this.data.stride+this.offset,a=0;a<this.itemSize;a++)t.push(this.data.array[s+a]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.toJSON(i)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});var tr,Ba=function(o){function i(t){var e;return(e=o.call(this)||this).type="SpriteMaterial",e.color=new st(16777215),e.map=null,e.alphaMap=null,e.rotation=0,e.sizeAttenuation=!0,e.transparent=!0,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this},i}(Gt);Ba.prototype.isSpriteMaterial=!0;var Br=new se,ir=new se,nr=new se,sr=new He,Ir=new He,Eh=new ht,Ia=new se,Or=new se,Oa=new se,Ah=new He,Xo=new He,Ch=new He,Na=function(o){function i(e){var s;if((s=o.call(this)||this).type="Sprite",tr===void 0){tr=new ct;var a=new ki(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);tr.setIndex([0,1,2,0,2,3]),tr.setAttribute("position",new os(a,3,0,!1)),tr.setAttribute("uv",new os(a,2,3,!1))}return s.geometry=tr,s.material=e!==void 0?e:new Ba,s.center=new He(.5,.5),s}Ne(i,o);var t=i.prototype;return t.raycast=function(e,s){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ir.setFromMatrixScale(this.matrixWorld),Eh.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),nr.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ir.multiplyScalar(-nr.z);var a,c,m=this.material.rotation;m!==0&&(c=Math.cos(m),a=Math.sin(m));var v=this.center;Fa(Ia.set(-.5,-.5,0),nr,v,ir,a,c),Fa(Or.set(.5,-.5,0),nr,v,ir,a,c),Fa(Oa.set(.5,.5,0),nr,v,ir,a,c),Ah.set(0,0),Xo.set(1,0),Ch.set(1,1);var b=e.ray.intersectTriangle(Ia,Or,Oa,!1,Br);if(b!==null||(Fa(Or.set(-.5,.5,0),nr,v,ir,a,c),Xo.set(0,1),(b=e.ray.intersectTriangle(Ia,Oa,Or,!1,Br))!==null)){var E=e.ray.origin.distanceTo(Br);E<e.near||E>e.far||s.push({distance:E,point:Br.clone(),uv:wi.getUV(Br,Ia,Or,Oa,Ah,Xo,Ch,new He),face:null,object:this})}},t.copy=function(e){return o.prototype.copy.call(this,e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this},i}(Ke);function Fa(o,i,t,e,s,a){sr.subVectors(o,t).addScalar(.5).multiply(e),s!==void 0?(Ir.x=a*sr.x-s*sr.y,Ir.y=s*sr.x+a*sr.y):Ir.copy(sr),o.copy(i),o.x+=Ir.x,o.y+=Ir.y,o.applyMatrix4(Eh)}Na.prototype.isSprite=!0;var za=new se,Mh=new se,Zo=function(o){function i(){var e;return(e=o.call(this)||this)._currentLevel=0,e.type="LOD",Object.defineProperties(bi(e),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),e.autoUpdate=!0,e}Ne(i,o);var t=i.prototype;return t.copy=function(e){o.prototype.copy.call(this,e,!1);for(var s=e.levels,a=0,c=s.length;a<c;a++){var m=s[a];this.addLevel(m.object.clone(),m.distance)}return this.autoUpdate=e.autoUpdate,this},t.addLevel=function(e,s){s===void 0&&(s=0),s=Math.abs(s);var a,c=this.levels;for(a=0;a<c.length&&!(s<c[a].distance);a++);return c.splice(a,0,{distance:s,object:e}),this.add(e),this},t.getCurrentLevel=function(){return this._currentLevel},t.getObjectForDistance=function(e){var s=this.levels;if(s.length>0){var a,c;for(a=1,c=s.length;a<c&&!(e<s[a].distance);a++);return s[a-1].object}return null},t.raycast=function(e,s){if(this.levels.length>0){za.setFromMatrixPosition(this.matrixWorld);var a=e.ray.origin.distanceTo(za);this.getObjectForDistance(a).raycast(e,s)}},t.update=function(e){var s=this.levels;if(s.length>1){za.setFromMatrixPosition(e.matrixWorld),Mh.setFromMatrixPosition(this.matrixWorld);var a,c,m=za.distanceTo(Mh)/e.zoom;for(s[0].object.visible=!0,a=1,c=s.length;a<c&&m>=s[a].distance;a++)s[a-1].object.visible=!1,s[a].object.visible=!0;for(this._currentLevel=a-1;a<c;a++)s[a].object.visible=!1}},t.toJSON=function(e){var s=o.prototype.toJSON.call(this,e);this.autoUpdate===!1&&(s.object.autoUpdate=!1),s.object.levels=[];for(var a=this.levels,c=0,m=a.length;c<m;c++){var v=a[c];s.object.levels.push({object:v.object.uuid,distance:v.distance})}return s},i}(Ke),Th=new se,Lh=new Ft,Ph=new Ft,Ed=new se,Dh=new ht;function Nr(o,i){Jt.call(this,o,i),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ht,this.bindMatrixInverse=new ht}function Fr(){Ke.call(this),this.type="Bone"}Nr.prototype=Object.assign(Object.create(Jt.prototype),{constructor:Nr,isSkinnedMesh:!0,copy:function(i){return Jt.prototype.copy.call(this,i),this.bindMode=i.bindMode,this.bindMatrix.copy(i.bindMatrix),this.bindMatrixInverse.copy(i.bindMatrixInverse),this.skeleton=i.skeleton,this},bind:function(i,t){this.skeleton=i,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var i=new Ft,t=this.geometry.attributes.skinWeight,e=0,s=t.count;e<s;e++){i.x=t.getX(e),i.y=t.getY(e),i.z=t.getZ(e),i.w=t.getW(e);var a=1/i.manhattanLength();a!==1/0?i.multiplyScalar(a):i.set(1,0,0,0),t.setXYZW(e,i.x,i.y,i.z,i.w)}},updateMatrixWorld:function(i){Jt.prototype.updateMatrixWorld.call(this,i),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(i,t){var e=this.skeleton,s=this.geometry;Lh.fromBufferAttribute(s.attributes.skinIndex,i),Ph.fromBufferAttribute(s.attributes.skinWeight,i),Th.fromBufferAttribute(s.attributes.position,i).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var a=0;a<4;a++){var c=Ph.getComponent(a);if(c!==0){var m=Lh.getComponent(a);Dh.multiplyMatrices(e.bones[m].matrixWorld,e.boneInverses[m]),t.addScaledVector(Ed.copy(Th).applyMatrix4(Dh),c)}}return t.applyMatrix4(this.bindMatrixInverse)}}),Fr.prototype=Object.assign(Object.create(Ke.prototype),{constructor:Fr,isBone:!0});var Rh=new ht,Ad=new ht,qo=function(){function o(t,e){t===void 0&&(t=[]),e===void 0&&(e=[]),this.uuid=dt.generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}var i=o.prototype;return i.init=function(){var t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var s=0,a=this.bones.length;s<a;s++)this.boneInverses.push(new ht)}},i.calculateInverses=function(){this.boneInverses.length=0;for(var t=0,e=this.bones.length;t<e;t++){var s=new ht;this.bones[t]&&s.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(s)}},i.pose=function(){for(var t=0,e=this.bones.length;t<e;t++){var s=this.bones[t];s&&s.matrixWorld.copy(this.boneInverses[t]).invert()}for(var a=0,c=this.bones.length;a<c;a++){var m=this.bones[a];m&&(m.parent&&m.parent.isBone?(m.matrix.copy(m.parent.matrixWorld).invert(),m.matrix.multiply(m.matrixWorld)):m.matrix.copy(m.matrixWorld),m.matrix.decompose(m.position,m.quaternion,m.scale))}},i.update=function(){for(var t=this.bones,e=this.boneInverses,s=this.boneMatrices,a=this.boneTexture,c=0,m=t.length;c<m;c++){var v=t[c]?t[c].matrixWorld:Ad;Rh.multiplyMatrices(v,e[c]),Rh.toArray(s,16*c)}a!==null&&(a.needsUpdate=!0)},i.clone=function(){return new o(this.bones,this.boneInverses)},i.getBoneByName=function(t){for(var e=0,s=this.bones.length;e<s;e++){var a=this.bones[e];if(a.name===t)return a}},i.dispose=function(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)},i.fromJSON=function(t,e){this.uuid=t.uuid;for(var s=0,a=t.bones.length;s<a;s++){var c=t.bones[s],m=e[c];m===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",c),m=new Fr),this.bones.push(m),this.boneInverses.push(new ht().fromArray(t.boneInverses[s]))}return this.init(),this},i.toJSON=function(){var t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;for(var e=this.bones,s=this.boneInverses,a=0,c=e.length;a<c;a++){var m=e[a];t.bones.push(m.uuid);var v=s[a];t.boneInverses.push(v.toArray())}return t},o}(),Bh=new ht,Ih=new ht,Ua=[],zr=new Jt;function ka(o,i,t){Jt.call(this,o,i),this.instanceMatrix=new pt(new Float32Array(16*t),16),this.instanceColor=null,this.count=t,this.frustumCulled=!1}ka.prototype=Object.assign(Object.create(Jt.prototype),{constructor:ka,isInstancedMesh:!0,copy:function(i){return Jt.prototype.copy.call(this,i),this.instanceMatrix.copy(i.instanceMatrix),i.instanceColor!==null&&(this.instanceColor=i.instanceColor.clone()),this.count=i.count,this},getColorAt:function(i,t){t.fromArray(this.instanceColor.array,3*i)},getMatrixAt:function(i,t){t.fromArray(this.instanceMatrix.array,16*i)},raycast:function(i,t){var e=this.matrixWorld,s=this.count;if(zr.geometry=this.geometry,zr.material=this.material,zr.material!==void 0)for(var a=0;a<s;a++){this.getMatrixAt(a,Bh),Ih.multiplyMatrices(e,Bh),zr.matrixWorld=Ih,zr.raycast(i,Ua);for(var c=0,m=Ua.length;c<m;c++){var v=Ua[c];v.instanceId=a,v.object=this,t.push(v)}Ua.length=0}},setColorAt:function(i,t){this.instanceColor===null&&(this.instanceColor=new pt(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*i)},setMatrixAt:function(i,t){t.toArray(this.instanceMatrix.array,16*i)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});var yi=function(o){function i(t){var e;return(e=o.call(this)||this).type="LineBasicMaterial",e.color=new st(16777215),e.linewidth=1,e.linecap="round",e.linejoin="round",e.morphTargets=!1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this},i}(Gt);yi.prototype.isLineBasicMaterial=!0;var Oh=new se,Nh=new se,Fh=new ht,Qo=new rn,ja=new mn;function vn(o,i){o===void 0&&(o=new ct),i===void 0&&(i=new yi),Ke.call(this),this.type="Line",this.geometry=o,this.material=i,this.updateMorphTargets()}vn.prototype=Object.assign(Object.create(Ke.prototype),{constructor:vn,isLine:!0,copy:function(i){return Ke.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},computeLineDistances:function(){var i=this.geometry;if(i.isBufferGeometry)if(i.index===null){for(var t=i.attributes.position,e=[0],s=1,a=t.count;s<a;s++)Oh.fromBufferAttribute(t,s-1),Nh.fromBufferAttribute(t,s),e[s]=e[s-1],e[s]+=Oh.distanceTo(Nh);i.setAttribute("lineDistance",new at(e,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(i,t){var e=this.geometry,s=this.matrixWorld,a=i.params.Line.threshold;if(e.boundingSphere===null&&e.computeBoundingSphere(),ja.copy(e.boundingSphere),ja.applyMatrix4(s),ja.radius+=a,i.ray.intersectsSphere(ja)!==!1){Fh.copy(s).invert(),Qo.copy(i.ray).applyMatrix4(Fh);var c=a/((this.scale.x+this.scale.y+this.scale.z)/3),m=c*c,v=new se,b=new se,E=new se,S=new se,L=this.isLineSegments?2:1;if(e.isBufferGeometry){var I=e.index,O=e.attributes.position;if(I!==null)for(var U=I.array,G=0,W=U.length-1;G<W;G+=L){var X=U[G],ie=U[G+1];if(v.fromBufferAttribute(O,X),b.fromBufferAttribute(O,ie),!(Qo.distanceSqToSegment(v,b,S,E)>m)){S.applyMatrix4(this.matrixWorld);var $=i.ray.origin.distanceTo(S);$<i.near||$>i.far||t.push({distance:$,point:E.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}else for(var ee=0,he=O.count-1;ee<he;ee+=L)if(v.fromBufferAttribute(O,ee),b.fromBufferAttribute(O,ee+1),!(Qo.distanceSqToSegment(v,b,S,E)>m)){S.applyMatrix4(this.matrixWorld);var oe=i.ray.origin.distanceTo(S);oe<i.near||oe>i.far||t.push({distance:oe,point:E.clone().applyMatrix4(this.matrixWorld),index:ee,face:null,faceIndex:null,object:this})}}else e.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var i=this.geometry;if(i.isBufferGeometry){var t=i.morphAttributes,e=Object.keys(t);if(e.length>0){var s=t[e[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,c=s.length;a<c;a++){var m=s[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[m]=a}}}}else{var v=i.morphTargets;v!==void 0&&v.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var zh=new se,Uh=new se;function Ii(o,i){vn.call(this,o,i),this.type="LineSegments"}Ii.prototype=Object.assign(Object.create(vn.prototype),{constructor:Ii,isLineSegments:!0,computeLineDistances:function(){var i=this.geometry;if(i.isBufferGeometry)if(i.index===null){for(var t=i.attributes.position,e=[],s=0,a=t.count;s<a;s+=2)zh.fromBufferAttribute(t,s),Uh.fromBufferAttribute(t,s+1),e[s]=s===0?0:e[s-1],e[s+1]=e[s]+zh.distanceTo(Uh);i.setAttribute("lineDistance",new at(e,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}});var Jo=function(o){function i(t,e){var s;return(s=o.call(this,t,e)||this).type="LineLoop",s}return Ne(i,o),i}(vn);Jo.prototype.isLineLoop=!0;var Cs=function(o){function i(t){var e;return(e=o.call(this)||this).type="PointsMaterial",e.color=new st(16777215),e.map=null,e.alphaMap=null,e.size=1,e.sizeAttenuation=!0,e.morphTargets=!1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this},i}(Gt);Cs.prototype.isPointsMaterial=!0;var kh=new ht,$o=new rn,Va=new mn,Wa=new se;function rr(o,i){o===void 0&&(o=new ct),i===void 0&&(i=new Cs),Ke.call(this),this.type="Points",this.geometry=o,this.material=i,this.updateMorphTargets()}function jh(o,i,t,e,s,a,c){var m=$o.distanceSqToPoint(o);if(m<t){var v=new se;$o.closestPointToPoint(o,v),v.applyMatrix4(e);var b=s.ray.origin.distanceTo(v);if(b<s.near||b>s.far)return;a.push({distance:b,distanceToRay:Math.sqrt(m),point:v,index:i,face:null,object:c})}}rr.prototype=Object.assign(Object.create(Ke.prototype),{constructor:rr,isPoints:!0,copy:function(i){return Ke.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},raycast:function(i,t){var e=this.geometry,s=this.matrixWorld,a=i.params.Points.threshold;if(e.boundingSphere===null&&e.computeBoundingSphere(),Va.copy(e.boundingSphere),Va.applyMatrix4(s),Va.radius+=a,i.ray.intersectsSphere(Va)!==!1){kh.copy(s).invert(),$o.copy(i.ray).applyMatrix4(kh);var c=a/((this.scale.x+this.scale.y+this.scale.z)/3),m=c*c;if(e.isBufferGeometry){var v=e.index,b=e.attributes.position;if(v!==null)for(var E=v.array,S=0,L=E.length;S<L;S++){var I=E[S];Wa.fromBufferAttribute(b,I),jh(Wa,I,m,s,i,t,this)}else for(var O=0,U=b.count;O<U;O++)Wa.fromBufferAttribute(b,O),jh(Wa,O,m,s,i,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var i=this.geometry;if(i.isBufferGeometry){var t=i.morphAttributes,e=Object.keys(t);if(e.length>0){var s=t[e[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,c=s.length;a<c;a++){var m=s[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[m]=a}}}}else{var v=i.morphTargets;v!==void 0&&v.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var Vh=function(o){function i(e,s,a,c,m,v,b,E,S){var L;(L=o.call(this,e,s,a,c,m,v,b,E,S)||this).format=b!==void 0?b:Y,L.minFilter=v!==void 0?v:T,L.magFilter=m!==void 0?m:T,L.generateMipmaps=!1;var I=bi(L);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function O(){I.needsUpdate=!0,e.requestVideoFrameCallback(O)}),L}Ne(i,o);var t=i.prototype;return t.clone=function(){return new this.constructor(this.image).copy(this)},t.update=function(){var e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)},i}(ui);Vh.prototype.isVideoTexture=!0;var el=function(o){function i(t,e,s,a,c,m,v,b,E,S,L,I){var O;return(O=o.call(this,null,m,v,b,E,S,a,c,L,I)||this).image={width:e,height:s},O.mipmaps=t,O.flipY=!1,O.generateMipmaps=!1,O}return Ne(i,o),i}(ui);el.prototype.isCompressedTexture=!0;var Wh=function(o){function i(t,e,s,a,c,m,v,b,E){var S;return(S=o.call(this,t,e,s,a,c,m,v,b,E)||this).needsUpdate=!0,S}return Ne(i,o),i}(ui);Wh.prototype.isCanvasTexture=!0;var Gh=function(o){function i(t,e,s,a,c,m,v,b,E,S){var L;if((S=S!==void 0?S:ae)!==ae&&S!==j)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return s===void 0&&S===ae&&(s=H),s===void 0&&S===j&&(s=K),(L=o.call(this,null,a,c,m,v,b,S,s,E)||this).image={width:t,height:e},L.magFilter=v!==void 0?v:x,L.minFilter=b!==void 0?b:x,L.flipY=!1,L.generateMipmaps=!1,L}return Ne(i,o),i}(ui);Gh.prototype.isDepthTexture=!0;var Ga=function(o){function i(t,e,s,a){var c;t===void 0&&(t=1),e===void 0&&(e=8),s===void 0&&(s=0),a===void 0&&(a=2*Math.PI),(c=o.call(this)||this).type="CircleGeometry",c.parameters={radius:t,segments:e,thetaStart:s,thetaLength:a},e=Math.max(3,e);var m=[],v=[],b=[],E=[],S=new se,L=new He;v.push(0,0,0),b.push(0,0,1),E.push(.5,.5);for(var I=0,O=3;I<=e;I++,O+=3){var U=s+I/e*a;S.x=t*Math.cos(U),S.y=t*Math.sin(U),v.push(S.x,S.y,S.z),b.push(0,0,1),L.x=(v[O]/t+1)/2,L.y=(v[O+1]/t+1)/2,E.push(L.x,L.y)}for(var G=1;G<=e;G++)m.push(G,G+1,0);return c.setIndex(m),c.setAttribute("position",new at(v,3)),c.setAttribute("normal",new at(b,3)),c.setAttribute("uv",new at(E,2)),c}return Ne(i,o),i}(ct),ar=function(o){function i(t,e,s,a,c,m,v,b){var E;t===void 0&&(t=1),e===void 0&&(e=1),s===void 0&&(s=1),a===void 0&&(a=8),c===void 0&&(c=1),m===void 0&&(m=!1),v===void 0&&(v=0),b===void 0&&(b=2*Math.PI),(E=o.call(this)||this).type="CylinderGeometry",E.parameters={radiusTop:t,radiusBottom:e,height:s,radialSegments:a,heightSegments:c,openEnded:m,thetaStart:v,thetaLength:b};var S=bi(E);a=Math.floor(a),c=Math.floor(c);var L=[],I=[],O=[],U=[],G=0,W=[],X=s/2,ie=0;function $(ee){for(var he=G,oe=new He,re=new se,me=0,pe=ee===!0?t:e,xe=ee===!0?1:-1,Ce=1;Ce<=a;Ce++)I.push(0,X*xe,0),O.push(0,xe,0),U.push(.5,.5),G++;for(var Ie=G,Pe=0;Pe<=a;Pe++){var de=Pe/a*b+v,ve=Math.cos(de),Me=Math.sin(de);re.x=pe*Me,re.y=X*xe,re.z=pe*ve,I.push(re.x,re.y,re.z),O.push(0,xe,0),oe.x=.5*ve+.5,oe.y=.5*Me*xe+.5,U.push(oe.x,oe.y),G++}for(var we=0;we<a;we++){var ye=he+we,Te=Ie+we;ee===!0?L.push(Te,Te+1,ye):L.push(Te+1,Te,ye),me+=3}S.addGroup(ie,me,ee===!0?1:2),ie+=me}return function(){for(var ee=new se,he=new se,oe=0,re=(e-t)/s,me=0;me<=c;me++){for(var pe=[],xe=me/c,Ce=xe*(e-t)+t,Ie=0;Ie<=a;Ie++){var Pe=Ie/a,de=Pe*b+v,ve=Math.sin(de),Me=Math.cos(de);he.x=Ce*ve,he.y=-xe*s+X,he.z=Ce*Me,I.push(he.x,he.y,he.z),ee.set(ve,re,Me).normalize(),O.push(ee.x,ee.y,ee.z),U.push(Pe,1-xe),pe.push(G++)}W.push(pe)}for(var we=0;we<a;we++)for(var ye=0;ye<c;ye++){var Te=W[ye][we],Ue=W[ye+1][we],tt=W[ye+1][we+1],ot=W[ye][we+1];L.push(Te,Ue,ot),L.push(Ue,tt,ot),oe+=6}S.addGroup(ie,oe,0),ie+=oe}(),m===!1&&(t>0&&$(!0),e>0&&$(!1)),E.setIndex(L),E.setAttribute("position",new at(I,3)),E.setAttribute("normal",new at(O,3)),E.setAttribute("uv",new at(U,2)),E}return Ne(i,o),i}(ct),Ha=function(o){function i(t,e,s,a,c,m,v){var b;return t===void 0&&(t=1),e===void 0&&(e=1),s===void 0&&(s=8),a===void 0&&(a=1),c===void 0&&(c=!1),m===void 0&&(m=0),v===void 0&&(v=2*Math.PI),(b=o.call(this,0,t,e,s,a,c,m,v)||this).type="ConeGeometry",b.parameters={radius:t,height:e,radialSegments:s,heightSegments:a,openEnded:c,thetaStart:m,thetaLength:v},b}return Ne(i,o),i}(ar),ls=function(o){function i(t,e,s,a){var c;s===void 0&&(s=1),a===void 0&&(a=0),(c=o.call(this)||this).type="PolyhedronGeometry",c.parameters={vertices:t,indices:e,radius:s,detail:a};var m=[],v=[];function b(O,U,G,W){for(var X=W+1,ie=[],$=0;$<=X;$++){ie[$]=[];for(var ee=O.clone().lerp(G,$/X),he=U.clone().lerp(G,$/X),oe=X-$,re=0;re<=oe;re++)ie[$][re]=re===0&&$===X?ee:ee.clone().lerp(he,re/oe)}for(var me=0;me<X;me++)for(var pe=0;pe<2*(X-me)-1;pe++){var xe=Math.floor(pe/2);pe%2==0?(E(ie[me][xe+1]),E(ie[me+1][xe]),E(ie[me][xe])):(E(ie[me][xe+1]),E(ie[me+1][xe+1]),E(ie[me+1][xe]))}}function E(O){m.push(O.x,O.y,O.z)}function S(O,U){var G=3*O;U.x=t[G+0],U.y=t[G+1],U.z=t[G+2]}function L(O,U,G,W){W<0&&O.x===1&&(v[U]=O.x-1),G.x===0&&G.z===0&&(v[U]=W/2/Math.PI+.5)}function I(O){return Math.atan2(O.z,-O.x)}return function(O){for(var U=new se,G=new se,W=new se,X=0;X<e.length;X+=3)S(e[X+0],U),S(e[X+1],G),S(e[X+2],W),b(U,G,W,O)}(a),function(O){for(var U=new se,G=0;G<m.length;G+=3)U.x=m[G+0],U.y=m[G+1],U.z=m[G+2],U.normalize().multiplyScalar(O),m[G+0]=U.x,m[G+1]=U.y,m[G+2]=U.z}(s),function(){for(var O=new se,U=0;U<m.length;U+=3){O.x=m[U+0],O.y=m[U+1],O.z=m[U+2];var G=I(O)/2/Math.PI+.5,W=(X=O,Math.atan2(-X.y,Math.sqrt(X.x*X.x+X.z*X.z))/Math.PI+.5);v.push(G,1-W)}var X;(function(){for(var ie=new se,$=new se,ee=new se,he=new se,oe=new He,re=new He,me=new He,pe=0,xe=0;pe<m.length;pe+=9,xe+=6){ie.set(m[pe+0],m[pe+1],m[pe+2]),$.set(m[pe+3],m[pe+4],m[pe+5]),ee.set(m[pe+6],m[pe+7],m[pe+8]),oe.set(v[xe+0],v[xe+1]),re.set(v[xe+2],v[xe+3]),me.set(v[xe+4],v[xe+5]),he.copy(ie).add($).add(ee).divideScalar(3);var Ce=I(he);L(oe,xe+0,ie,Ce),L(re,xe+2,$,Ce),L(me,xe+4,ee,Ce)}})(),function(){for(var ie=0;ie<v.length;ie+=6){var $=v[ie+0],ee=v[ie+2],he=v[ie+4],oe=Math.max($,ee,he),re=Math.min($,ee,he);oe>.9&&re<.1&&($<.2&&(v[ie+0]+=1),ee<.2&&(v[ie+2]+=1),he<.2&&(v[ie+4]+=1))}}()}(),c.setAttribute("position",new at(m,3)),c.setAttribute("normal",new at(m.slice(),3)),c.setAttribute("uv",new at(v,2)),a===0?c.computeVertexNormals():c.normalizeNormals(),c}return Ne(i,o),i}(ct),Ka=function(o){function i(t,e){var s;t===void 0&&(t=1),e===void 0&&(e=0);var a=(1+Math.sqrt(5))/2,c=1/a,m=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-c,-a,0,-c,a,0,c,-a,0,c,a,-c,-a,0,-c,a,0,c,-a,0,c,a,0,-a,0,-c,a,0,-c,-a,0,c,a,0,c];return(s=o.call(this,m,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e)||this).type="DodecahedronGeometry",s.parameters={radius:t,detail:e},s}return Ne(i,o),i}(ls),Ya=new se,Xa=new se,tl=new se,or=new wi,il=function(o){function i(t,e){var s;if((s=o.call(this)||this).type="EdgesGeometry",s.parameters={thresholdAngle:e},e=e!==void 0?e:1,t.isGeometry===!0)return console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),bi(s);for(var a=Math.pow(10,4),c=Math.cos(dt.DEG2RAD*e),m=t.getIndex(),v=t.getAttribute("position"),b=m?m.count:v.count,E=[0,0,0],S=["a","b","c"],L=new Array(3),I={},O=[],U=0;U<b;U+=3){m?(E[0]=m.getX(U),E[1]=m.getX(U+1),E[2]=m.getX(U+2)):(E[0]=U,E[1]=U+1,E[2]=U+2);var G=or.a,W=or.b,X=or.c;if(G.fromBufferAttribute(v,E[0]),W.fromBufferAttribute(v,E[1]),X.fromBufferAttribute(v,E[2]),or.getNormal(tl),L[0]=Math.round(G.x*a)+","+Math.round(G.y*a)+","+Math.round(G.z*a),L[1]=Math.round(W.x*a)+","+Math.round(W.y*a)+","+Math.round(W.z*a),L[2]=Math.round(X.x*a)+","+Math.round(X.y*a)+","+Math.round(X.z*a),L[0]!==L[1]&&L[1]!==L[2]&&L[2]!==L[0])for(var ie=0;ie<3;ie++){var $=(ie+1)%3,ee=L[ie],he=L[$],oe=or[S[ie]],re=or[S[$]],me=ee+"_"+he,pe=he+"_"+ee;pe in I&&I[pe]?(tl.dot(I[pe].normal)<=c&&(O.push(oe.x,oe.y,oe.z),O.push(re.x,re.y,re.z)),I[pe]=null):me in I||(I[me]={index0:E[ie],index1:E[$],normal:tl.clone()})}}for(var xe in I)if(I[xe]){var Ce=I[xe],Ie=Ce.index0,Pe=Ce.index1;Ya.fromBufferAttribute(v,Ie),Xa.fromBufferAttribute(v,Pe),O.push(Ya.x,Ya.y,Ya.z),O.push(Xa.x,Xa.y,Xa.z)}return s.setAttribute("position",new at(O,3)),s}return Ne(i,o),i}(ct),Cd=function(i,t,e){e=e||2;var s,a,c,m,v,b,E,S=t&&t.length,L=S?t[0]*e:i.length,I=Hh(i,0,L,e,!0),O=[];if(!I||I.next===I.prev)return O;if(S&&(I=function(G,W,X,ie){var $,ee,he,oe=[];for($=0,ee=W.length;$<ee;$++)(he=Hh(G,W[$]*ie,$<ee-1?W[$+1]*ie:G.length,ie,!1))===he.next&&(he.steiner=!0),oe.push(Id(he));for(oe.sort(Dd),$=0;$<oe.length;$++)Rd(oe[$],X),X=hs(X,X.next);return X}(i,t,I,e)),i.length>80*e){s=c=i[0],a=m=i[1];for(var U=e;U<L;U+=e)(v=i[U])<s&&(s=v),(b=i[U+1])<a&&(a=b),v>c&&(c=v),b>m&&(m=b);E=(E=Math.max(c-s,m-a))!==0?1/E:0}return Ur(I,O,e,s,a,E),O};function Hh(o,i,t,e,s){var a,c;if(s===function(m,v,b,E){for(var S=0,L=v,I=b-E;L<b;L+=E)S+=(m[I]-m[L])*(m[L+1]+m[I+1]),I=L;return S}(o,i,t,e)>0)for(a=i;a<t;a+=e)c=Xh(a,o[a],o[a+1],c);else for(a=t-e;a>=i;a-=e)c=Xh(a,o[a],o[a+1],c);return c&&Za(c,c.next)&&(jr(c),c=c.next),c}function hs(o,i){if(!o)return o;i||(i=o);var t,e=o;do if(t=!1,e.steiner||!Za(e,e.next)&&ti(e.prev,e,e.next)!==0)e=e.next;else{if(jr(e),(e=i=e.prev)===e.next)break;t=!0}while(t||e!==i);return i}function Ur(o,i,t,e,s,a,c){if(o){!c&&a&&function(E,S,L,I){var O=E;do O.z===null&&(O.z=nl(O.x,O.y,S,L,I)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==E);O.prevZ.nextZ=null,O.prevZ=null,function(U){var G,W,X,ie,$,ee,he,oe,re=1;do{for(W=U,U=null,$=null,ee=0;W;){for(ee++,X=W,he=0,G=0;G<re&&(he++,X=X.nextZ);G++);for(oe=re;he>0||oe>0&&X;)he!==0&&(oe===0||!X||W.z<=X.z)?(ie=W,W=W.nextZ,he--):(ie=X,X=X.nextZ,oe--),$?$.nextZ=ie:U=ie,ie.prevZ=$,$=ie;W=X}$.nextZ=null,re*=2}while(ee>1)}(O)}(o,e,s,a);for(var m,v,b=o;o.prev!==o.next;)if(m=o.prev,v=o.next,a?Td(o,e,s,a):Md(o))i.push(m.i/t),i.push(o.i/t),i.push(v.i/t),jr(o),o=v.next,b=v.next;else if((o=v)===b){c?c===1?Ur(o=Ld(hs(o),i,t),i,t,e,s,a,2):c===2&&Pd(o,i,t,e,s,a):Ur(hs(o),i,t,e,s,a,1);break}}}function Md(o){var i=o.prev,t=o,e=o.next;if(ti(i,t,e)>=0)return!1;for(var s=o.next.next;s!==o.prev;){if(lr(i.x,i.y,t.x,t.y,e.x,e.y,s.x,s.y)&&ti(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function Td(o,i,t,e){var s=o.prev,a=o,c=o.next;if(ti(s,a,c)>=0)return!1;for(var m=s.x<a.x?s.x<c.x?s.x:c.x:a.x<c.x?a.x:c.x,v=s.y<a.y?s.y<c.y?s.y:c.y:a.y<c.y?a.y:c.y,b=s.x>a.x?s.x>c.x?s.x:c.x:a.x>c.x?a.x:c.x,E=s.y>a.y?s.y>c.y?s.y:c.y:a.y>c.y?a.y:c.y,S=nl(m,v,i,t,e),L=nl(b,E,i,t,e),I=o.prevZ,O=o.nextZ;I&&I.z>=S&&O&&O.z<=L;){if(I!==o.prev&&I!==o.next&&lr(s.x,s.y,a.x,a.y,c.x,c.y,I.x,I.y)&&ti(I.prev,I,I.next)>=0||(I=I.prevZ,O!==o.prev&&O!==o.next&&lr(s.x,s.y,a.x,a.y,c.x,c.y,O.x,O.y)&&ti(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;I&&I.z>=S;){if(I!==o.prev&&I!==o.next&&lr(s.x,s.y,a.x,a.y,c.x,c.y,I.x,I.y)&&ti(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;O&&O.z<=L;){if(O!==o.prev&&O!==o.next&&lr(s.x,s.y,a.x,a.y,c.x,c.y,O.x,O.y)&&ti(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function Ld(o,i,t){var e=o;do{var s=e.prev,a=e.next.next;!Za(s,a)&&Kh(s,e,e.next,a)&&kr(s,a)&&kr(a,s)&&(i.push(s.i/t),i.push(e.i/t),i.push(a.i/t),jr(e),jr(e.next),e=o=a),e=e.next}while(e!==o);return hs(e)}function Pd(o,i,t,e,s,a){var c=o;do{for(var m=c.next.next;m!==c.prev;){if(c.i!==m.i&&Od(c,m)){var v=Yh(c,m);return c=hs(c,c.next),v=hs(v,v.next),Ur(c,i,t,e,s,a),void Ur(v,i,t,e,s,a)}m=m.next}c=c.next}while(c!==o)}function Dd(o,i){return o.x-i.x}function Rd(o,i){if(i=function(e,s){var a,c=s,m=e.x,v=e.y,b=-1/0;do{if(v<=c.y&&v>=c.next.y&&c.next.y!==c.y){var E=c.x+(v-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(E<=m&&E>b){if(b=E,E===m){if(v===c.y)return c;if(v===c.next.y)return c.next}a=c.x<c.next.x?c:c.next}}c=c.next}while(c!==s);if(!a)return null;if(m===b)return a;var S,L=a,I=a.x,O=a.y,U=1/0;c=a;do m>=c.x&&c.x>=I&&m!==c.x&&lr(v<O?m:b,v,I,O,v<O?b:m,v,c.x,c.y)&&(S=Math.abs(v-c.y)/(m-c.x),kr(c,e)&&(S<U||S===U&&(c.x>a.x||c.x===a.x&&Bd(a,c)))&&(a=c,U=S)),c=c.next;while(c!==L);return a}(o,i)){var t=Yh(i,o);hs(i,i.next),hs(t,t.next)}}function Bd(o,i){return ti(o.prev,o,i.prev)<0&&ti(i.next,o,o.next)<0}function nl(o,i,t,e,s){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-t)*s)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-e)*s)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Id(o){var i=o,t=o;do(i.x<t.x||i.x===t.x&&i.y<t.y)&&(t=i),i=i.next;while(i!==o);return t}function lr(o,i,t,e,s,a,c,m){return(s-c)*(i-m)-(o-c)*(a-m)>=0&&(o-c)*(e-m)-(t-c)*(i-m)>=0&&(t-c)*(a-m)-(s-c)*(e-m)>=0}function Od(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(t,e){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&Kh(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(o,i)&&(kr(o,i)&&kr(i,o)&&function(t,e){var s=t,a=!1,c=(t.x+e.x)/2,m=(t.y+e.y)/2;do s.y>m!=s.next.y>m&&s.next.y!==s.y&&c<(s.next.x-s.x)*(m-s.y)/(s.next.y-s.y)+s.x&&(a=!a),s=s.next;while(s!==t);return a}(o,i)&&(ti(o.prev,o,i.prev)||ti(o,i.prev,i))||Za(o,i)&&ti(o.prev,o,o.next)>0&&ti(i.prev,i,i.next)>0)}function ti(o,i,t){return(i.y-o.y)*(t.x-i.x)-(i.x-o.x)*(t.y-i.y)}function Za(o,i){return o.x===i.x&&o.y===i.y}function Kh(o,i,t,e){var s=Qa(ti(o,i,t)),a=Qa(ti(o,i,e)),c=Qa(ti(t,e,o)),m=Qa(ti(t,e,i));return s!==a&&c!==m||!(s!==0||!qa(o,t,i))||!(a!==0||!qa(o,e,i))||!(c!==0||!qa(t,o,e))||!(m!==0||!qa(t,i,e))}function qa(o,i,t){return i.x<=Math.max(o.x,t.x)&&i.x>=Math.min(o.x,t.x)&&i.y<=Math.max(o.y,t.y)&&i.y>=Math.min(o.y,t.y)}function Qa(o){return o>0?1:o<0?-1:0}function kr(o,i){return ti(o.prev,o,o.next)<0?ti(o,i,o.next)>=0&&ti(o,o.prev,i)>=0:ti(o,i,o.prev)<0||ti(o,o.next,i)<0}function Yh(o,i){var t=new sl(o.i,o.x,o.y),e=new sl(i.i,i.x,i.y),s=o.next,a=i.prev;return o.next=i,i.prev=o,t.next=s,s.prev=t,e.next=t,t.prev=e,a.next=e,e.prev=a,e}function Xh(o,i,t,e){var s=new sl(o,i,t);return e?(s.next=e.next,s.prev=e,e.next.prev=s,e.next=s):(s.prev=s,s.next=s),s}function jr(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function sl(o,i,t){this.i=o,this.x=i,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Un={area:function(i){for(var t=i.length,e=0,s=t-1,a=0;a<t;s=a++)e+=i[s].x*i[a].y-i[a].x*i[s].y;return .5*e},isClockWise:function(i){return Un.area(i)<0},triangulateShape:function(i,t){var e=[],s=[],a=[];Zh(i),qh(e,i);var c=i.length;t.forEach(Zh);for(var m=0;m<t.length;m++)s.push(c),c+=t[m].length,qh(e,t[m]);for(var v=Cd(e,s),b=0;b<v.length;b+=3)a.push(v.slice(b,b+3));return a}};function Zh(o){var i=o.length;i>2&&o[i-1].equals(o[0])&&o.pop()}function qh(o,i){for(var t=0;t<i.length;t++)o.push(i[t].x),o.push(i[t].y)}var kn=function(o){function i(t,e){var s;(s=o.call(this)||this).type="ExtrudeGeometry",s.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var a=bi(s),c=[],m=[],v=0,b=t.length;v<b;v++)E(t[v]);function E(S){var L=[],I=e.curveSegments!==void 0?e.curveSegments:12,O=e.steps!==void 0?e.steps:1,U=e.depth!==void 0?e.depth:100,G=e.bevelEnabled===void 0||e.bevelEnabled,W=e.bevelThickness!==void 0?e.bevelThickness:6,X=e.bevelSize!==void 0?e.bevelSize:W-2,ie=e.bevelOffset!==void 0?e.bevelOffset:0,$=e.bevelSegments!==void 0?e.bevelSegments:3,ee=e.extrudePath,he=e.UVGenerator!==void 0?e.UVGenerator:Nd;e.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),U=e.amount);var oe,re,me,pe,xe,Ce=!1;ee&&(oe=ee.getSpacedPoints(O),Ce=!0,G=!1,re=ee.computeFrenetFrames(O,!1),me=new se,pe=new se,xe=new se),G||($=0,W=0,X=0,ie=0);var Ie=S.extractPoints(I),Pe=Ie.shape,de=Ie.holes;if(!Un.isClockWise(Pe)){Pe=Pe.reverse();for(var ve=0,Me=de.length;ve<Me;ve++){var we=de[ve];Un.isClockWise(we)&&(de[ve]=we.reverse())}}for(var ye=Un.triangulateShape(Pe,de),Te=Pe,Ue=0,tt=de.length;Ue<tt;Ue++){var ot=de[Ue];Pe=Pe.concat(ot)}function ue(Et,It,yt){return It||console.error("THREE.ExtrudeGeometry: vec does not exist"),It.clone().multiplyScalar(yt).add(Et)}var fe=Pe.length,Oe=ye.length;function De(Et,It,yt){var zt,jt,Dt,ai=Et.x-It.x,Xt=Et.y-It.y,mi=yt.x-Et.x,$i=yt.y-Et.y,Us=ai*ai+Xt*Xt,Af=ai*$i-Xt*mi;if(Math.abs(Af)>Number.EPSILON){var tu=Math.sqrt(Us),iu=Math.sqrt(mi*mi+$i*$i),nu=It.x-Xt/tu,su=It.y+ai/tu,ru=((yt.x-$i/iu-nu)*$i-(yt.y+mi/iu-su)*mi)/(ai*$i-Xt*mi),au=(zt=nu+ai*ru-Et.x)*zt+(jt=su+Xt*ru-Et.y)*jt;if(au<=2)return new He(zt,jt);Dt=Math.sqrt(au/2)}else{var To=!1;ai>Number.EPSILON?mi>Number.EPSILON&&(To=!0):ai<-Number.EPSILON?mi<-Number.EPSILON&&(To=!0):Math.sign(Xt)===Math.sign($i)&&(To=!0),To?(zt=-Xt,jt=ai,Dt=Math.sqrt(Us)):(zt=ai,jt=Xt,Dt=Math.sqrt(Us/2))}return new He(zt/Dt,jt/Dt)}for(var Ve=[],Ae=0,Ee=Te.length,Ze=Ee-1,qe=Ae+1;Ae<Ee;Ae++,Ze++,qe++)Ze===Ee&&(Ze=0),qe===Ee&&(qe=0),Ve[Ae]=De(Te[Ae],Te[Ze],Te[qe]);for(var rt,Xe=[],gt=Ve.concat(),Rt=0,Bt=de.length;Rt<Bt;Rt++){var wt=de[Rt];rt=[];for(var At=0,Yt=wt.length,kt=Yt-1,ei=At+1;At<Yt;At++,kt++,ei++)kt===Yt&&(kt=0),ei===Yt&&(ei=0),rt[At]=De(wt[At],wt[kt],wt[ei]);Xe.push(rt),gt=gt.concat(rt)}for(var fi=0;fi<$;fi++){for(var Dn=fi/$,jn=W*Math.cos(Dn*Math.PI/2),pi=X*Math.sin(Dn*Math.PI/2)+ie,ci=0,Ye=Te.length;ci<Ye;ci++){var oa=ue(Te[ci],Ve[ci],pi);Vt(oa.x,oa.y,-jn)}for(var fr=0,la=de.length;fr<la;fr++){var ha=de[fr];rt=Xe[fr];for(var Ji=0,Mo=ha.length;Ji<Mo;Ji++){var ca=ue(ha[Ji],rt[Ji],pi);Vt(ca.x,ca.y,-jn)}}}for(var ua=X+ie,ps=0;ps<fe;ps++){var Fs=G?ue(Pe[ps],gt[ps],ua):Pe[ps];Ce?(pe.copy(re.normals[0]).multiplyScalar(Fs.x),me.copy(re.binormals[0]).multiplyScalar(Fs.y),xe.copy(oe[0]).add(pe).add(me),Vt(xe.x,xe.y,xe.z)):Vt(Fs.x,Fs.y,0)}for(var Rn=1;Rn<=O;Rn++)for(var wn=0;wn<fe;wn++){var zs=G?ue(Pe[wn],gt[wn],ua):Pe[wn];Ce?(pe.copy(re.normals[Rn]).multiplyScalar(zs.x),me.copy(re.binormals[Rn]).multiplyScalar(zs.y),xe.copy(oe[Rn]).add(pe).add(me),Vt(xe.x,xe.y,xe.z)):Vt(zs.x,zs.y,U/O*Rn)}for(var pr=$-1;pr>=0;pr--){for(var da=pr/$,Bn=W*Math.cos(da*Math.PI/2),fa=X*Math.sin(da*Math.PI/2)+ie,ce=0,We=Te.length;ce<We;ce++){var Le=ue(Te[ce],Ve[ce],fa);Vt(Le.x,Le.y,U+Bn)}for(var ke=0,Qe=de.length;ke<Qe;ke++){var St=de[ke];rt=Xe[ke];for(var xt=0,Ct=St.length;xt<Ct;xt++){var mt=ue(St[xt],rt[xt],fa);Ce?Vt(mt.x,mt.y+oe[O-1].y,oe[O-1].x+Bn):Vt(mt.x,mt.y,U+Bn)}}}function Ht(Et,It){for(var yt=Et.length;--yt>=0;){var zt=yt,jt=yt-1;jt<0&&(jt=Et.length-1);for(var Dt=0,ai=O+2*$;Dt<ai;Dt++){var Xt=fe*Dt,mi=fe*(Dt+1);Mt(It+zt+Xt,It+jt+Xt,It+jt+mi,It+zt+mi)}}}function Vt(Et,It,yt){L.push(Et),L.push(It),L.push(yt)}function ut(Et,It,yt){ii(Et),ii(It),ii(yt);var zt=c.length/3,jt=he.generateTopUV(a,c,zt-3,zt-2,zt-1);Pt(jt[0]),Pt(jt[1]),Pt(jt[2])}function Mt(Et,It,yt,zt){ii(Et),ii(It),ii(zt),ii(It),ii(yt),ii(zt);var jt=c.length/3,Dt=he.generateSideWallUV(a,c,jt-6,jt-3,jt-2,jt-1);Pt(Dt[0]),Pt(Dt[1]),Pt(Dt[3]),Pt(Dt[1]),Pt(Dt[2]),Pt(Dt[3])}function ii(Et){c.push(L[3*Et+0]),c.push(L[3*Et+1]),c.push(L[3*Et+2])}function Pt(Et){m.push(Et.x),m.push(Et.y)}(function(){var Et=c.length/3;if(G){for(var It=0,yt=fe*It,zt=0;zt<Oe;zt++){var jt=ye[zt];ut(jt[2]+yt,jt[1]+yt,jt[0]+yt)}yt=fe*(It=O+2*$);for(var Dt=0;Dt<Oe;Dt++){var ai=ye[Dt];ut(ai[0]+yt,ai[1]+yt,ai[2]+yt)}}else{for(var Xt=0;Xt<Oe;Xt++){var mi=ye[Xt];ut(mi[2],mi[1],mi[0])}for(var $i=0;$i<Oe;$i++){var Us=ye[$i];ut(Us[0]+fe*O,Us[1]+fe*O,Us[2]+fe*O)}}a.addGroup(Et,c.length/3-Et,0)})(),function(){var Et=c.length/3,It=0;Ht(Te,It),It+=Te.length;for(var yt=0,zt=de.length;yt<zt;yt++){var jt=de[yt];Ht(jt,It),It+=jt.length}a.addGroup(Et,c.length/3-Et,1)}()}return s.setAttribute("position",new at(c,3)),s.setAttribute("uv",new at(m,2)),s.computeVertexNormals(),s}return Ne(i,o),i.prototype.toJSON=function(){var t=ct.prototype.toJSON.call(this);return function(e,s,a){if(a.shapes=[],Array.isArray(e))for(var c=0,m=e.length;c<m;c++){var v=e[c];a.shapes.push(v.uuid)}else a.shapes.push(e.uuid);return s.extrudePath!==void 0&&(a.options.extrudePath=s.extrudePath.toJSON()),a}(this.parameters.shapes,this.parameters.options,t)},i}(ct),Nd={generateTopUV:function(i,t,e,s,a){var c=t[3*e],m=t[3*e+1],v=t[3*s],b=t[3*s+1],E=t[3*a],S=t[3*a+1];return[new He(c,m),new He(v,b),new He(E,S)]},generateSideWallUV:function(i,t,e,s,a,c){var m=t[3*e],v=t[3*e+1],b=t[3*e+2],E=t[3*s],S=t[3*s+1],L=t[3*s+2],I=t[3*a],O=t[3*a+1],U=t[3*a+2],G=t[3*c],W=t[3*c+1],X=t[3*c+2];return Math.abs(v-S)<.01?[new He(m,1-b),new He(E,1-L),new He(I,1-U),new He(G,1-X)]:[new He(v,1-b),new He(S,1-L),new He(O,1-U),new He(W,1-X)]}},Ja=function(o){function i(t,e){var s;t===void 0&&(t=1),e===void 0&&(e=0);var a=(1+Math.sqrt(5))/2,c=[-1,a,0,1,a,0,-1,-a,0,1,-a,0,0,-1,a,0,1,a,0,-1,-a,0,1,-a,a,0,-1,a,0,1,-a,0,-1,-a,0,1];return(s=o.call(this,c,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e)||this).type="IcosahedronGeometry",s.parameters={radius:t,detail:e},s}return Ne(i,o),i}(ls),$a=function(o){function i(t,e,s,a){var c;e===void 0&&(e=12),s===void 0&&(s=0),a===void 0&&(a=2*Math.PI),(c=o.call(this)||this).type="LatheGeometry",c.parameters={points:t,segments:e,phiStart:s,phiLength:a},e=Math.floor(e),a=dt.clamp(a,0,2*Math.PI);for(var m=[],v=[],b=[],E=1/e,S=new se,L=new He,I=0;I<=e;I++)for(var O=s+I*E*a,U=Math.sin(O),G=Math.cos(O),W=0;W<=t.length-1;W++)S.x=t[W].x*U,S.y=t[W].y,S.z=t[W].x*G,v.push(S.x,S.y,S.z),L.x=I/e,L.y=W/(t.length-1),b.push(L.x,L.y);for(var X=0;X<e;X++)for(var ie=0;ie<t.length-1;ie++){var $=ie+X*t.length,ee=$,he=$+t.length,oe=$+t.length+1,re=$+1;m.push(ee,he,re),m.push(he,oe,re)}if(c.setIndex(m),c.setAttribute("position",new at(v,3)),c.setAttribute("uv",new at(b,2)),c.computeVertexNormals(),a===2*Math.PI)for(var me=c.attributes.normal.array,pe=new se,xe=new se,Ce=new se,Ie=e*t.length*3,Pe=0,de=0;Pe<t.length;Pe++,de+=3)pe.x=me[de+0],pe.y=me[de+1],pe.z=me[de+2],xe.x=me[Ie+de+0],xe.y=me[Ie+de+1],xe.z=me[Ie+de+2],Ce.addVectors(pe,xe).normalize(),me[de+0]=me[Ie+de+0]=Ce.x,me[de+1]=me[Ie+de+1]=Ce.y,me[de+2]=me[Ie+de+2]=Ce.z;return c}return Ne(i,o),i}(ct),Vr=function(o){function i(t,e){var s;return t===void 0&&(t=1),e===void 0&&(e=0),(s=o.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e)||this).type="OctahedronGeometry",s.parameters={radius:t,detail:e},s}return Ne(i,o),i}(ls);function Ms(o,i,t){ct.call(this),this.type="ParametricGeometry",this.parameters={func:o,slices:i,stacks:t};var e=[],s=[],a=[],c=[],m=1e-5,v=new se,b=new se,E=new se,S=new se,L=new se;o.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var I=i+1,O=0;O<=t;O++)for(var U=O/t,G=0;G<=i;G++){var W=G/i;o(W,U,b),s.push(b.x,b.y,b.z),W-m>=0?(o(W-m,U,E),S.subVectors(b,E)):(o(W+m,U,E),S.subVectors(E,b)),U-m>=0?(o(W,U-m,E),L.subVectors(b,E)):(o(W,U+m,E),L.subVectors(E,b)),v.crossVectors(S,L).normalize(),a.push(v.x,v.y,v.z),c.push(W,U)}for(var X=0;X<t;X++)for(var ie=0;ie<i;ie++){var $=X*I+ie,ee=X*I+ie+1,he=(X+1)*I+ie+1,oe=(X+1)*I+ie;e.push($,ee,oe),e.push(ee,he,oe)}this.setIndex(e),this.setAttribute("position",new at(s,3)),this.setAttribute("normal",new at(a,3)),this.setAttribute("uv",new at(c,2))}Ms.prototype=Object.create(ct.prototype),Ms.prototype.constructor=Ms;var eo=function(o){function i(t,e,s,a,c,m){var v;t===void 0&&(t=.5),e===void 0&&(e=1),s===void 0&&(s=8),a===void 0&&(a=1),c===void 0&&(c=0),m===void 0&&(m=2*Math.PI),(v=o.call(this)||this).type="RingGeometry",v.parameters={innerRadius:t,outerRadius:e,thetaSegments:s,phiSegments:a,thetaStart:c,thetaLength:m},s=Math.max(3,s);for(var b=[],E=[],S=[],L=[],I=t,O=(e-t)/(a=Math.max(1,a)),U=new se,G=new He,W=0;W<=a;W++){for(var X=0;X<=s;X++){var ie=c+X/s*m;U.x=I*Math.cos(ie),U.y=I*Math.sin(ie),E.push(U.x,U.y,U.z),S.push(0,0,1),G.x=(U.x/e+1)/2,G.y=(U.y/e+1)/2,L.push(G.x,G.y)}I+=O}for(var $=0;$<a;$++)for(var ee=$*(s+1),he=0;he<s;he++){var oe=he+ee,re=oe,me=oe+s+1,pe=oe+s+2,xe=oe+1;b.push(re,me,xe),b.push(me,pe,xe)}return v.setIndex(b),v.setAttribute("position",new at(E,3)),v.setAttribute("normal",new at(S,3)),v.setAttribute("uv",new at(L,2)),v}return Ne(i,o),i}(ct),Wr=function(o){function i(t,e){var s;e===void 0&&(e=12),(s=o.call(this)||this).type="ShapeGeometry",s.parameters={shapes:t,curveSegments:e};var a=[],c=[],m=[],v=[],b=0,E=0;if(Array.isArray(t)===!1)L(t);else for(var S=0;S<t.length;S++)L(t[S]),s.addGroup(b,E,S),b+=E,E=0;function L(I){var O=c.length/3,U=I.extractPoints(e),G=U.shape,W=U.holes;Un.isClockWise(G)===!1&&(G=G.reverse());for(var X=0,ie=W.length;X<ie;X++){var $=W[X];Un.isClockWise($)===!0&&(W[X]=$.reverse())}for(var ee=Un.triangulateShape(G,W),he=0,oe=W.length;he<oe;he++){var re=W[he];G=G.concat(re)}for(var me=0,pe=G.length;me<pe;me++){var xe=G[me];c.push(xe.x,xe.y,0),m.push(0,0,1),v.push(xe.x,xe.y)}for(var Ce=0,Ie=ee.length;Ce<Ie;Ce++){var Pe=ee[Ce],de=Pe[0]+O,ve=Pe[1]+O,Me=Pe[2]+O;a.push(de,ve,Me),E+=3}}return s.setIndex(a),s.setAttribute("position",new at(c,3)),s.setAttribute("normal",new at(m,3)),s.setAttribute("uv",new at(v,2)),s}return Ne(i,o),i.prototype.toJSON=function(){var t=ct.prototype.toJSON.call(this);return function(e,s){if(s.shapes=[],Array.isArray(e))for(var a=0,c=e.length;a<c;a++){var m=e[a];s.shapes.push(m.uuid)}else s.shapes.push(e.uuid);return s}(this.parameters.shapes,t)},i}(ct),Gr=function(o){function i(t,e,s,a,c,m,v){var b;t===void 0&&(t=1),e===void 0&&(e=8),s===void 0&&(s=6),a===void 0&&(a=0),c===void 0&&(c=2*Math.PI),m===void 0&&(m=0),v===void 0&&(v=Math.PI),(b=o.call(this)||this).type="SphereGeometry",b.parameters={radius:t,widthSegments:e,heightSegments:s,phiStart:a,phiLength:c,thetaStart:m,thetaLength:v},e=Math.max(3,Math.floor(e)),s=Math.max(2,Math.floor(s));for(var E=Math.min(m+v,Math.PI),S=0,L=[],I=new se,O=new se,U=[],G=[],W=[],X=[],ie=0;ie<=s;ie++){var $=[],ee=ie/s,he=0;ie==0&&m==0?he=.5/e:ie==s&&E==Math.PI&&(he=-.5/e);for(var oe=0;oe<=e;oe++){var re=oe/e;I.x=-t*Math.cos(a+re*c)*Math.sin(m+ee*v),I.y=t*Math.cos(m+ee*v),I.z=t*Math.sin(a+re*c)*Math.sin(m+ee*v),G.push(I.x,I.y,I.z),O.copy(I).normalize(),W.push(O.x,O.y,O.z),X.push(re+he,1-ee),$.push(S++)}L.push($)}for(var me=0;me<s;me++)for(var pe=0;pe<e;pe++){var xe=L[me][pe+1],Ce=L[me][pe],Ie=L[me+1][pe],Pe=L[me+1][pe+1];(me!==0||m>0)&&U.push(xe,Ce,Pe),(me!==s-1||E<Math.PI)&&U.push(Ce,Ie,Pe)}return b.setIndex(U),b.setAttribute("position",new at(G,3)),b.setAttribute("normal",new at(W,3)),b.setAttribute("uv",new at(X,2)),b}return Ne(i,o),i}(ct),to=function(o){function i(t,e){var s;return t===void 0&&(t=1),e===void 0&&(e=0),(s=o.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e)||this).type="TetrahedronGeometry",s.parameters={radius:t,detail:e},s}return Ne(i,o),i}(ls),io=function(o){function i(t,e){var s;e===void 0&&(e={});var a=e.font;if(!a||!a.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ct||bi(s);var c=a.generateShapes(t,e.size);return e.depth=e.height!==void 0?e.height:50,e.bevelThickness===void 0&&(e.bevelThickness=10),e.bevelSize===void 0&&(e.bevelSize=8),e.bevelEnabled===void 0&&(e.bevelEnabled=!1),(s=o.call(this,c,e)||this).type="TextGeometry",s}return Ne(i,o),i}(kn),no=function(o){function i(t,e,s,a,c){var m;t===void 0&&(t=1),e===void 0&&(e=.4),s===void 0&&(s=8),a===void 0&&(a=6),c===void 0&&(c=2*Math.PI),(m=o.call(this)||this).type="TorusGeometry",m.parameters={radius:t,tube:e,radialSegments:s,tubularSegments:a,arc:c},s=Math.floor(s),a=Math.floor(a);for(var v=[],b=[],E=[],S=[],L=new se,I=new se,O=new se,U=0;U<=s;U++)for(var G=0;G<=a;G++){var W=G/a*c,X=U/s*Math.PI*2;I.x=(t+e*Math.cos(X))*Math.cos(W),I.y=(t+e*Math.cos(X))*Math.sin(W),I.z=e*Math.sin(X),b.push(I.x,I.y,I.z),L.x=t*Math.cos(W),L.y=t*Math.sin(W),O.subVectors(I,L).normalize(),E.push(O.x,O.y,O.z),S.push(G/a),S.push(U/s)}for(var ie=1;ie<=s;ie++)for(var $=1;$<=a;$++){var ee=(a+1)*ie+$-1,he=(a+1)*(ie-1)+$-1,oe=(a+1)*(ie-1)+$,re=(a+1)*ie+$;v.push(ee,he,re),v.push(he,oe,re)}return m.setIndex(v),m.setAttribute("position",new at(b,3)),m.setAttribute("normal",new at(E,3)),m.setAttribute("uv",new at(S,2)),m}return Ne(i,o),i}(ct),so=function(o){function i(t,e,s,a,c,m){var v;t===void 0&&(t=1),e===void 0&&(e=.4),s===void 0&&(s=64),a===void 0&&(a=8),c===void 0&&(c=2),m===void 0&&(m=3),(v=o.call(this)||this).type="TorusKnotGeometry",v.parameters={radius:t,tube:e,tubularSegments:s,radialSegments:a,p:c,q:m},s=Math.floor(s),a=Math.floor(a);for(var b=[],E=[],S=[],L=[],I=new se,O=new se,U=new se,G=new se,W=new se,X=new se,ie=new se,$=0;$<=s;++$){var ee=$/s*c*Math.PI*2;ve(ee,c,m,t,U),ve(ee+.01,c,m,t,G),X.subVectors(G,U),ie.addVectors(G,U),W.crossVectors(X,ie),ie.crossVectors(W,X),W.normalize(),ie.normalize();for(var he=0;he<=a;++he){var oe=he/a*Math.PI*2,re=-e*Math.cos(oe),me=e*Math.sin(oe);I.x=U.x+(re*ie.x+me*W.x),I.y=U.y+(re*ie.y+me*W.y),I.z=U.z+(re*ie.z+me*W.z),E.push(I.x,I.y,I.z),O.subVectors(I,U).normalize(),S.push(O.x,O.y,O.z),L.push($/s),L.push(he/a)}}for(var pe=1;pe<=s;pe++)for(var xe=1;xe<=a;xe++){var Ce=(a+1)*(pe-1)+(xe-1),Ie=(a+1)*pe+(xe-1),Pe=(a+1)*pe+xe,de=(a+1)*(pe-1)+xe;b.push(Ce,Ie,de),b.push(Ie,Pe,de)}function ve(Me,we,ye,Te,Ue){var tt=Math.cos(Me),ot=Math.sin(Me),ue=ye/we*Me,fe=Math.cos(ue);Ue.x=Te*(2+fe)*.5*tt,Ue.y=Te*(2+fe)*ot*.5,Ue.z=Te*Math.sin(ue)*.5}return v.setIndex(b),v.setAttribute("position",new at(E,3)),v.setAttribute("normal",new at(S,3)),v.setAttribute("uv",new at(L,2)),v}return Ne(i,o),i}(ct),ro=function(o){function i(t,e,s,a,c){var m;e===void 0&&(e=64),s===void 0&&(s=1),a===void 0&&(a=8),c===void 0&&(c=!1),(m=o.call(this)||this).type="TubeGeometry",m.parameters={path:t,tubularSegments:e,radius:s,radialSegments:a,closed:c};var v=t.computeFrenetFrames(e,c);m.tangents=v.tangents,m.normals=v.normals,m.binormals=v.binormals;var b=new se,E=new se,S=new He,L=new se,I=[],O=[],U=[],G=[];function W(X){L=t.getPointAt(X/e,L);for(var ie=v.normals[X],$=v.binormals[X],ee=0;ee<=a;ee++){var he=ee/a*Math.PI*2,oe=Math.sin(he),re=-Math.cos(he);E.x=re*ie.x+oe*$.x,E.y=re*ie.y+oe*$.y,E.z=re*ie.z+oe*$.z,E.normalize(),O.push(E.x,E.y,E.z),b.x=L.x+s*E.x,b.y=L.y+s*E.y,b.z=L.z+s*E.z,I.push(b.x,b.y,b.z)}}return function(){for(var X=0;X<e;X++)W(X);W(c===!1?e:0),function(){for(var ie=0;ie<=e;ie++)for(var $=0;$<=a;$++)S.x=ie/e,S.y=$/a,U.push(S.x,S.y)}(),function(){for(var ie=1;ie<=e;ie++)for(var $=1;$<=a;$++){var ee=(a+1)*(ie-1)+($-1),he=(a+1)*ie+($-1),oe=(a+1)*ie+$,re=(a+1)*(ie-1)+$;G.push(ee,he,re),G.push(he,oe,re)}}()}(),m.setIndex(G),m.setAttribute("position",new at(I,3)),m.setAttribute("normal",new at(O,3)),m.setAttribute("uv",new at(U,2)),m}return Ne(i,o),i.prototype.toJSON=function(){var t=ct.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},i}(ct),rl=function(o){function i(t){var e;if((e=o.call(this)||this).type="WireframeGeometry",t.isGeometry===!0)return console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),bi(e);var s=[],a=[0,0],c={},m=new se;if(t.index!==null){var v=t.attributes.position,b=t.index,E=t.groups;E.length===0&&(E=[{start:0,count:b.count,materialIndex:0}]);for(var S=0,L=E.length;S<L;++S)for(var I=E[S],O=I.start,U=O,G=O+I.count;U<G;U+=3)for(var W=0;W<3;W++){var X=b.getX(U+W),ie=b.getX(U+(W+1)%3);a[0]=Math.min(X,ie),a[1]=Math.max(X,ie);var $=a[0]+","+a[1];c[$]===void 0&&(c[$]={index1:a[0],index2:a[1]})}for(var ee in c){var he=c[ee];m.fromBufferAttribute(v,he.index1),s.push(m.x,m.y,m.z),m.fromBufferAttribute(v,he.index2),s.push(m.x,m.y,m.z)}}else for(var oe=t.attributes.position,re=0,me=oe.count/3;re<me;re++)for(var pe=0;pe<3;pe++){var xe=3*re+pe;m.fromBufferAttribute(oe,xe),s.push(m.x,m.y,m.z);var Ce=3*re+(pe+1)%3;m.fromBufferAttribute(oe,Ce),s.push(m.x,m.y,m.z)}return e.setAttribute("position",new at(s,3)),e}return Ne(i,o),i}(ct),Oi=Object.freeze({__proto__:null,BoxGeometry:Ss,BoxBufferGeometry:Ss,CircleGeometry:Ga,CircleBufferGeometry:Ga,ConeGeometry:Ha,ConeBufferGeometry:Ha,CylinderGeometry:ar,CylinderBufferGeometry:ar,DodecahedronGeometry:Ka,DodecahedronBufferGeometry:Ka,EdgesGeometry:il,ExtrudeGeometry:kn,ExtrudeBufferGeometry:kn,IcosahedronGeometry:Ja,IcosahedronBufferGeometry:Ja,LatheGeometry:$a,LatheBufferGeometry:$a,OctahedronGeometry:Vr,OctahedronBufferGeometry:Vr,ParametricGeometry:Ms,ParametricBufferGeometry:Ms,PlaneGeometry:Lr,PlaneBufferGeometry:Lr,PolyhedronGeometry:ls,PolyhedronBufferGeometry:ls,RingGeometry:eo,RingBufferGeometry:eo,ShapeGeometry:Wr,ShapeBufferGeometry:Wr,SphereGeometry:Gr,SphereBufferGeometry:Gr,TetrahedronGeometry:to,TetrahedronBufferGeometry:to,TextGeometry:io,TextBufferGeometry:io,TorusGeometry:no,TorusBufferGeometry:no,TorusKnotGeometry:so,TorusKnotBufferGeometry:so,TubeGeometry:ro,TubeBufferGeometry:ro,WireframeGeometry:rl}),al=function(o){function i(t){var e;return(e=o.call(this)||this).type="ShadowMaterial",e.color=new st(0),e.transparent=!0,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.color.copy(t.color),this},i}(Gt);al.prototype.isShadowMaterial=!0;var hr=function(o){function i(t){var e;return(e=o.call(this,t)||this).type="RawShaderMaterial",e}return Ne(i,o),i}(Ui);function Tn(o){Gt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new st(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new st(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(o)}function cs(o){Tn.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new He(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=dt.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(o)}hr.prototype.isRawShaderMaterial=!0,Tn.prototype=Object.create(Gt.prototype),Tn.prototype.constructor=Tn,Tn.prototype.isMeshStandardMaterial=!0,Tn.prototype.copy=function(o){return Gt.prototype.copy.call(this,o),this.defines={STANDARD:""},this.color.copy(o.color),this.roughness=o.roughness,this.metalness=o.metalness,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.roughnessMap=o.roughnessMap,this.metalnessMap=o.metalnessMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.envMapIntensity=o.envMapIntensity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.skinning=o.skinning,this.morphTargets=o.morphTargets,this.morphNormals=o.morphNormals,this.flatShading=o.flatShading,this.vertexTangents=o.vertexTangents,this},cs.prototype=Object.create(Tn.prototype),cs.prototype.constructor=cs,cs.prototype.isMeshPhysicalMaterial=!0,cs.prototype.copy=function(o){return Tn.prototype.copy.call(this,o),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=o.clearcoat,this.clearcoatMap=o.clearcoatMap,this.clearcoatRoughness=o.clearcoatRoughness,this.clearcoatRoughnessMap=o.clearcoatRoughnessMap,this.clearcoatNormalMap=o.clearcoatNormalMap,this.clearcoatNormalScale.copy(o.clearcoatNormalScale),this.reflectivity=o.reflectivity,o.sheen?this.sheen=(this.sheen||new st).copy(o.sheen):this.sheen=null,this.transmission=o.transmission,this.transmissionMap=o.transmissionMap,this};var ao=function(o){function i(t){var e;return(e=o.call(this)||this).type="MeshPhongMaterial",e.color=new st(16777215),e.specular=new st(1118481),e.shininess=30,e.map=null,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=null,e.aoMapIntensity=1,e.emissive=new st(0),e.emissiveIntensity=1,e.emissiveMap=null,e.bumpMap=null,e.bumpScale=1,e.normalMap=null,e.normalMapType=0,e.normalScale=new He(1,1),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=null,e.alphaMap=null,e.envMap=null,e.combine=0,e.reflectivity=1,e.refractionRatio=.98,e.wireframe=!1,e.wireframeLinewidth=1,e.wireframeLinecap="round",e.wireframeLinejoin="round",e.skinning=!1,e.morphTargets=!1,e.morphNormals=!1,e.flatShading=!1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this},i}(Gt);ao.prototype.isMeshPhongMaterial=!0;var ol=function(o){function i(t){var e;return(e=o.call(this)||this).defines={TOON:""},e.type="MeshToonMaterial",e.color=new st(16777215),e.map=null,e.gradientMap=null,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=null,e.aoMapIntensity=1,e.emissive=new st(0),e.emissiveIntensity=1,e.emissiveMap=null,e.bumpMap=null,e.bumpScale=1,e.normalMap=null,e.normalMapType=0,e.normalScale=new He(1,1),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.alphaMap=null,e.wireframe=!1,e.wireframeLinewidth=1,e.wireframeLinecap="round",e.wireframeLinejoin="round",e.skinning=!1,e.morphTargets=!1,e.morphNormals=!1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},i}(Gt);ol.prototype.isMeshToonMaterial=!0;var ll=function(o){function i(t){var e;return(e=o.call(this)||this).type="MeshNormalMaterial",e.bumpMap=null,e.bumpScale=1,e.normalMap=null,e.normalMapType=0,e.normalScale=new He(1,1),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.wireframe=!1,e.wireframeLinewidth=1,e.fog=!1,e.skinning=!1,e.morphTargets=!1,e.morphNormals=!1,e.flatShading=!1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this},i}(Gt);ll.prototype.isMeshNormalMaterial=!0;var hl=function(o){function i(t){var e;return(e=o.call(this)||this).type="MeshLambertMaterial",e.color=new st(16777215),e.map=null,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=null,e.aoMapIntensity=1,e.emissive=new st(0),e.emissiveIntensity=1,e.emissiveMap=null,e.specularMap=null,e.alphaMap=null,e.envMap=null,e.combine=0,e.reflectivity=1,e.refractionRatio=.98,e.wireframe=!1,e.wireframeLinewidth=1,e.wireframeLinecap="round",e.wireframeLinejoin="round",e.skinning=!1,e.morphTargets=!1,e.morphNormals=!1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},i}(Gt);hl.prototype.isMeshLambertMaterial=!0;var cl=function(o){function i(t){var e;return(e=o.call(this)||this).defines={MATCAP:""},e.type="MeshMatcapMaterial",e.color=new st(16777215),e.matcap=null,e.map=null,e.bumpMap=null,e.bumpScale=1,e.normalMap=null,e.normalMapType=0,e.normalScale=new He(1,1),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.alphaMap=null,e.skinning=!1,e.morphTargets=!1,e.morphNormals=!1,e.flatShading=!1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this},i}(Gt);cl.prototype.isMeshMatcapMaterial=!0;var ul=function(o){function i(t){var e;return(e=o.call(this)||this).type="LineDashedMaterial",e.scale=1,e.dashSize=3,e.gapSize=1,e.setValues(t),e}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this},i}(yi);ul.prototype.isLineDashedMaterial=!0;var Fd=Object.freeze({__proto__:null,ShadowMaterial:al,SpriteMaterial:Ba,RawShaderMaterial:hr,ShaderMaterial:Ui,PointsMaterial:Cs,MeshPhysicalMaterial:cs,MeshStandardMaterial:Tn,MeshPhongMaterial:ao,MeshToonMaterial:ol,MeshNormalMaterial:ll,MeshLambertMaterial:hl,MeshDepthMaterial:La,MeshDistanceMaterial:Pa,MeshBasicMaterial:zn,MeshMatcapMaterial:cl,LineDashedMaterial:ul,LineBasicMaterial:yi,Material:Gt}),$t={arraySlice:function(i,t,e){return $t.isTypedArray(i)?new i.constructor(i.subarray(t,e!==void 0?e:i.length)):i.slice(t,e)},convertArray:function(i,t,e){return!i||!e&&i.constructor===t?i:typeof t.BYTES_PER_ELEMENT=="number"?new t(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){for(var t=i.length,e=new Array(t),s=0;s!==t;++s)e[s]=s;return e.sort(function(a,c){return i[a]-i[c]}),e},sortedArray:function(i,t,e){for(var s=i.length,a=new i.constructor(s),c=0,m=0;m!==s;++c)for(var v=e[c]*t,b=0;b!==t;++b)a[m++]=i[v+b];return a},flattenJSON:function(i,t,e,s){for(var a=1,c=i[0];c!==void 0&&c[s]===void 0;)c=i[a++];if(c!==void 0){var m=c[s];if(m!==void 0)if(Array.isArray(m))do(m=c[s])!==void 0&&(t.push(c.time),e.push.apply(e,m)),c=i[a++];while(c!==void 0);else if(m.toArray!==void 0)do(m=c[s])!==void 0&&(t.push(c.time),m.toArray(e,e.length)),c=i[a++];while(c!==void 0);else do(m=c[s])!==void 0&&(t.push(c.time),e.push(m)),c=i[a++];while(c!==void 0)}},subclip:function(i,t,e,s,a){a===void 0&&(a=30);var c=i.clone();c.name=t;for(var m=[],v=0;v<c.tracks.length;++v){for(var b=c.tracks[v],E=b.getValueSize(),S=[],L=[],I=0;I<b.times.length;++I){var O=b.times[I]*a;if(!(O<e||O>=s)){S.push(b.times[I]);for(var U=0;U<E;++U)L.push(b.values[I*E+U])}}S.length!==0&&(b.times=$t.convertArray(S,b.times.constructor),b.values=$t.convertArray(L,b.values.constructor),m.push(b))}c.tracks=m;for(var G=1/0,W=0;W<c.tracks.length;++W)G>c.tracks[W].times[0]&&(G=c.tracks[W].times[0]);for(var X=0;X<c.tracks.length;++X)c.tracks[X].shift(-1*G);return c.resetDuration(),c},makeClipAdditive:function(i,t,e,s){t===void 0&&(t=0),e===void 0&&(e=i),s===void 0&&(s=30),s<=0&&(s=30);for(var a=e.tracks.length,c=t/s,m=function(E){var S=e.tracks[E],L=S.ValueTypeName;if(L==="bool"||L==="string")return"continue";var I=i.tracks.find(function(ve){return ve.name===S.name&&ve.ValueTypeName===L});if(I===void 0)return"continue";var O=0,U=S.getValueSize();S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(O=U/3);var G=0,W=I.getValueSize();I.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(G=W/3);var X=S.times.length-1,ie=void 0;if(c<=S.times[0]){var $=O,ee=U-O;ie=$t.arraySlice(S.values,$,ee)}else if(c>=S.times[X]){var he=X*U+O,oe=he+U-O;ie=$t.arraySlice(S.values,he,oe)}else{var re=S.createInterpolant(),me=O,pe=U-O;re.evaluate(c),ie=$t.arraySlice(re.resultBuffer,me,pe)}L==="quaternion"&&new ni().fromArray(ie).normalize().conjugate().toArray(ie);for(var xe=I.times.length,Ce=0;Ce<xe;++Ce){var Ie=Ce*W+G;if(L==="quaternion")ni.multiplyQuaternionsFlat(I.values,Ie,ie,0,I.values,Ie);else for(var Pe=W-2*G,de=0;de<Pe;++de)I.values[Ie+de]-=ie[de]}},v=0;v<a;++v)m(v);return i.blendMode=Vn,i}};function Qi(o,i,t,e){this.parameterPositions=o,this._cachedIndex=0,this.resultBuffer=e!==void 0?e:new i.constructor(t),this.sampleValues=i,this.valueSize=t}function oo(o,i,t,e){Qi.call(this,o,i,t,e),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Hr(o,i,t,e){Qi.call(this,o,i,t,e)}function lo(o,i,t,e){Qi.call(this,o,i,t,e)}Object.assign(Qi.prototype,{evaluate:function(i){var t=this.parameterPositions,e=this._cachedIndex,s=t[e],a=t[e-1];e:{t:{var c;i:{n:if(!(i<s)){for(var m=e+2;;){if(s===void 0){if(i<a)break n;return e=t.length,this._cachedIndex=e,this.afterEnd_(e-1,i,a)}if(e===m)break;if(a=s,i<(s=t[++e]))break t}c=t.length;break i}if(i>=a)break e;var v=t[1];i<v&&(e=2,a=v);for(var b=e-2;;){if(a===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,s);if(e===b)break;if(s=a,i>=(a=t[--e-1]))break t}c=e,e=0}for(;e<c;){var E=e+c>>>1;i<t[E]?c=E:e=E+1}if(s=t[e],(a=t[e-1])===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,s);if(s===void 0)return e=t.length,this._cachedIndex=e,this.afterEnd_(e-1,a,i)}this._cachedIndex=e,this.intervalChanged_(e,a,s)}return this.interpolate_(e,a,i,s)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(i){for(var t=this.resultBuffer,e=this.sampleValues,s=this.valueSize,a=i*s,c=0;c!==s;++c)t[c]=e[a+c];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Qi.prototype,{beforeStart_:Qi.prototype.copySampleValue_,afterEnd_:Qi.prototype.copySampleValue_}),oo.prototype=Object.assign(Object.create(Qi.prototype),{constructor:oo,DefaultSettings_:{endingStart:Ut,endingEnd:Ut},intervalChanged_:function(i,t,e){var s=this.parameterPositions,a=i-2,c=i+1,m=s[a],v=s[c];if(m===void 0)switch(this.getSettings_().endingStart){case Zt:a=i,m=2*t-e;break;case oi:m=t+s[a=s.length-2]-s[a+1];break;default:a=i,m=e}if(v===void 0)switch(this.getSettings_().endingEnd){case Zt:c=i,v=2*e-t;break;case oi:c=1,v=e+s[1]-s[0];break;default:c=i-1,v=t}var b=.5*(e-t),E=this.valueSize;this._weightPrev=b/(t-m),this._weightNext=b/(v-e),this._offsetPrev=a*E,this._offsetNext=c*E},interpolate_:function(i,t,e,s){for(var a=this.resultBuffer,c=this.sampleValues,m=this.valueSize,v=i*m,b=v-m,E=this._offsetPrev,S=this._offsetNext,L=this._weightPrev,I=this._weightNext,O=(e-t)/(s-t),U=O*O,G=U*O,W=-L*G+2*L*U-L*O,X=(1+L)*G+(-1.5-2*L)*U+(-.5+L)*O+1,ie=(-1-I)*G+(1.5+I)*U+.5*O,$=I*G-I*U,ee=0;ee!==m;++ee)a[ee]=W*c[E+ee]+X*c[b+ee]+ie*c[v+ee]+$*c[S+ee];return a}}),Hr.prototype=Object.assign(Object.create(Qi.prototype),{constructor:Hr,interpolate_:function(i,t,e,s){for(var a=this.resultBuffer,c=this.sampleValues,m=this.valueSize,v=i*m,b=v-m,E=(e-t)/(s-t),S=1-E,L=0;L!==m;++L)a[L]=c[b+L]*S+c[v+L]*E;return a}}),lo.prototype=Object.assign(Object.create(Qi.prototype),{constructor:lo,interpolate_:function(i){return this.copySampleValue_(i-1)}});var yn=function(){function o(t,e,s,a){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=$t.convertArray(e,this.TimeBufferType),this.values=$t.convertArray(s,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}o.toJSON=function(t){var e,s=t.constructor;if(s.toJSON!==this.toJSON)e=s.toJSON(t);else{e={name:t.name,times:$t.convertArray(t.times,Array),values:$t.convertArray(t.values,Array)};var a=t.getInterpolation();a!==t.DefaultInterpolation&&(e.interpolation=a)}return e.type=t.ValueTypeName,e};var i=o.prototype;return i.InterpolantFactoryMethodDiscrete=function(t){return new lo(this.times,this.values,this.getValueSize(),t)},i.InterpolantFactoryMethodLinear=function(t){return new Hr(this.times,this.values,this.getValueSize(),t)},i.InterpolantFactoryMethodSmooth=function(t){return new oo(this.times,this.values,this.getValueSize(),t)},i.setInterpolation=function(t){var e;switch(t){case nt:e=this.InterpolantFactoryMethodDiscrete;break;case $e:e=this.InterpolantFactoryMethodLinear;break;case _t:e=this.InterpolantFactoryMethodSmooth}if(e===void 0){var s="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(t===this.DefaultInterpolation)throw new Error(s);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",s),this}return this.createInterpolant=e,this},i.getInterpolation=function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return nt;case this.InterpolantFactoryMethodLinear:return $e;case this.InterpolantFactoryMethodSmooth:return _t}},i.getValueSize=function(){return this.values.length/this.times.length},i.shift=function(t){if(t!==0)for(var e=this.times,s=0,a=e.length;s!==a;++s)e[s]+=t;return this},i.scale=function(t){if(t!==1)for(var e=this.times,s=0,a=e.length;s!==a;++s)e[s]*=t;return this},i.trim=function(t,e){for(var s=this.times,a=s.length,c=0,m=a-1;c!==a&&s[c]<t;)++c;for(;m!==-1&&s[m]>e;)--m;if(++m,c!==0||m!==a){c>=m&&(c=(m=Math.max(m,1))-1);var v=this.getValueSize();this.times=$t.arraySlice(s,c,m),this.values=$t.arraySlice(this.values,c*v,m*v)}return this},i.validate=function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var s=this.times,a=this.values,c=s.length;c===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var m=null,v=0;v!==c;v++){var b=s[v];if(typeof b=="number"&&isNaN(b)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,v,b),t=!1;break}if(m!==null&&m>b){console.error("THREE.KeyframeTrack: Out of order keys.",this,v,b,m),t=!1;break}m=b}if(a!==void 0&&$t.isTypedArray(a))for(var E=0,S=a.length;E!==S;++E){var L=a[E];if(isNaN(L)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,E,L),t=!1;break}}return t},i.optimize=function(){for(var t=$t.arraySlice(this.times),e=$t.arraySlice(this.values),s=this.getValueSize(),a=this.getInterpolation()===_t,c=t.length-1,m=1,v=1;v<c;++v){var b=!1,E=t[v];if(E!==t[v+1]&&(v!==1||E!==t[0]))if(a)b=!0;else for(var S=v*s,L=S-s,I=S+s,O=0;O!==s;++O){var U=e[S+O];if(U!==e[L+O]||U!==e[I+O]){b=!0;break}}if(b){if(v!==m){t[m]=t[v];for(var G=v*s,W=m*s,X=0;X!==s;++X)e[W+X]=e[G+X]}++m}}if(c>0){t[m]=t[c];for(var ie=c*s,$=m*s,ee=0;ee!==s;++ee)e[$+ee]=e[ie+ee];++m}return m!==t.length?(this.times=$t.arraySlice(t,0,m),this.values=$t.arraySlice(e,0,m*s)):(this.times=t,this.values=e),this},i.clone=function(){var t=$t.arraySlice(this.times,0),e=$t.arraySlice(this.values,0),s=new this.constructor(this.name,t,e);return s.createInterpolant=this.createInterpolant,s},o}();yn.prototype.TimeBufferType=Float32Array,yn.prototype.ValueBufferType=Float32Array,yn.prototype.DefaultInterpolation=$e;var Ts=function(o){function i(){return o.apply(this,arguments)||this}return Ne(i,o),i}(yn);Ts.prototype.ValueTypeName="bool",Ts.prototype.ValueBufferType=Array,Ts.prototype.DefaultInterpolation=nt,Ts.prototype.InterpolantFactoryMethodLinear=void 0,Ts.prototype.InterpolantFactoryMethodSmooth=void 0;var dl=function(o){function i(){return o.apply(this,arguments)||this}return Ne(i,o),i}(yn);dl.prototype.ValueTypeName="color";var Kr=function(o){function i(){return o.apply(this,arguments)||this}return Ne(i,o),i}(yn);function ho(o,i,t,e){Qi.call(this,o,i,t,e)}Kr.prototype.ValueTypeName="number",ho.prototype=Object.assign(Object.create(Qi.prototype),{constructor:ho,interpolate_:function(i,t,e,s){for(var a=this.resultBuffer,c=this.sampleValues,m=this.valueSize,v=(e-t)/(s-t),b=i*m,E=b+m;b!==E;b+=4)ni.slerpFlat(a,0,c,b-m,c,b,v);return a}});var cr=function(o){function i(){return o.apply(this,arguments)||this}return Ne(i,o),i.prototype.InterpolantFactoryMethodLinear=function(t){return new ho(this.times,this.values,this.getValueSize(),t)},i}(yn);cr.prototype.ValueTypeName="quaternion",cr.prototype.DefaultInterpolation=$e,cr.prototype.InterpolantFactoryMethodSmooth=void 0;var Ls=function(o){function i(){return o.apply(this,arguments)||this}return Ne(i,o),i}(yn);Ls.prototype.ValueTypeName="string",Ls.prototype.ValueBufferType=Array,Ls.prototype.DefaultInterpolation=nt,Ls.prototype.InterpolantFactoryMethodLinear=void 0,Ls.prototype.InterpolantFactoryMethodSmooth=void 0;var Yr=function(o){function i(){return o.apply(this,arguments)||this}return Ne(i,o),i}(yn);Yr.prototype.ValueTypeName="vector";var Xr=function(){function o(t,e,s,a){e===void 0&&(e=-1),a===void 0&&(a=Nt),this.name=t,this.tracks=s,this.duration=e,this.blendMode=a,this.uuid=dt.generateUUID(),this.duration<0&&this.resetDuration()}o.parse=function(t){for(var e=[],s=t.tracks,a=1/(t.fps||1),c=0,m=s.length;c!==m;++c)e.push(zd(s[c]).scale(a));var v=new this(t.name,t.duration,e,t.blendMode);return v.uuid=t.uuid,v},o.toJSON=function(t){for(var e=[],s=t.tracks,a={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode},c=0,m=s.length;c!==m;++c)e.push(yn.toJSON(s[c]));return a},o.CreateFromMorphTargetSequence=function(t,e,s,a){for(var c=e.length,m=[],v=0;v<c;v++){var b=[],E=[];b.push((v+c-1)%c,v,(v+1)%c),E.push(0,1,0);var S=$t.getKeyframeOrder(b);b=$t.sortedArray(b,1,S),E=$t.sortedArray(E,1,S),a||b[0]!==0||(b.push(c),E.push(E[0])),m.push(new Kr(".morphTargetInfluences["+e[v].name+"]",b,E).scale(1/s))}return new this(t,-1,m)},o.findByName=function(t,e){var s=t;if(!Array.isArray(t)){var a=t;s=a.geometry&&a.geometry.animations||a.animations}for(var c=0;c<s.length;c++)if(s[c].name===e)return s[c];return null},o.CreateClipsFromMorphTargetSequences=function(t,e,s){for(var a={},c=/^([\w-]*?)([\d]+)$/,m=0,v=t.length;m<v;m++){var b=t[m],E=b.name.match(c);if(E&&E.length>1){var S=E[1],L=a[S];L||(a[S]=L=[]),L.push(b)}}var I=[];for(var O in a)I.push(this.CreateFromMorphTargetSequence(O,a[O],e,s));return I},o.parseAnimation=function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var s=function(oe,re,me,pe,xe){if(me.length!==0){var Ce=[],Ie=[];$t.flattenJSON(me,Ce,Ie,pe),Ce.length!==0&&xe.push(new oe(re,Ce,Ie))}},a=[],c=t.name||"default",m=t.fps||30,v=t.blendMode,b=t.length||-1,E=t.hierarchy||[],S=0;S<E.length;S++){var L=E[S].keys;if(L&&L.length!==0)if(L[0].morphTargets){var I={},O=void 0;for(O=0;O<L.length;O++)if(L[O].morphTargets)for(var U=0;U<L[O].morphTargets.length;U++)I[L[O].morphTargets[U]]=-1;for(var G in I){for(var W=[],X=[],ie=0;ie!==L[O].morphTargets.length;++ie){var $=L[O];W.push($.time),X.push($.morphTarget===G?1:0)}a.push(new Kr(".morphTargetInfluence["+G+"]",W,X))}b=I.length*(m||1)}else{var ee=".bones["+e[S].name+"]";s(Yr,ee+".position",L,"pos",a),s(cr,ee+".quaternion",L,"rot",a),s(Yr,ee+".scale",L,"scl",a)}}return a.length===0?null:new this(c,b,a,v)};var i=o.prototype;return i.resetDuration=function(){for(var t=0,e=0,s=this.tracks.length;e!==s;++e){var a=this.tracks[e];t=Math.max(t,a.times[a.times.length-1])}return this.duration=t,this},i.trim=function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},i.validate=function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},i.optimize=function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},i.clone=function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)},i.toJSON=function(){return this.constructor.toJSON(this)},o}();function zd(o){if(o.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var i=function(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Kr;case"vector":case"vector2":case"vector3":case"vector4":return Yr;case"color":return dl;case"quaternion":return cr;case"bool":case"boolean":return Ts;case"string":return Ls}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}(o.type);if(o.times===void 0){var t=[],e=[];$t.flattenJSON(o.keys,t,e,"value"),o.times=t,o.values=e}return i.parse!==void 0?i.parse(o):new i(o.name,o.times,o.values,o.interpolation)}var Ps={enabled:!1,files:{},add:function(i,t){this.enabled!==!1&&(this.files[i]=t)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};function fl(o,i,t){var e=this,s=!1,a=0,c=0,m=void 0,v=[];this.onStart=void 0,this.onLoad=o,this.onProgress=i,this.onError=t,this.itemStart=function(b){c++,s===!1&&e.onStart!==void 0&&e.onStart(b,a,c),s=!0},this.itemEnd=function(b){a++,e.onProgress!==void 0&&e.onProgress(b,a,c),a===c&&(s=!1,e.onLoad!==void 0&&e.onLoad())},this.itemError=function(b){e.onError!==void 0&&e.onError(b)},this.resolveURL=function(b){return m?m(b):b},this.setURLModifier=function(b){return m=b,this},this.addHandler=function(b,E){return v.push(b,E),this},this.removeHandler=function(b){var E=v.indexOf(b);return E!==-1&&v.splice(E,2),this},this.getHandler=function(b){for(var E=0,S=v.length;E<S;E+=2){var L=v[E],I=v[E+1];if(L.global&&(L.lastIndex=0),L.test(b))return I}return null}}var Qh=new fl;function si(o){this.manager=o!==void 0?o:Qh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(si.prototype,{load:function(){},loadAsync:function(i,t){var e=this;return new Promise(function(s,a){e.load(i,s,t,a)})},parse:function(){},setCrossOrigin:function(i){return this.crossOrigin=i,this},setWithCredentials:function(i){return this.withCredentials=i,this},setPath:function(i){return this.path=i,this},setResourcePath:function(i){return this.resourcePath=i,this},setRequestHeader:function(i){return this.requestHeader=i,this}});var bn={};function cn(o){si.call(this,o)}cn.prototype=Object.assign(Object.create(si.prototype),{constructor:cn,load:function(i,t,e,s){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);var a=this,c=Ps.get(i);if(c!==void 0)return a.manager.itemStart(i),setTimeout(function(){t&&t(c),a.manager.itemEnd(i)},0),c;if(bn[i]===void 0){var m,v=i.match(/^data:(.*?)(;base64)?,(.*)$/);if(v){var b=v[1],E=!!v[2],S=v[3];S=decodeURIComponent(S),E&&(S=atob(S));try{var L,I=(this.responseType||"").toLowerCase();switch(I){case"arraybuffer":case"blob":for(var O=new Uint8Array(S.length),U=0;U<S.length;U++)O[U]=S.charCodeAt(U);L=I==="blob"?new Blob([O.buffer],{type:b}):O.buffer;break;case"document":var G=new DOMParser;L=G.parseFromString(S,b);break;case"json":L=JSON.parse(S);break;default:L=S}setTimeout(function(){t&&t(L),a.manager.itemEnd(i)},0)}catch(X){setTimeout(function(){s&&s(X),a.manager.itemError(i),a.manager.itemEnd(i)},0)}}else{for(var W in bn[i]=[],bn[i].push({onLoad:t,onProgress:e,onError:s}),(m=new XMLHttpRequest).open("GET",i,!0),m.addEventListener("load",function(X){var ie=this.response,$=bn[i];if(delete bn[i],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Ps.add(i,ie);for(var ee=0,he=$.length;ee<he;ee++){var oe=$[ee];oe.onLoad&&oe.onLoad(ie)}a.manager.itemEnd(i)}else{for(var re=0,me=$.length;re<me;re++){var pe=$[re];pe.onError&&pe.onError(X)}a.manager.itemError(i),a.manager.itemEnd(i)}},!1),m.addEventListener("progress",function(X){for(var ie=bn[i],$=0,ee=ie.length;$<ee;$++){var he=ie[$];he.onProgress&&he.onProgress(X)}},!1),m.addEventListener("error",function(X){var ie=bn[i];delete bn[i];for(var $=0,ee=ie.length;$<ee;$++){var he=ie[$];he.onError&&he.onError(X)}a.manager.itemError(i),a.manager.itemEnd(i)},!1),m.addEventListener("abort",function(X){var ie=bn[i];delete bn[i];for(var $=0,ee=ie.length;$<ee;$++){var he=ie[$];he.onError&&he.onError(X)}a.manager.itemError(i),a.manager.itemEnd(i)},!1),this.responseType!==void 0&&(m.responseType=this.responseType),this.withCredentials!==void 0&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(W,this.requestHeader[W]);m.send(null)}return a.manager.itemStart(i),m}bn[i].push({onLoad:t,onProgress:e,onError:s})},setResponseType:function(i){return this.responseType=i,this},setMimeType:function(i){return this.mimeType=i,this}});var Ud=function(o){function i(e){return o.call(this,e)||this}Ne(i,o);var t=i.prototype;return t.load=function(e,s,a,c){var m=this,v=new cn(this.manager);v.setPath(this.path),v.setRequestHeader(this.requestHeader),v.setWithCredentials(this.withCredentials),v.load(e,function(b){try{s(m.parse(JSON.parse(b)))}catch(E){c?c(E):console.error(E),m.manager.itemError(e)}},a,c)},t.parse=function(e){for(var s=[],a=0;a<e.length;a++){var c=Xr.parse(e[a]);s.push(c)}return s},i}(si);function pl(o){si.call(this,o)}pl.prototype=Object.assign(Object.create(si.prototype),{constructor:pl,load:function(i,t,e,s){var a=this,c=[],m=new el,v=new cn(this.manager);v.setPath(this.path),v.setResponseType("arraybuffer"),v.setRequestHeader(this.requestHeader),v.setWithCredentials(a.withCredentials);var b=0;function E(I){v.load(i[I],function(O){var U=a.parse(O,!0);c[I]={width:U.width,height:U.height,format:U.format,mipmaps:U.mipmaps},(b+=1)===6&&(U.mipmapCount===1&&(m.minFilter=T),m.image=c,m.format=U.format,m.needsUpdate=!0,t&&t(m))},e,s)}if(Array.isArray(i))for(var S=0,L=i.length;S<L;++S)E(S);else v.load(i,function(I){var O=a.parse(I,!0);if(O.isCubemap){for(var U=O.mipmaps.length/O.mipmapCount,G=0;G<U;G++){c[G]={mipmaps:[]};for(var W=0;W<O.mipmapCount;W++)c[G].mipmaps.push(O.mipmaps[G*O.mipmapCount+W]),c[G].format=O.format,c[G].width=O.width,c[G].height=O.height}m.image=c}else m.image.width=O.width,m.image.height=O.height,m.mipmaps=O.mipmaps;O.mipmapCount===1&&(m.minFilter=T),m.format=O.format,m.needsUpdate=!0,t&&t(m)},e,s);return m}});var co=function(o){function i(t){return o.call(this,t)||this}return Ne(i,o),i.prototype.load=function(t,e,s,a){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var c=this,m=Ps.get(t);if(m!==void 0)return c.manager.itemStart(t),setTimeout(function(){e&&e(m),c.manager.itemEnd(t)},0),m;var v=document.createElementNS("http://www.w3.org/1999/xhtml","img");function b(){v.removeEventListener("load",b,!1),v.removeEventListener("error",E,!1),Ps.add(t,this),e&&e(this),c.manager.itemEnd(t)}function E(S){v.removeEventListener("load",b,!1),v.removeEventListener("error",E,!1),a&&a(S),c.manager.itemError(t),c.manager.itemEnd(t)}return v.addEventListener("load",b,!1),v.addEventListener("error",E,!1),t.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(v.crossOrigin=this.crossOrigin),c.manager.itemStart(t),v.src=t,v},i}(si),Jh=function(o){function i(t){return o.call(this,t)||this}return Ne(i,o),i.prototype.load=function(t,e,s,a){var c=new Qs,m=new co(this.manager);m.setCrossOrigin(this.crossOrigin),m.setPath(this.path);var v=0;function b(S){m.load(t[S],function(L){c.images[S]=L,++v===6&&(c.needsUpdate=!0,e&&e(c))},void 0,a)}for(var E=0;E<t.length;++E)b(E);return c},i}(si);function uo(o){si.call(this,o)}function fo(o){si.call(this,o)}function Ni(){this.type="Curve",this.arcLengthDivisions=200}uo.prototype=Object.assign(Object.create(si.prototype),{constructor:uo,load:function(i,t,e,s){var a=this,c=new Js,m=new cn(this.manager);return m.setResponseType("arraybuffer"),m.setRequestHeader(this.requestHeader),m.setPath(this.path),m.setWithCredentials(a.withCredentials),m.load(i,function(v){var b=a.parse(v);b&&(b.image!==void 0?c.image=b.image:b.data!==void 0&&(c.image.width=b.width,c.image.height=b.height,c.image.data=b.data),c.wrapS=b.wrapS!==void 0?b.wrapS:p,c.wrapT=b.wrapT!==void 0?b.wrapT:p,c.magFilter=b.magFilter!==void 0?b.magFilter:T,c.minFilter=b.minFilter!==void 0?b.minFilter:T,c.anisotropy=b.anisotropy!==void 0?b.anisotropy:1,b.encoding!==void 0&&(c.encoding=b.encoding),b.flipY!==void 0&&(c.flipY=b.flipY),b.format!==void 0&&(c.format=b.format),b.type!==void 0&&(c.type=b.type),b.mipmaps!==void 0&&(c.mipmaps=b.mipmaps,c.minFilter=C),b.mipmapCount===1&&(c.minFilter=T),c.needsUpdate=!0,t&&t(c,b))},e,s),c}}),fo.prototype=Object.assign(Object.create(si.prototype),{constructor:fo,load:function(i,t,e,s){var a=new ui,c=new co(this.manager);return c.setCrossOrigin(this.crossOrigin),c.setPath(this.path),c.load(i,function(m){a.image=m;var v=i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0;a.format=v?Y:k,a.needsUpdate=!0,t!==void 0&&t(a)},e,s),a}}),Object.assign(Ni.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(i,t){var e=this.getUtoTmapping(i);return this.getPoint(e,t)},getPoints:function(i){i===void 0&&(i=5);for(var t=[],e=0;e<=i;e++)t.push(this.getPoint(e/i));return t},getSpacedPoints:function(i){i===void 0&&(i=5);for(var t=[],e=0;e<=i;e++)t.push(this.getPointAt(e/i));return t},getLength:function(){var i=this.getLengths();return i[i.length-1]},getLengths:function(i){if(i===void 0&&(i=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===i+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,e=[],s=this.getPoint(0),a=0;e.push(0);for(var c=1;c<=i;c++)a+=(t=this.getPoint(c/i)).distanceTo(s),e.push(a),s=t;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(i,t){var e,s=this.getLengths(),a=0,c=s.length;e=t||i*s[c-1];for(var m,v=0,b=c-1;v<=b;)if((m=s[a=Math.floor(v+(b-v)/2)]-e)<0)v=a+1;else{if(!(m>0)){b=a;break}b=a-1}if(s[a=b]===e)return a/(c-1);var E=s[a];return(a+(e-E)/(s[a+1]-E))/(c-1)},getTangent:function(i,t){var e=1e-4,s=i-e,a=i+e;s<0&&(s=0),a>1&&(a=1);var c=this.getPoint(s),m=this.getPoint(a),v=t||(c.isVector2?new He:new se);return v.copy(m).sub(c).normalize(),v},getTangentAt:function(i,t){var e=this.getUtoTmapping(i);return this.getTangent(e,t)},computeFrenetFrames:function(i,t){for(var e=new se,s=[],a=[],c=[],m=new se,v=new ht,b=0;b<=i;b++){var E=b/i;s[b]=this.getTangentAt(E,new se),s[b].normalize()}a[0]=new se,c[0]=new se;var S=Number.MAX_VALUE,L=Math.abs(s[0].x),I=Math.abs(s[0].y),O=Math.abs(s[0].z);L<=S&&(S=L,e.set(1,0,0)),I<=S&&(S=I,e.set(0,1,0)),O<=S&&e.set(0,0,1),m.crossVectors(s[0],e).normalize(),a[0].crossVectors(s[0],m),c[0].crossVectors(s[0],a[0]);for(var U=1;U<=i;U++){if(a[U]=a[U-1].clone(),c[U]=c[U-1].clone(),m.crossVectors(s[U-1],s[U]),m.length()>Number.EPSILON){m.normalize();var G=Math.acos(dt.clamp(s[U-1].dot(s[U]),-1,1));a[U].applyMatrix4(v.makeRotationAxis(m,G))}c[U].crossVectors(s[U],a[U])}if(t===!0){var W=Math.acos(dt.clamp(a[0].dot(a[i]),-1,1));W/=i,s[0].dot(m.crossVectors(a[0],a[i]))>0&&(W=-W);for(var X=1;X<=i;X++)a[X].applyMatrix4(v.makeRotationAxis(s[X],W*X)),c[X].crossVectors(s[X],a[X])}return{tangents:s,normals:a,binormals:c}},clone:function(){return new this.constructor().copy(this)},copy:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this},toJSON:function(){var i={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return i.arcLengthDivisions=this.arcLengthDivisions,i.type=this.type,i},fromJSON:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}});var Zr=function(o){function i(e,s,a,c,m,v,b,E){var S;return e===void 0&&(e=0),s===void 0&&(s=0),a===void 0&&(a=1),c===void 0&&(c=1),m===void 0&&(m=0),v===void 0&&(v=2*Math.PI),b===void 0&&(b=!1),E===void 0&&(E=0),(S=o.call(this)||this).type="EllipseCurve",S.aX=e,S.aY=s,S.xRadius=a,S.yRadius=c,S.aStartAngle=m,S.aEndAngle=v,S.aClockwise=b,S.aRotation=E,S}Ne(i,o);var t=i.prototype;return t.getPoint=function(e,s){for(var a=s||new He,c=2*Math.PI,m=this.aEndAngle-this.aStartAngle,v=Math.abs(m)<Number.EPSILON;m<0;)m+=c;for(;m>c;)m-=c;m<Number.EPSILON&&(m=v?0:c),this.aClockwise!==!0||v||(m===c?m=-c:m-=c);var b=this.aStartAngle+e*m,E=this.aX+this.xRadius*Math.cos(b),S=this.aY+this.yRadius*Math.sin(b);if(this.aRotation!==0){var L=Math.cos(this.aRotation),I=Math.sin(this.aRotation),O=E-this.aX,U=S-this.aY;E=O*L-U*I+this.aX,S=O*I+U*L+this.aY}return a.set(E,S)},t.copy=function(e){return o.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},t.fromJSON=function(e){return o.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},i}(Ni);Zr.prototype.isEllipseCurve=!0;var ml=function(o){function i(t,e,s,a,c,m){var v;return(v=o.call(this,t,e,s,s,a,c,m)||this).type="ArcCurve",v}return Ne(i,o),i}(Zr);function _l(){var o=0,i=0,t=0,e=0;function s(a,c,m,v){o=a,i=m,t=-3*a+3*c-2*m-v,e=2*a-2*c+m+v}return{initCatmullRom:function(c,m,v,b,E){s(m,v,E*(v-c),E*(b-m))},initNonuniformCatmullRom:function(c,m,v,b,E,S,L){var I=(m-c)/E-(v-c)/(E+S)+(v-m)/S,O=(v-m)/S-(b-m)/(S+L)+(b-v)/L;s(m,v,I*=S,O*=S)},calc:function(c){var m=c*c;return o+i*c+t*m+e*(m*c)}}}ml.prototype.isArcCurve=!0;var po=new se,gl=new _l,vl=new _l,yl=new _l,bl=function(o){function i(e,s,a,c){var m;return e===void 0&&(e=[]),s===void 0&&(s=!1),a===void 0&&(a="centripetal"),c===void 0&&(c=.5),(m=o.call(this)||this).type="CatmullRomCurve3",m.points=e,m.closed=s,m.curveType=a,m.tension=c,m}Ne(i,o);var t=i.prototype;return t.getPoint=function(e,s){s===void 0&&(s=new se);var a,c,m=s,v=this.points,b=v.length,E=(b-(this.closed?0:1))*e,S=Math.floor(E),L=E-S;this.closed?S+=S>0?0:(Math.floor(Math.abs(S)/b)+1)*b:L===0&&S===b-1&&(S=b-2,L=1),this.closed||S>0?a=v[(S-1)%b]:(po.subVectors(v[0],v[1]).add(v[0]),a=po);var I=v[S%b],O=v[(S+1)%b];if(this.closed||S+2<b?c=v[(S+2)%b]:(po.subVectors(v[b-1],v[b-2]).add(v[b-1]),c=po),this.curveType==="centripetal"||this.curveType==="chordal"){var U=this.curveType==="chordal"?.5:.25,G=Math.pow(a.distanceToSquared(I),U),W=Math.pow(I.distanceToSquared(O),U),X=Math.pow(O.distanceToSquared(c),U);W<1e-4&&(W=1),G<1e-4&&(G=W),X<1e-4&&(X=W),gl.initNonuniformCatmullRom(a.x,I.x,O.x,c.x,G,W,X),vl.initNonuniformCatmullRom(a.y,I.y,O.y,c.y,G,W,X),yl.initNonuniformCatmullRom(a.z,I.z,O.z,c.z,G,W,X)}else this.curveType==="catmullrom"&&(gl.initCatmullRom(a.x,I.x,O.x,c.x,this.tension),vl.initCatmullRom(a.y,I.y,O.y,c.y,this.tension),yl.initCatmullRom(a.z,I.z,O.z,c.z,this.tension));return m.set(gl.calc(L),vl.calc(L),yl.calc(L)),m},t.copy=function(e){o.prototype.copy.call(this,e),this.points=[];for(var s=0,a=e.points.length;s<a;s++){var c=e.points[s];this.points.push(c.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);e.points=[];for(var s=0,a=this.points.length;s<a;s++){var c=this.points[s];e.points.push(c.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},t.fromJSON=function(e){o.prototype.fromJSON.call(this,e),this.points=[];for(var s=0,a=e.points.length;s<a;s++){var c=e.points[s];this.points.push(new se().fromArray(c))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},i}(Ni);function $h(o,i,t,e,s){var a=.5*(e-i),c=.5*(s-t),m=o*o;return(2*t-2*e+a+c)*(o*m)+(-3*t+3*e-2*a-c)*m+a*o+t}function qr(o,i,t,e){return function(s,a){var c=1-s;return c*c*a}(o,i)+function(s,a){return 2*(1-s)*s*a}(o,t)+function(s,a){return s*s*a}(o,e)}function Qr(o,i,t,e,s){return function(a,c){var m=1-a;return m*m*m*c}(o,i)+function(a,c){var m=1-a;return 3*m*m*a*c}(o,t)+function(a,c){return 3*(1-a)*a*a*c}(o,e)+function(a,c){return a*a*a*c}(o,s)}bl.prototype.isCatmullRomCurve3=!0;var mo=function(o){function i(e,s,a,c){var m;return e===void 0&&(e=new He),s===void 0&&(s=new He),a===void 0&&(a=new He),c===void 0&&(c=new He),(m=o.call(this)||this).type="CubicBezierCurve",m.v0=e,m.v1=s,m.v2=a,m.v3=c,m}Ne(i,o);var t=i.prototype;return t.getPoint=function(e,s){s===void 0&&(s=new He);var a=s,c=this.v0,m=this.v1,v=this.v2,b=this.v3;return a.set(Qr(e,c.x,m.x,v.x,b.x),Qr(e,c.y,m.y,v.y,b.y)),a},t.copy=function(e){return o.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},t.fromJSON=function(e){return o.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},i}(Ni);mo.prototype.isCubicBezierCurve=!0;var xl=function(o){function i(e,s,a,c){var m;return e===void 0&&(e=new se),s===void 0&&(s=new se),a===void 0&&(a=new se),c===void 0&&(c=new se),(m=o.call(this)||this).type="CubicBezierCurve3",m.v0=e,m.v1=s,m.v2=a,m.v3=c,m}Ne(i,o);var t=i.prototype;return t.getPoint=function(e,s){s===void 0&&(s=new se);var a=s,c=this.v0,m=this.v1,v=this.v2,b=this.v3;return a.set(Qr(e,c.x,m.x,v.x,b.x),Qr(e,c.y,m.y,v.y,b.y),Qr(e,c.z,m.z,v.z,b.z)),a},t.copy=function(e){return o.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},t.fromJSON=function(e){return o.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},i}(Ni);xl.prototype.isCubicBezierCurve3=!0;var Jr=function(o){function i(e,s){var a;return e===void 0&&(e=new He),s===void 0&&(s=new He),(a=o.call(this)||this).type="LineCurve",a.v1=e,a.v2=s,a}Ne(i,o);var t=i.prototype;return t.getPoint=function(e,s){s===void 0&&(s=new He);var a=s;return e===1?a.copy(this.v2):(a.copy(this.v2).sub(this.v1),a.multiplyScalar(e).add(this.v1)),a},t.getPointAt=function(e,s){return this.getPoint(e,s)},t.getTangent=function(e,s){var a=s||new He;return a.copy(this.v2).sub(this.v1).normalize(),a},t.copy=function(e){return o.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},t.fromJSON=function(e){return o.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},i}(Ni);Jr.prototype.isLineCurve=!0;var ec=function(o){function i(e,s){var a;return e===void 0&&(e=new se),s===void 0&&(s=new se),(a=o.call(this)||this).type="LineCurve3",a.isLineCurve3=!0,a.v1=e,a.v2=s,a}Ne(i,o);var t=i.prototype;return t.getPoint=function(e,s){s===void 0&&(s=new se);var a=s;return e===1?a.copy(this.v2):(a.copy(this.v2).sub(this.v1),a.multiplyScalar(e).add(this.v1)),a},t.getPointAt=function(e,s){return this.getPoint(e,s)},t.copy=function(e){return o.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},t.fromJSON=function(e){return o.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},i}(Ni),_o=function(o){function i(e,s,a){var c;return e===void 0&&(e=new He),s===void 0&&(s=new He),a===void 0&&(a=new He),(c=o.call(this)||this).type="QuadraticBezierCurve",c.v0=e,c.v1=s,c.v2=a,c}Ne(i,o);var t=i.prototype;return t.getPoint=function(e,s){s===void 0&&(s=new He);var a=s,c=this.v0,m=this.v1,v=this.v2;return a.set(qr(e,c.x,m.x,v.x),qr(e,c.y,m.y,v.y)),a},t.copy=function(e){return o.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},t.fromJSON=function(e){return o.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},i}(Ni);_o.prototype.isQuadraticBezierCurve=!0;var wl=function(o){function i(e,s,a){var c;return e===void 0&&(e=new se),s===void 0&&(s=new se),a===void 0&&(a=new se),(c=o.call(this)||this).type="QuadraticBezierCurve3",c.v0=e,c.v1=s,c.v2=a,c}Ne(i,o);var t=i.prototype;return t.getPoint=function(e,s){s===void 0&&(s=new se);var a=s,c=this.v0,m=this.v1,v=this.v2;return a.set(qr(e,c.x,m.x,v.x),qr(e,c.y,m.y,v.y),qr(e,c.z,m.z,v.z)),a},t.copy=function(e){return o.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},t.fromJSON=function(e){return o.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},i}(Ni);wl.prototype.isQuadraticBezierCurve3=!0;var go=function(o){function i(e){var s;return e===void 0&&(e=[]),(s=o.call(this)||this).type="SplineCurve",s.points=e,s}Ne(i,o);var t=i.prototype;return t.getPoint=function(e,s){s===void 0&&(s=new He);var a=s,c=this.points,m=(c.length-1)*e,v=Math.floor(m),b=m-v,E=c[v===0?v:v-1],S=c[v],L=c[v>c.length-2?c.length-1:v+1],I=c[v>c.length-3?c.length-1:v+2];return a.set($h(b,E.x,S.x,L.x,I.x),$h(b,E.y,S.y,L.y,I.y)),a},t.copy=function(e){o.prototype.copy.call(this,e),this.points=[];for(var s=0,a=e.points.length;s<a;s++){var c=e.points[s];this.points.push(c.clone())}return this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);e.points=[];for(var s=0,a=this.points.length;s<a;s++){var c=this.points[s];e.points.push(c.toArray())}return e},t.fromJSON=function(e){o.prototype.fromJSON.call(this,e),this.points=[];for(var s=0,a=e.points.length;s<a;s++){var c=e.points[s];this.points.push(new He().fromArray(c))}return this},i}(Ni);go.prototype.isSplineCurve=!0;var Sl=Object.freeze({__proto__:null,ArcCurve:ml,CatmullRomCurve3:bl,CubicBezierCurve:mo,CubicBezierCurve3:xl,EllipseCurve:Zr,LineCurve:Jr,LineCurve3:ec,QuadraticBezierCurve:_o,QuadraticBezierCurve3:wl,SplineCurve:go}),tc=function(o){function i(){var e;return(e=o.call(this)||this).type="CurvePath",e.curves=[],e.autoClose=!1,e}Ne(i,o);var t=i.prototype;return t.add=function(e){this.curves.push(e)},t.closePath=function(){var e=this.curves[0].getPoint(0),s=this.curves[this.curves.length-1].getPoint(1);e.equals(s)||this.curves.push(new Jr(s,e))},t.getPoint=function(e){for(var s=e*this.getLength(),a=this.getCurveLengths(),c=0;c<a.length;){if(a[c]>=s){var m=a[c]-s,v=this.curves[c],b=v.getLength(),E=b===0?0:1-m/b;return v.getPointAt(E)}c++}return null},t.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},t.updateArcLengths=function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},t.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],s=0,a=0,c=this.curves.length;a<c;a++)s+=this.curves[a].getLength(),e.push(s);return this.cacheLengths=e,e},t.getSpacedPoints=function(e){e===void 0&&(e=40);for(var s=[],a=0;a<=e;a++)s.push(this.getPoint(a/e));return this.autoClose&&s.push(s[0]),s},t.getPoints=function(e){e===void 0&&(e=12);for(var s,a=[],c=0,m=this.curves;c<m.length;c++)for(var v=m[c],b=v&&v.isEllipseCurve?2*e:v&&(v.isLineCurve||v.isLineCurve3)?1:v&&v.isSplineCurve?e*v.points.length:e,E=v.getPoints(b),S=0;S<E.length;S++){var L=E[S];s&&s.equals(L)||(a.push(L),s=L)}return this.autoClose&&a.length>1&&!a[a.length-1].equals(a[0])&&a.push(a[0]),a},t.copy=function(e){o.prototype.copy.call(this,e),this.curves=[];for(var s=0,a=e.curves.length;s<a;s++){var c=e.curves[s];this.curves.push(c.clone())}return this.autoClose=e.autoClose,this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var s=0,a=this.curves.length;s<a;s++){var c=this.curves[s];e.curves.push(c.toJSON())}return e},t.fromJSON=function(e){o.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var s=0,a=e.curves.length;s<a;s++){var c=e.curves[s];this.curves.push(new Sl[c.type]().fromJSON(c))}return this},i}(Ni),$r=function(o){function i(e){var s;return(s=o.call(this)||this).type="Path",s.currentPoint=new He,e&&s.setFromPoints(e),s}Ne(i,o);var t=i.prototype;return t.setFromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var s=1,a=e.length;s<a;s++)this.lineTo(e[s].x,e[s].y);return this},t.moveTo=function(e,s){return this.currentPoint.set(e,s),this},t.lineTo=function(e,s){var a=new Jr(this.currentPoint.clone(),new He(e,s));return this.curves.push(a),this.currentPoint.set(e,s),this},t.quadraticCurveTo=function(e,s,a,c){var m=new _o(this.currentPoint.clone(),new He(e,s),new He(a,c));return this.curves.push(m),this.currentPoint.set(a,c),this},t.bezierCurveTo=function(e,s,a,c,m,v){var b=new mo(this.currentPoint.clone(),new He(e,s),new He(a,c),new He(m,v));return this.curves.push(b),this.currentPoint.set(m,v),this},t.splineThru=function(e){var s=[this.currentPoint.clone()].concat(e),a=new go(s);return this.curves.push(a),this.currentPoint.copy(e[e.length-1]),this},t.arc=function(e,s,a,c,m,v){var b=this.currentPoint.x,E=this.currentPoint.y;return this.absarc(e+b,s+E,a,c,m,v),this},t.absarc=function(e,s,a,c,m,v){return this.absellipse(e,s,a,a,c,m,v),this},t.ellipse=function(e,s,a,c,m,v,b,E){var S=this.currentPoint.x,L=this.currentPoint.y;return this.absellipse(e+S,s+L,a,c,m,v,b,E),this},t.absellipse=function(e,s,a,c,m,v,b,E){var S=new Zr(e,s,a,c,m,v,b,E);if(this.curves.length>0){var L=S.getPoint(0);L.equals(this.currentPoint)||this.lineTo(L.x,L.y)}this.curves.push(S);var I=S.getPoint(1);return this.currentPoint.copy(I),this},t.copy=function(e){return o.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},t.fromJSON=function(e){return o.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this},i}(tc),us=function(o){function i(e){var s;return(s=o.call(this,e)||this).uuid=dt.generateUUID(),s.type="Shape",s.holes=[],s}Ne(i,o);var t=i.prototype;return t.getPointsHoles=function(e){for(var s=[],a=0,c=this.holes.length;a<c;a++)s[a]=this.holes[a].getPoints(e);return s},t.extractPoints=function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},t.copy=function(e){o.prototype.copy.call(this,e),this.holes=[];for(var s=0,a=e.holes.length;s<a;s++){var c=e.holes[s];this.holes.push(c.clone())}return this},t.toJSON=function(){var e=o.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var s=0,a=this.holes.length;s<a;s++){var c=this.holes[s];e.holes.push(c.toJSON())}return e},t.fromJSON=function(e){o.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var s=0,a=e.holes.length;s<a;s++){var c=e.holes[s];this.holes.push(new $r().fromJSON(c))}return this},i}($r),xn=function(o){function i(e,s){var a;return s===void 0&&(s=1),(a=o.call(this)||this).type="Light",a.color=new st(e),a.intensity=s,a}Ne(i,o);var t=i.prototype;return t.copy=function(e){return o.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},t.toJSON=function(e){var s=o.prototype.toJSON.call(this,e);return s.object.color=this.color.getHex(),s.object.intensity=this.intensity,this.groundColor!==void 0&&(s.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(s.object.distance=this.distance),this.angle!==void 0&&(s.object.angle=this.angle),this.decay!==void 0&&(s.object.decay=this.decay),this.penumbra!==void 0&&(s.object.penumbra=this.penumbra),this.shadow!==void 0&&(s.object.shadow=this.shadow.toJSON()),s},i}(Ke);xn.prototype.isLight=!0;var El=function(o){function i(t,e,s){var a;return(a=o.call(this,t,s)||this).type="HemisphereLight",a.position.copy(Ke.DefaultUp),a.updateMatrix(),a.groundColor=new st(e),a}return Ne(i,o),i.prototype.copy=function(t){return xn.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this},i}(xn);El.prototype.isHemisphereLight=!0;var ic=new ht,nc=new se,sc=new se,Al=function(){function o(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new He(512,512),this.map=null,this.mapPass=null,this.matrix=new ht,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Tr,this._frameExtents=new He(1,1),this._viewportCount=1,this._viewports=[new Ft(0,0,1,1)]}var i=o.prototype;return i.getViewportCount=function(){return this._viewportCount},i.getFrustum=function(){return this._frustum},i.updateMatrices=function(t){var e=this.camera,s=this.matrix;nc.setFromMatrixPosition(t.matrixWorld),e.position.copy(nc),sc.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(sc),e.updateMatrixWorld(),ic.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ic),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(e.projectionMatrix),s.multiply(e.matrixWorldInverse)},i.getViewport=function(t){return this._viewports[t]},i.getFrameExtents=function(){return this._frameExtents},i.copy=function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},i.clone=function(){return new this.constructor().copy(this)},i.toJSON=function(){var t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t},o}(),rc=function(o){function i(){var t;return(t=o.call(this,new di(50,1,.5,500))||this).focus=1,t}return Ne(i,o),i.prototype.updateMatrices=function(t){var e=this.camera,s=2*dt.RAD2DEG*t.angle*this.focus,a=this.mapSize.width/this.mapSize.height,c=t.distance||e.far;s===e.fov&&a===e.aspect&&c===e.far||(e.fov=s,e.aspect=a,e.far=c,e.updateProjectionMatrix()),o.prototype.updateMatrices.call(this,t)},i}(Al);rc.prototype.isSpotLightShadow=!0;var Cl=function(o){function i(t,e,s,a,c,m){var v;return s===void 0&&(s=0),a===void 0&&(a=Math.PI/3),c===void 0&&(c=0),m===void 0&&(m=1),(v=o.call(this,t,e)||this).type="SpotLight",v.position.copy(Ke.DefaultUp),v.updateMatrix(),v.target=new Ke,v.distance=s,v.angle=a,v.penumbra=c,v.decay=m,v.shadow=new rc,v}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this},gi(i,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}]),i}(xn);Cl.prototype.isSpotLight=!0;var ac=new ht,ea=new se,Ml=new se,oc=function(o){function i(){var t;return(t=o.call(this,new di(90,1,.5,500))||this)._frameExtents=new He(4,2),t._viewportCount=6,t._viewports=[new Ft(2,1,1,1),new Ft(0,1,1,1),new Ft(3,1,1,1),new Ft(1,1,1,1),new Ft(3,0,1,1),new Ft(1,0,1,1)],t._cubeDirections=[new se(1,0,0),new se(-1,0,0),new se(0,0,1),new se(0,0,-1),new se(0,1,0),new se(0,-1,0)],t._cubeUps=[new se(0,1,0),new se(0,1,0),new se(0,1,0),new se(0,1,0),new se(0,0,1),new se(0,0,-1)],t}return Ne(i,o),i.prototype.updateMatrices=function(t,e){e===void 0&&(e=0);var s=this.camera,a=this.matrix;ea.setFromMatrixPosition(t.matrixWorld),s.position.copy(ea),Ml.copy(s.position),Ml.add(this._cubeDirections[e]),s.up.copy(this._cubeUps[e]),s.lookAt(Ml),s.updateMatrixWorld(),a.makeTranslation(-ea.x,-ea.y,-ea.z),ac.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ac)},i}(Al);oc.prototype.isPointLightShadow=!0;var Tl=function(o){function i(t,e,s,a){var c;return s===void 0&&(s=0),a===void 0&&(a=1),(c=o.call(this,t,e)||this).type="PointLight",c.distance=s,c.decay=a,c.shadow=new oc,c}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this},gi(i,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}]),i}(xn);Tl.prototype.isPointLight=!0;var ta=function(o){function i(e,s,a,c,m,v){var b;return e===void 0&&(e=-1),s===void 0&&(s=1),a===void 0&&(a=1),c===void 0&&(c=-1),m===void 0&&(m=.1),v===void 0&&(v=2e3),(b=o.call(this)||this).type="OrthographicCamera",b.zoom=1,b.view=null,b.left=e,b.right=s,b.top=a,b.bottom=c,b.near=m,b.far=v,b.updateProjectionMatrix(),b}Ne(i,o);var t=i.prototype;return t.copy=function(e,s){return o.prototype.copy.call(this,e,s),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this},t.setViewOffset=function(e,s,a,c,m,v){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=s,this.view.offsetX=a,this.view.offsetY=c,this.view.width=m,this.view.height=v,this.updateProjectionMatrix()},t.clearViewOffset=function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},t.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),s=(this.top-this.bottom)/(2*this.zoom),a=(this.right+this.left)/2,c=(this.top+this.bottom)/2,m=a-e,v=a+e,b=c+s,E=c-s;if(this.view!==null&&this.view.enabled){var S=(this.right-this.left)/this.view.fullWidth/this.zoom,L=(this.top-this.bottom)/this.view.fullHeight/this.zoom;v=(m+=S*this.view.offsetX)+S*this.view.width,E=(b-=L*this.view.offsetY)-L*this.view.height}this.projectionMatrix.makeOrthographic(m,v,b,E,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},t.toJSON=function(e){var s=Ke.prototype.toJSON.call(this,e);return s.object.zoom=this.zoom,s.object.left=this.left,s.object.right=this.right,s.object.top=this.top,s.object.bottom=this.bottom,s.object.near=this.near,s.object.far=this.far,this.view!==null&&(s.object.view=Object.assign({},this.view)),s},i}(rs);ta.prototype.isOrthographicCamera=!0;var lc=function(o){function i(){return o.call(this,new ta(-5,5,5,-5,.5,500))||this}return Ne(i,o),i}(Al);lc.prototype.isDirectionalLightShadow=!0;var Ll=function(o){function i(t,e){var s;return(s=o.call(this,t,e)||this).type="DirectionalLight",s.position.copy(Ke.DefaultUp),s.updateMatrix(),s.target=new Ke,s.shadow=new lc,s}return Ne(i,o),i.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this},i}(xn);Ll.prototype.isDirectionalLight=!0;var Pl=function(o){function i(t,e){var s;return(s=o.call(this,t,e)||this).type="AmbientLight",s}return Ne(i,o),i}(xn);Pl.prototype.isAmbientLight=!0;var Dl=function(o){function i(e,s,a,c){var m;return a===void 0&&(a=10),c===void 0&&(c=10),(m=o.call(this,e,s)||this).type="RectAreaLight",m.width=a,m.height=c,m}Ne(i,o);var t=i.prototype;return t.copy=function(e){return o.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},t.toJSON=function(e){var s=o.prototype.toJSON.call(this,e);return s.object.width=this.width,s.object.height=this.height,s},i}(xn);Dl.prototype.isRectAreaLight=!0;var Rl=function(){function o(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new se)}var i=o.prototype;return i.set=function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},i.zero=function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},i.getAt=function(t,e){var s=t.x,a=t.y,c=t.z,m=this.coefficients;return e.copy(m[0]).multiplyScalar(.282095),e.addScaledVector(m[1],.488603*a),e.addScaledVector(m[2],.488603*c),e.addScaledVector(m[3],.488603*s),e.addScaledVector(m[4],s*a*1.092548),e.addScaledVector(m[5],a*c*1.092548),e.addScaledVector(m[6],.315392*(3*c*c-1)),e.addScaledVector(m[7],s*c*1.092548),e.addScaledVector(m[8],.546274*(s*s-a*a)),e},i.getIrradianceAt=function(t,e){var s=t.x,a=t.y,c=t.z,m=this.coefficients;return e.copy(m[0]).multiplyScalar(.886227),e.addScaledVector(m[1],1.023328*a),e.addScaledVector(m[2],1.023328*c),e.addScaledVector(m[3],1.023328*s),e.addScaledVector(m[4],.858086*s*a),e.addScaledVector(m[5],.858086*a*c),e.addScaledVector(m[6],.743125*c*c-.247708),e.addScaledVector(m[7],.858086*s*c),e.addScaledVector(m[8],.429043*(s*s-a*a)),e},i.add=function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},i.addScaledSH=function(t,e){for(var s=0;s<9;s++)this.coefficients[s].addScaledVector(t.coefficients[s],e);return this},i.scale=function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},i.lerp=function(t,e){for(var s=0;s<9;s++)this.coefficients[s].lerp(t.coefficients[s],e);return this},i.equals=function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},i.copy=function(t){return this.set(t.coefficients)},i.clone=function(){return new this.constructor().copy(this)},i.fromArray=function(t,e){e===void 0&&(e=0);for(var s=this.coefficients,a=0;a<9;a++)s[a].fromArray(t,e+3*a);return this},i.toArray=function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);for(var s=this.coefficients,a=0;a<9;a++)s[a].toArray(t,e+3*a);return t},o.getBasisAt=function(t,e){var s=t.x,a=t.y,c=t.z;e[0]=.282095,e[1]=.488603*a,e[2]=.488603*c,e[3]=.488603*s,e[4]=1.092548*s*a,e[5]=1.092548*a*c,e[6]=.315392*(3*c*c-1),e[7]=1.092548*s*c,e[8]=.546274*(s*s-a*a)},o}();Rl.prototype.isSphericalHarmonics3=!0;var ia=function(o){function i(e,s){var a;return e===void 0&&(e=new Rl),s===void 0&&(s=1),(a=o.call(this,void 0,s)||this).sh=e,a}Ne(i,o);var t=i.prototype;return t.copy=function(e){return o.prototype.copy.call(this,e),this.sh.copy(e.sh),this},t.fromJSON=function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},t.toJSON=function(e){var s=o.prototype.toJSON.call(this,e);return s.object.sh=this.sh.toArray(),s},i}(xn);ia.prototype.isLightProbe=!0;var hc=function(o){function i(e){var s;return(s=o.call(this,e)||this).textures={},s}Ne(i,o);var t=i.prototype;return t.load=function(e,s,a,c){var m=this,v=new cn(m.manager);v.setPath(m.path),v.setRequestHeader(m.requestHeader),v.setWithCredentials(m.withCredentials),v.load(e,function(b){try{s(m.parse(JSON.parse(b)))}catch(E){c?c(E):console.error(E),m.manager.itemError(e)}},a,c)},t.parse=function(e){var s=this.textures;function a(S){return s[S]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",S),s[S]}var c=new Fd[e.type];if(e.uuid!==void 0&&(c.uuid=e.uuid),e.name!==void 0&&(c.name=e.name),e.color!==void 0&&c.color!==void 0&&c.color.setHex(e.color),e.roughness!==void 0&&(c.roughness=e.roughness),e.metalness!==void 0&&(c.metalness=e.metalness),e.sheen!==void 0&&(c.sheen=new st().setHex(e.sheen)),e.emissive!==void 0&&c.emissive!==void 0&&c.emissive.setHex(e.emissive),e.specular!==void 0&&c.specular!==void 0&&c.specular.setHex(e.specular),e.shininess!==void 0&&(c.shininess=e.shininess),e.clearcoat!==void 0&&(c.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(c.clearcoatRoughness=e.clearcoatRoughness),e.fog!==void 0&&(c.fog=e.fog),e.flatShading!==void 0&&(c.flatShading=e.flatShading),e.blending!==void 0&&(c.blending=e.blending),e.combine!==void 0&&(c.combine=e.combine),e.side!==void 0&&(c.side=e.side),e.opacity!==void 0&&(c.opacity=e.opacity),e.transparent!==void 0&&(c.transparent=e.transparent),e.alphaTest!==void 0&&(c.alphaTest=e.alphaTest),e.depthTest!==void 0&&(c.depthTest=e.depthTest),e.depthWrite!==void 0&&(c.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(c.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(c.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(c.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(c.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(c.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(c.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(c.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(c.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(c.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(c.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(c.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(c.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(c.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(c.rotation=e.rotation),e.linewidth!==1&&(c.linewidth=e.linewidth),e.dashSize!==void 0&&(c.dashSize=e.dashSize),e.gapSize!==void 0&&(c.gapSize=e.gapSize),e.scale!==void 0&&(c.scale=e.scale),e.polygonOffset!==void 0&&(c.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(c.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(c.polygonOffsetUnits=e.polygonOffsetUnits),e.skinning!==void 0&&(c.skinning=e.skinning),e.morphTargets!==void 0&&(c.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(c.morphNormals=e.morphNormals),e.dithering!==void 0&&(c.dithering=e.dithering),e.vertexTangents!==void 0&&(c.vertexTangents=e.vertexTangents),e.visible!==void 0&&(c.visible=e.visible),e.toneMapped!==void 0&&(c.toneMapped=e.toneMapped),e.userData!==void 0&&(c.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?c.vertexColors=e.vertexColors>0:c.vertexColors=e.vertexColors),e.uniforms!==void 0)for(var m in e.uniforms){var v=e.uniforms[m];switch(c.uniforms[m]={},v.type){case"t":c.uniforms[m].value=a(v.value);break;case"c":c.uniforms[m].value=new st().setHex(v.value);break;case"v2":c.uniforms[m].value=new He().fromArray(v.value);break;case"v3":c.uniforms[m].value=new se().fromArray(v.value);break;case"v4":c.uniforms[m].value=new Ft().fromArray(v.value);break;case"m3":c.uniforms[m].value=new Wt().fromArray(v.value);break;case"m4":c.uniforms[m].value=new ht().fromArray(v.value);break;default:c.uniforms[m].value=v.value}}if(e.defines!==void 0&&(c.defines=e.defines),e.vertexShader!==void 0&&(c.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(c.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(var b in e.extensions)c.extensions[b]=e.extensions[b];if(e.shading!==void 0&&(c.flatShading=e.shading===1),e.size!==void 0&&(c.size=e.size),e.sizeAttenuation!==void 0&&(c.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(c.map=a(e.map)),e.matcap!==void 0&&(c.matcap=a(e.matcap)),e.alphaMap!==void 0&&(c.alphaMap=a(e.alphaMap)),e.bumpMap!==void 0&&(c.bumpMap=a(e.bumpMap)),e.bumpScale!==void 0&&(c.bumpScale=e.bumpScale),e.normalMap!==void 0&&(c.normalMap=a(e.normalMap)),e.normalMapType!==void 0&&(c.normalMapType=e.normalMapType),e.normalScale!==void 0){var E=e.normalScale;Array.isArray(E)===!1&&(E=[E,E]),c.normalScale=new He().fromArray(E)}return e.displacementMap!==void 0&&(c.displacementMap=a(e.displacementMap)),e.displacementScale!==void 0&&(c.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(c.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(c.roughnessMap=a(e.roughnessMap)),e.metalnessMap!==void 0&&(c.metalnessMap=a(e.metalnessMap)),e.emissiveMap!==void 0&&(c.emissiveMap=a(e.emissiveMap)),e.emissiveIntensity!==void 0&&(c.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(c.specularMap=a(e.specularMap)),e.envMap!==void 0&&(c.envMap=a(e.envMap)),e.envMapIntensity!==void 0&&(c.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(c.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(c.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(c.lightMap=a(e.lightMap)),e.lightMapIntensity!==void 0&&(c.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(c.aoMap=a(e.aoMap)),e.aoMapIntensity!==void 0&&(c.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(c.gradientMap=a(e.gradientMap)),e.clearcoatMap!==void 0&&(c.clearcoatMap=a(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(c.clearcoatRoughnessMap=a(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(c.clearcoatNormalMap=a(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(c.clearcoatNormalScale=new He().fromArray(e.clearcoatNormalScale)),e.transmission!==void 0&&(c.transmission=e.transmission),e.transmissionMap!==void 0&&(c.transmissionMap=a(e.transmissionMap)),c},t.setTextures=function(e){return this.textures=e,this},i}(si),Bl={decodeText:function(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);for(var t="",e=0,s=i.length;e<s;e++)t+=String.fromCharCode(i[e]);try{return decodeURIComponent(escape(t))}catch(a){return t}},extractUrlBase:function(i){var t=i.lastIndexOf("/");return t===-1?"./":i.substr(0,t+1)}};function na(){ct.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function vo(o,i,t,e){typeof t=="number"&&(e=t,t=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),pt.call(this,o,i,t),this.meshPerAttribute=e||1}na.prototype=Object.assign(Object.create(ct.prototype),{constructor:na,isInstancedBufferGeometry:!0,copy:function(i){return ct.prototype.copy.call(this,i),this.instanceCount=i.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var i=ct.prototype.toJSON.call(this);return i.instanceCount=this.instanceCount,i.isInstancedBufferGeometry=!0,i}}),vo.prototype=Object.assign(Object.create(pt.prototype),{constructor:vo,isInstancedBufferAttribute:!0,copy:function(i){return pt.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},toJSON:function(){var i=pt.prototype.toJSON.call(this);return i.meshPerAttribute=this.meshPerAttribute,i.isInstancedBufferAttribute=!0,i}});var cc=function(o){function i(e){return o.call(this,e)||this}Ne(i,o);var t=i.prototype;return t.load=function(e,s,a,c){var m=this,v=new cn(m.manager);v.setPath(m.path),v.setRequestHeader(m.requestHeader),v.setWithCredentials(m.withCredentials),v.load(e,function(b){try{s(m.parse(JSON.parse(b)))}catch(E){c?c(E):console.error(E),m.manager.itemError(e)}},a,c)},t.parse=function(e){var s={},a={};function c(Ie,Pe){if(s[Pe]!==void 0)return s[Pe];var de=Ie.interleavedBuffers[Pe],ve=function(we,ye){if(a[ye]!==void 0)return a[ye];var Te=we.arrayBuffers[ye],Ue=new Uint32Array(Te).buffer;return a[ye]=Ue,Ue}(Ie,de.buffer),Me=new ki(Cr(de.type,ve),de.stride);return Me.uuid=de.uuid,s[Pe]=Me,Me}var m=e.isInstancedBufferGeometry?new na:new ct,v=e.data.index;if(v!==void 0){var b=Cr(v.type,v.array);m.setIndex(new pt(b,1))}var E=e.data.attributes;for(var S in E){var L=E[S],I=void 0;if(L.isInterleavedBufferAttribute)I=new os(c(e.data,L.data),L.itemSize,L.offset,L.normalized);else{var O=Cr(L.type,L.array);I=new(L.isInstancedBufferAttribute?vo:pt)(O,L.itemSize,L.normalized)}L.name!==void 0&&(I.name=L.name),m.setAttribute(S,I)}var U=e.data.morphAttributes;if(U)for(var G in U){for(var W=U[G],X=[],ie=0,$=W.length;ie<$;ie++){var ee=W[ie],he=void 0;ee.isInterleavedBufferAttribute?he=new os(c(e.data,ee.data),ee.itemSize,ee.offset,ee.normalized):he=new pt(Cr(ee.type,ee.array),ee.itemSize,ee.normalized),ee.name!==void 0&&(he.name=ee.name),X.push(he)}m.morphAttributes[G]=X}e.data.morphTargetsRelative&&(m.morphTargetsRelative=!0);var oe=e.data.groups||e.data.drawcalls||e.data.offsets;if(oe!==void 0)for(var re=0,me=oe.length;re!==me;++re){var pe=oe[re];m.addGroup(pe.start,pe.count,pe.materialIndex)}var xe=e.data.boundingSphere;if(xe!==void 0){var Ce=new se;xe.center!==void 0&&Ce.fromArray(xe.center),m.boundingSphere=new mn(Ce,xe.radius)}return e.name&&(m.name=e.name),e.userData&&(m.userData=e.userData),m},i}(si),kd=function(o){function i(e){return o.call(this,e)||this}Ne(i,o);var t=i.prototype;return t.load=function(e,s,a,c){var m=this,v=this.path===""?Bl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||v;var b=new cn(this.manager);b.setPath(this.path),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(e,function(E){var S=null;try{S=JSON.parse(E)}catch(I){return c!==void 0&&c(I),void console.error("THREE:ObjectLoader: Can't parse "+e+".",I.message)}var L=S.metadata;L!==void 0&&L.type!==void 0&&L.type.toLowerCase()!=="geometry"?m.parse(S,s):console.error("THREE.ObjectLoader: Can't load "+e)},a,c)},t.parse=function(e,s){var a=this.parseAnimations(e.animations),c=this.parseShapes(e.shapes),m=this.parseGeometries(e.geometries,c),v=this.parseImages(e.images,function(){s!==void 0&&s(S)}),b=this.parseTextures(e.textures,v),E=this.parseMaterials(e.materials,b),S=this.parseObject(e.object,m,E,a),L=this.parseSkeletons(e.skeletons,S);if(this.bindSkeletons(S,L),s!==void 0){var I=!1;for(var O in v)if(v[O]instanceof HTMLImageElement){I=!0;break}I===!1&&s(S)}return S},t.parseShapes=function(e){var s={};if(e!==void 0)for(var a=0,c=e.length;a<c;a++){var m=new us().fromJSON(e[a]);s[m.uuid]=m}return s},t.parseSkeletons=function(e,s){var a={},c={};if(s.traverse(function(E){E.isBone&&(c[E.uuid]=E)}),e!==void 0)for(var m=0,v=e.length;m<v;m++){var b=new qo().fromJSON(e[m],c);a[b.uuid]=b}return a},t.parseGeometries=function(e,s){var a,c={};if(e!==void 0)for(var m=new cc,v=0,b=e.length;v<b;v++){var E=void 0,S=e[v];switch(S.type){case"PlaneGeometry":case"PlaneBufferGeometry":E=new Oi[S.type](S.width,S.height,S.widthSegments,S.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":E=new Oi[S.type](S.width,S.height,S.depth,S.widthSegments,S.heightSegments,S.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":E=new Oi[S.type](S.radius,S.segments,S.thetaStart,S.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":E=new Oi[S.type](S.radiusTop,S.radiusBottom,S.height,S.radialSegments,S.heightSegments,S.openEnded,S.thetaStart,S.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":E=new Oi[S.type](S.radius,S.height,S.radialSegments,S.heightSegments,S.openEnded,S.thetaStart,S.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":E=new Oi[S.type](S.radius,S.widthSegments,S.heightSegments,S.phiStart,S.phiLength,S.thetaStart,S.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":E=new Oi[S.type](S.radius,S.detail);break;case"RingGeometry":case"RingBufferGeometry":E=new Oi[S.type](S.innerRadius,S.outerRadius,S.thetaSegments,S.phiSegments,S.thetaStart,S.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":E=new Oi[S.type](S.radius,S.tube,S.radialSegments,S.tubularSegments,S.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":E=new Oi[S.type](S.radius,S.tube,S.tubularSegments,S.radialSegments,S.p,S.q);break;case"TubeGeometry":case"TubeBufferGeometry":E=new Oi[S.type](new Sl[S.path.type]().fromJSON(S.path),S.tubularSegments,S.radius,S.radialSegments,S.closed);break;case"LatheGeometry":case"LatheBufferGeometry":E=new Oi[S.type](S.points,S.segments,S.phiStart,S.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":E=new Oi[S.type](S.vertices,S.indices,S.radius,S.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":a=[];for(var L=0,I=S.shapes.length;L<I;L++){var O=s[S.shapes[L]];a.push(O)}E=new Oi[S.type](a,S.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":a=[];for(var U=0,G=S.shapes.length;U<G;U++){var W=s[S.shapes[U]];a.push(W)}var X=S.options.extrudePath;X!==void 0&&(S.options.extrudePath=new Sl[X.type]().fromJSON(X)),E=new Oi[S.type](a,S.options);break;case"BufferGeometry":case"InstancedBufferGeometry":E=m.parse(S);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+S.type+'"');continue}E.uuid=S.uuid,S.name!==void 0&&(E.name=S.name),E.isBufferGeometry===!0&&S.userData!==void 0&&(E.userData=S.userData),c[S.uuid]=E}return c},t.parseMaterials=function(e,s){var a={},c={};if(e!==void 0){var m=new hc;m.setTextures(s);for(var v=0,b=e.length;v<b;v++){var E=e[v];if(E.type==="MultiMaterial"){for(var S=[],L=0;L<E.materials.length;L++){var I=E.materials[L];a[I.uuid]===void 0&&(a[I.uuid]=m.parse(I)),S.push(a[I.uuid])}c[E.uuid]=S}else a[E.uuid]===void 0&&(a[E.uuid]=m.parse(E)),c[E.uuid]=a[E.uuid]}}return c},t.parseAnimations=function(e){var s={};if(e!==void 0)for(var a=0;a<e.length;a++){var c=e[a],m=Xr.parse(c);s[m.uuid]=m}return s},t.parseImages=function(e,s){var a,c=this,m={};function v(X){if(typeof X=="string"){var ie=X;return function($){return c.manager.itemStart($),a.load($,function(){c.manager.itemEnd($)},void 0,function(){c.manager.itemError($),c.manager.itemEnd($)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ie)?ie:c.resourcePath+ie)}return X.data?{data:Cr(X.type,X.data),width:X.width,height:X.height}:null}if(e!==void 0&&e.length>0){var b=new fl(s);(a=new co(b)).setCrossOrigin(this.crossOrigin);for(var E=0,S=e.length;E<S;E++){var L=e[E],I=L.url;if(Array.isArray(I)){m[L.uuid]=[];for(var O=0,U=I.length;O<U;O++){var G=v(I[O]);G!==null&&(G instanceof HTMLImageElement?m[L.uuid].push(G):m[L.uuid].push(new Js(G.data,G.width,G.height)))}}else{var W=v(L.url);W!==null&&(m[L.uuid]=W)}}}return m},t.parseTextures=function(e,s){function a(L,I){return typeof L=="number"?L:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",L),I[L])}var c={};if(e!==void 0)for(var m=0,v=e.length;m<v;m++){var b=e[m];b.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',b.uuid),s[b.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",b.image);var E=void 0,S=s[b.image];Array.isArray(S)?(E=new Qs(S),S.length===6&&(E.needsUpdate=!0)):(E=S&&S.data?new Js(S.data,S.width,S.height):new ui(S),S&&(E.needsUpdate=!0)),E.uuid=b.uuid,b.name!==void 0&&(E.name=b.name),b.mapping!==void 0&&(E.mapping=a(b.mapping,jd)),b.offset!==void 0&&E.offset.fromArray(b.offset),b.repeat!==void 0&&E.repeat.fromArray(b.repeat),b.center!==void 0&&E.center.fromArray(b.center),b.rotation!==void 0&&(E.rotation=b.rotation),b.wrap!==void 0&&(E.wrapS=a(b.wrap[0],uc),E.wrapT=a(b.wrap[1],uc)),b.format!==void 0&&(E.format=b.format),b.type!==void 0&&(E.type=b.type),b.encoding!==void 0&&(E.encoding=b.encoding),b.minFilter!==void 0&&(E.minFilter=a(b.minFilter,dc)),b.magFilter!==void 0&&(E.magFilter=a(b.magFilter,dc)),b.anisotropy!==void 0&&(E.anisotropy=b.anisotropy),b.flipY!==void 0&&(E.flipY=b.flipY),b.premultiplyAlpha!==void 0&&(E.premultiplyAlpha=b.premultiplyAlpha),b.unpackAlignment!==void 0&&(E.unpackAlignment=b.unpackAlignment),c[b.uuid]=E}return c},t.parseObject=function(e,s,a,c){var m,v,b;function E(oe){return s[oe]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",oe),s[oe]}function S(oe){if(oe!==void 0){if(Array.isArray(oe)){for(var re=[],me=0,pe=oe.length;me<pe;me++){var xe=oe[me];a[xe]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",xe),re.push(a[xe])}return re}return a[oe]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",oe),a[oe]}}switch(e.type){case"Scene":m=new Ra,e.background!==void 0&&Number.isInteger(e.background)&&(m.background=new st(e.background)),e.fog!==void 0&&(e.fog.type==="Fog"?m.fog=new Yo(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(m.fog=new Ko(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":m=new di(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(m.focus=e.focus),e.zoom!==void 0&&(m.zoom=e.zoom),e.filmGauge!==void 0&&(m.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(m.filmOffset=e.filmOffset),e.view!==void 0&&(m.view=Object.assign({},e.view));break;case"OrthographicCamera":m=new ta(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(m.zoom=e.zoom),e.view!==void 0&&(m.view=Object.assign({},e.view));break;case"AmbientLight":m=new Pl(e.color,e.intensity);break;case"DirectionalLight":m=new Ll(e.color,e.intensity);break;case"PointLight":m=new Tl(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":m=new Dl(e.color,e.intensity,e.width,e.height);break;case"SpotLight":m=new Cl(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":m=new El(e.color,e.groundColor,e.intensity);break;case"LightProbe":m=new ia().fromJSON(e);break;case"SkinnedMesh":m=new Nr(v=E(e.geometry),b=S(e.material)),e.bindMode!==void 0&&(m.bindMode=e.bindMode),e.bindMatrix!==void 0&&m.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(m.skeleton=e.skeleton);break;case"Mesh":m=new Jt(v=E(e.geometry),b=S(e.material));break;case"InstancedMesh":v=E(e.geometry),b=S(e.material);var L=e.count,I=e.instanceMatrix;(m=new ka(v,b,L)).instanceMatrix=new pt(new Float32Array(I.array),16);break;case"LOD":m=new Zo;break;case"Line":m=new vn(E(e.geometry),S(e.material));break;case"LineLoop":m=new Jo(E(e.geometry),S(e.material));break;case"LineSegments":m=new Ii(E(e.geometry),S(e.material));break;case"PointCloud":case"Points":m=new rr(E(e.geometry),S(e.material));break;case"Sprite":m=new Na(S(e.material));break;case"Group":m=new Es;break;case"Bone":m=new Fr;break;default:m=new Ke}if(m.uuid=e.uuid,e.name!==void 0&&(m.name=e.name),e.matrix!==void 0?(m.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(m.matrixAutoUpdate=e.matrixAutoUpdate),m.matrixAutoUpdate&&m.matrix.decompose(m.position,m.quaternion,m.scale)):(e.position!==void 0&&m.position.fromArray(e.position),e.rotation!==void 0&&m.rotation.fromArray(e.rotation),e.quaternion!==void 0&&m.quaternion.fromArray(e.quaternion),e.scale!==void 0&&m.scale.fromArray(e.scale)),e.castShadow!==void 0&&(m.castShadow=e.castShadow),e.receiveShadow!==void 0&&(m.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(m.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(m.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(m.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&m.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(m.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(m.visible=e.visible),e.frustumCulled!==void 0&&(m.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(m.renderOrder=e.renderOrder),e.userData!==void 0&&(m.userData=e.userData),e.layers!==void 0&&(m.layers.mask=e.layers),e.children!==void 0)for(var O=e.children,U=0;U<O.length;U++)m.add(this.parseObject(O[U],s,a,c));if(e.animations!==void 0)for(var G=e.animations,W=0;W<G.length;W++){var X=G[W];m.animations.push(c[X])}if(e.type==="LOD"){e.autoUpdate!==void 0&&(m.autoUpdate=e.autoUpdate);for(var ie=e.levels,$=0;$<ie.length;$++){var ee=ie[$],he=m.getObjectByProperty("uuid",ee.object);he!==void 0&&m.addLevel(he,ee.distance)}}return m},t.bindSkeletons=function(e,s){Object.keys(s).length!==0&&e.traverse(function(a){if(a.isSkinnedMesh===!0&&a.skeleton!==void 0){var c=s[a.skeleton];c===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",a.skeleton):a.bind(c,a.bindMatrix)}})},t.setTexturePath=function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)},i}(si),jd={UVMapping:N,CubeReflectionMapping:_,CubeRefractionMapping:l,EquirectangularReflectionMapping:n,EquirectangularRefractionMapping:r,CubeUVReflectionMapping:h,CubeUVRefractionMapping:u},uc={RepeatWrapping:g,ClampToEdgeWrapping:p,MirroredRepeatWrapping:y},dc={NearestFilter:x,NearestMipmapNearestFilter:w,NearestMipmapLinearFilter:M,LinearFilter:T,LinearMipmapNearestFilter:A,LinearMipmapLinearFilter:C};function Il(o){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),si.call(this,o),this.options={premultiplyAlpha:"none"}}Il.prototype=Object.assign(Object.create(si.prototype),{constructor:Il,isImageBitmapLoader:!0,setOptions:function(i){return this.options=i,this},load:function(i,t,e,s){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);var a=this,c=Ps.get(i);if(c!==void 0)return a.manager.itemStart(i),setTimeout(function(){t&&t(c),a.manager.itemEnd(i)},0),c;var m={};m.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",m.headers=this.requestHeader,fetch(i,m).then(function(v){return v.blob()}).then(function(v){return createImageBitmap(v,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(v){Ps.add(i,v),t&&t(v),a.manager.itemEnd(i)}).catch(function(v){s&&s(v),a.manager.itemError(i),a.manager.itemEnd(i)}),a.manager.itemStart(i)}});var fc=function(){function o(){this.type="ShapePath",this.color=new st,this.subPaths=[],this.currentPath=null}var i=o.prototype;return i.moveTo=function(t,e){return this.currentPath=new $r,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},i.lineTo=function(t,e){return this.currentPath.lineTo(t,e),this},i.quadraticCurveTo=function(t,e,s,a){return this.currentPath.quadraticCurveTo(t,e,s,a),this},i.bezierCurveTo=function(t,e,s,a,c,m){return this.currentPath.bezierCurveTo(t,e,s,a,c,m),this},i.splineThru=function(t){return this.currentPath.splineThru(t),this},i.toShapes=function(t,e){function s(Te){for(var Ue=[],tt=0,ot=Te.length;tt<ot;tt++){var ue=Te[tt],fe=new us;fe.curves=ue.curves,Ue.push(fe)}return Ue}function a(Te,Ue){for(var tt=Ue.length,ot=!1,ue=tt-1,fe=0;fe<tt;ue=fe++){var Oe=Ue[ue],De=Ue[fe],Ve=De.x-Oe.x,Ae=De.y-Oe.y;if(Math.abs(Ae)>Number.EPSILON){if(Ae<0&&(Oe=Ue[fe],Ve=-Ve,De=Ue[ue],Ae=-Ae),Te.y<Oe.y||Te.y>De.y)continue;if(Te.y===Oe.y){if(Te.x===Oe.x)return!0}else{var Ee=Ae*(Te.x-Oe.x)-Ve*(Te.y-Oe.y);if(Ee===0)return!0;if(Ee<0)continue;ot=!ot}}else{if(Te.y!==Oe.y)continue;if(De.x<=Te.x&&Te.x<=Oe.x||Oe.x<=Te.x&&Te.x<=De.x)return!0}}return ot}var c,m,v,b=Un.isClockWise,E=this.subPaths;if(E.length===0)return[];if(e===!0)return s(E);var S=[];if(E.length===1)return m=E[0],(v=new us).curves=m.curves,S.push(v),S;var L=!b(E[0].getPoints());L=t?!L:L;var I,O,U=[],G=[],W=[],X=0;G[X]=void 0,W[X]=[];for(var ie=0,$=E.length;ie<$;ie++)c=b(I=(m=E[ie]).getPoints()),(c=t?!c:c)?(!L&&G[X]&&X++,G[X]={s:new us,p:I},G[X].s.curves=m.curves,L&&X++,W[X]=[]):W[X].push({h:m,p:I[0]});if(!G[0])return s(E);if(G.length>1){for(var ee=!1,he=[],oe=0,re=G.length;oe<re;oe++)U[oe]=[];for(var me=0,pe=G.length;me<pe;me++)for(var xe=W[me],Ce=0;Ce<xe.length;Ce++){for(var Ie=xe[Ce],Pe=!0,de=0;de<G.length;de++)a(Ie.p,G[de].p)&&(me!==de&&he.push({froms:me,tos:de,hole:Ce}),Pe?(Pe=!1,U[de].push(Ie)):ee=!0);Pe&&U[me].push(Ie)}he.length>0&&(ee||(W=U))}for(var ve=0,Me=G.length;ve<Me;ve++){v=G[ve].s,S.push(v);for(var we=0,ye=(O=W[ve]).length;we<ye;we++)v.holes.push(O[we].h)}return S},o}(),Ol=function(){function o(i){this.type="Font",this.data=i}return o.prototype.generateShapes=function(i,t){t===void 0&&(t=100);for(var e=[],s=function(m,v,b){for(var E=Array.from(m),S=v/b.resolution,L=(b.boundingBox.yMax-b.boundingBox.yMin+b.underlineThickness)*S,I=[],O=0,U=0,G=0;G<E.length;G++){var W=E[G];if(W===`
`)O=0,U-=L;else{var X=Vd(W,S,O,U,b);O+=X.offsetX,I.push(X.path)}}return I}(i,t,this.data),a=0,c=s.length;a<c;a++)Array.prototype.push.apply(e,s[a].toShapes());return e},o}();function Vd(o,i,t,e,s){var a=s.glyphs[o]||s.glyphs["?"];if(a){var c,m,v,b,E,S,L,I,O=new fc;if(a.o)for(var U=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),G=0,W=U.length;G<W;)switch(U[G++]){case"m":c=U[G++]*i+t,m=U[G++]*i+e,O.moveTo(c,m);break;case"l":c=U[G++]*i+t,m=U[G++]*i+e,O.lineTo(c,m);break;case"q":v=U[G++]*i+t,b=U[G++]*i+e,E=U[G++]*i+t,S=U[G++]*i+e,O.quadraticCurveTo(E,S,v,b);break;case"b":v=U[G++]*i+t,b=U[G++]*i+e,E=U[G++]*i+t,S=U[G++]*i+e,L=U[G++]*i+t,I=U[G++]*i+e,O.bezierCurveTo(E,S,L,I,v,b)}return{offsetX:a.ha*i,path:O}}console.error('THREE.Font: character "'+o+'" does not exists in font family '+s.familyName+".")}Ol.prototype.isFont=!0;var yo,Wd=function(o){function i(e){return o.call(this,e)||this}Ne(i,o);var t=i.prototype;return t.load=function(e,s,a,c){var m=this,v=new cn(this.manager);v.setPath(this.path),v.setRequestHeader(this.requestHeader),v.setWithCredentials(m.withCredentials),v.load(e,function(b){var E;try{E=JSON.parse(b)}catch(L){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),E=JSON.parse(b.substring(65,b.length-2))}var S=m.parse(E);s&&s(S)},a,c)},t.parse=function(e){return new Ol(e)},i}(si),Nl={getContext:function(){return yo===void 0&&(yo=new(window.AudioContext||window.webkitAudioContext)),yo},setContext:function(i){yo=i}},pc=function(o){function i(t){return o.call(this,t)||this}return Ne(i,o),i.prototype.load=function(t,e,s,a){var c=this,m=new cn(this.manager);m.setResponseType("arraybuffer"),m.setPath(this.path),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials),m.load(t,function(v){try{var b=v.slice(0);Nl.getContext().decodeAudioData(b,function(E){e(E)})}catch(E){a?a(E):console.error(E),c.manager.itemError(t)}},s,a)},i}(si),mc=function(o){function i(t,e,s){var a;s===void 0&&(s=1),a=o.call(this,void 0,s)||this;var c=new st().set(t),m=new st().set(e),v=new se(c.r,c.g,c.b),b=new se(m.r,m.g,m.b),E=Math.sqrt(Math.PI),S=E*Math.sqrt(.75);return a.sh.coefficients[0].copy(v).add(b).multiplyScalar(E),a.sh.coefficients[1].copy(v).sub(b).multiplyScalar(S),a}return Ne(i,o),i}(ia);mc.prototype.isHemisphereLightProbe=!0;var _c=function(o){function i(t,e){var s;e===void 0&&(e=1),s=o.call(this,void 0,e)||this;var a=new st().set(t);return s.sh.coefficients[0].set(a.r,a.g,a.b).multiplyScalar(2*Math.sqrt(Math.PI)),s}return Ne(i,o),i}(ia);_c.prototype.isAmbientLightProbe=!0;var gc=new ht,vc=new ht,Gd=function(){function o(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new di,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new di,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}return o.prototype.update=function(i){var t=this._cache;if(t.focus!==i.focus||t.fov!==i.fov||t.aspect!==i.aspect*this.aspect||t.near!==i.near||t.far!==i.far||t.zoom!==i.zoom||t.eyeSep!==this.eyeSep){t.focus=i.focus,t.fov=i.fov,t.aspect=i.aspect*this.aspect,t.near=i.near,t.far=i.far,t.zoom=i.zoom,t.eyeSep=this.eyeSep;var e,s,a=i.projectionMatrix.clone(),c=t.eyeSep/2,m=c*t.near/t.focus,v=t.near*Math.tan(dt.DEG2RAD*t.fov*.5)/t.zoom;vc.elements[12]=-c,gc.elements[12]=c,e=-v*t.aspect+m,s=v*t.aspect+m,a.elements[0]=2*t.near/(s-e),a.elements[8]=(s+e)/(s-e),this.cameraL.projectionMatrix.copy(a),e=-v*t.aspect-m,s=v*t.aspect-m,a.elements[0]=2*t.near/(s-e),a.elements[8]=(s+e)/(s-e),this.cameraR.projectionMatrix.copy(a)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(vc),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(gc)},o}(),yc=function(){function o(t){this.autoStart=t===void 0||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}var i=o.prototype;return i.start=function(){this.startTime=bc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},i.stop=function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},i.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},i.getDelta=function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=bc();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t},o}();function bc(){return(typeof performance>"u"?Date:performance).now()}var Ds=new se,xc=new ni,Hd=new se,Rs=new se,Kd=function(o){function i(){var e;return(e=o.call(this)||this).type="AudioListener",e.context=Nl.getContext(),e.gain=e.context.createGain(),e.gain.connect(e.context.destination),e.filter=null,e.timeDelta=0,e._clock=new yc,e}Ne(i,o);var t=i.prototype;return t.getInput=function(){return this.gain},t.removeFilter=function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},t.getFilter=function(){return this.filter},t.setFilter=function(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},t.getMasterVolume=function(){return this.gain.gain.value},t.setMasterVolume=function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},t.updateMatrixWorld=function(e){o.prototype.updateMatrixWorld.call(this,e);var s=this.context.listener,a=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ds,xc,Hd),Rs.set(0,0,-1).applyQuaternion(xc),s.positionX){var c=this.context.currentTime+this.timeDelta;s.positionX.linearRampToValueAtTime(Ds.x,c),s.positionY.linearRampToValueAtTime(Ds.y,c),s.positionZ.linearRampToValueAtTime(Ds.z,c),s.forwardX.linearRampToValueAtTime(Rs.x,c),s.forwardY.linearRampToValueAtTime(Rs.y,c),s.forwardZ.linearRampToValueAtTime(Rs.z,c),s.upX.linearRampToValueAtTime(a.x,c),s.upY.linearRampToValueAtTime(a.y,c),s.upZ.linearRampToValueAtTime(a.z,c)}else s.setPosition(Ds.x,Ds.y,Ds.z),s.setOrientation(Rs.x,Rs.y,Rs.z,a.x,a.y,a.z)},i}(Ke),Fl=function(o){function i(e){var s;return(s=o.call(this)||this).type="Audio",s.listener=e,s.context=e.context,s.gain=s.context.createGain(),s.gain.connect(e.getInput()),s.autoplay=!1,s.buffer=null,s.detune=0,s.loop=!1,s.loopStart=0,s.loopEnd=0,s.offset=0,s.duration=void 0,s.playbackRate=1,s.isPlaying=!1,s.hasPlaybackControl=!0,s.source=null,s.sourceType="empty",s._startedAt=0,s._progress=0,s._connected=!1,s.filters=[],s}Ne(i,o);var t=i.prototype;return t.getOutput=function(){return this.gain},t.setNodeSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},t.setMediaElementSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},t.setMediaStreamSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},t.setBuffer=function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},t.play=function(e){if(e===void 0&&(e=0),this.isPlaying!==!0){if(this.hasPlaybackControl!==!1){this._startedAt=this.context.currentTime+e;var s=this.context.createBufferSource();return s.buffer=this.buffer,s.loop=this.loop,s.loopStart=this.loopStart,s.loopEnd=this.loopEnd,s.onended=this.onEnded.bind(this),s.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=s,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},t.pause=function(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.stop=function(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},t.connect=function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,s=this.filters.length;e<s;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this},t.disconnect=function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,s=this.filters.length;e<s;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this},t.getFilters=function(){return this.filters},t.setFilters=function(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this},t.setDetune=function(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},t.getDetune=function(){return this.detune},t.getFilter=function(){return this.getFilters()[0]},t.setFilter=function(e){return this.setFilters(e?[e]:[])},t.setPlaybackRate=function(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.getPlaybackRate=function(){return this.playbackRate},t.onEnded=function(){this.isPlaying=!1},t.getLoop=function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},t.setLoop=function(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.setLoopStart=function(e){return this.loopStart=e,this},t.setLoopEnd=function(e){return this.loopEnd=e,this},t.getVolume=function(){return this.gain.gain.value},t.setVolume=function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},i}(Ke),Bs=new se,wc=new ni,Yd=new se,Is=new se,Xd=function(o){function i(e){var s;return(s=o.call(this,e)||this).panner=s.context.createPanner(),s.panner.panningModel="HRTF",s.panner.connect(s.gain),s}Ne(i,o);var t=i.prototype;return t.getOutput=function(){return this.panner},t.getRefDistance=function(){return this.panner.refDistance},t.setRefDistance=function(e){return this.panner.refDistance=e,this},t.getRolloffFactor=function(){return this.panner.rolloffFactor},t.setRolloffFactor=function(e){return this.panner.rolloffFactor=e,this},t.getDistanceModel=function(){return this.panner.distanceModel},t.setDistanceModel=function(e){return this.panner.distanceModel=e,this},t.getMaxDistance=function(){return this.panner.maxDistance},t.setMaxDistance=function(e){return this.panner.maxDistance=e,this},t.setDirectionalCone=function(e,s,a){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=s,this.panner.coneOuterGain=a,this},t.updateMatrixWorld=function(e){if(o.prototype.updateMatrixWorld.call(this,e),this.hasPlaybackControl!==!0||this.isPlaying!==!1){this.matrixWorld.decompose(Bs,wc,Yd),Is.set(0,0,1).applyQuaternion(wc);var s=this.panner;if(s.positionX){var a=this.context.currentTime+this.listener.timeDelta;s.positionX.linearRampToValueAtTime(Bs.x,a),s.positionY.linearRampToValueAtTime(Bs.y,a),s.positionZ.linearRampToValueAtTime(Bs.z,a),s.orientationX.linearRampToValueAtTime(Is.x,a),s.orientationY.linearRampToValueAtTime(Is.y,a),s.orientationZ.linearRampToValueAtTime(Is.z,a)}else s.setPosition(Bs.x,Bs.y,Bs.z),s.setOrientation(Is.x,Is.y,Is.z)}},i}(Fl),Sc=function(){function o(t,e){e===void 0&&(e=2048),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}var i=o.prototype;return i.getFrequencyData=function(){return this.analyser.getByteFrequencyData(this.data),this.data},i.getAverageFrequency=function(){for(var t=0,e=this.getFrequencyData(),s=0;s<e.length;s++)t+=e[s];return t/e.length},o}(),Ec=function(){function o(t,e,s){var a,c,m;switch(this.binding=t,this.valueSize=s,e){case"quaternion":a=this._slerp,c=this._slerpAdditive,m=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*s),this._workIndex=5;break;case"string":case"bool":a=this._select,c=this._select,m=this._setAdditiveIdentityOther,this.buffer=new Array(5*s);break;default:a=this._lerp,c=this._lerpAdditive,m=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*s)}this._mixBufferRegion=a,this._mixBufferRegionAdditive=c,this._setIdentity=m,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}var i=o.prototype;return i.accumulate=function(t,e){var s=this.buffer,a=this.valueSize,c=t*a+a,m=this.cumulativeWeight;if(m===0){for(var v=0;v!==a;++v)s[c+v]=s[v];m=e}else{var b=e/(m+=e);this._mixBufferRegion(s,c,0,b,a)}this.cumulativeWeight=m},i.accumulateAdditive=function(t){var e=this.buffer,s=this.valueSize,a=s*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,a,0,t,s),this.cumulativeWeightAdditive+=t},i.apply=function(t){var e=this.valueSize,s=this.buffer,a=t*e+e,c=this.cumulativeWeight,m=this.cumulativeWeightAdditive,v=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,c<1){var b=e*this._origIndex;this._mixBufferRegion(s,a,b,1-c,e)}m>0&&this._mixBufferRegionAdditive(s,a,this._addIndex*e,1,e);for(var E=e,S=e+e;E!==S;++E)if(s[E]!==s[E+e]){v.setValue(s,a);break}},i.saveOriginalState=function(){var t=this.binding,e=this.buffer,s=this.valueSize,a=s*this._origIndex;t.getValue(e,a);for(var c=s,m=a;c!==m;++c)e[c]=e[a+c%s];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},i.restoreOriginalState=function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},i._setAdditiveIdentityNumeric=function(){for(var t=this._addIndex*this.valueSize,e=t+this.valueSize,s=t;s<e;s++)this.buffer[s]=0},i._setAdditiveIdentityQuaternion=function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},i._setAdditiveIdentityOther=function(){for(var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize,s=0;s<this.valueSize;s++)this.buffer[e+s]=this.buffer[t+s]},i._select=function(t,e,s,a,c){if(a>=.5)for(var m=0;m!==c;++m)t[e+m]=t[s+m]},i._slerp=function(t,e,s,a){ni.slerpFlat(t,e,t,e,t,s,a)},i._slerpAdditive=function(t,e,s,a,c){var m=this._workIndex*c;ni.multiplyQuaternionsFlat(t,m,t,e,t,s),ni.slerpFlat(t,e,t,e,t,m,a)},i._lerp=function(t,e,s,a,c){for(var m=1-a,v=0;v!==c;++v){var b=e+v;t[b]=t[b]*m+t[s+v]*a}},i._lerpAdditive=function(t,e,s,a,c){for(var m=0;m!==c;++m){var v=e+m;t[v]=t[v]+t[s+m]*a}},o}(),Zd="\\[\\]\\.:\\/",qd=new RegExp("[\\[\\]\\.:\\/]","g"),zl="[^\\[\\]\\.:\\/]",Qd="[^"+Zd.replace("\\.","")+"]",Jd=/((?:WC+[\/:])*)/.source.replace("WC",zl),$d=/(WCOD+)?/.source.replace("WCOD",Qd),ef=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zl),tf=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zl),nf=new RegExp("^"+Jd+$d+ef+tf+"$"),sf=["material","materials","bones"];function Ac(o,i,t){var e=t||Ti.parseTrackName(i);this._targetGroup=o,this._bindings=o.subscribe_(i,e)}function Ti(o,i,t){this.path=i,this.parsedPath=t||Ti.parseTrackName(i),this.node=Ti.findNode(o,this.parsedPath.nodeName)||o,this.rootNode=o}Object.assign(Ac.prototype,{getValue:function(i,t){this.bind();var e=this._targetGroup.nCachedObjects_,s=this._bindings[e];s!==void 0&&s.getValue(i,t)},setValue:function(i,t){for(var e=this._bindings,s=this._targetGroup.nCachedObjects_,a=e.length;s!==a;++s)e[s].setValue(i,t)},bind:function(){for(var i=this._bindings,t=this._targetGroup.nCachedObjects_,e=i.length;t!==e;++t)i[t].bind()},unbind:function(){for(var i=this._bindings,t=this._targetGroup.nCachedObjects_,e=i.length;t!==e;++t)i[t].unbind()}}),Object.assign(Ti,{Composite:Ac,create:function(i,t,e){return i&&i.isAnimationObjectGroup?new Ti.Composite(i,t,e):new Ti(i,t,e)},sanitizeNodeName:function(i){return i.replace(/\s/g,"_").replace(qd,"")},parseTrackName:function(i){var t=nf.exec(i);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+i);var e={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=e.nodeName&&e.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){var a=e.nodeName.substring(s+1);sf.indexOf(a)!==-1&&(e.nodeName=e.nodeName.substring(0,s),e.objectName=a)}if(e.propertyName===null||e.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return e},findNode:function(i,t){if(!t||t===""||t==="."||t===-1||t===i.name||t===i.uuid)return i;if(i.skeleton){var e=i.skeleton.getBoneByName(t);if(e!==void 0)return e}if(i.children){var s=function a(c){for(var m=0;m<c.length;m++){var v=c[m];if(v.name===t||v.uuid===t)return v;var b=a(v.children);if(b)return b}return null}(i.children);if(s)return s}return null}}),Object.assign(Ti.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(o,i){o[i]=this.node[this.propertyName]},function(o,i){for(var t=this.resolvedProperty,e=0,s=t.length;e!==s;++e)o[i++]=t[e]},function(o,i){o[i]=this.resolvedProperty[this.propertyIndex]},function(o,i){this.resolvedProperty.toArray(o,i)}],SetterByBindingTypeAndVersioning:[[function(o,i){this.targetObject[this.propertyName]=o[i]},function(o,i){this.targetObject[this.propertyName]=o[i],this.targetObject.needsUpdate=!0},function(o,i){this.targetObject[this.propertyName]=o[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(o,i){for(var t=this.resolvedProperty,e=0,s=t.length;e!==s;++e)t[e]=o[i++]},function(o,i){for(var t=this.resolvedProperty,e=0,s=t.length;e!==s;++e)t[e]=o[i++];this.targetObject.needsUpdate=!0},function(o,i){for(var t=this.resolvedProperty,e=0,s=t.length;e!==s;++e)t[e]=o[i++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(o,i){this.resolvedProperty[this.propertyIndex]=o[i]},function(o,i){this.resolvedProperty[this.propertyIndex]=o[i],this.targetObject.needsUpdate=!0},function(o,i){this.resolvedProperty[this.propertyIndex]=o[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(o,i){this.resolvedProperty.fromArray(o,i)},function(o,i){this.resolvedProperty.fromArray(o,i),this.targetObject.needsUpdate=!0},function(o,i){this.resolvedProperty.fromArray(o,i),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(i,t){this.bind(),this.getValue(i,t)},setValue:function(i,t){this.bind(),this.setValue(i,t)},bind:function(){var i=this.node,t=this.parsedPath,e=t.objectName,s=t.propertyName,a=t.propertyIndex;if(i||(i=Ti.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,i){if(e){var c=t.objectIndex;switch(e){case"materials":if(!i.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!i.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);i=i.material.materials;break;case"bones":if(!i.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);i=i.skeleton.bones;for(var m=0;m<i.length;m++)if(i[m].name===c){c=m;break}break;default:if(i[e]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);i=i[e]}if(c!==void 0){if(i[c]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);i=i[c]}}var v=i[s];if(v!==void 0){var b=this.Versioning.None;this.targetObject=i,i.needsUpdate!==void 0?b=this.Versioning.NeedsUpdate:i.matrixWorldNeedsUpdate!==void 0&&(b=this.Versioning.MatrixWorldNeedsUpdate);var E=this.BindingType.Direct;if(a!==void 0){if(s==="morphTargetInfluences"){if(!i.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!i.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!i.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);i.morphTargetDictionary[a]!==void 0&&(a=i.morphTargetDictionary[a])}E=this.BindingType.ArrayElement,this.resolvedProperty=v,this.propertyIndex=a}else v.fromArray!==void 0&&v.toArray!==void 0?(E=this.BindingType.HasFromToArray,this.resolvedProperty=v):Array.isArray(v)?(E=this.BindingType.EntireArray,this.resolvedProperty=v):this.propertyName=s;this.getValue=this.GetterByBindingType[E],this.setValue=this.SetterByBindingTypeAndVersioning[E][b]}else{var S=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+S+"."+s+" but it wasn't found.",i)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Ti.prototype,{_getValue_unbound:Ti.prototype.getValue,_setValue_unbound:Ti.prototype.setValue});var Cc=function(){function o(){this.uuid=dt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,s=arguments.length;e!==s;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var a=this;this.stats={objects:{get total(){return a._objects.length},get inUse(){return this.total-a.nCachedObjects_}},get bindingsPerObject(){return a._bindings.length}}}var i=o.prototype;return i.add=function(){for(var t=this._objects,e=this._indicesByUUID,s=this._paths,a=this._parsedPaths,c=this._bindings,m=c.length,v=void 0,b=t.length,E=this.nCachedObjects_,S=0,L=arguments.length;S!==L;++S){var I=arguments[S],O=I.uuid,U=e[O];if(U===void 0){U=b++,e[O]=U,t.push(I);for(var G=0,W=m;G!==W;++G)c[G].push(new Ti(I,s[G],a[G]))}else if(U<E){v=t[U];var X=--E,ie=t[X];e[ie.uuid]=U,t[U]=ie,e[O]=X,t[X]=I;for(var $=0,ee=m;$!==ee;++$){var he=c[$],oe=he[X],re=he[U];he[U]=oe,re===void 0&&(re=new Ti(I,s[$],a[$])),he[X]=re}}else t[U]!==v&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=E},i.remove=function(){for(var t=this._objects,e=this._indicesByUUID,s=this._bindings,a=s.length,c=this.nCachedObjects_,m=0,v=arguments.length;m!==v;++m){var b=arguments[m],E=b.uuid,S=e[E];if(S!==void 0&&S>=c){var L=c++,I=t[L];e[I.uuid]=S,t[S]=I,e[E]=L,t[L]=b;for(var O=0,U=a;O!==U;++O){var G=s[O],W=G[L],X=G[S];G[S]=W,G[L]=X}}}this.nCachedObjects_=c},i.uncache=function(){for(var t=this._objects,e=this._indicesByUUID,s=this._bindings,a=s.length,c=this.nCachedObjects_,m=t.length,v=0,b=arguments.length;v!==b;++v){var E=arguments[v],S=E.uuid,L=e[S];if(L!==void 0)if(delete e[S],L<c){var I=--c,O=t[I],U=--m,G=t[U];e[O.uuid]=L,t[L]=O,e[G.uuid]=I,t[I]=G,t.pop();for(var W=0,X=a;W!==X;++W){var ie=s[W],$=ie[I],ee=ie[U];ie[L]=$,ie[I]=ee,ie.pop()}}else{var he=--m,oe=t[he];he>0&&(e[oe.uuid]=L),t[L]=oe,t.pop();for(var re=0,me=a;re!==me;++re){var pe=s[re];pe[L]=pe[he],pe.pop()}}}this.nCachedObjects_=c},i.subscribe_=function(t,e){var s=this._bindingsIndicesByPath,a=s[t],c=this._bindings;if(a!==void 0)return c[a];var m=this._paths,v=this._parsedPaths,b=this._objects,E=b.length,S=this.nCachedObjects_,L=new Array(E);a=c.length,s[t]=a,m.push(t),v.push(e),c.push(L);for(var I=S,O=b.length;I!==O;++I){var U=b[I];L[I]=new Ti(U,t,e)}return L},i.unsubscribe_=function(t){var e=this._bindingsIndicesByPath,s=e[t];if(s!==void 0){var a=this._paths,c=this._parsedPaths,m=this._bindings,v=m.length-1,b=m[v];e[t[v]]=s,m[s]=b,m.pop(),c[s]=c[v],c.pop(),a[s]=a[v],a.pop()}},o}();Cc.prototype.isAnimationObjectGroup=!0;var rf=function(){function o(t,e,s,a){s===void 0&&(s=null),a===void 0&&(a=e.blendMode),this._mixer=t,this._clip=e,this._localRoot=s,this.blendMode=a;for(var c=e.tracks,m=c.length,v=new Array(m),b={endingStart:Ut,endingEnd:Ut},E=0;E!==m;++E){var S=c[E].createInterpolant(null);v[E]=S,S.settings=b}this._interpolantSettings=b,this._interpolants=v,this._propertyBindings=new Array(m),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}var i=o.prototype;return i.play=function(){return this._mixer._activateAction(this),this},i.stop=function(){return this._mixer._deactivateAction(this),this.reset()},i.reset=function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},i.isRunning=function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},i.isScheduled=function(){return this._mixer._isActiveAction(this)},i.startAt=function(t){return this._startTime=t,this},i.setLoop=function(t,e){return this.loop=t,this.repetitions=e,this},i.setEffectiveWeight=function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},i.getEffectiveWeight=function(){return this._effectiveWeight},i.fadeIn=function(t){return this._scheduleFading(t,0,1)},i.fadeOut=function(t){return this._scheduleFading(t,1,0)},i.crossFadeFrom=function(t,e,s){if(t.fadeOut(e),this.fadeIn(e),s){var a=this._clip.duration,c=t._clip.duration,m=c/a,v=a/c;t.warp(1,m,e),this.warp(v,1,e)}return this},i.crossFadeTo=function(t,e,s){return t.crossFadeFrom(this,e,s)},i.stopFading=function(){var t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},i.setEffectiveTimeScale=function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},i.getEffectiveTimeScale=function(){return this._effectiveTimeScale},i.setDuration=function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},i.syncWith=function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},i.halt=function(t){return this.warp(this._effectiveTimeScale,0,t)},i.warp=function(t,e,s){var a=this._mixer,c=a.time,m=this.timeScale,v=this._timeScaleInterpolant;v===null&&(v=a._lendControlInterpolant(),this._timeScaleInterpolant=v);var b=v.parameterPositions,E=v.sampleValues;return b[0]=c,b[1]=c+s,E[0]=t/m,E[1]=e/m,this},i.stopWarping=function(){var t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},i.getMixer=function(){return this._mixer},i.getClip=function(){return this._clip},i.getRoot=function(){return this._localRoot||this._mixer._root},i._update=function(t,e,s,a){if(this.enabled){var c=this._startTime;if(c!==null){var m=(t-c)*s;if(m<0||s===0)return;this._startTime=null,e=s*m}e*=this._updateTimeScale(t);var v=this._updateTime(e),b=this._updateWeight(t);if(b>0){var E=this._interpolants,S=this._propertyBindings;switch(this.blendMode){case Vn:for(var L=0,I=E.length;L!==I;++L)E[L].evaluate(v),S[L].accumulateAdditive(b);break;case Nt:default:for(var O=0,U=E.length;O!==U;++O)E[O].evaluate(v),S[O].accumulate(a,b)}}}else this._updateWeight(t)},i._updateWeight=function(t){var e=0;if(this.enabled){e=this.weight;var s=this._weightInterpolant;if(s!==null){var a=s.evaluate(t)[0];e*=a,t>s.parameterPositions[1]&&(this.stopFading(),a===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e},i._updateTimeScale=function(t){var e=0;if(!this.paused){e=this.timeScale;var s=this._timeScaleInterpolant;s!==null&&(e*=s.evaluate(t)[0],t>s.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},i._updateTime=function(t){var e=this._clip.duration,s=this.loop,a=this.time+t,c=this._loopCount,m=s===2202;if(t===0)return c===-1?a:m&&(1&c)==1?e-a:a;if(s===2200){c===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(a>=e)a=e;else{if(!(a<0)){this.time=a;break e}a=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(c===-1&&(t>=0?(c=0,this._setEndings(!0,this.repetitions===0,m)):this._setEndings(this.repetitions===0,!0,m)),a>=e||a<0){var v=Math.floor(a/e);a-=e*v,c+=Math.abs(v);var b=this.repetitions-c;if(b<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a=t>0?e:0,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(b===1){var E=t<0;this._setEndings(E,!E,m)}else this._setEndings(!1,!1,m);this._loopCount=c,this.time=a,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:v})}}else this.time=a;if(m&&(1&c)==1)return e-a}return a},i._setEndings=function(t,e,s){var a=this._interpolantSettings;s?(a.endingStart=Zt,a.endingEnd=Zt):(a.endingStart=t?this.zeroSlopeAtStart?Zt:Ut:oi,a.endingEnd=e?this.zeroSlopeAtEnd?Zt:Ut:oi)},i._scheduleFading=function(t,e,s){var a=this._mixer,c=a.time,m=this._weightInterpolant;m===null&&(m=a._lendControlInterpolant(),this._weightInterpolant=m);var v=m.parameterPositions,b=m.sampleValues;return v[0]=c,b[0]=e,v[1]=c+t,b[1]=s,this},o}(),Mc=function(o){function i(e){var s;return(s=o.call(this)||this)._root=e,s._initMemoryManager(),s._accuIndex=0,s.time=0,s.timeScale=1,s}Ne(i,o);var t=i.prototype;return t._bindAction=function(e,s){var a=e._localRoot||this._root,c=e._clip.tracks,m=c.length,v=e._propertyBindings,b=e._interpolants,E=a.uuid,S=this._bindingsByRootAndName,L=S[E];L===void 0&&(L={},S[E]=L);for(var I=0;I!==m;++I){var O=c[I],U=O.name,G=L[U];if(G!==void 0)v[I]=G;else{if((G=v[I])!==void 0){G._cacheIndex===null&&(++G.referenceCount,this._addInactiveBinding(G,E,U));continue}var W=s&&s._propertyBindings[I].binding.parsedPath;++(G=new Ec(Ti.create(a,U,W),O.ValueTypeName,O.getValueSize())).referenceCount,this._addInactiveBinding(G,E,U),v[I]=G}b[I].resultBuffer=G.buffer}},t._activateAction=function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){var s=(e._localRoot||this._root).uuid,a=e._clip.uuid,c=this._actionsByClip[a];this._bindAction(e,c&&c.knownActions[0]),this._addInactiveAction(e,a,s)}for(var m=e._propertyBindings,v=0,b=m.length;v!==b;++v){var E=m[v];E.useCount++==0&&(this._lendBinding(E),E.saveOriginalState())}this._lendAction(e)}},t._deactivateAction=function(e){if(this._isActiveAction(e)){for(var s=e._propertyBindings,a=0,c=s.length;a!==c;++a){var m=s[a];--m.useCount==0&&(m.restoreOriginalState(),this._takeBackBinding(m))}this._takeBackAction(e)}},t._initMemoryManager=function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},t._isActiveAction=function(e){var s=e._cacheIndex;return s!==null&&s<this._nActiveActions},t._addInactiveAction=function(e,s,a){var c=this._actions,m=this._actionsByClip,v=m[s];if(v===void 0)v={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,m[s]=v;else{var b=v.knownActions;e._byClipCacheIndex=b.length,b.push(e)}e._cacheIndex=c.length,c.push(e),v.actionByRoot[a]=e},t._removeInactiveAction=function(e){var s=this._actions,a=s[s.length-1],c=e._cacheIndex;a._cacheIndex=c,s[c]=a,s.pop(),e._cacheIndex=null;var m=e._clip.uuid,v=this._actionsByClip,b=v[m],E=b.knownActions,S=E[E.length-1],L=e._byClipCacheIndex;S._byClipCacheIndex=L,E[L]=S,E.pop(),e._byClipCacheIndex=null,delete b.actionByRoot[(e._localRoot||this._root).uuid],E.length===0&&delete v[m],this._removeInactiveBindingsForAction(e)},t._removeInactiveBindingsForAction=function(e){for(var s=e._propertyBindings,a=0,c=s.length;a!==c;++a){var m=s[a];--m.referenceCount==0&&this._removeInactiveBinding(m)}},t._lendAction=function(e){var s=this._actions,a=e._cacheIndex,c=this._nActiveActions++,m=s[c];e._cacheIndex=c,s[c]=e,m._cacheIndex=a,s[a]=m},t._takeBackAction=function(e){var s=this._actions,a=e._cacheIndex,c=--this._nActiveActions,m=s[c];e._cacheIndex=c,s[c]=e,m._cacheIndex=a,s[a]=m},t._addInactiveBinding=function(e,s,a){var c=this._bindingsByRootAndName,m=this._bindings,v=c[s];v===void 0&&(v={},c[s]=v),v[a]=e,e._cacheIndex=m.length,m.push(e)},t._removeInactiveBinding=function(e){var s=this._bindings,a=e.binding,c=a.rootNode.uuid,m=a.path,v=this._bindingsByRootAndName,b=v[c],E=s[s.length-1],S=e._cacheIndex;E._cacheIndex=S,s[S]=E,s.pop(),delete b[m],Object.keys(b).length===0&&delete v[c]},t._lendBinding=function(e){var s=this._bindings,a=e._cacheIndex,c=this._nActiveBindings++,m=s[c];e._cacheIndex=c,s[c]=e,m._cacheIndex=a,s[a]=m},t._takeBackBinding=function(e){var s=this._bindings,a=e._cacheIndex,c=--this._nActiveBindings,m=s[c];e._cacheIndex=c,s[c]=e,m._cacheIndex=a,s[a]=m},t._lendControlInterpolant=function(){var e=this._controlInterpolants,s=this._nActiveControlInterpolants++,a=e[s];return a===void 0&&((a=new Hr(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=s,e[s]=a),a},t._takeBackControlInterpolant=function(e){var s=this._controlInterpolants,a=e.__cacheIndex,c=--this._nActiveControlInterpolants,m=s[c];e.__cacheIndex=c,s[c]=e,m.__cacheIndex=a,s[a]=m},t.clipAction=function(e,s,a){var c=s||this._root,m=c.uuid,v=typeof e=="string"?Xr.findByName(c,e):e,b=v!==null?v.uuid:e,E=this._actionsByClip[b],S=null;if(a===void 0&&(a=v!==null?v.blendMode:Nt),E!==void 0){var L=E.actionByRoot[m];if(L!==void 0&&L.blendMode===a)return L;S=E.knownActions[0],v===null&&(v=S._clip)}if(v===null)return null;var I=new rf(this,v,s,a);return this._bindAction(I,S),this._addInactiveAction(I,b,m),I},t.existingAction=function(e,s){var a=s||this._root,c=a.uuid,m=typeof e=="string"?Xr.findByName(a,e):e,v=m?m.uuid:e,b=this._actionsByClip[v];return b!==void 0&&b.actionByRoot[c]||null},t.stopAllAction=function(){for(var e=this._actions,s=this._nActiveActions-1;s>=0;--s)e[s].stop();return this},t.update=function(e){e*=this.timeScale;for(var s=this._actions,a=this._nActiveActions,c=this.time+=e,m=Math.sign(e),v=this._accuIndex^=1,b=0;b!==a;++b)s[b]._update(c,e,m,v);for(var E=this._bindings,S=this._nActiveBindings,L=0;L!==S;++L)E[L].apply(v);return this},t.setTime=function(e){this.time=0;for(var s=0;s<this._actions.length;s++)this._actions[s].time=0;return this.update(e)},t.getRoot=function(){return this._root},t.uncacheClip=function(e){var s=this._actions,a=e.uuid,c=this._actionsByClip,m=c[a];if(m!==void 0){for(var v=m.knownActions,b=0,E=v.length;b!==E;++b){var S=v[b];this._deactivateAction(S);var L=S._cacheIndex,I=s[s.length-1];S._cacheIndex=null,S._byClipCacheIndex=null,I._cacheIndex=L,s[L]=I,s.pop(),this._removeInactiveBindingsForAction(S)}delete c[a]}},t.uncacheRoot=function(e){var s=e.uuid,a=this._actionsByClip;for(var c in a){var m=a[c].actionByRoot[s];m!==void 0&&(this._deactivateAction(m),this._removeInactiveAction(m))}var v=this._bindingsByRootAndName[s];if(v!==void 0)for(var b in v){var E=v[b];E.restoreOriginalState(),this._removeInactiveBinding(E)}},t.uncacheAction=function(e,s){var a=this.existingAction(e,s);a!==null&&(this._deactivateAction(a),this._removeInactiveAction(a))},i}(Si);Mc.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var Tc=function(){function o(i){typeof i=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),i=arguments[1]),this.value=i}return o.prototype.clone=function(){return new o(this.value.clone===void 0?this.value:this.value.clone())},o}();function Ul(o,i,t){ki.call(this,o,i),this.meshPerAttribute=t||1}function kl(o,i,t,e,s){this.buffer=o,this.type=i,this.itemSize=t,this.elementSize=e,this.count=s,this.version=0}function jl(o,i,t,e){t===void 0&&(t=0),e===void 0&&(e=1/0),this.ray=new rn(o,i),this.near=t,this.far=e,this.camera=null,this.layers=new Ot,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Lc(o,i){return o.distance-i.distance}function Vl(o,i,t,e){if(o.layers.test(i.layers)&&o.raycast(i,t),e===!0)for(var s=o.children,a=0,c=s.length;a<c;a++)Vl(s[a],i,t,!0)}Ul.prototype=Object.assign(Object.create(ki.prototype),{constructor:Ul,isInstancedInterleavedBuffer:!0,copy:function(i){return ki.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},clone:function(i){var t=ki.prototype.clone.call(this,i);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(i){var t=ki.prototype.toJSON.call(this,i);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(kl.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),Object.assign(kl.prototype,{isGLBufferAttribute:!0,setBuffer:function(i){return this.buffer=i,this},setType:function(i,t){return this.type=i,this.elementSize=t,this},setItemSize:function(i){return this.itemSize=i,this},setCount:function(i){return this.count=i,this}}),Object.assign(jl.prototype,{set:function(i,t){this.ray.set(i,t)},setFromCamera:function(i,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(i.x,i.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(i.x,i.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(i,t,e){return t===void 0&&(t=!1),e===void 0&&(e=[]),Vl(i,this,e,t),e.sort(Lc),e},intersectObjects:function(i,t,e){t===void 0&&(t=!1),e===void 0&&(e=[]);for(var s=0,a=i.length;s<a;s++)Vl(i[s],this,e,t);return e.sort(Lc),e}});var af=function(){function o(t,e,s){return t===void 0&&(t=1),e===void 0&&(e=0),s===void 0&&(s=0),this.radius=t,this.phi=e,this.theta=s,this}var i=o.prototype;return i.set=function(t,e,s){return this.radius=t,this.phi=e,this.theta=s,this},i.copy=function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},i.makeSafe=function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},i.setFromVector3=function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},i.setFromCartesianCoords=function(t,e,s){return this.radius=Math.sqrt(t*t+e*e+s*s),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,s),this.phi=Math.acos(dt.clamp(e/this.radius,-1,1))),this},i.clone=function(){return new this.constructor().copy(this)},o}(),of=function(){function o(t,e,s){return t===void 0&&(t=1),e===void 0&&(e=0),s===void 0&&(s=0),this.radius=t,this.theta=e,this.y=s,this}var i=o.prototype;return i.set=function(t,e,s){return this.radius=t,this.theta=e,this.y=s,this},i.copy=function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},i.setFromVector3=function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},i.setFromCartesianCoords=function(t,e,s){return this.radius=Math.sqrt(t*t+s*s),this.theta=Math.atan2(t,s),this.y=e,this},i.clone=function(){return new this.constructor().copy(this)},o}(),Pc=new He,ur=function(){function o(t,e){t===void 0&&(t=new He(1/0,1/0)),e===void 0&&(e=new He(-1/0,-1/0)),this.min=t,this.max=e}var i=o.prototype;return i.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},i.setFromPoints=function(t){this.makeEmpty();for(var e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this},i.setFromCenterAndSize=function(t,e){var s=Pc.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this},i.clone=function(){return new this.constructor().copy(this)},i.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},i.makeEmpty=function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},i.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},i.getCenter=function(t){return t===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new He),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},i.getSize=function(t){return t===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new He),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},i.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},i.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},i.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},i.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},i.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},i.getParameter=function(t,e){return e===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new He),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},i.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},i.clampPoint=function(t,e){return e===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new He),e.copy(t).clamp(this.min,this.max)},i.distanceToPoint=function(t){return Pc.copy(t).clamp(this.min,this.max).sub(t).length()},i.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this},i.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},i.translate=function(t){return this.min.add(t),this.max.add(t),this},i.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},o}();ur.prototype.isBox2=!0;var Dc=new se,bo=new se,Rc=function(){function o(t,e){t===void 0&&(t=new se),e===void 0&&(e=new se),this.start=t,this.end=e}var i=o.prototype;return i.set=function(t,e){return this.start.copy(t),this.end.copy(e),this},i.copy=function(t){return this.start.copy(t.start),this.end.copy(t.end),this},i.getCenter=function(t){return t===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new se),t.addVectors(this.start,this.end).multiplyScalar(.5)},i.delta=function(t){return t===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),t=new se),t.subVectors(this.end,this.start)},i.distanceSq=function(){return this.start.distanceToSquared(this.end)},i.distance=function(){return this.start.distanceTo(this.end)},i.at=function(t,e){return e===void 0&&(console.warn("THREE.Line3: .at() target is now required"),e=new se),this.delta(e).multiplyScalar(t).add(this.start)},i.closestPointToPointParameter=function(t,e){Dc.subVectors(t,this.start),bo.subVectors(this.end,this.start);var s=bo.dot(bo),a=bo.dot(Dc)/s;return e&&(a=dt.clamp(a,0,1)),a},i.closestPointToPoint=function(t,e,s){var a=this.closestPointToPointParameter(t,e);return s===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),s=new se),this.delta(s).multiplyScalar(a).add(this.start)},i.applyMatrix4=function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},i.equals=function(t){return t.start.equals(this.start)&&t.end.equals(this.end)},i.clone=function(){return new this.constructor().copy(this)},o}();function sa(o){Ke.call(this),this.material=o,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}sa.prototype=Object.create(Ke.prototype),sa.prototype.constructor=sa,sa.prototype.isImmediateRenderObject=!0;var Bc=new se,lf=function(o){function i(e,s){var a;(a=o.call(this)||this).light=e,a.light.updateMatrixWorld(),a.matrix=e.matrixWorld,a.matrixAutoUpdate=!1,a.color=s;for(var c=new ct,m=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],v=0,b=1;v<32;v++,b++){var E=v/32*Math.PI*2,S=b/32*Math.PI*2;m.push(Math.cos(E),Math.sin(E),1,Math.cos(S),Math.sin(S),1)}c.setAttribute("position",new at(m,3));var L=new yi({fog:!1,toneMapped:!1});return a.cone=new Ii(c,L),a.add(a.cone),a.update(),a}Ne(i,o);var t=i.prototype;return t.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},t.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,s=e*Math.tan(this.light.angle);this.cone.scale.set(s,s,e),Bc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Bc),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)},i}(Ke),ds=new se,xo=new ht,Wl=new ht,Ic=function(o){function i(t){for(var e,s=Oc(t),a=new ct,c=[],m=[],v=new st(0,0,1),b=new st(0,1,0),E=0;E<s.length;E++){var S=s[E];S.parent&&S.parent.isBone&&(c.push(0,0,0),c.push(0,0,0),m.push(v.r,v.g,v.b),m.push(b.r,b.g,b.b))}a.setAttribute("position",new at(c,3)),a.setAttribute("color",new at(m,3));var L=new yi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(e=o.call(this,a,L)||this).type="SkeletonHelper",e.isSkeletonHelper=!0,e.root=t,e.bones=s,e.matrix=t.matrixWorld,e.matrixAutoUpdate=!1,e}return Ne(i,o),i.prototype.updateMatrixWorld=function(t){var e=this.bones,s=this.geometry,a=s.getAttribute("position");Wl.copy(this.root.matrixWorld).invert();for(var c=0,m=0;c<e.length;c++){var v=e[c];v.parent&&v.parent.isBone&&(xo.multiplyMatrices(Wl,v.matrixWorld),ds.setFromMatrixPosition(xo),a.setXYZ(m,ds.x,ds.y,ds.z),xo.multiplyMatrices(Wl,v.parent.matrixWorld),ds.setFromMatrixPosition(xo),a.setXYZ(m+1,ds.x,ds.y,ds.z),m+=2)}s.getAttribute("position").needsUpdate=!0,o.prototype.updateMatrixWorld.call(this,t)},i}(Ii);function Oc(o){var i=[];o&&o.isBone&&i.push(o);for(var t=0;t<o.children.length;t++)i.push.apply(i,Oc(o.children[t]));return i}var hf=function(o){function i(e,s,a){var c,m=new Gr(s,4,2),v=new zn({wireframe:!0,fog:!1,toneMapped:!1});return(c=o.call(this,m,v)||this).light=e,c.light.updateMatrixWorld(),c.color=a,c.type="PointLightHelper",c.matrix=c.light.matrixWorld,c.matrixAutoUpdate=!1,c.update(),c}Ne(i,o);var t=i.prototype;return t.dispose=function(){this.geometry.dispose(),this.material.dispose()},t.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)},i}(Jt),cf=new se,Nc=new st,Fc=new st,uf=function(o){function i(e,s,a){var c;(c=o.call(this)||this).light=e,c.light.updateMatrixWorld(),c.matrix=e.matrixWorld,c.matrixAutoUpdate=!1,c.color=a;var m=new Vr(s);m.rotateY(.5*Math.PI),c.material=new zn({wireframe:!0,fog:!1,toneMapped:!1}),c.color===void 0&&(c.material.vertexColors=!0);var v=m.getAttribute("position"),b=new Float32Array(3*v.count);return m.setAttribute("color",new pt(b,3)),c.add(new Jt(m,c.material)),c.update(),c}Ne(i,o);var t=i.prototype;return t.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},t.update=function(){var e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var s=e.geometry.getAttribute("color");Nc.copy(this.light.color),Fc.copy(this.light.groundColor);for(var a=0,c=s.count;a<c;a++){var m=a<c/2?Nc:Fc;s.setXYZ(a,m.r,m.g,m.b)}s.needsUpdate=!0}e.lookAt(cf.setFromMatrixPosition(this.light.matrixWorld).negate())},i}(Ke),zc=function(o){function i(t,e,s,a){var c;t===void 0&&(t=10),e===void 0&&(e=10),s===void 0&&(s=4473924),a===void 0&&(a=8947848),s=new st(s),a=new st(a);for(var m=e/2,v=t/e,b=t/2,E=[],S=[],L=0,I=0,O=-b;L<=e;L++,O+=v){E.push(-b,0,O,b,0,O),E.push(O,0,-b,O,0,b);var U=L===m?s:a;U.toArray(S,I),I+=3,U.toArray(S,I),I+=3,U.toArray(S,I),I+=3,U.toArray(S,I),I+=3}var G=new ct;G.setAttribute("position",new at(E,3)),G.setAttribute("color",new at(S,3));var W=new yi({vertexColors:!0,toneMapped:!1});return(c=o.call(this,G,W)||this).type="GridHelper",c}return Ne(i,o),i}(Ii),df=function(o){function i(t,e,s,a,c,m){var v;t===void 0&&(t=10),e===void 0&&(e=16),s===void 0&&(s=8),a===void 0&&(a=64),c===void 0&&(c=4473924),m===void 0&&(m=8947848),c=new st(c),m=new st(m);for(var b=[],E=[],S=0;S<=e;S++){var L=S/e*(2*Math.PI),I=Math.sin(L)*t,O=Math.cos(L)*t;b.push(0,0,0),b.push(I,0,O);var U=1&S?c:m;E.push(U.r,U.g,U.b),E.push(U.r,U.g,U.b)}for(var G=0;G<=s;G++)for(var W=1&G?c:m,X=t-t/s*G,ie=0;ie<a;ie++){var $=ie/a*(2*Math.PI),ee=Math.sin($)*X,he=Math.cos($)*X;b.push(ee,0,he),E.push(W.r,W.g,W.b),$=(ie+1)/a*(2*Math.PI),ee=Math.sin($)*X,he=Math.cos($)*X,b.push(ee,0,he),E.push(W.r,W.g,W.b)}var oe=new ct;oe.setAttribute("position",new at(b,3)),oe.setAttribute("color",new at(E,3));var re=new yi({vertexColors:!0,toneMapped:!1});return(v=o.call(this,oe,re)||this).type="PolarGridHelper",v}return Ne(i,o),i}(Ii),Uc=new se,wo=new se,kc=new se,ff=function(o){function i(e,s,a){var c;(c=o.call(this)||this).light=e,c.light.updateMatrixWorld(),c.matrix=e.matrixWorld,c.matrixAutoUpdate=!1,c.color=a,s===void 0&&(s=1);var m=new ct;m.setAttribute("position",new at([-s,s,0,s,s,0,s,-s,0,-s,-s,0,-s,s,0],3));var v=new yi({fog:!1,toneMapped:!1});return c.lightPlane=new vn(m,v),c.add(c.lightPlane),(m=new ct).setAttribute("position",new at([0,0,0,0,0,1],3)),c.targetLine=new vn(m,v),c.add(c.targetLine),c.update(),c}Ne(i,o);var t=i.prototype;return t.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},t.update=function(){Uc.setFromMatrixPosition(this.light.matrixWorld),wo.setFromMatrixPosition(this.light.target.matrixWorld),kc.subVectors(wo,Uc),this.lightPlane.lookAt(wo),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(wo),this.targetLine.scale.z=kc.length()},i}(Ke),So=new se,ri=new rs,pf=function(o){function i(t){var e,s=new ct,a=new yi({color:16777215,vertexColors:!0,toneMapped:!1}),c=[],m=[],v={},b=new st(16755200),E=new st(16711680),S=new st(43775),L=new st(16777215),I=new st(3355443);function O(G,W,X){U(G,X),U(W,X)}function U(G,W){c.push(0,0,0),m.push(W.r,W.g,W.b),v[G]===void 0&&(v[G]=[]),v[G].push(c.length/3-1)}return O("n1","n2",b),O("n2","n4",b),O("n4","n3",b),O("n3","n1",b),O("f1","f2",b),O("f2","f4",b),O("f4","f3",b),O("f3","f1",b),O("n1","f1",b),O("n2","f2",b),O("n3","f3",b),O("n4","f4",b),O("p","n1",E),O("p","n2",E),O("p","n3",E),O("p","n4",E),O("u1","u2",S),O("u2","u3",S),O("u3","u1",S),O("c","t",L),O("p","c",I),O("cn1","cn2",I),O("cn3","cn4",I),O("cf1","cf2",I),O("cf3","cf4",I),s.setAttribute("position",new at(c,3)),s.setAttribute("color",new at(m,3)),(e=o.call(this,s,a)||this).type="CameraHelper",e.camera=t,e.camera.updateProjectionMatrix&&e.camera.updateProjectionMatrix(),e.matrix=t.matrixWorld,e.matrixAutoUpdate=!1,e.pointMap=v,e.update(),e}return Ne(i,o),i.prototype.update=function(){var t=this.geometry,e=this.pointMap;ri.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),hi("c",e,t,ri,0,0,-1),hi("t",e,t,ri,0,0,1),hi("n1",e,t,ri,-1,-1,-1),hi("n2",e,t,ri,1,-1,-1),hi("n3",e,t,ri,-1,1,-1),hi("n4",e,t,ri,1,1,-1),hi("f1",e,t,ri,-1,-1,1),hi("f2",e,t,ri,1,-1,1),hi("f3",e,t,ri,-1,1,1),hi("f4",e,t,ri,1,1,1),hi("u1",e,t,ri,.7,1.1,-1),hi("u2",e,t,ri,-.7,1.1,-1),hi("u3",e,t,ri,0,2,-1),hi("cf1",e,t,ri,-1,0,1),hi("cf2",e,t,ri,1,0,1),hi("cf3",e,t,ri,0,-1,1),hi("cf4",e,t,ri,0,1,1),hi("cn1",e,t,ri,-1,0,-1),hi("cn2",e,t,ri,1,0,-1),hi("cn3",e,t,ri,0,-1,-1),hi("cn4",e,t,ri,0,1,-1),t.getAttribute("position").needsUpdate=!0},i}(Ii);function hi(o,i,t,e,s,a,c){So.set(s,a,c).unproject(e);var m=i[o];if(m!==void 0)for(var v=t.getAttribute("position"),b=0,E=m.length;b<E;b++)v.setXYZ(m[b],So.x,So.y,So.z)}var Gl,jc,fs,Eo=new xi,Vc=function(o){function i(e,s){var a;s===void 0&&(s=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),m=new Float32Array(24),v=new ct;return v.setIndex(new pt(c,1)),v.setAttribute("position",new pt(m,3)),(a=o.call(this,v,new yi({color:s,toneMapped:!1}))||this).object=e,a.type="BoxHelper",a.matrixAutoUpdate=!1,a.update(),a}Ne(i,o);var t=i.prototype;return t.update=function(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Eo.setFromObject(this.object),!Eo.isEmpty()){var s=Eo.min,a=Eo.max,c=this.geometry.attributes.position,m=c.array;m[0]=a.x,m[1]=a.y,m[2]=a.z,m[3]=s.x,m[4]=a.y,m[5]=a.z,m[6]=s.x,m[7]=s.y,m[8]=a.z,m[9]=a.x,m[10]=s.y,m[11]=a.z,m[12]=a.x,m[13]=a.y,m[14]=s.z,m[15]=s.x,m[16]=a.y,m[17]=s.z,m[18]=s.x,m[19]=s.y,m[20]=s.z,m[21]=a.x,m[22]=s.y,m[23]=s.z,c.needsUpdate=!0,this.geometry.computeBoundingSphere()}},t.setFromObject=function(e){return this.object=e,this.update(),this},t.copy=function(e){return Ii.prototype.copy.call(this,e),this.object=e.object,this},i}(Ii),mf=function(o){function i(t,e){var s;e===void 0&&(e=16776960);var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),c=new ct;return c.setIndex(new pt(a,1)),c.setAttribute("position",new at([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),(s=o.call(this,c,new yi({color:e,toneMapped:!1}))||this).box=t,s.type="Box3Helper",s.geometry.computeBoundingSphere(),s}return Ne(i,o),i.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),o.prototype.updateMatrixWorld.call(this,t))},i}(Ii),_f=function(o){function i(t,e,s){var a;e===void 0&&(e=1),s===void 0&&(s=16776960);var c=s,m=new ct;m.setAttribute("position",new at([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),m.computeBoundingSphere(),(a=o.call(this,m,new yi({color:c,toneMapped:!1}))||this).type="PlaneHelper",a.plane=t,a.size=e;var v=new ct;return v.setAttribute("position",new at([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),v.computeBoundingSphere(),a.add(new Jt(v,new zn({color:c,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),a}return Ne(i,o),i.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),o.prototype.updateMatrixWorld.call(this,t)},i}(vn),Wc=new se,gf=function(o){function i(e,s,a,c,m,v){var b;return e===void 0&&(e=new se(0,0,1)),s===void 0&&(s=new se(0,0,0)),a===void 0&&(a=1),c===void 0&&(c=16776960),m===void 0&&(m=.2*a),v===void 0&&(v=.2*m),(b=o.call(this)||this).type="ArrowHelper",Gl===void 0&&((Gl=new ct).setAttribute("position",new at([0,0,0,0,1,0],3)),(jc=new ar(0,.5,1,5,1)).translate(0,-.5,0)),b.position.copy(s),b.line=new vn(Gl,new yi({color:c,toneMapped:!1})),b.line.matrixAutoUpdate=!1,b.add(b.line),b.cone=new Jt(jc,new zn({color:c,toneMapped:!1})),b.cone.matrixAutoUpdate=!1,b.add(b.cone),b.setDirection(e),b.setLength(a,m,v),b}Ne(i,o);var t=i.prototype;return t.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Wc.set(e.z,0,-e.x).normalize();var s=Math.acos(e.y);this.quaternion.setFromAxisAngle(Wc,s)}},t.setLength=function(e,s,a){s===void 0&&(s=.2*e),a===void 0&&(a=.2*s),this.line.scale.set(1,Math.max(1e-4,e-s),1),this.line.updateMatrix(),this.cone.scale.set(a,s,a),this.cone.position.y=e,this.cone.updateMatrix()},t.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},t.copy=function(e){return o.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},i}(Ke),Gc=function(o){function i(t){var e;t===void 0&&(t=1);var s=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],a=new ct;a.setAttribute("position",new at(s,3)),a.setAttribute("color",new at([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var c=new yi({vertexColors:!0,toneMapped:!1});return(e=o.call(this,a,c)||this).type="AxesHelper",e}return Ne(i,o),i}(Ii),Hc=new Float32Array(1),vf=new Int32Array(Hc.buffer),yf={toHalfFloat:function(i){Hc[0]=i;var t=vf[0],e=t>>16&32768,s=t>>12&2047,a=t>>23&255;return a<103?e:a>142?(e|=31744,e|=(a==255?0:1)&&8388607&t):a<113?e|=((s|=2048)>>114-a)+(s>>113-a&1):(e|=a-112<<10|s>>1,e+=1&s)}},Ln=Math.pow(2,8),Kc=[.125,.215,.35,.446,.526,.582],Yc=5+Kc.length,ra=20,Pn=((fs={})[3e3]=0,fs[3001]=1,fs[3002]=2,fs[3004]=3,fs[3005]=4,fs[3006]=5,fs[3007]=6,fs),Os=new zn({side:1,depthWrite:!1,depthTest:!1}),bf=new Jt(new Ss,Os),Hl=new ta,Kl=Sf(),aa=Kl._lodPlanes,Xc=Kl._sizeLods,Ao=Kl._sigmas,Zc=new st,Yl=null,Ns=(1+Math.sqrt(5))/2,dr=1/Ns,qc=[new se(1,1,1),new se(-1,1,1),new se(1,1,-1),new se(-1,1,-1),new se(0,Ns,dr),new se(0,Ns,-dr),new se(dr,0,Ns),new se(-dr,0,Ns),new se(Ns,dr,0),new se(-Ns,dr,0)];function Qc(o){var i=Math.max(o.r,o.g,o.b),t=Math.min(Math.max(Math.ceil(Math.log2(i)),-128),127);return o.multiplyScalar(Math.pow(2,-t)),(t+128)/255}var xf=function(){function o(t){var e,s,a;this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=(e=ra,s=new Float32Array(e),a=new se(0,1,0),new hr({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:s},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a},inputEncoding:{value:Pn[3e3]},outputEncoding:{value:Pn[3e3]}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}var i=o.prototype;return i.fromScene=function(t,e,s,a){e===void 0&&(e=0),s===void 0&&(s=.1),a===void 0&&(a=100),Yl=this._renderer.getRenderTarget();var c=this._allocateTargets();return this._sceneToCubeUV(t,s,a,c),e>0&&this._blur(c,0,0,e),this._applyPMREM(c),this._cleanup(c),c},i.fromEquirectangular=function(t){return this._fromTexture(t)},i.fromCubemap=function(t){return this._fromTexture(t)},i.compileCubemapShader=function(){this._cubemapShader===null&&(this._cubemapShader=eu(),this._compileMaterial(this._cubemapShader))},i.compileEquirectangularShader=function(){this._equirectShader===null&&(this._equirectShader=$c(),this._compileMaterial(this._equirectShader))},i.dispose=function(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(var t=0;t<aa.length;t++)aa[t].dispose()},i._cleanup=function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Yl),t.scissorTest=!1,Co(t,0,0,t.width,t.height)},i._fromTexture=function(t){Yl=this._renderer.getRenderTarget();var e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},i._allocateTargets=function(t){var e={magFilter:x,minFilter:x,generateMipmaps:!1,type:z,format:1023,encoding:wf(t)?t.encoding:ms,depthBuffer:!1},s=Jc(e);return s.depthBuffer=!t,this._pingPongRenderTarget=Jc(e),s},i._compileMaterial=function(t){var e=new Jt(aa[0],t);this._renderer.compile(e,Hl)},i._sceneToCubeUV=function(t,e,s,a){var c=new di(90,1,e,s),m=[1,-1,1,1,1,1],v=[1,1,1,-1,-1,-1],b=this._renderer,E=b.autoClear,S=b.outputEncoding,L=b.toneMapping;b.getClearColor(Zc),b.toneMapping=0,b.outputEncoding=_i,b.autoClear=!1;var I=!1,O=t.background;if(O){if(O.isColor){Os.color.copy(O).convertSRGBToLinear(),t.background=null;var U=Qc(Os.color);Os.opacity=U,I=!0}}else{Os.color.copy(Zc).convertSRGBToLinear();var G=Qc(Os.color);Os.opacity=G,I=!0}for(var W=0;W<6;W++){var X=W%3;X==0?(c.up.set(0,m[W],0),c.lookAt(v[W],0,0)):X==1?(c.up.set(0,0,m[W]),c.lookAt(0,v[W],0)):(c.up.set(0,m[W],0),c.lookAt(0,0,v[W])),Co(a,X*Ln,W>2?Ln:0,Ln,Ln),b.setRenderTarget(a),I&&b.render(bf,c),b.render(t,c)}b.toneMapping=L,b.outputEncoding=S,b.autoClear=E},i._textureToCubeUV=function(t,e){var s=this._renderer;t.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=eu()):this._equirectShader==null&&(this._equirectShader=$c());var a=t.isCubeTexture?this._cubemapShader:this._equirectShader,c=new Jt(aa[0],a),m=a.uniforms;m.envMap.value=t,t.isCubeTexture||m.texelSize.value.set(1/t.image.width,1/t.image.height),m.inputEncoding.value=Pn[t.encoding],m.outputEncoding.value=Pn[e.texture.encoding],Co(e,0,0,3*Ln,2*Ln),s.setRenderTarget(e),s.render(c,Hl)},i._applyPMREM=function(t){var e=this._renderer,s=e.autoClear;e.autoClear=!1;for(var a=1;a<Yc;a++){var c=Math.sqrt(Ao[a]*Ao[a]-Ao[a-1]*Ao[a-1]),m=qc[(a-1)%qc.length];this._blur(t,a-1,a,c,m)}e.autoClear=s},i._blur=function(t,e,s,a,c){var m=this._pingPongRenderTarget;this._halfBlur(t,m,e,s,a,"latitudinal",c),this._halfBlur(m,t,s,s,a,"longitudinal",c)},i._halfBlur=function(t,e,s,a,c,m,v){var b=this._renderer,E=this._blurMaterial;m!=="latitudinal"&&m!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");var S=new Jt(aa[a],E),L=E.uniforms,I=Xc[s]-1,O=isFinite(c)?Math.PI/(2*I):2*Math.PI/39,U=c/O,G=isFinite(c)?1+Math.floor(3*U):ra;G>ra&&console.warn("sigmaRadians, "+c+", is too large and will clip, as it requested "+G+" samples when the maximum is set to "+ra);for(var W=[],X=0,ie=0;ie<ra;++ie){var $=ie/U,ee=Math.exp(-$*$/2);W.push(ee),ie==0?X+=ee:ie<G&&(X+=2*ee)}for(var he=0;he<W.length;he++)W[he]=W[he]/X;L.envMap.value=t.texture,L.samples.value=G,L.weights.value=W,L.latitudinal.value=m==="latitudinal",v&&(L.poleAxis.value=v),L.dTheta.value=O,L.mipInt.value=8-s,L.inputEncoding.value=Pn[t.texture.encoding],L.outputEncoding.value=Pn[t.texture.encoding];var oe=Xc[a];Co(e,3*Math.max(0,Ln-2*oe),(a===0?0:2*Ln)+2*oe*(a>4?a-8+4:0),3*oe,2*oe),b.setRenderTarget(e),b.render(S,Hl)},o}();function wf(o){return o!==void 0&&o.type===z&&(o.encoding===_i||o.encoding===Wn||o.encoding===Gn)}function Sf(){for(var o=[],i=[],t=[],e=8,s=0;s<Yc;s++){var a=Math.pow(2,e);i.push(a);var c=1/a;s>4?c=Kc[s-8+4-1]:s==0&&(c=0),t.push(c);for(var m=1/(a-1),v=-m/2,b=1+m/2,E=[v,v,b,v,b,b,v,v,b,b,v,b],S=new Float32Array(108),L=new Float32Array(72),I=new Float32Array(36),O=0;O<6;O++){var U=O%3*2/3-1,G=O>2?0:-1,W=[U,G,0,U+2/3,G,0,U+2/3,G+1,0,U,G,0,U+2/3,G+1,0,U,G+1,0];S.set(W,18*O),L.set(E,12*O);var X=[O,O,O,O,O,O];I.set(X,6*O)}var ie=new ct;ie.setAttribute("position",new pt(S,3)),ie.setAttribute("uv",new pt(L,2)),ie.setAttribute("faceIndex",new pt(I,1)),o.push(ie),e>4&&e--}return{_lodPlanes:o,_sizeLods:i,_sigmas:t}}function Jc(o){var i=new tn(3*Ln,3*Ln,o);return i.texture.mapping=h,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Co(o,i,t,e,s){o.viewport.set(i,t,e,s),o.scissor.set(i,t,e,s)}function $c(){var o=new He(1,1);return new hr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:o},inputEncoding:{value:Pn[3e3]},outputEncoding:{value:Pn[3e3]}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function eu(){return new hr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Pn[3e3]},outputEncoding:{value:Pn[3e3]}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}Ni.create=function(o,i){return console.log("THREE.Curve.create() has been deprecated"),o.prototype=Object.create(Ni.prototype),o.prototype.constructor=o,o.prototype.getPoint=i,o},$r.prototype.fromPoints=function(o){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(o)},zc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Ic.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},si.prototype.extractUrlBase=function(o){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Bl.extractUrlBase(o)},si.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},ur.prototype.center=function(o){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(o)},ur.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ur.prototype.isIntersectionBox=function(o){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)},ur.prototype.size=function(o){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(o)},xi.prototype.center=function(o){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(o)},xi.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},xi.prototype.isIntersectionBox=function(o){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)},xi.prototype.isIntersectionSphere=function(o){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(o)},xi.prototype.size=function(o){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(o)},mn.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Tr.prototype.setFromMatrix=function(o){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(o)},Rc.prototype.center=function(o){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(o)},dt.random16=function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},dt.nearestPowerOfTwo=function(o){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),dt.floorPowerOfTwo(o)},dt.nextPowerOfTwo=function(o){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),dt.ceilPowerOfTwo(o)},Wt.prototype.flattenToArrayOffset=function(o,i){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(o,i)},Wt.prototype.multiplyVector3=function(o){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),o.applyMatrix3(this)},Wt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Wt.prototype.applyToBufferAttribute=function(o){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),o.applyMatrix3(this)},Wt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Wt.prototype.getInverse=function(o){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(o).invert()},ht.prototype.extractPosition=function(o){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(o)},ht.prototype.flattenToArrayOffset=function(o,i){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(o,i)},ht.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new se().setFromMatrixColumn(this,3)},ht.prototype.setRotationFromQuaternion=function(o){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(o)},ht.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},ht.prototype.multiplyVector3=function(o){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)},ht.prototype.multiplyVector4=function(o){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)},ht.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},ht.prototype.rotateAxis=function(o){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),o.transformDirection(this)},ht.prototype.crossVector=function(o){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)},ht.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},ht.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},ht.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},ht.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},ht.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},ht.prototype.applyToBufferAttribute=function(o){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)},ht.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},ht.prototype.makeFrustum=function(o,i,t,e,s,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(o,i,e,t,s,a)},ht.prototype.getInverse=function(o){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(o).invert()},Bi.prototype.isIntersectionLine=function(o){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(o)},ni.prototype.multiplyVector3=function(o){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),o.applyQuaternion(this)},ni.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},rn.prototype.isIntersectionBox=function(o){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)},rn.prototype.isIntersectionPlane=function(o){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(o)},rn.prototype.isIntersectionSphere=function(o){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(o)},wi.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},wi.prototype.barycoordFromPoint=function(o,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(o,i)},wi.prototype.midpoint=function(o){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(o)},wi.prototypenormal=function(o){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(o)},wi.prototype.plane=function(o){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(o)},wi.barycoordFromPoint=function(o,i,t,e,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),wi.getBarycoord(o,i,t,e,s)},wi.normal=function(o,i,t,e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),wi.getNormal(o,i,t,e)},us.prototype.extractAllPoints=function(o){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(o)},us.prototype.extrude=function(o){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new kn(this,o)},us.prototype.makeGeometry=function(o){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Wr(this,o)},He.prototype.fromAttribute=function(o,i,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,i,t)},He.prototype.distanceToManhattan=function(o){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(o)},He.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},se.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},se.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},se.prototype.getPositionFromMatrix=function(o){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(o)},se.prototype.getScaleFromMatrix=function(o){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(o)},se.prototype.getColumnFromMatrix=function(o,i){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(i,o)},se.prototype.applyProjection=function(o){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(o)},se.prototype.fromAttribute=function(o,i,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,i,t)},se.prototype.distanceToManhattan=function(o){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(o)},se.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ft.prototype.fromAttribute=function(o,i,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,i,t)},Ft.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ke.prototype.getChildByName=function(o){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(o)},Ke.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Ke.prototype.translate=function(o,i){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(i,o)},Ke.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Ke.prototype.applyMatrix=function(o){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(o)},Object.defineProperties(Ke.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Jt.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Jt.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Zo.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(qo.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Nr.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ni.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(i){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=i}}),di.prototype.setLens=function(o,i){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),i!==void 0&&(this.filmGauge=i),this.setFocalLength(o)},Object.defineProperties(xn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}}),Object.defineProperties(pt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Vi},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Vi)}}}),pt.prototype.setDynamic=function(o){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(o===!0?Vi:un),this},pt.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},pt.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ct.prototype.addIndex=function(o){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(o)},ct.prototype.addAttribute=function(o,i){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),i&&i.isBufferAttribute||i&&i.isInterleavedBufferAttribute?o==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(i),this):this.setAttribute(o,i):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(o,new pt(arguments[1],arguments[2])))},ct.prototype.addDrawCall=function(o,i,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(o,i)},ct.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},ct.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},ct.prototype.removeAttribute=function(o){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(o)},ct.prototype.applyMatrix=function(o){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(o)},Object.defineProperties(ct.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(na.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(i){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=i}}}),Object.defineProperties(jl.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(i){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=i}}}),Object.defineProperties(ki.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Vi},set:function(i){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(i)}}}),ki.prototype.setDynamic=function(o){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(o===!0?Vi:un),this},ki.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},kn.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},kn.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},kn.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Ra.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(Tc.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Gt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new st}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===1}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}}}),Object.defineProperties(ao.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(cs.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(i){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=i}}}),Object.defineProperties(Ui.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}}),Kt.prototype.clearTarget=function(o,i,t,e){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(o),this.clear(i,t,e)},Kt.prototype.animate=function(o){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(o)},Kt.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Kt.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Kt.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Kt.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Kt.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Kt.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Kt.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Kt.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Kt.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Kt.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Kt.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Kt.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Kt.prototype.enableScissorTest=function(o){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(o)},Kt.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Kt.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Kt.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Kt.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Kt.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Kt.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Kt.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Kt.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Kt.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Kt.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Kt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?Wn:_i}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(bh.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(tn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}}),Object.defineProperties(Fl.prototype,{load:{value:function(i){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return new pc().load(i,function(e){t.setBuffer(e)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Sc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ca.prototype.updateCubeMap=function(o,i){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(o,i)},Ca.prototype.clear=function(o,i,t,e){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(o,i,t,e)},Hi.crossOrigin=void 0,Hi.loadTexture=function(o,i,t,e){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var s=new fo;s.setCrossOrigin(this.crossOrigin);var a=s.load(o,t,void 0,e);return i&&(a.mapping=i),a},Hi.loadTextureCube=function(o,i,t,e){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var s=new Jh;s.setCrossOrigin(this.crossOrigin);var a=s.load(o,t,void 0,e);return i&&(a.mapping=i),a},Hi.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Hi.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Ef={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:B}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=B),f.ACESFilmicToneMapping=4,f.AddEquation=d,f.AddOperation=2,f.AdditiveAnimationBlendMode=Vn,f.AdditiveBlending=2,f.AlphaFormat=1021,f.AlwaysDepth=1,f.AlwaysStencilFunc=519,f.AmbientLight=Pl,f.AmbientLightProbe=_c,f.AnimationClip=Xr,f.AnimationLoader=Ud,f.AnimationMixer=Mc,f.AnimationObjectGroup=Cc,f.AnimationUtils=$t,f.ArcCurve=ml,f.ArrayCamera=Da,f.ArrowHelper=gf,f.Audio=Fl,f.AudioAnalyser=Sc,f.AudioContext=Nl,f.AudioListener=Kd,f.AudioLoader=pc,f.AxesHelper=Gc,f.AxisHelper=function(o){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Gc(o)},f.BackSide=1,f.BasicDepthPacking=3200,f.BasicShadowMap=0,f.BinaryTextureLoader=function(o){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new uo(o)},f.Bone=Fr,f.BooleanKeyframeTrack=Ts,f.BoundingBoxHelper=function(o,i){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Vc(o,i)},f.Box2=ur,f.Box3=xi,f.Box3Helper=mf,f.BoxBufferGeometry=Ss,f.BoxGeometry=Ss,f.BoxHelper=Vc,f.BufferAttribute=pt,f.BufferGeometry=ct,f.BufferGeometryLoader=cc,f.ByteType=1010,f.Cache=Ps,f.Camera=rs,f.CameraHelper=pf,f.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},f.CanvasTexture=Wh,f.CatmullRomCurve3=bl,f.CineonToneMapping=3,f.CircleBufferGeometry=Ga,f.CircleGeometry=Ga,f.ClampToEdgeWrapping=p,f.Clock=yc,f.Color=st,f.ColorKeyframeTrack=dl,f.CompressedTexture=el,f.CompressedTextureLoader=pl,f.ConeBufferGeometry=Ha,f.ConeGeometry=Ha,f.CubeCamera=Ca,f.CubeReflectionMapping=_,f.CubeRefractionMapping=l,f.CubeTexture=Qs,f.CubeTextureLoader=Jh,f.CubeUVReflectionMapping=h,f.CubeUVRefractionMapping=u,f.CubicBezierCurve=mo,f.CubicBezierCurve3=xl,f.CubicInterpolant=oo,f.CullFaceBack=1,f.CullFaceFront=2,f.CullFaceFrontBack=3,f.CullFaceNone=0,f.Curve=Ni,f.CurvePath=tc,f.CustomBlending=5,f.CustomToneMapping=5,f.CylinderBufferGeometry=ar,f.CylinderGeometry=ar,f.Cylindrical=of,f.DataTexture=Js,f.DataTexture2DArray=Vo,f.DataTexture3D=Wo,f.DataTextureLoader=uo,f.DataUtils=yf,f.DecrementStencilOp=7683,f.DecrementWrapStencilOp=34056,f.DefaultLoadingManager=Qh,f.DepthFormat=ae,f.DepthStencilFormat=j,f.DepthTexture=Gh,f.DirectionalLight=Ll,f.DirectionalLightHelper=ff,f.DiscreteInterpolant=lo,f.DodecahedronBufferGeometry=Ka,f.DodecahedronGeometry=Ka,f.DoubleSide=2,f.DstAlphaFactor=206,f.DstColorFactor=208,f.DynamicBufferAttribute=function(o,i){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new pt(o,i).setUsage(Vi)},f.DynamicCopyUsage=35050,f.DynamicDrawUsage=Vi,f.DynamicReadUsage=35049,f.EdgesGeometry=il,f.EdgesHelper=function(o,i){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Ii(new il(o.geometry),new yi({color:i!==void 0?i:16777215}))},f.EllipseCurve=Zr,f.EqualDepth=4,f.EqualStencilFunc=514,f.EquirectangularReflectionMapping=n,f.EquirectangularRefractionMapping=r,f.Euler=ft,f.EventDispatcher=Si,f.ExtrudeBufferGeometry=kn,f.ExtrudeGeometry=kn,f.FaceColors=1,f.FileLoader=cn,f.FlatShading=1,f.Float16BufferAttribute=Er,f.Float32Attribute=function(o,i){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new at(o,i)},f.Float32BufferAttribute=at,f.Float64Attribute=function(o,i){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Ar(o,i)},f.Float64BufferAttribute=Ar,f.FloatType=P,f.Fog=Yo,f.FogExp2=Ko,f.Font=Ol,f.FontLoader=Wd,f.FrontSide=0,f.Frustum=Tr,f.GLBufferAttribute=kl,f.GLSL1="100",f.GLSL3=Hn,f.GammaEncoding=Gn,f.GreaterDepth=6,f.GreaterEqualDepth=5,f.GreaterEqualStencilFunc=518,f.GreaterStencilFunc=516,f.GridHelper=zc,f.Group=Es,f.HalfFloatType=Z,f.HemisphereLight=El,f.HemisphereLightHelper=uf,f.HemisphereLightProbe=mc,f.IcosahedronBufferGeometry=Ja,f.IcosahedronGeometry=Ja,f.ImageBitmapLoader=Il,f.ImageLoader=co,f.ImageUtils=Hi,f.ImmediateRenderObject=sa,f.IncrementStencilOp=7682,f.IncrementWrapStencilOp=34055,f.InstancedBufferAttribute=vo,f.InstancedBufferGeometry=na,f.InstancedInterleavedBuffer=Ul,f.InstancedMesh=ka,f.Int16Attribute=function(o,i){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new wr(o,i)},f.Int16BufferAttribute=wr,f.Int32Attribute=function(o,i){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Sr(o,i)},f.Int32BufferAttribute=Sr,f.Int8Attribute=function(o,i){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new yr(o,i)},f.Int8BufferAttribute=yr,f.IntType=1013,f.InterleavedBuffer=ki,f.InterleavedBufferAttribute=os,f.Interpolant=Qi,f.InterpolateDiscrete=nt,f.InterpolateLinear=$e,f.InterpolateSmooth=_t,f.InvertStencilOp=5386,f.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},f.KeepStencilOp=ji,f.KeyframeTrack=yn,f.LOD=Zo,f.LatheBufferGeometry=$a,f.LatheGeometry=$a,f.Layers=Ot,f.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},f.LessDepth=2,f.LessEqualDepth=3,f.LessEqualStencilFunc=515,f.LessStencilFunc=513,f.Light=xn,f.LightProbe=ia,f.Line=vn,f.Line3=Rc,f.LineBasicMaterial=yi,f.LineCurve=Jr,f.LineCurve3=ec,f.LineDashedMaterial=ul,f.LineLoop=Jo,f.LinePieces=1,f.LineSegments=Ii,f.LineStrip=0,f.LinearEncoding=_i,f.LinearFilter=T,f.LinearInterpolant=Hr,f.LinearMipMapLinearFilter=1008,f.LinearMipMapNearestFilter=1007,f.LinearMipmapLinearFilter=C,f.LinearMipmapNearestFilter=A,f.LinearToneMapping=1,f.Loader=si,f.LoaderUtils=Bl,f.LoadingManager=fl,f.LogLuvEncoding=3003,f.LoopOnce=2200,f.LoopPingPong=2202,f.LoopRepeat=2201,f.LuminanceAlphaFormat=1025,f.LuminanceFormat=1024,f.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},f.Material=Gt,f.MaterialLoader=hc,f.Math=dt,f.MathUtils=dt,f.Matrix3=Wt,f.Matrix4=ht,f.MaxEquation=104,f.Mesh=Jt,f.MeshBasicMaterial=zn,f.MeshDepthMaterial=La,f.MeshDistanceMaterial=Pa,f.MeshFaceMaterial=function(o){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),o},f.MeshLambertMaterial=hl,f.MeshMatcapMaterial=cl,f.MeshNormalMaterial=ll,f.MeshPhongMaterial=ao,f.MeshPhysicalMaterial=cs,f.MeshStandardMaterial=Tn,f.MeshToonMaterial=ol,f.MinEquation=103,f.MirroredRepeatWrapping=y,f.MixOperation=1,f.MultiMaterial=function(o){return o===void 0&&(o=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),o.isMultiMaterial=!0,o.materials=o,o.clone=function(){return o.slice()},o},f.MultiplyBlending=4,f.MultiplyOperation=0,f.NearestFilter=x,f.NearestMipMapLinearFilter=1005,f.NearestMipMapNearestFilter=1004,f.NearestMipmapLinearFilter=M,f.NearestMipmapNearestFilter=w,f.NeverDepth=0,f.NeverStencilFunc=512,f.NoBlending=0,f.NoColors=0,f.NoToneMapping=0,f.NormalAnimationBlendMode=Nt,f.NormalBlending=1,f.NotEqualDepth=7,f.NotEqualStencilFunc=517,f.NumberKeyframeTrack=Kr,f.Object3D=Ke,f.ObjectLoader=kd,f.ObjectSpaceNormalMap=1,f.OctahedronBufferGeometry=Vr,f.OctahedronGeometry=Vr,f.OneFactor=201,f.OneMinusDstAlphaFactor=207,f.OneMinusDstColorFactor=209,f.OneMinusSrcAlphaFactor=205,f.OneMinusSrcColorFactor=203,f.OrthographicCamera=ta,f.PCFShadowMap=1,f.PCFSoftShadowMap=2,f.PMREMGenerator=xf,f.ParametricBufferGeometry=Ms,f.ParametricGeometry=Ms,f.Particle=function(o){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Na(o)},f.ParticleBasicMaterial=function(o){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Cs(o)},f.ParticleSystem=function(o,i){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new rr(o,i)},f.ParticleSystemMaterial=function(o){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Cs(o)},f.Path=$r,f.PerspectiveCamera=di,f.Plane=Bi,f.PlaneBufferGeometry=Lr,f.PlaneGeometry=Lr,f.PlaneHelper=_f,f.PointCloud=function(o,i){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new rr(o,i)},f.PointCloudMaterial=function(o){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Cs(o)},f.PointLight=Tl,f.PointLightHelper=hf,f.Points=rr,f.PointsMaterial=Cs,f.PolarGridHelper=df,f.PolyhedronBufferGeometry=ls,f.PolyhedronGeometry=ls,f.PositionalAudio=Xd,f.PropertyBinding=Ti,f.PropertyMixer=Ec,f.QuadraticBezierCurve=_o,f.QuadraticBezierCurve3=wl,f.Quaternion=ni,f.QuaternionKeyframeTrack=cr,f.QuaternionLinearInterpolant=ho,f.REVISION=B,f.RGBADepthPacking=3201,f.RGBAFormat=k,f.RGBAIntegerFormat=1033,f.RGBA_ASTC_10x10_Format=37819,f.RGBA_ASTC_10x5_Format=37816,f.RGBA_ASTC_10x6_Format=37817,f.RGBA_ASTC_10x8_Format=37818,f.RGBA_ASTC_12x10_Format=37820,f.RGBA_ASTC_12x12_Format=37821,f.RGBA_ASTC_4x4_Format=37808,f.RGBA_ASTC_5x4_Format=37809,f.RGBA_ASTC_5x5_Format=37810,f.RGBA_ASTC_6x5_Format=37811,f.RGBA_ASTC_6x6_Format=37812,f.RGBA_ASTC_8x5_Format=37813,f.RGBA_ASTC_8x6_Format=37814,f.RGBA_ASTC_8x8_Format=37815,f.RGBA_BPTC_Format=36492,f.RGBA_ETC2_EAC_Format=Re,f.RGBA_PVRTC_2BPPV1_Format=je,f.RGBA_PVRTC_4BPPV1_Format=be,f.RGBA_S3TC_DXT1_Format=J,f.RGBA_S3TC_DXT3_Format=te,f.RGBA_S3TC_DXT5_Format=_e,f.RGBDEncoding=Sn,f.RGBEEncoding=ms,f.RGBEFormat=1023,f.RGBFormat=Y,f.RGBIntegerFormat=1032,f.RGBM16Encoding=bt,f.RGBM7Encoding=In,f.RGB_ETC1_Format=36196,f.RGB_ETC2_Format=ze,f.RGB_PVRTC_2BPPV1_Format=le,f.RGB_PVRTC_4BPPV1_Format=ne,f.RGB_S3TC_DXT1_Format=F,f.RGFormat=1030,f.RGIntegerFormat=1031,f.RawShaderMaterial=hr,f.Ray=rn,f.Raycaster=jl,f.RectAreaLight=Dl,f.RedFormat=1028,f.RedIntegerFormat=1029,f.ReinhardToneMapping=2,f.RepeatWrapping=g,f.ReplaceStencilOp=7681,f.ReverseSubtractEquation=102,f.RingBufferGeometry=eo,f.RingGeometry=eo,f.SRGB8_ALPHA8_ASTC_10x10_Format=37851,f.SRGB8_ALPHA8_ASTC_10x5_Format=37848,f.SRGB8_ALPHA8_ASTC_10x6_Format=37849,f.SRGB8_ALPHA8_ASTC_10x8_Format=37850,f.SRGB8_ALPHA8_ASTC_12x10_Format=37852,f.SRGB8_ALPHA8_ASTC_12x12_Format=37853,f.SRGB8_ALPHA8_ASTC_4x4_Format=37840,f.SRGB8_ALPHA8_ASTC_5x4_Format=37841,f.SRGB8_ALPHA8_ASTC_5x5_Format=37842,f.SRGB8_ALPHA8_ASTC_6x5_Format=37843,f.SRGB8_ALPHA8_ASTC_6x6_Format=37844,f.SRGB8_ALPHA8_ASTC_8x5_Format=37845,f.SRGB8_ALPHA8_ASTC_8x6_Format=37846,f.SRGB8_ALPHA8_ASTC_8x8_Format=37847,f.Scene=Ra,f.SceneUtils=Ef,f.ShaderChunk=Lt,f.ShaderLib=gn,f.ShaderMaterial=Ui,f.ShadowMaterial=al,f.Shape=us,f.ShapeBufferGeometry=Wr,f.ShapeGeometry=Wr,f.ShapePath=fc,f.ShapeUtils=Un,f.ShortType=1011,f.Skeleton=qo,f.SkeletonHelper=Ic,f.SkinnedMesh=Nr,f.SmoothShading=2,f.Sphere=mn,f.SphereBufferGeometry=Gr,f.SphereGeometry=Gr,f.Spherical=af,f.SphericalHarmonics3=Rl,f.SplineCurve=go,f.SpotLight=Cl,f.SpotLightHelper=lf,f.Sprite=Na,f.SpriteMaterial=Ba,f.SrcAlphaFactor=204,f.SrcAlphaSaturateFactor=210,f.SrcColorFactor=202,f.StaticCopyUsage=35046,f.StaticDrawUsage=un,f.StaticReadUsage=35045,f.StereoCamera=Gd,f.StreamCopyUsage=35042,f.StreamDrawUsage=35040,f.StreamReadUsage=35041,f.StringKeyframeTrack=Ls,f.SubtractEquation=101,f.SubtractiveBlending=3,f.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},f.TangentSpaceNormalMap=0,f.TetrahedronBufferGeometry=to,f.TetrahedronGeometry=to,f.TextBufferGeometry=io,f.TextGeometry=io,f.Texture=ui,f.TextureLoader=fo,f.TorusBufferGeometry=no,f.TorusGeometry=no,f.TorusKnotBufferGeometry=so,f.TorusKnotGeometry=so,f.Triangle=wi,f.TriangleFanDrawMode=2,f.TriangleStripDrawMode=1,f.TrianglesDrawMode=0,f.TubeBufferGeometry=ro,f.TubeGeometry=ro,f.UVMapping=N,f.Uint16Attribute=function(o,i){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new xs(o,i)},f.Uint16BufferAttribute=xs,f.Uint32Attribute=function(o,i){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new ws(o,i)},f.Uint32BufferAttribute=ws,f.Uint8Attribute=function(o,i){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new br(o,i)},f.Uint8BufferAttribute=br,f.Uint8ClampedAttribute=function(o,i){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new xr(o,i)},f.Uint8ClampedBufferAttribute=xr,f.Uniform=Tc,f.UniformsLib=et,f.UniformsUtils=Ql,f.UnsignedByteType=z,f.UnsignedInt248Type=K,f.UnsignedIntType=q,f.UnsignedShort4444Type=1017,f.UnsignedShort5551Type=1018,f.UnsignedShort565Type=1019,f.UnsignedShortType=H,f.VSMShadowMap=3,f.Vector2=He,f.Vector3=se,f.Vector4=Ft,f.VectorKeyframeTrack=Yr,f.Vertex=function(o,i,t){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new se(o,i,t)},f.VertexColors=2,f.VideoTexture=Vh,f.WebGL1Renderer=Sh,f.WebGLCubeRenderTarget=Ma,f.WebGLMultisampleRenderTarget=Xn,f.WebGLRenderTarget=tn,f.WebGLRenderTargetCube=function(o,i,t){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ma(o,t)},f.WebGLRenderer=Kt,f.WebGLUtils=xh,f.WireframeGeometry=rl,f.WireframeHelper=function(o,i){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Ii(new rl(o.geometry),new yi({color:i!==void 0?i:16777215}))},f.WrapAroundEnding=oi,f.XHRLoader=function(o){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new cn(o)},f.ZeroCurvatureEnding=Ut,f.ZeroFactor=200,f.ZeroSlopeEnding=Zt,f.ZeroStencilOp=0,f.sRGBEncoding=Wn,Object.defineProperty(f,"__esModule",{value:!0})})},688:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(3660),f(4371),f(210),f(8976)],B=f.dj.d(R,function(d,N,_,l,n,r){var h=d([],{getName:function(){},start:function(y,x){},send:function(y){},stop:function(){},isStarted:function(){},isFastChannel:function(){}}),u;u=d([h],{logSubscriptions:!1,constructor:function(y,x,w,M,T){this._streamName=y,this._streamId=x,this._factory=w,this._setDelegate(M),this._subscription={},this._onDisconnected(),this.messageService=T||n.messageService},getName:function(){return this._streamName},send:function(y){var x;return this.isStarted()?y?Object.prototype.toString.call(y)!=="[object ArrayBuffer]"?(r.error("Cannot send as data is not an ArrayBuffer object."),new l().reject("Cannot send as data is not an ArrayBuffer object.")):(x=this._queueSend(y),this._deferProcessQueue(),x):(r.error("Cannot send as data is null."),new l().reject("Cannot send as data is null.")):(r.error("Cannot send as not connected to a stream."),new l().reject("Cannot send as not connected to a stream."))},start:function(y,x){this.logSubscriptions&&r.info("BinaryStream start: "+this._streamName,y,x);var w=this._addHandler(y,x),M;return w?(this._connectHandle=_.after(this.messageService,"onConnected",N.hitch(this,"_onConnected"),!0),this._disconnectHandle=_.after(this.messageService,"onDisconnected",N.hitch(this,"_onDisconnected"),!0),this.messageService.isConnected()?this._onConnected():this._onDisconnected(),this._messageHandle=_.after(this._delegate,"onMessage",N.hitch(this,this._onDelegateMessage),!0),this._closeHandle=_.after(this._delegate,"onClose",N.hitch(this,this._onDelegateClose),!0),this.isStarted()?new l().resolve():(M=this._queueStart(),this._deferProcessQueue(),M)):(r.error("Already connected to a stream, can't start."),new l().reject("Already connected to a stream, can't start."))},stop:function(){this.logSubscriptions&&r.info("BinaryStream stop: "+this._streamName);var y=this._removeHandler(),x;return y?this.isStarted()?(x=this._queueStop().then(N.hitch(this,this._cleanup),N.hitch(this,this._cleanup)),this._deferProcessQueue(),x):(this._cleanup(),new l().resolve()):(this._cleanup(),new l().reject("Not connected to stream, can't stop."))},flush:function(){var y=new l;return this.isConnected()?(this._processQueue(),y.resolve()):y.reject("Can only manually flush the queue when connected."),y.promise},isConnected:function(){return this._isConnected},isStarted:function(){var y=this._delegate&&this._delegate.delegateConnected();return this.isConnected()&&y},isFastChannel:function(){return!1},_setDelegate:function(y){this._delegate=y},_onDisconnected:function(){this._isConnected=!1,this._queuedOps=[]},_onConnected:function(){this._isConnected=!0,this._processQueue()},_queueSend:function(y){var x=new l;return this._queuedOps.push({type:"send",data:y,deferred:x}),x.promise},_queueStart:function(){var y=new l;return this._queuedOps.push({type:"start",deferred:y}),y.promise},_queueStop:function(){var y=new l;return this._queuedOps.push({type:"stop",deferred:y}),y.promise},_processQueue:function(){if(this.isConnected()){var y=this._queuedOps;this._queuedOps=[],y.forEach(function(x){var w;x.type==="send"?this.isStarted()?w=this._delegate.doSend(x.data):this._queuedOps.push(x):x.type==="start"?w=this._doStart():x.type==="stop"&&(w=this._doStop()),w.then(x.deferred.resolve,x.deferred.reject)},this)}},_deferProcessQueue:function(){if(!this._deferredTimeout){var y=this;this._deferredTimeout=setTimeout(function(){y._deferredTimeout=!1,y._processQueue()},0)}},_doStart:function(){if(this.started)return new l().resolve();var y=this._delegate.connect();return this.started=!0,y},_doStop:function(){if(this.started){var y=this._delegate.disconnect();return this.started=!1,y}else return new l().resolve()},_onDelegateMessage:function(y){y&&this._callHandler(y)},_addHandler:function(y,x){if(!this._subscription.hasOwnProperty("handler")){if(x=x||this,typeof y=="string"&&typeof x[y]!="function"){r.warn("Not adding, invalid handler: "+y);return}return this._subscription={handler:y,scope:x},!0}return!1},_removeHandler:function(){var y=this._subscription.hasOwnProperty("handler");return this._subscription={},y},_callHandler:function(y){try{typeof this._subscription.handler=="string"?this._subscription.scope[this._subscription.handler].call(this._subscription.scope,y):this._subscription.handler.call(this._subscription.scope,y)}catch(x){r.error("Error while executing message handler on stream: "+this._streamName+", error: "+x)}},_onDelegateClose:function(){this._cleanup()},_cleanup:function(){this._onDisconnected(),this._connectHandle&&this._connectHandle.remove(),this._disconnectHandle&&this._disconnectHandle.remove(),this._messageHandle&&this._messageHandle.remove(),this._closeHandle&&this._closeHandle.remove(),this._factory&&this._factory._removeStream(this._streamName)}});var g;return g=d([h],{logging:!1,constructor:function(y,x,w){this._streamName=y,this._factory=x,this._fallbackStream=w,this._isStarted=!1,this._subscription={}},getName:function(){return this._streamName},start:function(y,x){if(!this.isStarted()&&window.cefclient&&window.cefclient.createChannel)try{var w=this._addHandler(y,x);if(w){var M=this;window.cefclient.createChannel(this._streamName,function(T,A){A&&M._callHandler({channelName:T,data:A})},[]),this._isStarted=!0,this._logHelper("Successfully created webwindow stream")}else return r.error("Already connected to a stream, can't start."),new l().reject("Already connected to a stream, can't start.");return new l().resolve()}catch(T){r.warn("Could not connect to webwindow stream.")}return this._logHelper("Could not create webwindow stream, using fallback"),this._useFallback=!0,this._fallbackStream.start(y,x)},send:function(y){return this._useFallback?this._fallbackStream.send(y):this.isStarted()?y?Object.prototype.toString.call(y)!=="[object ArrayBuffer]"?(r.error("Cannot send as data is not an ArrayBuffer object."),new l().reject("Cannot send as data is not an ArrayBuffer object.")):(window.cefclient.sendData(this._streamName,y),this._logHelper("Webwindow stream sent data of size: "+y.byteLength),new l().resolve()):(r.error("Cannot send as data is null."),new l().reject("Cannot send as data is null.")):(r.error("Cannot send as not connected to a stream."),new l().reject("Cannot send as not connected to a stream."))},stop:function(){if(this._useFallback)return this._fallbackStream.stop();var y=this._removeHandler();return y?(this.isStarted()&&(window.cefclient.stop(this._streamName),this._logHelper("Stopped webwindow stream"),this._isStarted=!1),this._cleanup(),new l().resolve()):(this._cleanup(),new l().reject("Cannot stop as not connected to a stream."))},isStarted:function(){return this._useFallback?this._fallbackStream.isStarted():this._isStarted},isFastChannel:function(){return this._isStarted&&!this._useFallback},flush:function(){return this._useFallback?this._fallbackStream.flush():new l().resolve()},_cleanup:function(){this._factory&&this._factory._removeStream(this._streamName)},_callHandler:function(y){try{typeof this._subscription.handler=="string"?this._subscription.scope[this._subscription.handler].call(this._subscription.scope,y):this._subscription.handler.call(this._subscription.scope,y)}catch(x){r.error("Error while executing message handler on stream: "+this._streamName+", error: "+x)}},_addHandler:function(y,x){if(!this._subscription.hasOwnProperty("handler")){if(x=x||this,typeof y=="string"&&typeof x[y]!="function"){r.warn("Not adding, invalid handler: "+y);return}return this._subscription={handler:y,scope:x},!0}return!1},_removeHandler:function(){var y=this._subscription.hasOwnProperty("handler");return this._subscription={},y},_logHelper:function(y){this.logging&&r.info(this._streamName+" - "+y)}}),h.Impl=u,h.CefImpl=g,h},D,V),D.exports=B},1668:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(3660),f(8976),f(688),f(5370)],B=f.dj.d(R,function(d,N,_,l,n,r){var h;h=d([],{logLifeCycle:!1,constructor:function(){this._streams={},this._nextStreamId=-1},createStream:function(y,x,w){if(!this._hasStream(y)){this.logLifeCycle&&l.info("Creating new stream: "+y),this._nextStreamId+=2;var M=w||this._createDelegate(y),T=new n.Impl(y,this._nextStreamId,this,M,x),A=h.enableCefBinaryStream&&window.cefclient&&window.cefclient.createChannel;if(A)var T=new n.CefImpl(y,this,T);this._streams[y]=T}return this._streams[y]},_hasStream:function(y){return this._streams.hasOwnProperty(y)},_removeStream:function(y){return this._hasStream(y)?(this.logLifeCycle&&l.info("Removing stream: "+y),delete this._streams[y],!0):!1},_createDelegate:function(y){return new r(y,this._nextStreamId)}}),h.enableCefBinaryStream=!0,location.search.indexOf("cefbinarystream=off")>=0&&(h.enableCefBinaryStream=!1);var u=new h,g={factory:u,createStream:N.hitch(u,"createStream")};return g},D,V),D.exports=B},7317:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(8976)],B=f.dj.d(R,function(d,N,_){var l={RESERVED:0,SETUP:1,KEEPALIVE:2,CONNECT_STREAM:3,DISCONNECT_STREAM:4,PAYLOAD:5,CANCEL_PAYLOAD:6,ERROR:7,EXT:255},n={EMPTY:0,SETUP_ACK:128,SETUP_RESPOND:64,KEEPALIVE_RESPOND:128,CONNECT_STREAM_ACK:128,PAYLOAD_COMPLETE:128},r={INVALID_SETUP:1,UNSUPPORTED_SETUP:2,REJECTED_SETUP:3,CONNECTION_ERROR:257,APPLICATION_ERROR:513,REJECTED:514,CANCELED:515,INVALID:516,RESERVED:4294967295},h;h=d([],{DEFAULT_MAJOR_VERSION:0,DEFAULT_MINOR_VERSION:1,DEFAULT_KEEPALIVETIME:32,MAX_LIFETIME:65535,MAX_STREAM_ID:4294967295,HEADER_LENGTH:10,ERROR_CODE_LENGTH:4,SETUP_PARAMS_LENGTH:12,HEADER_LENGTH_START:0,HEADER_STREAM_ID_START:4,HEADER_TYPE_START:8,HEADER_FLAGS_START:9,_convertStringToArrayBuffer:function(y){for(var x=new ArrayBuffer(y.length*2),w=new Uint16Array(x),M=0,T=y.length;M<T;M++)w[M]=y.charCodeAt(M);return x},_convertArrayBufferToString:function(y){return String.fromCharCode.apply(null,new Uint16Array(y))},_copyArrayBuffer:function(y,x,w){var M=new Uint8Array(x);M.set(new Uint8Array(y),w)},_deserializeHeaderLength:function(y){var x=y.byteLength,w=y.getUint32(this.HEADER_LENGTH_START);if(x!==w)throw new Error("Header length "+w+" does not match buffer length "+x);return w},_deserializeType:function(y){return y.getUint8(this.HEADER_TYPE_START)},_deserializeFlags:function(y){return y.getUint8(this.HEADER_FLAGS_START)},_deserializeStreamId:function(y){return y.getUint32(this.HEADER_STREAM_ID_START)},_deserializePayload:function(y,x,w){w.payload=y.slice(x)},_deserializeHeader:function(y,x){return x.header={length:this._deserializeHeaderLength(y),streamId:this._deserializeStreamId(y),type:this._deserializeType(y),flags:this._deserializeFlags(y)},this.HEADER_LENGTH},_deserializeErrorCode:function(y,x,w){return w.errorCode=y.getUint32(x),x+=this.ERROR_CODE_LENGTH,x},_deserializeSetupParams:function(y,x,w){w.setupParams={majorVersion:y.getUint32(x),minorVersion:y.getUint32(x+4),keepAliveTime:y.getUint16(x+8),maxLifeTime:y.getUint16(x+10)},x+=this.SETUP_PARAMS_LENGTH;var M=y.getUint8(x);return w.dataEncoding=y.getUint8(x,M*2),x+=1+M,x},deserialize:function(y){var x=new window.DataView(y),w={},M=this._deserializeHeader(x,w);switch(w.header.type){case l.SETUP:M=this._deserializeSetupParams(x,M,w),this._deserializePayload(y,M,w);break;case l.KEEPALIVE:case l.CONNECT_STREAM:case l.PAYLOAD:this._deserializePayload(y,M,w);break;case l.DISCONNECT_STREAM:case l.CANCEL_PAYLOAD:break;case l.ERROR:M=this._deserializeErrorCode(x,M,w),this._deserializePayload(y,M,w);break;default:throw new Error("Invalid frame type")}return w},_computeFrameLength:function(y){var x=this.HEADER_LENGTH;return y.header.type===l.SETUP?(x+=this.SETUP_PARAMS_LENGTH,x+=1+y.dataEncoding.length):y.header.type===l.ERROR&&(x+=this.ERROR_CODE_LENGTH),y.payload instanceof ArrayBuffer&&(x+=y.payload.byteLength),x},_serializeHeader:function(y,x){return x.setUint32(this.HEADER_LENGTH_START,y.header.length),x.setUint32(this.HEADER_STREAM_ID_START,y.header.streamId),x.setUint8(this.HEADER_TYPE_START,y.header.type),x.setUint8(this.HEADER_FLAGS_START,y.header.flags),this.HEADER_LENGTH},_serializePayload:function(y,x,w){this._copyArrayBuffer(y.payload,x,w)},_serializeSetupParams:function(y,x,w){return x.setUint32(w,y.setupParams.majorVersion),x.setUint32(w+4,y.setupParams.minorVersion),x.setUint16(w+8,y.setupParams.keepAliveTime),x.setUint16(w+10,y.setupParams.maxLifeTime),w+=this.SETUP_PARAMS_LENGTH,x.setUint8(w,y.dataEncoding.length),w+=1,this._copyArrayBuffer(this._convertStringToArrayBuffer(y.dataEncoding),x.buffer,w),w+=y.dataEncoding.length*2,w},_serializeErrorCode:function(y,x,w){return x.setUint32(w,y.errorCode),w+=this.ERROR_CODE_LENGTH,w},serialize:function(y){var x=new ArrayBuffer(y.header.length),w=new window.DataView(x),M=this._serializeHeader(y,w);return y.header.type===l.SETUP?M=this._serializeSetupParams(y,w,M):y.header.type===l.ERROR&&(M=this._serializeErrorCode(y,w,M)),y.payload instanceof ArrayBuffer&&this._serializePayload(y,x,M),x},getSetupFrame:function(y){var x={header:{type:l.SETUP,flags:y.flags||n.EMPTY,streamId:0},setupParams:{majorVersion:y.majorVersion||this.DEFAULT_MAJOR_VERSION,minorVersion:y.minorVersion||this.DEFAULT_MINOR_VERSION,keepAliveTime:y.keepAliveTime||this.DEFAULT_KEEPALIVETIME,maxLifeTime:y.maxLifeTime||this.MAX_LIFETIME},dataEncoding:y.dataEncoding||"",payload:y.data||""};return x.header.length=this._computeFrameLength(x),x},getKeepAliveFrame:function(y){var x={header:{type:l.KEEPALIVE,flags:y.respond?n.KEEPALIVE_RESPOND:n.EMPTY,streamId:0},payload:y.data||""};return x.header.length=this._computeFrameLength(x),x},getConnectStreamFrame:function(y){var x={header:{type:l.CONNECT_STREAM,flags:y.ack?n.CONNECT_STREAM_ACK:n.EMPTY,streamId:y.streamId},payload:y.data};return x.header.length=this._computeFrameLength(x),x},getDisconnectStreamFrame:function(y){var x={header:{type:l.DISCONNECT_STREAM,flags:n.EMPTY,streamId:y.streamId}};return x.header.length=this._computeFrameLength(x),x},getPayloadFrame:function(y){var x={header:{type:l.PAYLOAD,flags:y.complete?n.PAYLOAD_COMPLETE:n.EMPTY,streamId:y.streamId},payload:y.data};return x.header.length=this._computeFrameLength(x),x},getCancelPayloadFrame:function(y){var x={header:{type:l.CANCEL_PAYLOAD,flags:n.EMPTY,streamId:y.streamId}};return x.header.length=this._computeFrameLength(x),x},_getErrorFrame:function(y,x){var w={header:{type:l.ERROR,flags:n.EMPTY,streamId:y.streamId},errorCode:x,payload:y.data};return w.header.length=this._computeFrameLength(w),w},getInvalidSetupFrame:function(y){var x={streamId:0,data:this._convertStringToArrayBuffer(y)};return this._getErrorFrame(x,r.INVALID_SETUP)},getUnsupportedSetupFrame:function(y){var x={streamId:0,data:this._convertStringToArrayBuffer(y)};return this._getErrorFrame(x,r.UNSUPPORTED_SETUP)},getRejectedSetupFrame:function(y){var x={streamId:0,data:this._convertStringToArrayBuffer(y)};return this._getErrorFrame(x,r.REJECTED_SETUP)},getConnectionErrorFrame:function(y){return y.data=this._convertStringToArrayBuffer(y.msg),this._getErrorFrame(y,r.CONNECTION_ERROR)},getApplicationErrorFrame:function(y){return y.data=this._convertStringToArrayBuffer(y.msg),this._getErrorFrame(y,r.APPLICATION_ERROR)}});var u=new h,g={impl:u,TYPES:l,FLAGS:n,ERROR_CODES:r,deserialize:u.deserialize.bind(u),serialize:u.serialize.bind(u),getSetupFrame:u.getSetupFrame.bind(u),getKeepAliveFrame:u.getKeepAliveFrame.bind(u),getConnectStreamFrame:u.getConnectStreamFrame.bind(u),getDisconnectStreamFrame:u.getDisconnectStreamFrame.bind(u),getPayloadFrame:u.getPayloadFrame.bind(u),getCancelPayloadFrame:u.getCancelPayloadFrame.bind(u),getInvalidSetupFrame:u.getInvalidSetupFrame.bind(u),getUnsupportedSetupFrame:u.getUnsupportedSetupFrame.bind(u),getRejectedSetupFrame:u.getRejectedSetupFrame.bind(u),getConnectionErrorFrame:u.getConnectionErrorFrame.bind(u),getApplicationErrorFrame:u.getApplicationErrorFrame.bind(u)};return g},D,V),D.exports=B},5370:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(3660),f(4371),f(8374),f(8976),f(5992),f(7317)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u){return d([],{BASE_END_POINT:"messageservice/binary/",KEEPALIVE_TIMEOUT:2e4,logLifecycle:!1,constructor:function(p,y,x){x=x||{},this._streamName=p,this._streamId=y,this._keepAliveTimeout=x.keepAliveTimeout||this.KEEPALIVE_TIMEOUT,this._timers=[]},onMessage:function(p){},onClose:function(){},connect:function(){var p=new l;this.delegate=this._createDelegate(),this._messageHandle=_.after(this.delegate,"onMessage",N.hitch(this,this._handleTransportMessage),!0),this._closeHandle=_.after(this.delegate,"onClose",N.hitch(this,this._handleTransportClose),!0),this.delegate.setUrl(this._getEndpoint());var y=this.delegate.connect(),x=this;return y.then(function(w){if(x._keepAliveTimeout>0){var M=setInterval(function(){x._sendKeepAlive(!1)},x._keepAliveTimeout);x._timers.push(M)}p.resolve(w)},function(w){p.reject(w)}),this._logLifecycleInfo("BinaryStreamTransport constructing new websocket instance."),p.promise},disconnect:function(){return this.delegate.reset(),new l().resolve()},cleanup:function(){this.delegate&&(this._logLifecycleInfo("BinaryStreamTransport disconnecting due to cleanup call."),this.delegate.disconnect(),this.delegate=null)},delegateConnected:function(){return this.delegate?this.delegate.isConnected():!1},doSend:function(p){var y=u.getPayloadFrame({streamId:this._streamId,complete:!0,data:p});return this._delegateSend(y),new l().resolve()},_delegateSend:function(p){var y=u.serialize(p);this.delegate.send(y)},_handleTransportMessage:function(p){var y=p.data,x=u.deserialize(y);switch(this._logLifecycleInfo("Received frame type: "+x.header.type),x.header.type){case u.TYPES.KEEPALIVE:this._handleKeepAlive(x);break;case u.TYPES.PAYLOAD:this._handlePayload(x);break;default:throw new Error(x.header.type+" frame not supported")}},_handleTransportClose:function(p,y){this._timers&&(this._logLifecycleInfo("Canceling all timers"),this._timers.forEach(function(x){clearInterval(x)})),this.onClose(),this._messageHandle&&this._messageHandle.remove(),this._closeHandle&&this._closeHandle.remove()},_handlePayload:function(p){this._logLifecycleInfo("Received Payload of size: "+p.payload.byteLength),this.onMessage({data:p.payload})},_handleKeepAlive:function(p){this._logLifecycleInfo("Received keepalive from server")},_sendKeepAlive:function(p){if(p=p||!1,!!this.delegateConnected()){this._logLifecycleInfo("Sending keep-alive");var y=u.getKeepAliveFrame({respond:p});this._delegateSend(y)}},_getEndpoint:function(){return n.createWorkerRoutingHostUrl(this.BASE_END_POINT+this._streamName)},_logLifecycleInfo:function(p){this.logLifecycle&&r.info(p)},_createDelegate:function(){return new h}})},D,V),D.exports=B},5992:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(4371),f(8976)],B=f.dj.d(R,function(d,N,_,l){return d([],{CLOSE_NORMAL_CLOSURE:1e3,CLOSE_GOING_AWAY:1001,CLOSE_PROTOCOL_ERROR:1002,logLifecycle:!1,connectTimeout:5e3,constructor:function(){this._webSocket=null,this._connected=!1},connect:function(){var r=new _,h=this.getUrl();if(!h)return l.error("Invalid URL"),r.reject("Invalid URL"),r.promise;var h=h.replace(/^http/,"ws");if(h.indexOf("ws")!==0)return l.error("Invalid URL: ",h),r.reject("Invalid URL: "+h),r.promise;this.logLifecycle&&l.info("Connecting to URL: "+h);var u=this,g=null;this.connectTimeout>0&&(g=setTimeout(function(){g=null,this._connected||(this.logLifecycle&&l.info("Timed out while connecting to URL ",h,"in "+u.connectTimeout,"ms"),u.onClose(u.CLOSE_PROTOCOL_ERROR,"Connect Timeout"),r.reject("Timed out while connecting to URL"))},this.connectTimeout));var p;try{p=new WebSocket(h),p.binaryType="arraybuffer";var y=function(){if(u.logLifecycle&&l.info("WebSocket opened: "+p),g&&(window.clearTimeout(g),g=null),r.resolve(),p!==u._webSocket){u.logLifecycle&&l.info("Ignoring open event, WebSocket"+u._webSocket);return}u.onOpen()},x=function(T){var A=T?T.code:u.CLOSE_NORMAL_CLOSURE,C=T?T.reason:void 0;if(u.logLifecycle&&l.info("WebSocket closed: "+A+"/"+C),g&&(window.clearTimeout(g),g=null),r.reject(),p!==u._webSocket){u.logLifecycle&&l.info("Ignoring close event, WebSocket");return}u.onClose(A,C)},w=function(T){if(u.logLifecycle&&l.info("WebSocket message received"),p!==u._webSocket){u.logLifecycle&&l.info("Ignoring message event, WebSocket");return}u.onMessage(T)};p.onopen=y,p.onclose=x,p.onerror=function(){l.error("WebSocket received error"),x({code:u.CLOSE_PROTOCOL_ERROR})},p.onmessage=w,this._webSocket=p}catch(M){l.error("WebSocket error: ",M),r.reject("Browser does not support WebSockets")}return r.promise},onOpen:function(){this._connected=!0},onMessage:function(r){},onClose:function(r,h){this._webSocket!==null&&this._connected&&this._webSocket.close(this.CLOSE_NORMAL_CLOSURE,"Close"),this._connected=!1,this._webSocket=null},send:function(r){try{this._webSocket===null?(this.logLifecycle&&l.info("WebSocket not connected, connecting..."),this.connect()):this._connected&&(this.logLifecycle&&l.info("Sending data"),this._webSocket.send(r))}catch(h){l.error("Error sending data: ",h)}},abort:function(){if(this._webSocket!==null)try{this.logLifecycle&&l.info("Aborting..."),this._webSocket.close(this.CLOSE_GOING_AWAY)}catch(r){this.logLifecycle&&l.info("Error aborting: ",r)}this.reset()},reset:function(){this.logLifecycle&&l.info("WebSocket closing connection"),this._webSocket!==null&&this._connected&&this._webSocket.close(this.CLOSE_NORMAL_CLOSURE,"Reset"),this._webSocket=null,this._connected=!1},setUrl:function(r){this._url=r},getUrl:function(){return this._url},isConnected:function(){return this._connected}})},D,V),D.exports=B},5260:(D,V,f)=>{var R,B;R=[f(8976)],B=f.dj.d(R,function(d){"use strict";var N={};const _={deprecated:function(l){var n,r,h;let u=!1;if(typeof window=="object"&&(u=((n=window.$mwLog)==null?void 0:n.mode)==="PRODUCTION"||((h=(r=window.dojo)==null?void 0:r.config)==null?void 0:h.isDebug)===!1),!(!u||!!window.showDeprecationsAsErrors)||!this._isConfigValid(l))return;const p=window.showDeprecationsAsErrors||l.deprecationLevel===this.ERROR?this.ERROR:this.WARN;let y=`DEPRECATED: ${l.deprecated.module}${l.deprecated.method?"."+l.deprecated.method+"()":""}.`;l.replacement&&(y+=` Use ${l.replacement.module}${l.replacement.method?"."+l.replacement.method+"()":""} instead.`),l.removalVersion&&(y+=` Will be removed in version: ${l.removalVersion}.`),l.geckNumber&&(y+=` Please use g${l.geckNumber} to track latest information regarding this deprecation.`),l.additionalInformation&&(y+=` ${l.additionalInformation}`),d[p](y)},_isConfigValid:function(l){let n=!!l.deprecated&&typeof l.deprecated=="object"&&Object.hasOwn(l.deprecated,"module");return l.replacement&&(n=n&&typeof l.replacement=="object"&&Object.hasOwn(l.replacement,"module")),l.geckNumber&&(n=n&&typeof l.geckNumber=="number"),n||d.error("Supplied deprecationConfig properties are not valid. Please refer to mw-deprecation-utils JSDoc for the correct API usage."),n}};return Object.defineProperties(_,{WARN:{value:"warn",enumerable:!0},ERROR:{value:"error",enumerable:!0}}),N.default=_,N.default},D,V),D.exports=B},1423:(D,V,f)=>{var R,B;R=[f(9292),f(5260)],B=f.dj.d(R,function(d,N){"use strict";var _={};const l={HYPERLINK_ESCAPE_REGEXP:/<a\s+href\s*=\s*"[^"]*"[^>]*>[\s\S]*?<\/a>/g,HYPERLINK_WITH_PARENTHESIS_ESCAPE_REGEXP:/<a\s+href\s*=\s*"([^"]*)"([^>]*)>([\s\S]*?)<\/a>/g,STRONG_ESCAPE_REGEXP:/<strong>|<\/strong>/g,BOLD_LINK_ATTRIBUTE_REGEX:/\bstyle\s*=\s*"[^"]*\bfont-weight\s*:\s*bold\b[^"]*"/,SINGLE_LETTER_DRIVE_REGEX:/^[a-zA-Z]:$/,parseQueryString:function(){const n=window.location.search;return this._parseQueryString(n)},_parseQueryString:function(n){const r=new URLSearchParams(n);return this._transformSearchParams(r)},_transformSearchParams:function(n){const r={};for(const h of n.keys()){let u=n.getAll(h);u.length===1&&(u=u[0]),r[h]=u}return r},parseUrl:function(n){const r=document.createElement("a");r.display="none",r.href=n||window.location.href;const h={protocol:r.protocol,hostname:r.hostname,port:r.port,pathname:r.pathname,search:r.search,hash:r.hash};return(h.protocol==="https:"||h.protocol==="http:")&&!h.pathname.startsWith("/")&&(h.pathname="/"+h.pathname),h.protocol==="https:"&&h.port==="443"&&!n.startsWith("https://"+h.hostname+":443")&&(h.port=""),h},escapeHtml:function(n){const r=document.createElement("div");return r.textContent=n,r.innerHTML},escapeLinksAndHtml:function(n,r){N.deprecated({deprecated:{module:"mw-html-utils/HtmlUtils",method:"escapeLinksAndHtml"},replacement:{module:"mw-html-utils/HtmlUtils",method:"treatHtmlLikeCommandWindow"}});let h="";const u=n.split(this.HYPERLINK_ESCAPE_REGEXP),g=n.match(this.HYPERLINK_ESCAPE_REGEXP);let p="";const y=this,x=function(w,M,T,A){const C=y.parseUrl(M).protocol;C!=="http:"&&C!=="https:"&&C!=="matlab:"&&(M="#"),M=y.escapeHtml(M),A=y._strongNotEscaped(A,!0),p='<a href="'+M+'">'+A+"</a>"};if(r)h=this.escapeHtml(n),h=this.escapeWhitespace(h);else if(u[0]!==""&&(h=this._strongNotEscaped(u[0],!0)),g!==null&&g.length!==0)for(let w=0;w<g.length;w=w+1)g[w].replace(this.HYPERLINK_WITH_PARENTHESIS_ESCAPE_REGEXP,x),u[w+1]!==""&&(u[w+1]=this._strongNotEscaped(u[w+1],!0)),h+=p+u[w+1];return h},treatHtmlLikeCommandWindow:function(n,r,h){if(typeof n!="string")return"";let u="";const g=n.split(this.HYPERLINK_ESCAPE_REGEXP),p=n.match(this.HYPERLINK_ESCAPE_REGEXP);let y="";const x=this;h=h||{};const w=function(M,T,A,C){const z=x.parseUrl(T).protocol;let H="";z!=="http:"&&z!=="https:"&&z!=="matlab:"&&z!=="file:"&&!z.match(x.SINGLE_LETTER_DRIVE_REGEX)&&(T="#"),T=x.escapeHtml(T),C=x._strongNotEscaped(C,!1),x.BOLD_LINK_ATTRIBUTE_REGEX.test(A)&&(H=' style="font-weight:bold"'),y='<a href="'+T+'"'+H+">"+C+"</a>"};if(r)u=this.escapeHtml(n);else if(g[0]!==""&&(u=this._strongNotEscaped(g[0],!1)),p!==null&&p.length!==0)for(let M=0;M<p.length;M=M+1)p[M].replace(this.HYPERLINK_WITH_PARENTHESIS_ESCAPE_REGEXP,w),g[M+1]!==""&&(g[M+1]=this._strongNotEscaped(g[M+1],!1)),u+=y+g[M+1];return h.addPreTagToPreserveWhiteSpace&&(u='<span style="white-space: pre">'+u+"</span>"),u},_strongNotEscaped:function(n,r){let h="";const u=n.match(this.STRONG_ESCAPE_REGEXP),g=n.split(this.STRONG_ESCAPE_REGEXP);let p=function(x){return x};if(r&&(p=this.escapeWhitespace),u!==null&&u.length!==0){h=p(this.escapeHtml(g[0]));for(let y=0;y<u.length;y=y+1)h+=u[y]+p(this.escapeHtml(g[y+1]))}else h=p(this.escapeHtml(n));return h},escapeWhitespace:function(n){return N.deprecated({deprecated:{module:"mw-html-utils/HtmlUtils",method:"escapeWhitespace"},replacement:{module:"Plain HTML",method:'Set class as white-space: pre or use <span style="white-space: pre">...</span>'}}),n=n||"",n.replace(/\n/g,"<br>").replace(/ {2}/g,"&nbsp;&nbsp;")},handleAnchors:function(n,r){var h;if((h=r==null?void 0:r.target)!=null&&h.href){r.preventDefault(),r.stopPropagation();const u=r.target.href;if(u.indexOf("matlab:")!==-1){if(u.substring(0,7)==="matlab:"){const p=r.target.href.substring(7);n(window.decodeURIComponent(p))}}else window.open(r.target.href)}},isElementOverflown:function(n){return n.scrollHeight>n.clientHeight||n.scrollWidth>n.clientWidth},sanitizeHtmlFromJava:d.sanitizeHtmlFromJava,sanitizeHtml:d.sanitizeHtml};return _.default=l,_.default},D,V),D.exports=B},9292:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};const N={A:["target","href","title"],ABBR:["title"],ADDRESS:[],AREA:["shape","coords","href","alt"],ARTICLE:[],ASIDE:[],AUDIO:["autoplay","controls","loop","preload","src"],B:[],BDI:["dir"],BDO:["dir"],BIG:[],BLOCKQUOTE:["cite"],BR:[],CAPTION:[],CENTER:[],CITE:[],CODE:[],COL:["align","valign","span","width"],COLGROUP:["align","valign","span","width"],DD:[],DEL:["datetime"],DETAILS:["open"],DIV:[],DL:[],DT:[],EM:[],FONT:["color","size","face"],FOOTER:[],H1:[],H2:[],H3:[],H4:[],H5:[],H6:[],HEADER:[],HR:[],I:[],IMG:["src","alt","title","width","height"],INS:["datetime"],LI:[],MARK:[],NAV:[],OL:[],P:[],PRE:[],S:[],SECTION:[],SMALL:[],SPAN:[],SUB:[],SUP:[],STRONG:[],TABLE:["width","border","align","valign"],TBODY:["align","valign"],TD:["width","rowspan","colspan","align","valign"],TFOOT:["align","valign"],TH:["width","rowspan","colspan","align","valign"],THEAD:["align","valign"],TR:["rowspan","align","valign"],TT:[],U:[],UL:[],VIDEO:["autoplay","controls","loop","preload","src","height","width"]},_=Object.assign(N),l={href:{"http:":!0,"https:":!0,"mailto:":!0,"matlab:":!0,relative:{"#":!0,"/":!0}},src:{"http:":!0,"https:":!0,"mailto:":!0,relative:{"#":!0,"/":!0}}},n=Object.assign(l),r=["backgroundColor","borderBottom","borderBottomColor","borderBottomLeftRadius","borderBottomRightRadius","borderBottomStyle","borderBottomWidth","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRadius","borderRight","borderRightColor","borderRightStyle","borderRightWidth","borderSpacing","borderStyle","borderTop","borderTopColor","borderTopLeftRadius","borderTopRightRadius","borderTopStyle","borderTopWidth","borderWidth","color","fontFamily","fontSize","fontStyle","fontWeight","height","lineHeight","margin","marginBottom","marginLeft","marginRight","marginTop","maxHeight","maxWidth","minHeight","minWidth","overflow","overflowWrap","overflowX","overflowY","padding","paddingBottom","paddingLeft","paddingRight","paddingTop","textAlign","textAnchor","textDecoration","textIndent","textOverflow","textShadow","textTransform","width"],h=[...r];h.push("whiteSpace");const u=function(y,x,w){const M=x.getAttribute("style"),T=w?r:h;if(y.style&&M!==null&&M!=="")for(const A of T){const C=x.style[A];y.style[A]!==void 0&&(y.style[A]=C)}},g=function(y,x,w,M,T){const A=typeof window=="object"&&window.Node?window.Node.ELEMENT_NODE:1,C=typeof window=="object"&&window.Node?window.Node.TEXT_NODE:3;return T=T||{},function(z){const H=function(ae,j){const F=String.prototype.trim.call(j),J=F.indexOf(":");if(J<0){if(ae.relative[F.charAt(0)])return F;if(T.allowRelative){if(F.charAt(0)==="."){if(F.charAt(1)===".")return F.charAt(2)==="/"?F.charAt(3)===""?"#":F:"#";if(F.charAt(1)==="/")return F.charAt(2)===""?"#":F;if(F.charAt(1)==="")return"#"}return"./"+F}}const te=F.substring(0,J);return ae[te+":"]?F:"#"},q=function(ae,j){const F=[];for(const J of ae)if(j.hasAttribute(J)){const te=j.getAttribute(J);let _e="";x[J]?_e=H(x[J],te):_e=te,F.push({key:J,value:_e})}return F},P=function(ae){let j;if(ae.nodeType===A)if(y[ae.tagName]){j=document.createElement(ae.tagName);const J=y[ae.tagName];q(J,ae).forEach(_e=>{j.setAttribute(_e.key,_e.value)}),w&&u(j,ae,M)}else j=document.createDocumentFragment();else ae.nodeType===C?j=document.createTextNode(ae.textContent):j=document.createDocumentFragment();return j},Z=function(ae,j=0){const F=document.createDocumentFragment();if(j>150||!ae)return F;for(let J=ae.firstChild;J;J=J.nextSibling){const te=P(J);J.nodeType===A&&te.appendChild(Z(J,j+1)),F.appendChild(te)}return F},Y=new DOMParser().parseFromString(z,"text/html");let k;return Y.body?k=Z(Y.body):k=document.createDocumentFragment(),k}},p={sanitizeHtmlFromJava:g(N,l,!0,"java"),sanitizeHtml:(y,x={})=>g(_,n,!0,!1,x)(y)};return d.default=p,d.default},D,V),D.exports=B},8976:(D,V,f)=>{var R,B;R=[f(7781),f(9694),f(1393),f(7354),f(804),f(7053)],B=f.dj.d(R,function(d,N,_,l,n,r){"use strict";var h={};const u="DEFAULT",p=l.create(100),y={debug:4,log:3,dir:3,table:3,trace:3,time:3,timeEnd:3,group:3,groupCollapsed:3,groupEnd:3,info:2,warn:1,assert:0,error:0},x={};let w=0,M=N.DEBUG,T=d.DEVELOPMENT;const A=[],C={};let z=null,H=null,q=null;class P{constructor(K){if(C[K]!=null)return;n.makeReadOnlyProperty(this,"name",K),C[this.name]=this,this._timers={},this._threshold=N.DEBUG,this._showTimestamp=!0,n.makeReadOnlyProperty(this,"modes",d),n.makeReadOnlyProperty(this,"levels",N);const Y=this;typeof window=="object"&&(window.$mwLog={get filter(){return Y.filter},set filter(k){Y.filter=k},get mode(){return Y.mode},set mode(k){Y.mode=k}})}static _sanitizeLevel(K){return typeof K=="number"?K:N.DEBUG}static _sanitizeMode(K){return n.objectValues(d).indexOf(K)>-1?K:d.DEVELOPMENT}setLogForwarder(K){r.isLogForwarder(K)?H=K:this.warn("Failed to set up logForwarder")}setLogConfig(K){r.isLogConfig(K)?q=K:this.warn("Failed to set up logConfig")}get threshold(){return this._threshold}set threshold(K){this._threshold=P._sanitizeLevel(K)}get showTimestamp(){return this._showTimestamp}set showTimestamp(K){this._showTimestamp=!!K}get globalThreshold(){return M}set globalThreshold(K){M=P._sanitizeLevel(K)}get mode(){return T}set mode(K){K&&(T=P._sanitizeMode(K))}get filter(){return z}set filter(K){(typeof K=="function"||K===null)&&(z=K)}_shouldLog(K,Y){if(z&&T===d.DEVELOPMENT){const k={name:this.name,type:Y};return!!z(k)}return M>K&&this._threshold>K}_nameAndTime(){const K=[];return this.name!==u&&K.push(this.name),this._showTimestamp&&K.push(n.currentTimeString()),K}table(K){if(this._shouldLog(y.table,_.TABLE)){const Y={namespace:this.name,type:_.TABLE,message:[K],time:new Date};p.add(Y),n.printToConsole(_.LOG,this._nameAndTime(),T),n.printToConsole(_.TABLE,[K],T),n.execCallbacks(x,Y)}}trace(){if(this._shouldLog(y.trace,_.TRACE)){const K={namespace:this.name,type:_.TRACE,message:null,time:new Date};let k=new Error().stack.split(`
`);for(k[0]==="Error"&&k.shift();k[0].includes("Log.js")||k[0].includes("logger.trace")||k[0].includes("trace");)k.shift();k=k.join(`
`),K.message=[k],p.add(K),n.printToConsole(_.LOG,this._nameAndTime(),T),n.printToConsole(_.TRACE,[],T),n.execCallbacks(x,K)}}time(K){this._shouldLog(y.time)&&(this._timers[K]==null?this._timers[K]=new Date().getTime():this.warn('timer "'+K+'" already exists.'))}timeEnd(K){if(this._shouldLog(y.timeEnd,_.TIME_END)){const Y={namespace:this.name,type:_.TIME_END,message:null,time:new Date};if(this._timers[K]!=null){const k=new Date().getTime()-this._timers[K];Y.message=[K+": "+k+"ms - timer ended"],p.add(Y),n.printToConsole(_.LOG,this._nameAndTime().concat(Y.message),T),n.execCallbacks(x,Y),this._timers[K]=null}else this.warn('timer "'+K+`" doesn't exist.`)}}_group(K,Y){if(this._shouldLog(y.group,Y?_.GROUP_COLLAPSED:_.GROUP)){const k=Y?_.GROUP_COLLAPSED:_.GROUP,ae={namespace:this.name,type:k,message:[K],time:new Date};A.push(K),p.add(ae),n.printToConsole(k,[K],T),n.execCallbacks(x,ae)}}groupCollapsed(K){this._group(K,!0)}group(K){this._group(K,!1)}groupEnd(){if(this._shouldLog(y.groupEnd,_.GROUP_END)){const K=A.pop(),Y={namespace:this.name,type:_.GROUP_END,message:[K],time:new Date};p.add(Y),n.printToConsole(_.GROUP_END,[],T),n.execCallbacks(x,Y)}}assert(K,Y){if(this._shouldLog(y.assert,_.ASSERT)&&!K){const k={namespace:this.name,type:_.ASSERT,message:["Assertion failed:",Y],time:new Date};p.add(k),k.message.shift();const ae=[!1].concat(this._nameAndTime().concat(k.message));n.printToConsole(_.ASSERT,ae,T),n.execCallbacks(x,k)}}_basicLogMethod(K,Y,k){if(this._shouldLog(Y,K)){const j={namespace:this.name,type:K,message:k,time:new Date};k=this._nameAndTime().concat(k),p.add(j),n.printToConsole(K,k,T),n.execCallbacks(x,j)}const ae=r.translateToForwardLevel(K);r.shouldForward(ae,this.name,H,q)&&H[ae](k)}debug(K){const Y=Array.prototype.slice.call(arguments);this._basicLogMethod(_.DEBUG,y.debug,Y)}log(K){const Y=Array.prototype.slice.call(arguments);this._basicLogMethod(_.LOG,y.log,Y)}dir(K){const Y=Array.prototype.slice.call(arguments);this._basicLogMethod(_.DIR,y.dir,Y)}info(K){const Y=Array.prototype.slice.call(arguments);this._basicLogMethod(_.INFO,y.info,Y)}warn(K){const Y=Array.prototype.slice.call(arguments);this._basicLogMethod(_.WARN,y.warn,Y)}error(K){const Y=Array.prototype.slice.call(arguments);this._basicLogMethod(_.ERROR,y.error,Y)}addCallback(K,Y){x[w]=K,Y&&p.applyCallback(K);const k={},ae=w;return k.remove=()=>{delete x[ae]},w++,k}createLogger(K){const Y=new P(K);return Y.name?Y:C[K]}}return h.default=new P(u),h.default},D,V),D.exports=B},7354:(D,V,f)=>{var R,B;R=[f(804)],B=f.dj.d(R,function(d){"use strict";var N={};function _(n){const r={},h=[];d.makeReadOnlyProperty(r,"size",n);let u=0;return r.add=function(g){h[u]=g,u=(u+1)%r.size},r.applyCallback=function(g){let p=u+1;h[p]===void 0&&(p=0);let y=0,x=p;for(;y<r.size&&h[x]!==void 0;)g(h[x]),x=(x+1)%n,y++},r}const l={};return l.create=_,N.default=l,N.default},D,V),D.exports=B},9694:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};const N={DEBUG:5,LOG:4,TABLE:4,TIME:4,DIR:4,INFO:3,WARN:2,ASSERT:1,ERROR:1};return Object.freeze(N),d.default=N,d.default},D,V),D.exports=B},7781:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};const N={DEVELOPMENT:"DEVELOPMENT",PRODUCTION:"PRODUCTION"};return Object.freeze(N),d.default=N,d.default},D,V),D.exports=B},1393:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};const N={DEBUG:"debug",LOG:"log",TABLE:"table",TRACE:"trace",TIME_END:"timeEnd",GROUP:"group",GROUP_COLLAPSED:"groupCollapsed",GROUP_END:"groupEnd",DIR:"dir",INFO:"info",WARN:"warn",ASSERT:"assert",ERROR:"error"};return Object.freeze(N),d.default=N,d.default},D,V),D.exports=B},7053:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};const N={};return N.isLogForwarderEmpty=function(_){return _==null},N.isLogConfigEmpty=function(_){return _==null||_.mwLogConfig==null},N.ismwLoggerConfigEmpty=function(_){return _==null||_.otelLoggerLevel==null},N.shouldForward=function(_,l,n,r){if(this.isLogForwarderEmpty(n)||this.isLogConfigEmpty(r))return!1;const h=l in r.mwLogConfig?r.mwLogConfig[l]:r.mwLogConfig.default;return this.ismwLoggerConfigEmpty(h)?!1:n.forwardLevelCheck(_,h.otelLoggerLevel)},N.isLogForwarder=function(_){return _!=null&&_.interface==="LogForwarder"},N.isLogConfig=function(_){return _!=null&&_.interface==="LogConfig"},N.translateToForwardLevel=function(_){return _==="info"&&(_="log"),_},d.default=N,d.default},D,V),D.exports=B},804:(D,V,f)=>{var R,B;R=[f(7781)],B=f.dj.d(R,function(d){"use strict";var N={};const _={};return _.objectValues=function(l){const n=[];for(const r in l)Object.prototype.hasOwnProperty.call(l,r)&&n.push(l[r]);return n},_.makeReadOnlyProperty=function(l,n,r){Object.defineProperty(l,n,{value:r,writable:!1})},_.execCallbacks=function(l,n){const r=_.objectValues(l);for(const h in r)r[h](n)},_.currentTimeString=function(){const l=new Date;return l.toLocaleTimeString("en-US",{hour12:!1,hour:"numeric",minute:"numeric",second:"numeric"})+"."+l.getTime()%1e3},_.printToConsole=function(l,n,r){(r!==d.PRODUCTION||l==="error")&&console[l].apply(console,n)},N.default=_,N.default},D,V),D.exports=B},210:(D,V,f)=>{var R,B;R=[f(7355),f(9597),f(140),f(7223),f(8374)],B=f.dj.d(R,function(d,N,_,l,n){"use strict";var r={};function h(x,w){const M=w._startFunction||w.start,T=w.stop,A=x._startFunction||x.start,C=x.stop,z=function(){A.call(x,[]),M.call(w,[])},H=function(){T.call(w,[]),C.call(x,[])};w._startFunction?w._startFunction=z:w.start=z,x._startFunction?x._startFunction=z:x.start=z,w.stop=H,x.stop=H}const u=d(new N(n,null,null,null,{instanceType:_.MATLAB_SERVICE_HOST.name})),g=new N(n,null,null,null,{instanceType:_.APP_SERVICE_HOST.name});let p;n.enableServerOnWorkerAsync=function(){},n.disableServerOnWorkerAsync=function(){};const y={};return y[_.APP_SERVICE_HOST.name]=()=>(p||(p=d(g),u.isStarted()&&p.start(),h(u,p)),p),y[_.MATLAB_SERVICE_HOST.name]=()=>u,u.create=function(x){return l(y,x)},r.default=u,r.default},D,V),D.exports=B},9597:(D,V,f)=>{var R,B;R=[f(1203),f(6723),f(4371),f(3553),f(7723),f(54),f(140),f(8976),f(7570)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u,g){"use strict";var p={};let y,x,A=0,C=0;const z={},H=200;setInterval(function(){A+=H,Object.keys(z).forEach(function(k){const ae=z[k];ae&&ae.execTime<=A&&(ae.func(),delete z[k])})},H);const q=function(k,ae){if(ae===0)return y(k,ae);{C+=1;const j=`t-${C}`;return z[j]={func:function(){try{k()}catch(F){u.warn(`Exception invoking timed function in callback
, this is likely an issue with code calling MessageService`,k,F)}},execTime:A+ae},j}},P=function(k){typeof k=="number"?x(k):delete z[k]},Z=function(k,ae,j,F,J){const te=new l.CometD(k);return te.registerExtension("ack",new n),y=te.setTimeout,x=te.clearTimeout,te.setTimeout=q,te.clearTimeout=P,te},K=function(k,ae){k.successful?ae.resolve(k):(u.warn("Message failed: ",JSON.stringify(k)),ae.reject(k))},Y=d([],{BASE_PREFIX:"/matlab",BASE_END_POINT:"messageservice/async",logCometdLifecycle:!1,logCometdSubscriptions:!1,constructor:function(k,ae,j,F,J){J=J||{},this.remote=k,this.constructCometD=ae||Z,this.workerProxyAsyncClient=j||new g("remoteWorkerAsyncProducer");const te=h[J.instanceType];te&&(this.BASE_PREFIX=te.BASE_PREFIX,this.BASE_END_POINT=te.BASE_END_POINT),this.cometdProperties=F||{useWorkerScheduler:!1,stickyReconnect:!0,connectTimeout:5e3,maxConnections:2,backoffIncrement:2e3,maxBackoff:2e3,logLevel:"warn",maxNetworkDelay:2e4,requestHeaders:{},appendMessageTypeToURL:!1,autoBatch:!0,urls:{},maxURILength:2e3,maxSendBayeuxMessageSize:Number.MAX_SAFE_INTEGER};const _e=["maxNetworkDelay","connectTimeout","logLevel"],ne=N.cometdProperties;if(ne)for(let je=0;je<_e.length;je+=1){const ze=_e[je];ne[ze]!==void 0&&(this.cometdProperties[ze]=ne[ze])}this.subscriptions={},this.recentMessages=[],this._deferredCleanupFunction=()=>{this._deferredCleanup=!1,this.recentMessages=[]},this.routingHost=Y.workerHostOverride||this.remote.getWorkerRoutingHost(),this.routingKey=this.remote.getWorkerRoutingKey(),this.computeToken=this.remote.getComputeSessionId();const le=this.remote.getEndPointByName("WORKER_ASYNC_ENDPOINT");this.withCredentials=le?le.withCredentials:!1;const be=this._setUpEndPoint();this.computeToken&&(be.computeToken=this.computeToken),this.cometdProperties.url=be.url,this.cometdProperties.requestHeaders={computeToken:be.computeToken},this.cometd=null,this._connectedAtLeastOnce=!1,this.logCometdLifecycle&&u.info("MessageServiceAsync will construct new cometd instance when connecting.")},onMessage:function(k){},onConnectionError:function(k){},onConnectionFails:function(){},onConnectionSuccess:function(){},connect:function(k){this.routingHost=Y.workerHostOverride||this.remote.getWorkerRoutingHost(),this.routingKey=this.remote.getWorkerRoutingKey(),this.computeToken=this.remote.getComputeSessionId();const ae=this.remote.getEndPointByName("WORKER_ASYNC_ENDPOINT");this.withCredentials=ae?ae.withCredentials:!1;const j=this._setUpEndPoint();this.computeToken&&(j.computeToken=this.computeToken),this.cometdProperties.url=j.url,this.cometdProperties.requestHeaders={computeToken:j.computeToken},this.cometd||(this.cometd=this.constructCometD("messageService",this.workerProxyAsyncClient,{websocket:Y.enableWebsocket},j,this.remote),this.registerTransports({websocket:Y.enableWebsocket}),this.logCometdLifecycle&&u.info("MessageServiceAsync constructing new cometd instance."));const F=new _;let J=0;return this.cleanupListeners(),this._handshakeHandle=this.cometd.addListener("/meta/handshake",te=>{if(te.successful===!0){J=0;let _e,ne;const le=[];this.doStartBatch();for(_e in k)Object.prototype.hasOwnProperty.call(k,_e)&&(ne=k[_e],le.push(this.doSubscribe(_e)),ne.subscribed=!0);this.doEndBatch(),Promise.all(le).then(be=>{this._connectedAtLeastOnce=!0,F.isFulfilled()?this.cometd&&this.onConnectionSuccess():F.resolve(be)},()=>{let be,je;const ze=[];this.doStartBatch();for(be in k)Object.prototype.hasOwnProperty.call(k,be)&&(je=k[be],ze.push(this.doSubscribe(be)),je.subscribed=!0);this.doEndBatch(),Promise.all(ze).then(Re=>{this._connectedAtLeastOnce=!0,F.isFulfilled()?this.cometd&&this.onConnectionSuccess():F.resolve(Re)},Re=>{F.reject(Re)})})}}),this._connectHandle=this.cometd.addListener("/meta/connect",te=>{te.successful===!0&&(J>0&&this.cometd&&this.onConnectionSuccess(),J=0)}),this._unsuccessHandle=this.cometd.addListener("/meta/unsuccessful",te=>{if((te.channel==="/meta/handshake"||te.channel==="/meta/connect"||te.advice&&te.advice.reconnect==="handshake")&&J<30)J+=1,J===1&&this.onConnectionError(te);else if(te.channel==="/meta/disconnect")F&&!F.isFulfilled()&&F.reject(te);else if(J>=30){const _e=this.doDisconnect();this._connectedAtLeastOnce||_e.catch(()=>{u.info("MessageService never got connected to the server, and the attempt to disconnect also fails. Suppressing console error with this info log")}),F&&!F.isFulfilled()?F.reject(te):this.onConnectionFails()}}),this.cometd.init(this.cometdProperties),F.promise},registerTransports:function(k){const ae=new l.LongPollingTransport;ae.accept=()=>!0;const j=new l.WebSocketTransport;this.cometd.unregisterTransports(),k[r.WEBSOCKET]&&this.cometd.registerTransport(r.WEBSOCKET,j,0),this.cometd.registerTransport(r.LONG_POLLING,ae,1)},disconnect:function(){this.logCometdLifecycle&&u.info("MessageServiceAsync disconnecting cometd due to disconnect call.",this.cometd.getClientId());const k=this._createOneShotMessagePromise("/meta/disconnect");return this.cometd.disconnect(),k},destructCometd:function(){this.cometd&&(this.cleanupListeners(),this.cometd=null,this.logCometdLifecycle&&u.info("MessageServiceAsync destroying cometd instance."))},cleanup:function(){this.cometd&&(this.logCometdLifecycle&&u.info("MessageServiceAsync disconnecting cometd due to cleanup call.",this.cometd,this.cometd&&this.cometd.getClientId()),this.cometd.disconnect())},cleanupListeners:function(){this._handshakeHandle&&this.cometd.removeListener(this._handshakeHandle),this._connectHandle&&this.cometd.removeListener(this._connectHandle),this._unsuccessHandle&&this.cometd.removeListener(this._unsuccessHandle)},delegateConnected:function(){return this.cometd?!this.cometd.isDisconnected()&&this.cometd.getStatus()!=="handshaking":!1},doPublish:function(k,ae){const j=new _;return this.cometd.publish(this._getRequestChannel(k),ae,{},function(F){K(F,j)}),j.promise},doSubscribe:function(k){this.logCometdSubscriptions&&u.info("MessageServiceAsync subscribing cometd to channel: "+k);const ae=this._createOneShotMessagePromise("/meta/subscribe");return this.subscriptions[k]=this.cometd.subscribe(this._getRequestChannel(k),this,this._handleCometResponse),ae},doDisconnect:function(){this.logCometdSubscriptions&&u.info("MessageServiceAsync sending disconnect to cometd");const k=this._createOneShotMessagePromise("/meta/disconnect");return this.cometd.disconnect(!0),k},doUnsubscribe:function(k){if(this.subscriptions[k]){this.logCometdSubscriptions&&u.info("MessageServiceAsync unsubscribing cometd from channel: "+k);const ae=this._createOneShotMessagePromise("/meta/unsubscribe");return this.cometd.unsubscribe(this.subscriptions[k]),delete this.subscriptions[k],ae}else return new _().resolve({successful:!0})},doStartBatch:function(){this.cometd.startBatch()},doEndBatch:function(){this.cometd.endBatch()},doSetLatency:function(k){this.workerProxyAsyncClient.setLatency(k)},doSetErrorRate:function(k){this.workerProxyAsyncClient.setErrorRate(k)},getTransport:function(){return this.cometd&&!this.cometd.isDisconnected()?this.cometd.getTransport().getType():r.UNKNOWN},_handleCometResponse:function(k){this._shouldHandleMessage(k)&&this.onMessage(this._stripBasePrefixAndConvertToJson(k))},_shouldHandleMessage:function(k){return k.id?!1:this.recentMessages.indexOf(k)<0?(this.recentMessages.push(k),this._deferRecentMessagesCleanup(),!0):!1},_deferRecentMessagesCleanup:function(){this._deferredCleanup||(this._deferredCleanup=setTimeout(this._deferredCleanupFunction,0))},_createOneShotMessagePromise:function(k){const ae=new _;return this._addOneShotListener(k,function(j){K(j,ae)}),ae.promise},_addOneShotListener:function(k,ae){const j=this,F=this.cometd,J=this.cometd.addListener(k,function(te){F.removeListener(J),ae.apply(j,arguments)})},_setUpEndPoint:function(){let k,ae=!1;const j="MESSAGE_SERVICE_ASYNC_ENDPOINT",F=!0,J=!0;let te;return k=this.routingHost||"/",k.slice(-1)!=="/"&&(k+="/"),k+=this.BASE_END_POINT,this.routingKey&&(k+="?routingkey="+this.routingKey),{remoteSupportsSendPayload:ae,url:k,endPointName:j,endPointAllowsDirectXhr:te}},_getRequestChannel:function(k){return this.BASE_PREFIX+k},_stripBasePrefixAndConvertToJson:function(k){return{channel:k.channel.substring(this.BASE_PREFIX.length),data:k.data}}});return Y.enableWebsocket=!1,Y.workerHostOverride=!1,window.location.search.indexOf("websocket=on")>=0&&(Y.enableWebsocket=!0),p.default=Y,p.default},D,V),D.exports=B},376:(D,V,f)=>{var R,B;R=[f(1203),f(1873),f(3660),f(4371),f(8976),f(4528),f(8706),f(54)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u){"use strict";var g={};return g.default=d([r],{logSubscriptions:!1,constructor:function(){this.batching=!0,this.typeSerializers=[],this.typeDeserializers={},this.channelSubscriptions={},this._queuedOps=[],this._hasConnected=!1},setDelegate:function p(y){this.inherited("setDelegate",p,arguments),_.after(this._delegate,"onMessage",N.hitch(this,this.handleMessage),!0)},publish:function(p,y){if(!h(p))throw new Error(`Illegal argument: invalid channel name ${p}`);if(this.isConnected()){const x=this._queuePublish(p,this.serialize(y));return this._deferProcessQueue(),x}else return this._queuePublish(p,this.serialize(y))},subscribe:function(p,y,x){if(!h(p))throw new Error(`Illegal argument: invalid channel name ${p}`);this.logSubscriptions&&n.info("MessageService subscribe: "+p,y,x);const w=this._queueSubscribe(p,y,x);return this._addHandler(this.channelSubscriptions,p,y,x),w.catch(()=>{w.isCanceled()||this._removeHandler(this.channelSubscriptions,p,y,x)}),this.isConnected()&&this._deferProcessQueue(),w},unsubscribe:function(p,y,x){if(!h(p))throw new Error(`Illegal argument: invalid channel name ${p}`);if(this.logSubscriptions&&n.info("MessageService unsubscribe: "+p,y,x),this._removeHandler(this.channelSubscriptions,p,y,x)){if(this._removeQueuedMatchingSubscribe(p,y,x))return new l().resolve();if(this.isConnected()){const M=this._queueUnsubscribe(p,y,x);return this._deferProcessQueue(),M}else return new l().resolve()}else return n.error("Not subscribed to channel: "+p+", can't unsubscribe."),new l().reject("Not subscribed to channel: "+p+", can't unsubscribe.")},flush:function(){if(this.isConnected())this._processQueue();else throw new Error("Can only manually flush the queue when connected.")},setLatency:function(p){this._delegate&&this._delegate.doSetLatency&&this._delegate.doSetLatency(p)},setErrorRate:function(p){this._delegate&&this._delegate.doSetErrorRate&&this._delegate.doSetErrorRate(p)},getTransport:function(){return this._delegate&&this._delegate.getTransport?this._delegate.getTransport():u.UNKNOWN},_enterDisconnected:function p(){this.inherited("_enterDisconnected",p,arguments),this._rejectQueue()},_enterConnecting:function p(){this.inherited("_enterConnecting",p,arguments),Object.keys(this.channelSubscriptions).forEach(y=>{this.channelSubscriptions[y].subscribed=!1})},_enterConnected:function p(){this._hasConnected=!0,this.inherited("_enterConnected",p,arguments),this._processQueue()},_enterDisconnecting:function p(){this._processQueue(),this.inherited("_enterDisconnecting",p,arguments)},_enterFatallyDisconnected:function p(){this.inherited("_enterFatallyDisconnected",p,arguments),this._rejectQueue()},_queuePublish:function(p,y){const x=new l;return this._queuedOps.push({type:"publish",channel:p,data:y,deferred:x}),x.promise},_queueSubscribe:function(p,y,x){const w=new l;return this._queuedOps.push({type:"subscribe",channel:p,handler:y,scope:x,deferred:w}),w.promise},_removeQueuedMatchingSubscribe:function(p,y,x){let w;for(let M=this._queuedOps.length-1;M>=0;M-=1)if(w=this._queuedOps[M],w.type==="subscribe"&&w.channel===p&&w.handler===y&&w.scope===x){this._queuedOps.splice(M,1);const T=this._delegate&&this._delegate.delegateConnected();return this.isConnected()&&T&&w.deferred.resolve(),!0}},_queueUnsubscribe:function(p,y,x){const w=new l;return this._queuedOps.push({type:"unsubscribe",channel:p,handler:y,scope:x,deferred:w}),w.promise},_processQueue:function(){const p=this._delegate&&this._delegate.delegateConnected();if(!(this.isConnected()&&p)&&this._currentState!=="disconnecting")return;this._delegate.doStartBatch();const x=this._queuedOps;this._queuedOps=[],x.forEach(function(w){let M;w.type==="publish"?M=this._delegate.doPublish(w.channel,w.data):w.type==="subscribe"?M=this._doSubscribe(w.channel,w.handler,w.scope):w.type==="unsubscribe"&&(M=this._doUnsubscribe(w.channel,w.handler,w.scope)),M.then(w.deferred.resolve,w.deferred.reject)},this),this._delegate.doEndBatch()},_rejectQueue:function(){if(this._hasConnected){for(let p=0;p<this._queuedOps.length;p+=1)this._queuedOps[p].deferred.reject(new Error("MessageService disconnected. Discarding queued message"));this._queuedOps=[]}this._hasConnected=!1},_deferProcessQueue:function(){if(this.batching&&!this._deferredTimeout){const p=this;this._deferredTimeout=setTimeout(function(){p._deferredTimeout=!1,p._processQueue()},0)}else this.batching||this._processQueue()},_doSubscribe:function(p){if(this.channelSubscriptions[p].subscribed)return new l().resolve();{const y=this._delegate.doSubscribe(p);return this.channelSubscriptions[p].subscribed=!0,y.catch(()=>{this.channelSubscriptions[p].subscribed=!1}),y}},_doUnsubscribe:function(p){return this.channelSubscriptions[p]?new l().resolve():this._delegate.doUnsubscribe(p)},handleMessage:function(p){let y;if(p&&p.channel){p.data&&(p.data=this.deserialize(p.data));const x=p.channel.split("/");for(y=1;y<=x.length;y+=1)this._callHandlers(this.channelSubscriptions,x.slice(0,y).concat("**").join("/"),p);this._callHandlers(this.channelSubscriptions,x.slice(0,x.length-1).concat("*").join("/"),p),this._callHandlers(this.channelSubscriptions,x.concat("*").join("/"),p),this._callHandlers(this.channelSubscriptions,p.channel,p)}},registerMessageHandler:function(p,y,x){n.error("registerMessageHandler is not supported any more.")},deregisterMessageHandler:function(p,y,x){n.error("deregisterMessageHandler is not supported any more.")},registerTypeSerializer:function(p,y,x){this.typeSerializers.push({typeMatcher:p,type:y,serializer:x})},registerTypeDeserializer:function(p,y){this.typeDeserializers[p]=y},serialize:function(p){return Array.isArray(p)?this._serializeArray(p):p==null||typeof p=="number"||typeof p=="boolean"||N.isString(p)?p:this._serializeObject(p)},deserialize:function(p){return Array.isArray(p)?this._deserializeArray(p):typeof p=="number"||typeof p=="boolean"||N.isString(p)?p:this._deserializeObject(p)},_addHandler:function(p,y,x,w){if(w=w||this,typeof x=="string"&&typeof w[x]!="function"){n.warn("Not adding invalid handler: "+x);return}let M=p[y];M||(M=[],p[y]=M);const T={channel:y,handler:x,scope:w};M.push(T),M.sort(function(A){return A.exclusive?-1:0})},_removeHandler:function(p,y,x,w){w=w||this;const M=p[y],T=this._getHandlerIndex(M,{handler:x,scope:w});return T>=0&&M.splice(T,1),(!M||M.length===0)&&delete p[y],T>=0},_callHandlers:function(p,y,x){let w,M;if(Object.prototype.hasOwnProperty.call(p,y))for(w=p[y],M=0;M<w.length;M+=1)try{typeof w[M].handler=="string"?w[M].scope[w[M].handler].call(w[M].scope,x):w[M].handler.call(w[M].scope,x)}catch(T){n.error("Error while executing message handler on channel: "+y+", message: "+JSON.stringify(x,null,2)+", error: ",T)}},_getHandlerIndex:function(p,y){if(!p)return-1;let x;for(x=0;x<p.length;x+=1)if(y.handler===p[x].handler&&y.scope===p[x].scope)return x;return-1},_serializeObject:function(p){let y;for(y=0;y<this.typeSerializers.length;y+=1){const w=this.typeSerializers[y];if(w.typeMatcher(p))return{__type__:w.type,__value__:w.serializer.call(this,p)}}if(p instanceof window.Image)return p;const x={};for(const w in p)Object.prototype.hasOwnProperty.call(p,w)&&(x[w]=this.serialize(p[w]));return x},_serializeArray:function(p){const y=Array.from(p);let x;const w=y.length;for(x=0;x<w;x+=1)y[x]=this.serialize(y[x]);return y},_deserializeObject:function(p){let y;if(p==null)return null;if(Object.prototype.hasOwnProperty.call(p,"__type__")&&Object.prototype.hasOwnProperty.call(p,"__value__"))try{return this.typeDeserializers[p.__type__].call(this,p.__value__)}catch(x){n.error("Error while trying to deserialize: ",p,"Error: ",x)}for(y in p)Object.prototype.hasOwnProperty.call(p,y)&&p[y]!==null&&p[y]!==void 0&&(p[y]=this.deserialize(p[y]));return p},_deserializeArray:function(p){let y;const x=p.length;for(y=0;y<x;y+=1)p[y]=this.deserialize(p[y]);return p}}),g.default},D,V),D.exports=B},4528:(D,V,f)=>{var R,B;R=[f(1203),f(3543),f(1873),f(3660),f(6014),f(8976)],B=f.dj.d(R,function(d,N,_,l,n,r){"use strict";var h={};return h.default=d([N],{logStateChanges:!1,constructor:function(){this._stateOptions={context:this,name:"WraDataService",namespace:"MOTW.wra",defaultSubstate:"disconnected",substates:{disconnected:{transitions:{onEnterState:this._enterDisconnected,start:"connecting"}},connecting:{transitions:{onEnterState:this._enterConnecting,_connectSuccess:"connected",_connectFailure:"fatallyDisconnected",stop:"disconnected"}},connected:{transitions:{onEnterState:this._enterConnected,_reconnect:"connecting",stop:"disconnecting"}},disconnecting:{transitions:{onEnterState:this._enterDisconnecting,_disconnectSuccess:"disconnected",_disconnectFailure:"disconnected","timeout 2":"disconnected"}},fatallyDisconnected:{transitions:{onEnterState:this._enterFatallyDisconnected,stop:"disconnected"}}}}},setDelegate:function(u){this._delegate!==u&&(this._delegate=u,this._states=new n(this._stateOptions),l.after(this._states,"onEnterState",_.hitch(this,this._enterState),!0),this._states.start());const g=this;l.after(this._delegate,"onConnectionError",function(p){g._changeStateToConnecting(p)},!0),l.after(this._delegate,"onConnectionFails",function(){g._currentState="fatallyDisconnected",g._enterFatallyDisconnected()},!0),l.after(this._delegate,"onConnectionSuccess",function(){g._currentState="connected",g._enterConnected()},!0)},_changeStateToConnecting:function(u){r.info("Something wrong with connection, so changing state to connecting now, cometd is trying to connect again on its own. Here are some details about the error: ",JSON.stringify(u)),this._currentState="connecting",this.onNotConnected()},onConnected:function(){this.emit("connected")},onNewlyConnected:function(){},onDisconnected:function(){this.emit("disconnected")},onReconnected:function(){this.emit("reconnected")},onFatallyDisconnected:function(){this.emit("fatallyDisconnected")},onNotConnected:function(){this.emit("notConnected")},isStarted:function(){return this._currentState!=="disconnecting"&&this._currentState!=="disconnected"},isConnected:function(){return this._currentState==="connected"},isFatallyDisconnected:function(){return this._currentState==="fatallyDisconnected"},isDisconnected:function(){return this._currentState==="disconnected"},start:function(){this._forceStop=!1},stop:function(){this._forceStop=!0},_enterState:function(u){const g=this._currentState;this._currentState=u,this.logStateChanges&&r.info("MessageService state change: "+g+" -> "+u),g==="connected"&&this.onNotConnected(),u==="connected"&&this._previouslyConnected?this.onReconnected():u==="connected"&&!this._previouslyConnected&&this.onNewlyConnected()},_enterDisconnected:function(){this._previouslyConnected=!1,this._delegate.cleanup(),this._forceStop&&this._delegate.destructCometd(),this.onDisconnected()},_enterConnecting:function(){this._delegate.cleanup(),this._delegate.connect(this.channelSubscriptions).then(this._connectSuccess,this._connectFailure)},_reconnect:function(){},_connectSuccess:function(){},_connectFailure:function(){},_timeoutAction:function(){this.logStateChanges&&r.info("MessageService timeout:",arguments)},_enterConnected:function(){this._previouslyConnected&&r.info("Successfully connected."),this._previouslyConnected=!0,this.onConnected()},_enterFatallyDisconnected:function(){this.onFatallyDisconnected()},_enterDisconnecting:function(){this._delegate.disconnect().then(this._disconnectSuccess,this._disconnectFailure)},_disconnectSuccess:function(){},_disconnectFailure:function(){}}),h.default},D,V),D.exports=B},7355:(D,V,f)=>{var R,B;R=[f(1873),f(3660),f(1929),f(376)],B=f.dj.d(R,function(d,N,_,l){"use strict";var n={};return n.default=function(h){const u=new l,g={messageService:u,subscribe:d.hitch(u,"subscribe"),unsubscribe:d.hitch(u,"unsubscribe"),publish:d.hitch(u,"publish"),start:d.hitch(u,"start"),stop:d.hitch(u,"stop"),isRunning:d.hitch(u,"isStarted"),isStarted:d.hitch(u,"isStarted"),isConnected:d.hitch(u,"isConnected"),isFatallyDisconnected:d.hitch(u,"isFatallyDisconnected"),isDisconnected:d.hitch(u,"isDisconnected"),setLatency:d.hitch(u,"setLatency"),setErrorRate:d.hitch(u,"setErrorRate"),getTransport:d.hitch(u,"getTransport"),onConnected:function(){},onDisconnected:function(){},onReconnected:function(){},onFatallyDisconnected:function(){},onNotConnected:function(){},on:function(p,y){return _(this.messageService,p,y)},handleMessage:d.hitch(u,"handleMessage"),internalMotwDisableStart:function(){this._startFunction=this.start,this.start=function(){}},internalMotwEnableStart:function(){this._startFunction&&(this.start=this._startFunction,this._startFunction=null)}};return N.after(u,"onConnected",d.hitch(g,"onConnected"),!0),N.after(u,"onDisconnected",d.hitch(g,"onDisconnected"),!0),N.after(u,"onReconnected",d.hitch(g,"onReconnected"),!0),N.after(u,"onFatallyDisconnected",d.hitch(g,"onFatallyDisconnected"),!0),N.after(u,"onNotConnected",d.hitch(g,"onNotConnected"),!0),u.setDelegate(h),g},n.default},D,V),D.exports=B},140:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};return d.default={APP_SERVICE_HOST:{name:"APP_SERVICE_HOST",BASE_PREFIX:"/matlab",BASE_END_POINT:"messageservice/async/blue"},MATLAB_SERVICE_HOST:{name:"MATLAB_SERVICE_HOST",BASE_PREFIX:"/matlab",BASE_END_POINT:"messageservice/async"}},d.default},D,V),D.exports=B},8706:(D,V,f)=>{var R,B;R=[f(3553)],B=f.dj.d(R,function(d){"use strict";var N={};function _(g){return d.Utils.isString(g)}function l(g){return g>="A"&&g<="Z"?!0:g>="a"&&g<="z"}function n(g){return g>="0"&&g<="9"}function r(g){switch(g){case" ":case"!":case"#":case"$":case"(":case")":case"*":case"+":case"-":case".":case"/":case"@":case"_":case"{":case"~":case"}":case":":case"\\":case",":return!0;default:return!1}}function h(g){if(!_(g)||g.length<2||g.charAt(0)!=="/")return!1;for(let p=1;p<g.length;++p){const y=g.charAt(p);if(!(l(y)||n(y)||r(y)))return!1}return!0}const u=function(g){return h("/matlab"+g)};return N.default=u,N.default},D,V),D.exports=B},7223:(D,V,f)=>{var R,B;R=[f(140)],B=f.dj.d(R,function(d){"use strict";var N={};const _=/AppServiceHost/i,l=r=>r.serviceName.match(_)!==null,n=(r,h)=>l(h)?r[d.APP_SERVICE_HOST.name]():r[d.MATLAB_SERVICE_HOST.name]();return N.default=function(h,u){if(u.serviceName){if(!u.serviceName.length||u.serviceName.length<5)throw new Error("serviceName must be longer than 4 characters")}else throw new Error("Must provide a serviceName");const g=n(h,u),p={};return["subscribe","unsubscribe","publish","isStarted","isConnected","isFatallyDisconnected","isDisconnected","setLatency","setErrorRate","getTransport","on","onConnected","onDisconnected"].forEach(y=>{p[y]=g[y].bind(g)}),p.messageService=g.messageService,p},N.default},D,V),D.exports=B},54:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};return d.default={UNKNOWN:"unknown",LONG_POLLING:"long-polling",WEBSOCKET:"websocket"},d.default},D,V),D.exports=B},9685:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(640),f(7570),f(3971)],B=f.dj.d(R,function(d,N,_,l){return d([],{constructor:function(){this._initializeEndPointsCollection()},_initializeEndPointsCollection:function(){this.endPointsCollection={ROUTER_LEAF_INSECURE_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"messageservice/json",messages:["RouterLogin","CreateAccount","CurrentUser","Login","UpdateAccount","ServiceRegistry","ClientType","AuthorizationDetails","AcquireMatlab"],iframeProxyName:"remoteProducer",withCredentials:!0,acceptsMessageContainerMessages:!0},ROUTER_LEAF_SECURE_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"messageservice/json/secure",messages:[],iframeProxyName:"remoteProducer",withCredentials:!0,acceptsMessageContainerMessages:!0},WORKER_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!1,iframeProxyUrl:"",pathSuffix:"messageservice/json/secure",messages:[],iframeProxyName:"remoteWorkerProducer",withCredentials:!0,acceptsMessageContainerMessages:!0},WORKER_ASYNC_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"messageservice/async",messages:[],iframeProxyName:"remoteWorkerAsyncProducer",withCredentials:!0,acceptsMessageContainerMessages:!0},USAGE_DATA_ROUTER_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"udc/service/v1/events",messages:["UsageDataEventCollection"],iframeProxyName:"remoteUDCProducer",withCredentials:!1,acceptsMessageContainerMessages:!1},HELP_DATA_ROUTER_ENDPOINT:{routingHost:"",routingKey:"",iframeProxy:null,enabled:!0,iframeProxyUrl:"",pathSuffix:"",messages:["HelpDataEventCollection"],iframeProxyName:"doc_center",withCredentials:!1,acceptsMessageContainerMessages:!1}}},reset:function(){this._initializeEndPointsCollection()},setUpNewEndPoint:function(r,h,u,g,p){this.endPointsCollection[r]={routingHost:"",routingKey:"",pathSuffix:u,enabled:h,messages:[],iframeProxy:null,iframeProxyName:g,acceptsMessageContainerMessages:p}},getPathSuffixForEndPoint:function(r){return this.endPointsCollection[r].pathSuffix},setPathSuffixForEndPoint:function(r,h){this.endPointsCollection[r].pathSuffix=h},getEndPointNames:function(){const r={};let h;for(h in this.endPointsCollection)Object.prototype.hasOwnProperty.call(this.endPointsCollection,h)&&(r[h]=h);return r},setRoutingHostAndRoutingKey:function(r,h,u){if(h&&h.lastIndexOf("/")!==h.length-1&&(h+="/"),!l.isAllowed(h))throw new Error("Insecure endpoint.");this.endPointsCollection[r].routingHost=h,u&&(this.endPointsCollection[r].routingKey=u),this._setIframeRoutingHostAndRoutingkey(r)},_setIframeRoutingHostAndRoutingkey:function(r){const h=this.getIframeProxyClientForEndPoint(r);h&&h.setRemotePageHost(this.endPointsCollection[r].routingHost,this.endPointsCollection[r].routingKey,null,this.endPointsCollection[r].iframeProxyUrl,{withCredentials:this.endPointsCollection[r].withCredentials})},getRoutingHost:function(r){return this.endPointsCollection[r].routingHost},getRoutingKey:function(r){return this.endPointsCollection[r].routingKey},getMessageTypesMappedToEndPoint:function(r){return this.endPointsCollection[r].messages},isEndPointEnabled:function(r){return this.endPointsCollection[r].enabled},setMessageTypesToEndPoint:function(r,h){this.endPointsCollection[r].messages=h},enableEndPoint:function(r){this.endPointsCollection[r].enabled=!0},disableEndPoint:function(r){this.endPointsCollection[r].enabled=!1},getEndPointForMessageType:function(r){let h=null,u;for(u in this.endPointsCollection)if(Object.prototype.hasOwnProperty.call(this.endPointsCollection,u)&&(h=N.lastIndexOf(this.endPointsCollection[u].messages,r)>-1?u:h,h)){if(this.isEndPointEnabled(h))break;h=null}return h||this.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT},getRemoteUrlForEndPoint:function(r){let h=this.endPointsCollection[r].routingHost+this.endPointsCollection[r].pathSuffix;return this.endPointsCollection[r].routingKey&&(h=h+"?routingkey="+this.endPointsCollection[r].routingKey),h},setIframeProxyClientForEndPoint:function(r,h){this.endPointsCollection[r].iframeProxy=h},getIframeProxyClientForEndPoint:function(r){let h=this.endPointsCollection[r].iframeProxy;return h||(h=new _(this.endPointsCollection[r].iframeProxyName),this.endPointsCollection[r].iframeProxy=h),h},isEndpointMessageContainerBased:function(r){return r&&this.endPointsCollection[r]?this.endPointsCollection[r].acceptsMessageContainerMessages:!0},addMessagesTypesToEndPoint:function(r,h){this.endPointsCollection[r]&&this.endPointsCollection[r].messages.indexOf(h)===-1&&this.endPointsCollection[r].messages.push(h)},removeMessageTypesFromEndPoint:function(r,h){if(this.endPointsCollection[r]){const u=this.endPointsCollection[r].messages.indexOf(h);u>-1&&this.endPointsCollection[r].messages.splice(u,1)}}})},D,V),D.exports=B},8374:(D,V,f)=>{"use strict";var R,B;R=[f(1873),f(5642),f(3660),f(7570),f(742),f(4361),f(8083),f(6113),f(1462),f(9819),f(3461),f(958),f(8976),f(4202),f(245)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u,g,p,y,x,w,M,T){const A={reset:function(){let z=[];const H=new n,q=new h({faultManager:H}),P=new r({responseManager:q});A.faultManager=H,A.responseManager=q,A.requestManager=P,A._serviceRegistryLookup=T,A._uploadParameters={};const Z=A.proxyClient=new l;A.createUploadIframeTarget=d.hitch(Z,Z.createUploadIframeTarget),A.cancelUpload=d.hitch(Z,Z.cancelUpload),p.setIframeProxyClientForEndPoint(p.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT,Z),p.setIframeProxyClientForEndPoint(p.getEndPointNames().ROUTER_LEAF_INSECURE_ENDPOINT,Z),u.construct=function(K){return K=K||{},p.getRoutingHost(p.getEndPointNames().ROUTER_LEAF_INSECURE_ENDPOINT)||A.setEndpoint(),K.allowedMessages=z,K.sendMessage=A.sendMessage,K.computeSessionId=A.getComputeSessionId,new g(K)},A.registerEndpointLevelFaultHandler=d.hitch(H,H.registerEndpointLevelFaultHandler),A.sendMessage=d.hitch(P,P.sendMessage),A.sendPayload=y.sendPayload,A.registerDefaultMessageFactory=d.hitch(P,P.registerDefaultMessageFactory),A.deregisterDefaultMessageFactory=d.hitch(P,P.deregisterDefaultMessageFactory),A.registerResponseHandler=d.hitch(q,q.registerResponseHandler),A.deregisterResponseHandler=d.hitch(q,q.deregisterResponseHandler),A.registerFaultHandler=d.hitch(H,H.registerFaultHandler),A.deregisterFaultHandler=d.hitch(H,H.deregisterFaultHandler),A.registerTopLevelFaultHandler=d.hitch(H,H.registerTopLevelFaultHandler),A.deregisterTopLevelFaultHandler=d.hitch(H,H.deregisterTopLevelFaultHandler),A.setServiceEndPoint=function(K,Y,k){p.setRoutingHostAndRoutingKey(K,Y,k)},A.setServicePathSuffixForEndPoint=function(K,Y){p.setPathSuffixForEndPoint(K,Y)},A.ignoreTopLevelFault=A.registerTopLevelFaultHandler,A.setComputeToken=function(K){A._uploadParameters.computeToken=K.computeSessionId,P.computeToken=K},A.setWorkerEndpoint=function(K,Y){A._uploadParameters.routingKey=Y,p.setRoutingHostAndRoutingKey(p.getEndPointNames().WORKER_ENDPOINT,K,Y)},A.setEndpoint=function(K){if(!K){const Y=A._serviceRegistryLookup.getServiceRegistryEndpoint("primary");Y?K=Y:(w.info("ServiceRegistryLookup is empty, falling back to localhost"),K="/")}if(!K||K==="/"){const Y=(document.getElementsByTagName("base")[0]||{}).href;if(Y!==void 0){const k=document.createElement("a");k.display="none",k.href=Y,K=k.protocol+"//"+k.hostname+(k.port?":"+k.port:"")+"/"}else K=window.location.protocol+"//"+window.location.host+"/"}p.setRoutingHostAndRoutingKey(p.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT,K),p.setRoutingHostAndRoutingKey(p.getEndPointNames().ROUTER_LEAF_INSECURE_ENDPOINT,K),Z.setRemotePageHost(K,void 0,void 0,void 0,{withCredentials:p.endPointsCollection[p.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT].withCredentials})},A.setAllowedMessages=function(K){z=K},A.allowAllMessages=function(){z=[]},A.getEndPoint=function(){return p.getRoutingHost(p.getEndPointNames().ROUTER_LEAF_SECURE_ENDPOINT)},A.getComputeSessionId=function(){return P.computeToken?P.computeToken.computeSessionId:null},A.getWorkerRoutingHost=function(){let K=p.getRoutingHost(p.getEndPointNames().WORKER_ENDPOINT);if(K)return K;if(K=A._serviceRegistryLookup.getServiceRegistryEndpoint("primary"),!K||K==="/"){const Y=(document.getElementsByTagName("base")[0]||{}).href;if(Y!==void 0){const k=document.createElement("a");k.display="none",k.href=Y,K=k.protocol+"//"+k.hostname+(k.port?":"+k.port:"")+"/"}else K=window.location.protocol+"//"+window.location.host+"/"}return K},A.getWorkerRoutingKey=function(){return p.getRoutingKey(p.getEndPointNames().WORKER_ENDPOINT)},A.getDownloadUrlForFile=K=>{if(!K)throw new Error("Invalid input arguments provided!");const Y=new N,k=new URL(A.getWorkerRoutingHost()+"download"+K);return y.sendPayload(JSON.stringify({messages:{CreateCsrfToken:[{}]}}),p.getEndPointNames().WORKER_ENDPOINT).then(j=>{j.messages.CreateCsrfTokenResponse.forEach(function(F){F.messageFaults&&F.messageFaults.length>0||(k.searchParams.set("csrfToken",F.csrfToken),Y.resolve(k))})}),Y},A.upload=function(K,Y){return new x().upload(K,Y,{endpoint:A.getWorkerRoutingHost(),uploadParams:A._uploadParameters})},A.createWorkerRoutingHostUrl=function(K){return M.createWorkerRoutingHostUrl(K,{host:A.getWorkerRoutingHost(),sessionId:A.getComputeSessionId(),routingKey:A.getWorkerRoutingKey()})},A.getServiceRegistryEndpoint=function(K){return A._serviceRegistryLookup.getServiceRegistryEndpoint(K)},A.enableServerOnWorkerAsync=function(){p.enableEndPoint(p.getEndPointNames().WORKER_ASYNC_ENDPOINT)},A.disableServerOnWorkerAsync=function(){p.disableEndPoint(p.getEndPointNames().WORKER_ASYNC_ENDPOINT)},A.isServerOnWorkerAsyncEnabled=function(){return p.isEndPointEnabled(p.getEndPointNames().WORKER_ASYNC_ENDPOINT)},A.enableServerOnWorker=function(){p.enableEndPoint(p.getEndPointNames().WORKER_ENDPOINT)},A.disableServerOnWorker=function(){p.disableEndPoint(p.getEndPointNames().WORKER_ENDPOINT)},A.isWorkerEndpointEnabled=function(){return p.isEndPointEnabled(p.getEndPointNames().WORKER_ENDPOINT)},A.setWorkerOnlyMessageTypes=function(K){p.setMessageTypesToEndPoint(p.getEndPointNames().WORKER_ENDPOINT,K)},_.after(Z,"onError",function(K){K&&H.handleNonTransactionFault(K)},!0),A.createNewEndPoint=function(K,Y,k,ae,j){this.getEndPointByName(K)||p.setUpNewEndPoint(K,Y,k,ae,j)},A.getUrlForEndPoint=function(K){return p.getRemoteUrlForEndPoint(K)},A.getEndPointByName=function(K){return p.getEndPointNames()[K]}}};return A.reset(),A},D,V),D.exports=B},9819:(D,V,f)=>{"use strict";var R,B;R=[f(9685)],B=f.dj.d(R,function(d){let N=null;return function(){return N===null&&(N=new d),N}()},D,V),D.exports=B},8999:(D,V,f)=>{"use strict";var R,B;R=[],B=f.dj.d(R,function(){"use strict";return class{constructor(d){this._xhr=null,this._uploadDestinationUrl=d.uploadDestinationUrl,this._computeToken=d.computeToken,this._routingkey=d.routingkey,this._fileDestination=d.fileDestination,this._csrfToken=d.csrfToken,this._postMessage=N=>{d.postMessage(N)}}_postMessageToParent(d){this._postMessage({data:d})}_createFormDataFromFileList(d){const N=new window.FormData,_="uploadFileName";for(let l=0;l<d.length;l++){const n=d[l];N.append(_,n,n.name)}return N}_createAndSendXhr(d){this._xhr=new XMLHttpRequest,this._xhr.upload.onprogress=N=>{this._postMessageToParent({type:"updateProgress",loaded:N.loaded,total:N.total})},this._xhr.onload=()=>{this._postMessageToParent({type:"uploadFinished",status:this._xhr.status,response:this._xhr.response})},this._xhr.onerror=()=>{this._postMessageToParent({type:"uploadError",status:this._xhr.status,response:this._xhr.response})},this._xhr.open("POST","".concat(this._uploadDestinationUrl,"?dest=").concat(this._fileDestination,"&computeToken=").concat(this._computeToken,"&routingkey=").concat(this._routingkey,"&csrfToken=").concat(this._csrfToken),!0),this._xhr.withCredentials=!0,this._xhr.send(d)}handleMessage(d){if(d.data instanceof FileList){const N=this._createFormDataFromFileList(d.data);this._createAndSendXhr(N);return}d.data==="cancelUpload"&&(this._xhr&&this._xhr.abort(),this._postMessageToParent({type:"uploadCanceled"}))}}},D,V),D.exports=B},958:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(4371),f(2490),f(1423),f(9819),f(3461),f(8999)],B=f.dj.d(R,function(d,N,_,l,n,r,h){return d([],{constructor:function(){},upload:function(g,p,y){const x=this;if(this._uploadHandler=new N(function(){x.postMessageToUploadIframe("cancelUpload"),x._unloadIframe()}),this._workerEndpoint=y.endpoint,g instanceof FileList){let w={csrfToken:void 0,validForMs:void 0};return r.sendPayload(JSON.stringify({messages:{CreateCsrfToken:[{}]}}),n.getEndPointNames().WORKER_ENDPOINT).then(function(T){T.messages.CreateCsrfTokenResponse.forEach(function(H){H.messageFaults&&H.messageFaults.length>0||(w={csrfToken:H.csrfToken,validForMs:H.validForMs})});const A=y.uploadParams,C=A.computeToken,z=A.routingKey;x._initiateUpload(g,{uploadDestinationUrl:x._workerEndpoint+"upload",computeToken:C,routingkey:z,fileDestination:encodeURIComponent(p),csrfToken:encodeURIComponent(w.csrfToken)})}),this._uploadHandler}},_initiateUpload:function(g,p){const y=this;this._eventCallBack=function(x){switch(x.data.type){case"updateProgress":y._uploadHandler.progress({loaded:x.data.loaded,total:x.data.total});break;case"uploadFinished":y._uploadHandler.resolve({status:x.data.status,response:x.data.response}),y._unloadIframe();break;case"uploadError":y._uploadHandler.reject({status:x.data.status,response:x.data.response});break;default:break}},p.postMessage=this._eventCallBack,this._ReplaceUploadIframe=new h(p),this.postMessageToUploadIframe(g)},_unloadIframe:function(){this._ReplaceUploadIframe=null},getHostName:function(g){return l.parseUrl(g).hostname},postMessageToUploadIframe:function(g){this._ReplaceUploadIframe&&this._ReplaceUploadIframe.handleMessage({data:g})}})},D,V),D.exports=B},1912:(D,V,f)=>{"use strict";var R,B;R=[],B=f.dj.d(R,function(){return{Eval:["CurrentFolder","ListFolder"],"Eval:Ping":[],"Eval:RunFile":["UpdateFile","CurrentFolder","ListFolder"],"Eval:MlsPublishPre":["UpdateFile"],"FEval:liveEvalInstrumentCode":[],Interrupt:[],"FEval:GetFigures":["CurrentFolder","ListFolder"],"FEval:CloseFigure":["FEval:GetFigures"],"FEval:SelectFigure":["FEval:GetFigures"],"FEval:ResetAxes":["FEval:GetFigures"],"FEval:ResizeFigure":["FEval:GetFigures"],"FEval:AxesInteraction2D":["FEval:GetFigures"],"FEval:AxesInteraction3D":["FEval:GetFigures"],CurrentUser:["ServiceRegistry"],RouterLogin:["ServiceRegistry"],CurrentFolder:["ListFolder"],MoveFile:["CurrentFolder"],Variable:[],CloseFile:["SaveSession"],UpdateFile:["SaveSession"],SaveSession:["UpdateFile"],SaveSessionState:["UpdateFile"],Logout:["CloseFile"],UpdateShare:["ListFolder"],AcquireMatlab:["ServiceRegistry"]}},D,V),D.exports=B},3245:(D,V,f)=>{"use strict";var R,B;R=[f(3458),f(1929),f(5665),f(8976)],B=f.dj.d(R,function(d,N,_,l){"use strict";function n(r){if(!r)throw new Error("Expected a valid url in urlToEmptyJsFile");const h={};h.framedoc=null;const u="error",g=_.get(r,h,!0),p=d.byId(g.id,h.frameDoc),y=N(p,u,function(x){l.info("CheckUrlService detected an error accessing url: "+r),g.handleResponse(null,x),y.remove()});return g.promise}return n},D,V),D.exports=B},7570:(D,V,f)=>{"use strict";var R,B;R=[f(5135),f(1203),f(5642),f(1873),f(3660),f(2490),f(8976),f(3245)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u){const g=N([],{constructor:function(){this._messageId=0,this._loaded=!1,this._pendingQueue=[],this._transactions={},this._uploadTargetCallbacks={},this._checkUrl=null,this._loadTimeoutHandle=null,this._checkUrlTimeout=null,this._errorRate=0,this._inFlightTransactions={},this._webSocket=null},setRemotePageHost:function(y,x,w,M){let T=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};y=this._combineUriPaths(y||"","/"),x=x||"",M=M||"",this.computeToken=w,this._withCredentials=this._withCredentials||!1,typeof T.withCredentials>"u"||T.withCredentials===null||(this._withCredentials=!!T.withCredentials),!(y===this._host&&x===this._key&&M===this._proxyUrl)&&(this._errorLoading=!1,this._host=y,this._key=x,this._proxyUrl=M,this._cleanupFailureChecks(),this._loaded=!0,this._flushPending())},setLatency:function(y){this._latency=y},setErrorRate:function(y){this._errorRate=y},sendMessage:function(y,x,w){const M=this;let T;this.computeToken&&(w=w||{},w.headers=w.headers||{},w.headers.computeToken=this.computeToken);const A=w||{},C=this._getNewMessageId();T={action:"sendMessage",id:C,endpoint:x,options:A,message:y};function z(){T={action:"abort",id:C},M._postMessage(T)}const H={deferred:new _(z),id:C};return this._errorLoading?H.deferred.reject("Error loading: "+this._url):(this._transactions[C]=H,this._postMessage(T)),H.deferred},_postMessage:function(y){this._loaded?this._postMessageNow(y):this._pendingQueue.push(y)},_handleMessage:function(y){let x,w,M,T;const A=y.data.action;if(!A)throw new Error("Client unable to parse message, no action specified: "+JSON.stringify(y.data));switch(A){case"ready":this._cleanupFailureChecks(),this._loaded=!0,this._flushPending();break;case"sendMessageResponse":this._sendMessageResponse(y);break;case"uploadIframeMessage":x=y.data.id,w=y.data.message,this._uploadTargetCallbacks[x](w);break;case"websocketOpened":this.onWebsocketOpen();break;case"websocketClosed":M=y.data.message,this.onWebsocketClose(M);break;case"websocketMsg":T=y.data.message,this.onWebsocketMsg(T);break;case"websocketError":this.onWebsocketError();break;default:throw new Error("Unknown action: "+A+", data: "+JSON.stringify(y.data))}},_sendMessageResponse:function(y){let x;const w=y.data.id,M=y.data.responseType,T=y.data.message;if(!w||!M)throw new Error("Invalid message: "+JSON.stringify(y.data));const A=this._transactions[w];if(!A)throw new Error("Unknown transaction id: "+w+": "+JSON.stringify(y.data));if(delete this._transactions[w],!A.deferred.isCanceled()){if(M==="success"){try{x=T&&JSON.parse(T)}catch(C){x=T}x=x===""?{}:x,A.deferred.resolve(x);return}this.onError(T),A.deferred.reject(T)}},_cleanupFailureChecks:function(){this._checkUrlTimeout&&clearTimeout(this._checkUrlTimeout),this._loadTimeoutHandle&&clearTimeout(this._loadTimeoutHandle),this._checkUrl&&!this._checkUrl.isFulfilled()&&this._checkUrl.cancel("Timeout Occurred",!1),this._checkUrlTimeout=null,this._loadTimeoutHandle=null,this._checkUrl=null},_handleLoadTimeout:function(){let y;if(this._loaded)return;const x={code:"IframeLoadTimeout",description:"Iframe proxy loading failed due to an HTTP error",message:""},w=this._transactions;this._transactions={},this._pendingQueue=[];for(y in w)Object.prototype.hasOwnProperty.call(w,y)&&w[y].deferred.reject("Timeout: "+this._url+" at "+new Date);this._errorLoading=!0,this.onError(x)},_handleXhrResponse:function(y,x){const w={action:"sendMessageResponse",id:y,responseType:"success",message:x};this._handleMessage({data:w})},_handleXhrFault:function(y,x){const w={action:"sendMessageResponse",id:y,responseType:"fault",message:x};this._handleMessage({data:w})},_sendXHRNow:function(y){let x,w,M,T,A,C,z;const H=y.data.action;if(!H)throw new Error("Unable to parse message, no action specified: "+JSON.stringify(y.data));let q;switch(H){case"sendMessage":if(x=y.data.id,w=y.data.endpoint,T=y.data.options,M=y.data.message,x&&w&&M)try{if(A=new XMLHttpRequest,this._inFlightTransactions[x]={xhr:A},C=!1,A.onreadystatechange=()=>{let P;A.readyState===0?(C=!0,this.handleXhrFault(x,"XHR readyState 0")):A.readyState===4&&!C&&(C=!0,P=A.status||0,P>=200&&P<300||P===304?this._handleXhrResponse(x,A.responseText):this._handleXhrFault(x,A.responseText)),C&&A&&(A.onreadystatechange=this._noop,A=null,delete this._inFlightTransactions[x].xhr,delete this._inFlightTransactions[x])},A.open("POST",w,!0),A.withCredentials=this._withCredentials,A.setRequestHeader("Content-Type",T.contentType?T.contentType:"application/json"),A.setRequestHeader("X-Requested-With","XMLHttpRequest"),T.headers)for(z in T.headers)Object.prototype.hasOwnProperty.call(T.headers,z)&&A.setRequestHeader(z,T.headers[z]);A.send(M)}catch(P){this.handleXhrFault(x,"Unable to send data: "+P.toString())}else throw new Error("Invalid message to send: "+JSON.stringify(y.data));break;case"abort":x=y.data.id,this._inFlightTransactions[x]&&this._inFlightTransactions[x].xhr.abort();break;case"connectWebsocket":q=y.data.url,this._webSocket=new WebSocket(q),this._webSocket.onopen=()=>{this.onWebsocketOpen()},this._webSocket.onmessage=P=>{this.onWebsocketMsg(P)},this._webSocket.onclose=P=>{const Z={code:P.code,reason:P.reason,wasClean:P.wasClean};this.onWebsocketClose(Z)},this._webSocket.onerror=()=>{this.onWebsocketError()};break;case"websocketSend":this._webSocket.send(y.data.data);break;case"closeWebsocket":this._webSocket.close();break;default:throw new Error("Unknown action: "+H)}},_postMessageNow:function(y){const x=this;let w,M;function T(){if(x._errorRate>0&&Math.random()<x._errorRate&&y.action==="sendMessage"){if(w=y.id,M=x._transactions[w],M){delete x._transactions[w],h.error("Generating simulated error. Request was: ",JSON.stringify(y));const A="403 Forbidden;403";x.onError(A),M.deferred.reject(A)}}else x._sendXHRNow({data:y})}this._latency?setTimeout(T,this._latency):T()},_flushPending:function(){this._pendingQueue.forEach(this._postMessageNow,this),this._pendingQueue=[]},_getNewMessageId:function(){return this._messageId+=1,this._messageId.toString()},onError:function(){},onWebsocketOpen:function(){},onWebsocketMsg:function(){},onWebsocketClose:function(){},onWebsocketError:function(){},_combineUriPaths:function(){return Array.prototype.slice.call(arguments).reduce(function(w,M){return w.length===0?M:(M.length>0&&(M[0]==="/"&&w.lastIndexOf("/")===w.length-1?M=M.substring(1):M[0]!=="/"&&w.lastIndexOf("/")!==w.length-1&&(w+="/")),w+M)})}});return g.WebSocket=N([],{constructor:function(y){const x=this;this.proxyClient=g.WebSocket.proxyClient,this.proxyClient.computeToken&&y.indexOf("?")>=0&&(y=y+"&computeToken="+this.proxyClient.computeToken);const w={action:"connectWebsocket",url:y};this.proxyClient._postMessage(w),n.after(this.proxyClient,"onWebsocketOpen",function(){x.onopen.apply(x,arguments)},!0),n.after(this.proxyClient,"onWebsocketMsg",function(){x.onmessage.apply(x,arguments)},!0),n.after(this.proxyClient,"onWebsocketClose",function(){x.onclose.apply(x,arguments)},!0),n.after(this.proxyClient,"onWebsocketError",function(){x.onerror.apply(x,arguments),x.proxyClient.onError.apply(x.proxyClient,arguments)},!0)},onopen:function(){},onmessage:function(){},onclose:function(){},onerror:function(){},send:function(y){const x={action:"websocketSend",data:y};this.proxyClient._postMessage(x)},close:function(){const y={action:"closeWebsocket"};this.proxyClient._postMessage(y)}}),g},D,V),D.exports=B},1462:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(4771),f(3461)],B=f.dj.d(R,function(d,N,_){return d([N],{_doSend:function(n){return _.sendPayload(n,this.endPointName)}})},D,V),D.exports=B},742:(D,V,f)=>{"use strict";var R,B;R=[f(640),f(1203),f(1873)],B=f.dj.d(R,function(d,N,_){return N([],{constructor:function(n){n=n||{},this.faultHandlers=n.faultHandlers||{},this.topLevelHandlers=n.topLevelHandlers||[],this.endPointLevelHandlers=n.endPointLevelHandlers||{}},registerFaultHandler:function(n,r,h){h&&(r=_.hitch(h,r)),this.faultHandlers[n]=r},deregisterFaultHandler:function(n){delete this.faultHandlers[n]},registerTopLevelFaultHandler:function(n,r,h){let u;if(h&&(r=_.hitch(h,r)),_.isString(n)){if(n==="*")return u={matcher:n,handler:r},this.defaultTopLevelHandler=r,u;n=this._constructMatcherFromQuery(n)}return u={matcher:n,handler:r},this.topLevelHandlers.push(u),u},registerEndpointLevelFaultHandler:function(n,r,h,u){u&&(h=_.hitch(u,h)),_.isString(r)&&(r=this._constructMatcherFromQuery(r));const g={matcher:r,handler:h};return this.endPointLevelHandlers[n]||(this.endPointLevelHandlers[n]=[]),this.endPointLevelHandlers[n].push(g),g},deregisterTopLevelFaultHandler:function(n){const r=this.topLevelHandlers.indexOf(n);r>-1?this.topLevelHandlers.splice(r,1):n.matcher==="*"&&delete this.defaultTopLevelHandler},_constructMatcherFromQuery:function(n){const r=n.split("||"),h=[];return r.forEach(function(u){u=_.trim(u),u=u.replace(/([.])/g,"\\$1"),u=u.replace(/\*/g,".*"),h.push(new RegExp("^"+u+"$"))}),function(u){return d.some(h,function(g){return g.test(u.faultCode||u.code||"")})}},handleFault:function(n){let r;const h=function(g,p){let y;const x=n.getMessageClassifier(p);x&&(y=[g,x].join(":"),this.faultHandlers[y]&&this.faultHandlers[y](n.fault,n.context))};for(r in n.requestMessages)if(Object.prototype.hasOwnProperty.call(n.requestMessages,r)){this.faultHandlers[r]&&this.faultHandlers[r](n.fault,n.context);const u=n.requestMessages[r];Array.isArray(u)&&u.forEach(_.hitch(this,h,r))}this.faultHandlers["*"]&&this.faultHandlers["*"](n.fault,n.context),this.endPointLevelHandlers[n.endPointName]?this._handleEndpointLevelFault(n):this._handleTopLevelFault(n)},_handleEndpointLevelFault:function(n){let r=!1;const h=d.filter(this.endPointLevelHandlers[n.endPointName],function(u){return u.matcher.call(this,n.fault,n.context)},this);return h.length>0&&h[0].handler&&(r=!0,h[0].handler.call(this,n.fault,n.context,n)),r},_handleTopLevelFault:function(n){const r=d.filter(this.topLevelHandlers,function(u){return u.matcher.call(this,n.fault,n.context)},this),h=r.length>0?r[0].handler:this.defaultTopLevelHandler;h&&h.call(this,n.fault,n.context,n)},handleNonTransactionFault:function(n){const r=d.filter(this.topLevelHandlers,function(u){return u.matcher.call(this,n)},this),h=r.length>0?r[0].handler:this.defaultTopLevelHandler;h&&h.call(this,n)}})},D,V),D.exports=B},4771:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(8519),f(1873),f(9819),f(6113)],B=f.dj.d(R,function(d,N,_,l,n){return d(n,{constructor:function(h){h=h||{},this.uuid=h.uuid||this._generateUuid()},_getRequest:function(h){const u=l.isEndpointMessageContainerBased(this.endPointName);let g=null;return u?(g={uuid:this.uuid,messages:h},this.computeToken&&(g.computeToken=this.computeToken)):Object.keys(h).forEach(function(y){g=h[y]}),this._sanitizeForJson(g),JSON.stringify(g,null,0)},_sanitizeForJson:function(h){let u;if(_.isArray(h))h.forEach(this._sanitizeForJson,this);else if(_.isObject(h))for(u in h)Object.prototype.hasOwnProperty.call(h,u)&&(h[u]===void 0?delete h[u]:(_.isObject(h[u])||_.isArray(h[u]))&&this._sanitizeForJson(h[u]))},_doSend:function(h){return N.post({url:this._getEndpoint(),contentType:"application/json",handleAs:"json",postData:h})},_processResponse:function(h){this.stopTime=new Date().getTime(),h?(h.fault&&(this.fault=h.fault),h.messages?this.responseMessages=h.messages:this.responseMessages=h):this.fault={faultCode:"Connection.Fault",message:"Unable to communicate with server, no response."}},_processFault:function(h){this.stopTime=new Date().getTime(),this.fault={faultCode:"Connection.Fault",message:h}}})},D,V),D.exports=B},4361:(D,V,f)=>{"use strict";var R,B;R=[f(640),f(1203),f(5642),f(1873),f(9819),f(1912),f(6113)],B=f.dj.d(R,function(d,N,_,l,n,r,h){return N([],{defaultMapping:r,constructor:function(g){g=g||{},this.defaultFactories=g.defaultFactories||{},this.mockHandlers=g.mockHandlers||{},this.mapping=g.mapping||this.defaultMapping,this.responseManager=g.responseManager},registerDefaultMessageFactory:function(g,p,y){y&&(p=l.hitch(y,p)),this.defaultFactories[g]=p},deregisterDefaultMessageFactory:function(g){delete this.defaultFactories[g]},registerMockResponseGenerator:function(g,p,y){const x=this;p=l.hitch(y||this,p),this.mockHandlers[g]=function(w,M){let T;const A=h.construct(M);T=p(w,A),T||(T=new _,T.callback()),T.addCallback(function(){x.responseManager._processResult(A)})}},deregisterMockResponseGenerator:function(g){delete this.mockHandlers[g]},sendMessage:function(g,p,y){const x={},w={};let M,T;p=p||{},this._createAndFillTransactions(g,p,y,x,w);const A=Object.keys(x);for(M=0;M<A.length;M=M+1)T=A[M],this._callMocks(w[T]),x[T].send(),this.responseManager.handleTransaction(x[T])},_getTransaction:function(g,p){return h.construct({context:p,computeToken:this.computeToken,endPointName:g})},_getMockTransaction:function(g,p,y){return h.construct({context:p,computeToken:this.computeToken,endPointName:g,uuid:y})},_createAndFillTransactions:function(g,p,y,x,w){let M,T;const A=function(q){let P,Z,K,Y,k,ae;const j=n.getEndPointForMessageType(q);if(k=x[j],ae=w[j],k||(k=this._getTransaction(j,p),ae=this._getMockTransaction(j,p,k.uuid),x[j]=k,w[j]=ae),this.defaultFactories[q]){if(P=this.defaultFactories[q](k.context),!P)return;Z=q.split(":"),K=Z[0],Y=Z.slice(1,Z.length).join(":"),this.mockHandlers[q]||k.addRequestMessage(K,P,Y),ae.addRequestMessage(K,P,Y)}};let C,z;for(M in g)if(Object.prototype.hasOwnProperty.call(g,M)){const H=n.getEndPointForMessageType(M);C=w[H],z=x[H],x[H]||(z=this._getTransaction(H,p),C=this._getMockTransaction(H,p,z.uuid),x[H]=z,w[H]=C),T=[M,y].join(":"),this.mockHandlers[M]||this.mockHandlers[T]||z.addRequestMessage(M,g[M],y),C.addRequestMessage(M,g[M],y),this.mapping[T]?this.mapping[T].forEach(A,this):this.mapping[M]&&this.mapping[M].forEach(A,this)}},_callMocks:function(g){let p,y;const x=g.context;delete g.context;const w=function(T,A){let C;const z=p.getMessageClassifier(A);z&&(C=[T,z].join(":"),this.mockHandlers[C]&&this.mockHandlers[C]([A],p))};for(y in g.requestMessages)Object.prototype.hasOwnProperty.call(g.requestMessages,y)&&(p=l.mixin({},g),p.context=x,Object.prototype.hasOwnProperty.call(this.mockHandlers,y)&&this.mockHandlers[y](p.requestMessages[y],p),Array.isArray(p.requestMessages[y])?p.requestMessages[y].forEach(l.hitch(this,w,y)):w(y,p.requestMessages[y]));this.mockHandlers["*"]&&this.mockHandlers["*"](y,p.requestMessages[y],p)}})},D,V),D.exports=B},8083:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(8976),f(9819)],B=f.dj.d(R,function(d,N,_,l){return d([],{constructor:function(r){r=r||{},this.responseHandlers=r.responseHandlers||{},this.faultManager=r.faultManager,this.transactions=r.transactions||[]},registerResponseHandler:function(r,h,u){u&&(h=N.hitch(u,h)),this.responseHandlers[r]=h},deregisterResponseHandler:function(r){delete this.responseHandlers[r]},handleTransaction:function(r){this.transactions.push(r),r.deferred.addCallback(N.hitch(this,this._processAll,r)),r.deferred.addCallback(N.hitch(this,this._processResult,r)),r.deferred.addErrback(N.hitch(this,this._processAll,r)),r.deferred.addErrback(N.hitch(this,this._processFault,r))},_processAll:function(r){const h=this.transactions.indexOf(r);h>=0&&this.transactions.splice(h,1)},_processResult:function(r){r.getResponseMessageTypes().forEach(function(h){const u=r.responseMessages[h],g=[];try{Array.isArray(u)&&(u.forEach(function(p){let y;const x=r.getMessageClassifier(p);if(x){y=[h,x].join(":");const w=this;let M=!1;r.getRequestMessageTypes().forEach(function(T){const A=r.requestMessages[T];Array.isArray(A)?A.forEach(function(C){w.responseHandlers[y]&&C.uuid===p.uuid&&(w.responseHandlers[y]([p],r.context),M=!0)}):w.responseHandlers[y]&&A.uuid===p.uuid&&(w.responseHandlers[y]([p],r.context),M=!0)}),M||g.push(p)}else g.push(p)},this),g.length>0&&this.responseHandlers[h]&&this.responseHandlers[h](g,r.context),this.responseHandlers["*"]&&this.responseHandlers["*"](h,r.responseMessages[h],r.context))}catch(p){_.error(`Remote: Fault occurred while processing response.
Message: `+p.message+`
Type: `+h+`
Response: `+JSON.stringify(u,null,2))}},this),this._processUdcResponses(r),r.fault&&this.faultManager.handleFault(r)},_processUdcResponses:function(r){if(!l.isEndpointMessageContainerBased(r.endPointName)){const u=Object.keys(r.requestMessages)[0];this.responseHandlers[u]&&this.responseHandlers[u](r.responseMessages)}},_processFault:function(r){this.faultManager.handleFault(r)}})},D,V),D.exports=B},6113:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(5642),f(1873),f(9819),f(8260)],B=f.dj.d(R,function(d,N,_,l,n){return d([],{constructor:function(h){h=h||{},this.requestMessages=h.requestMessages||{},this.responseMessages=h.responseMessages||{},this.context=h.context,this.computeToken=h.computeToken,this.uuidClassifierMap=h.uuidClassifierMap||{},this.endPointName=h.endPointName||null,this.allowedMessages=h.allowedMessages||[],this.ignoreMessageTypes=h.ignoreMessageTypes||[],this.sendMessage=h.sendMessage},addRequestMessage:function(h,u,g){if(!u)return;const p=l.isEndpointMessageContainerBased(this.endPointName);this.requestMessages[h]||(this.requestMessages[h]=[]),_.isArray(u)?u.forEach(function(y){this.addRequestMessage(h,y,g)},this):p?(u.uuid=u.uuid||this._generateUuid(),g&&(this.uuidClassifierMap[u.uuid]=g),this.requestMessages[h].push(u)):this.requestMessages[h]=u,this.requestMessages=this._filterMessages(this.requestMessages)},_filterMessages:function(h){const u={};return this.getRequestMessageTypes().forEach(function(g){(this.allowedMessages.length===0||this.allowedMessages.indexOf(g)>=0)&&(u[g]=h[g])},this),u},getResponseMessageTypes:function(){let h;const u=[];for(h in this.responseMessages)Object.prototype.hasOwnProperty.call(this.responseMessages,h)&&u.push(h);return u},getRequestMessageTypes:function(){let h;const u=[];for(h in this.requestMessages)Object.prototype.hasOwnProperty.call(this.requestMessages,h)&&u.push(h);return u},getMessageClassifier:function(h){return h&&h.uuid&&Object.prototype.hasOwnProperty.call(this.uuidClassifierMap,h.uuid)?this.uuidClassifierMap[h.uuid]:""},send:function(){this._removeEmptyMessages(),this._isEmpty(this.requestMessages)?(this.deferred=new N,this.deferred.callback()):(this.startTime=new Date().getTime(),this.deferred=this._doSend(this._getRequest(this.requestMessages)),this.deferred.addCallback(this,this._processResponse),this.deferred.addErrback(this,this._processFault))},addIgnoreMessageType:function(h,u){if(this.getRequestMessageTypes().indexOf(h)>-1)if(u){let g;for(g in this.uuidClassifierMap)Object.prototype.hasOwnProperty.call(this.uuidClassifierMap,g)&&u&&this.uuidClassifierMap[g]===u&&this.ignoreMessageTypes.push(h+":"+u)}else this.ignoreMessageTypes.push(h)},_removeEmptyMessages:function(){if(!this._isEmpty(this.requestMessages)){let h;for(h in this.requestMessages)Object.prototype.hasOwnProperty.call(this.requestMessages,h)&&_.isArray(this.requestMessages[h])&&n.getArrayLength(this.requestMessages[h])===0&&delete this.requestMessages[h]}},_isEmpty:function(h){let u;for(u in h)if(Object.prototype.hasOwnProperty.call(h,u))return!1;return!0},_generateUuid:function(){return n.generateUuid()}})},D,V),D.exports=B},3812:(D,V,f)=>{"use strict";var R,B;R=[f(9810),f(1423),f(3971)],B=f.dj.d(R,function(d,N,_){let l=!1;const n={};n._serviceData={},n.getServiceRegistryEndpoint=function(u){if(n._serviceData.serviceregistry){let g;const p=n._serviceData.serviceregistry.length;for(g=0;g<p;g+=1)if(n._serviceData.serviceregistry[g].name===u)return n._serviceData.serviceregistry[g].endpoint}return""};const r=function(g){let p=N.parseQueryString().mre;if(p){const y=new URL(p,window.location.href);if(_.isAllowed(y)){p=y.href;let x=g.serviceregistry;x=Array.isArray(x)?x:[];let w=!1;x.forEach(M=>{M.name&&M.name==="primary"&&(M.endpoint=p,w=!0)}),w||(x.push({name:"primary",endpoint:p}),g.serviceregistry=x)}}return g},h={_doXhr:function(g,p){return d(g,{handleAs:"json",failOk:!0,method:"GET",timeout:15e3,sync:p})},_reset:function(){l=!1,n._serviceData={}},load:function(g,p,y){if(l)y(n);else{const x=!p.async;h._doXhr("/serviceregistrylookup/1/service",x).then(function(w){w instanceof Object||(w={}),n._serviceData=r(w),l=!0,y(n)},function(){n._serviceData=r({}),l=!0,y(n)})}}};return h},D,V),D.exports=B},4202:(D,V,f)=>{"use strict";var R,B;R=[f(8976)],B=f.dj.d(R,function(d){const N=/^(?:[a-z]+:)?\/\//i,_=["localhost","127.0.0.1","[::1]"];return{createWorkerRoutingHostUrl:function(n,r){if(n==="about:blank")return n;let h=n,u="",g="";const p=r.host,y=r.sessionId,x=r.routingKey;let w=!0;try{if(u=new URL(p),this.isAbsoluteUrl(n))if(g=new URL(n),g.origin&&_.includes(g.hostname)){const M=g.pathname;h=new URL(M,u).href,g.search&&(g.searchParams.has("mre")&&g.searchParams.delete("mre"),h=h+g.search)}else g.origin&&g.hostname!==u.hostname&&(w=!1);else n&&n.startsWith("/")?h=u+n.substr(1,n.length):h=u+n;return w?(h=new URL(h),h.searchParams.set("mre",u),x&&y&&(h.search+="&routingkey="+x+"&computeToken="+encodeURIComponent(y)),h.href):h}catch(M){d.error("Input URL is malformed")}return h},isAbsoluteUrl:function(n){return!!N.test(n)}}},D,V),D.exports=B},3971:(D,V,f)=>{"use strict";var R,B;R=[],B=f.dj.d(R,function(){const d=["localhost","127.0.0.1","[::1]"];return{isAllowed(N){return N instanceof URL||(N=new URL(N)),this._checkIfSameOrigin(N.origin)||this._checkIfMathWorksAllowedDomain(N.hostname)||this._checkIfAllowedLocalHost(N.hostname)},_checkIfSameOrigin:N=>N===window.location.protocol+"//"+window.location.host,_checkIfMathWorksAllowedDomain:N=>{const _=N;for(const l of[".matlab.com",".mathworks.com",".mathworks.cn",".mwcloudtest.com"])if(_.endsWith(l))return!0;return!1},_checkIfAllowedLocalHost:N=>!!d.includes(N)}},D,V),D.exports=B},3461:(D,V,f)=>{"use strict";var R,B;R=[f(9819),f(5642)],B=f.dj.d(R,function(d,N){const _=function(n,r,h){return d.getIframeProxyClientForEndPoint(r).sendMessage(n,d.getRemoteUrlForEndPoint(r),h)};return{sendPayload:function(n,r,h){const u=new N;return _(n,r,h).then(function(p){u.resolve(p)}),u}}},D,V),D.exports=B},6014:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(3558)],B=f.dj.d(R,function(d,N){return d([],{constructor:function(l){l.stateMachine=this,this.state=new N(l)},start:function(){this.state.enter()},stop:function(){this.state.exit()},_changeState:function(l,n){this.state.enter(l,n)},onEnterState:function(l){},onExitState:function(l){}})},D,V),D.exports=B},5763:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(3660),f(8976),f(8171)],B=f.dj.d(R,function(d,N,_,l,n){return d(n,{constructor:function(){this.connection={}},enable:function(){N.isFunction(this.context[this.name])&&(this.cachedFunction=this.context[this.name]),this.connection=_.after(this.context,this.name,N.hitch(null,this.triggerHandler,this.name),!0)},disable:function(){this.connection.remove(),this.cachedFunction&&(this.context[this.name]=this.cachedFunction)}})},D,V),D.exports=B},8338:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(7505),f(8976),f(8171)],B=f.dj.d(R,function(d,N,_,l,n){return d(n,{constructor:function(){const h=this.name.split(" ");(h.length<2||h[0]!=="subscribe")&&l.error("Invalid trigger name for a MessageTrigger. Could not parse out the message name."),this.messageId=h[1]||"",this.subscrition={}},enable:function(){this.subscription=_.subscribe(this.messageId,N.hitch(null,this.triggerHandler,this.name))},disable:function(){this.subscription.remove()}})},D,V),D.exports=B},1609:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(8976),f(8374),f(8171)],B=f.dj.d(R,function(d,N,_,l,n){return d(n,{constructor:function(){const h=this.name.split(" ");(h.length<2||h[0]!=="response"&&h[0]!=="fault")&&_.error("Invalid trigger name for a RemoteTrigger. Could not parse out the type of handler."),(!l.registerResponseHandler||!l.registerFaultHandler)&&_.error("The remote package is not available, this type of trigger will not work."),this.messageId=h[1]||"",this.handlerType=h[0]},enable:function(){this.handlerType==="response"?l.registerResponseHandler(this.messageId,N.hitch(null,this.triggerHandler,this.name)):l.registerFaultHandler(this.messageId,N.hitch(null,this.triggerHandler,this.name))},disable:function(){this.handlerType==="response"?l.deregisterResponseHandler(this.messageId):l.deregisterFaultHandler(this.messageId)}})},D,V),D.exports=B},3558:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(8976),f(5763),f(8338),f(1609),f(6974),f(80)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u){let g;return g=d([],{constructor:function(y){this.stateMachine=y.stateMachine||{_changeState:function(){},onEnterState:function(){},onExitState:function(){}},this.namespace=y.namespace||"",this.name=y.name||this.getDefaultName(),this.context=y.context||{},this.data=y.data||{},this.composition=y.composition||"XOR",this.defaultSubstate=y.defaultSubstate||"",this.constructSubstates(y.substates),this.constructTriggersAndTransitions(y.transitions),this.active=y.active||!1},getDefaultName:function(){let y,x;return this.namespace.length>0?(y=this.namespace.split("."),x=y.pop()):_.warn("State: state name is not specified."),x||""},constructSubstates:function(y){const x={};let w,M;for(w in y)Object.prototype.hasOwnProperty.call(y,w)&&(M=y[w],M.name&&M.name!==w&&_.error("State: error constructing substate: "+w+", the specified names don't match: "+M.name),M.name=w,M.namespace=M.namespace||[this.namespace,this.name].join("."),M.stateMachine=M.stateMachine||this.stateMachine,M.context=M.context||this.context,x[M.name]=new g(M));this.substates=x},constructTriggersAndTransitions:function(y){let x;const w={},M=[];let T;for(x in y)Object.prototype.hasOwnProperty.call(y,x)&&(T=this.constructTrigger(x),T&&M.push(T),w[x]=this.constructTransition(x,y[x]));this.transitions=w,this.triggers=M},constructTrigger:function(y){let x,w;const M=y.split(" ");return M.length===2?M[0]==="subscribe"?w=n:M[0]==="response"||M[0]==="fault"?w=r:M[0]==="timeout"&&(w=h):(y!=="onEnterState"||y!=="onExitState")&&(w=l),w&&(x=new w({name:y,context:this.context,triggerHandler:N.hitch(this,this.handleTrigger)})),x},constructTransition:function(y,x){let w,M;return(N.isFunction(x)||N.isString(x)||N.isArray(x))&&(y==="onEnterState"||y==="onExitState"?(w=x,x={},x.action=w,x.target=""):(M=x,x={},x.target=M)),x.state=this,new u(x)},enter:function(y,x){this.active||(this.active=!0,this.enableTriggers(),this.stateMachine.onEnterState(this.name),this.handleTrigger.apply(this,["onEnterState"].concat(x))),y?this.changeSubstates(y,x):this.changeToDefaultSubstate(x)},exit:function(){const y=this.activeSubstates();this.active=!1,this.disableTriggers(),y.forEach(function(x){x.exit()}),this.handleTrigger("onExitState"),this.stateMachine.onExitState(this.name)},enableTriggers:function(){this.triggers.forEach(function(y){y.enable()})},disableTriggers:function(){this.triggers.forEach(function(y){y.disable()})},handleTrigger:function(y){let x,w;this.transitions[y]&&(w=Array.prototype.slice.call(arguments,1,arguments.length),x=this.transitions[y].handleTrigger(y,w),x&&(N.isString(x)||(w=x.args,x=x.target),this.stateMachine._changeState(x,w)))},changeSubstates:function(y,x){const w=this.activeSubstates();this.substates[y]&&(w.length>=0&&w[0].name!==y&&w.forEach(function(M){M.exit()}),this.substates[y].enter(void 0,x))},changeToDefaultSubstate:function(y){this.activeSubstates().length===0&&this.substates[this.defaultSubstate]&&this.substates[this.defaultSubstate].enter(void 0,y)},activeSubstates:function(){const y=[];let x;for(x in this.substates)Object.prototype.hasOwnProperty.call(this.substates,x)&&this.substates[x].active&&y.push(this.substates[x]);return y}}),g},D,V),D.exports=B},6974:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(8976),f(8171)],B=f.dj.d(R,function(d,N,_,l){return d(l,{constructor:function(){const r=this.name.split(" ");(r.length<2||r[0]!=="timeout")&&_.error("Invalid trigger name for a TimeoutTrigger. Could not parse out the type of handler."),this.timeoutInSeconds=parseFloat(r[1]),this.handlerType=r[0]},enable:function(){this.disable(),this.timeoutHandle=setTimeout(N.hitch(null,this.triggerHandler,this.name),this.timeoutInSeconds*1e3)},disable:function(){this.timeoutHandle&&(clearTimeout(this.timeoutHandle),this.timeoutHandle=null)}})},D,V),D.exports=B},80:(D,V,f)=>{"use strict";var R,B;R=[f(1203),f(1873),f(8976)],B=f.dj.d(R,function(d,N,_){return d([],{constructor:function(n){this.state={},this.target="",this.condition=null,this.action=null,d.safeMixin(this,n)},handleTrigger:function(n,r){let h="";return this.checkCondition(n,r)&&(this.runAction(n,r),h=this.getTarget(n,this.target,r)),h},checkCondition:function(n,r){return this.condition?N.hitch(this.state.context,this.condition).apply(null,[n,this.state.data].concat(r)):!0},runAction:function(n,r){let h;const u=this;this.action&&(h=N.hitch(this.state.context,this.action),h.apply(null,[n,u.state.data].concat(r)))},getTarget:function(n,r,h){let u,g,p,y;if(N.isString(r))g=r;else if(N.isFunction(r))p=N.hitch(this.state.context,r),g=p.apply(null,[n,this.state.data].concat(h));else if(N.isArray(r))for(u=0;u<r.length;u+=1){if(g=this.getTarget(n,r[u],h),N.isString(g)){g={target:g},N.mixin(g,y);break}if(g&&g.target){N.mixin(g,y);break}y=g||{}}else _.warn("Transition: improper target: ",r);return g}})},D,V),D.exports=B},8171:(D,V,f)=>{"use strict";var R,B;R=[f(1203)],B=f.dj.d(R,function(d){return d([],{constructor:function(_){this.name="",this.context={},this.triggerHandler=_.triggerHandler||function(){},d.safeMixin(this,_)},enable:function(){},disable:function(){}})},D,V),D.exports=B},5663:(D,V,f)=>{var R,B;R=[f(5813),f(6091),f(8065),f(2377)],B=f.dj.d(R,function(d,N,_,l){"use strict";var n={};class r{static createTooltip(u){if(!_.isElement(u.referenceNode))throw new Error("You must pass a valid dom node");if(N.has(u.referenceNode))throw new Error("A tooltip already exists for this reference node.Pass a new reference node");const g=new d(u);N.set(u.referenceNode,g);const p={};return Object.defineProperty(p,"content",{get(){return g.content},set(y){g.content=y,g.replaceContent()},enumerable:!0,configurable:!0}),p.destroy=g.destroy.bind(g),p}}return r.TYPE=l,n.default=r,n.default},D,V),D.exports=B},6752:(D,V,f)=>{"use strict";var R,B;R=[f(2377),f(8087)],B=f.dj.d(R,function(d,N){"use strict";var _={};const l=`
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 0.5L15.5 14.5H0.5L8 0.5Z" fill="var(--mw-icon-alert-red, #B7313C)" stroke="var(--mw-icon-alert-red, #B7313C)" stroke-linecap="square" stroke-linejoin="round"/>
<circle cx="8" cy="12" r="1" fill="var(--mw-icon-background-default-white, white)"/>
<path d="M8 9V5" stroke="var(--mw-icon-background-default-white, white)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<use href="#error" />
</svg>`,n=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 0.5L15.5 14.5H0.5L8 0.5Z" fill="var(--mw-icon-background-medium-yellow, #FFEF91)" stroke="var(--mw-icon-border-default-yellow, #674C06)" stroke-linecap="square" stroke-linejoin="round"/>
<circle cx="8" cy="12" r="1" fill="var(--mw-icon-glyph-content-yellow, #674C07)"/>
<path d="M8 9V5" stroke="var(--mw-icon-glyph-content-yellow, #674C07)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<use href="#warning" />
</svg>`;class r{static createContent(u){const{container:g,content:p}=u;if(p.type){let x=document.createElement("div");const w=p.type;let M;if(p.type===d.ERROR?(M="mw-tooltip-icon-error",x.innerHTML=l):p.type===d.WARNING&&(x.innerHTML=n,M="mw-tooltip-icon-warning"),M){const T=x.children[0].cloneNode(!0);x=null,g.setAttribute("mw-tooltip-type",w),T.setAttribute("class",M),g.appendChild(T)}}else g.hasAttribute("mw-tooltip-type")&&g.removeAttribute("mw-tooltip-type");g.type=p.type,(p.text===void 0||p.text===null)&&(p.text=""),typeof p.text!="string"&&(p.text=p.text.toString());const y=document.createElement("span");if(y.className="mw-tooltip-text",g.appendChild(y),p.isHTML===!0){const x=N.sanitizeHtmlForTooltip(p.text);y.appendChild(x)}else p.text.split(`
`).forEach(w=>{const M=document.createElement("span");M.textContent=w,y.appendChild(M),y.appendChild(document.createElement("br"))})}}return _.default=r,_.default},D,V),D.exports=B},5813:(D,V,f)=>{var R,B;R=[f(6752),f(6091),f(3636),f(1054),f(1251),f(8065),f(4397),f(5590)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u){"use strict";var g={};class p{constructor(x){this._referenceNode=x.referenceNode,this._hoverTimeOut=[],this._focusTimeOut=[],Object.defineProperty(this,"content",{set:function(w){this._content=w||null},get:function(){return this._content},enumerable:!0,configurable:!0}),this._content=x.content||null,this._handleHide=this._handleHide.bind(this),this._handleEscape=this._handleEscape.bind(this),this._handleShowOnFocus=this._handleShowOnFocus.bind(this),this._handleShowOnHover=this._handleShowOnHover.bind(this),this._calculateTooltipZindex=this._calculateTooltipZindex.bind(this),this._handleThePositionOfToolTip=this._handleThePositionOfToolTip.bind(this),this._attachEventListeners(),_.set(l.IDLE,this)}_isCurrentTooltip(){return _.get(l.WAITING)===this||_.get(l.SHOW)===this}_handleShowOnFocus(x){if(this._isCurrentTooltip()||!this._content||_.get(l.CURRENT_ACTIVE_ELEMENT)===this){r.setTooltipPrivateEventProp(x,"_mwTooltipCustomData","_focusEventHandled");return}if(r.getTooltipPrivateEventProp(x,"_mwTooltipCustomData","_focusEventHandled"))return;r.setTooltipPrivateEventProp(x,"_mwTooltipCustomData","_focusEventHandled"),_.set(l.CURRENT_ACTIVE_ELEMENT,this),_.set(l.WAITING,this);const w=setTimeout(()=>{_.set(l.SHOW,this),this._createTooltip(this._content);const M=r.getCoordsWrtPage(this._referenceNode),T=M.top+this._referenceNode.clientTop+this._referenceNode.clientHeight,A=M.left+this._referenceNode.clientLeft+this._referenceNode.clientWidth,C=T+n.OFFSET_FROM_BOTTOM,z=A-n.OFFSET_FROM_RIGHT;this._handleThePositionOfToolTip(z,C)},500);this._focusTimeOut.push(w)}_handleShowOnHover(x){let w=x.target;if(!this._referenceNode.contains(x.target)||this._isCurrentTooltip()||!this._content){r.setTooltipPrivateEventProp(x,"_mwTooltipCustomData","_hoverEventHandled");return}if(r.getTooltipPrivateEventProp(x,"_mwTooltipCustomData","_hoverEventHandled"))return;r.setTooltipPrivateEventProp(x,"_mwTooltipCustomData","_hoverEventHandled");let M=x.pageX,T=x.pageY;this._mouseMove=C=>{w=C.target,M=C.pageX,T=C.pageY},this._referenceNode.addEventListener("mousemove",this._mouseMove),_.set(l.WAITING,this);const A=setTimeout(()=>{if(!this._referenceNode.contains(w)){this._hideTooltip();return}this._createTooltip(this._content),_.set(l.SHOW,this),this._referenceNode.removeEventListener("mousemove",this._mouseMove);const C=T+n.OFFSET_FROM_BOTTOM_WITH_Y,z=M+n.OFFSET_FROM_BOTTOM_WITH_X;this._handleThePositionOfToolTip(z,C,M,T)},500);this._hoverTimeOut.push(A)}_clearTimeoutsAndEvents(){this._mouseMove&&this._referenceNode.removeEventListener("mousemove",this._mouseMove),clearTimeout(this._hoverTimeOut.pop()),clearTimeout(this._focusTimeOut.pop())}replaceContent(){if(this._isOpen()){for(;this._tooltipContainerSpan.hasChildNodes();)this._tooltipContainerSpan.removeChild(this._tooltipContainerSpan.lastChild);d.createContent({content:this.content,container:this._tooltipContainerSpan})}}_isOpen(){return!!this._tooltipContainerSpan}_getReferenceNodeTheme(){let x=h.getTheme(this._referenceNode);return x=x===""?u.light:u[x],x}_createTooltip(x){if(!x||Object.keys(x).length<=0)return;this._tooltipContainerSpan=document.createElement("span");const w=this._getReferenceNodeTheme();h.setTheme(w,this._tooltipContainerSpan),this._tooltipContainerSpan.setAttribute("mw-tooltip",""),this._tooltipContainerSpan.setAttribute("role","tooltip"),this._tooltipContainerSpan.style.maxWidth="min(calc(100vw - 20px), 400px)",d.createContent({content:x,container:this._tooltipContainerSpan}),document.body.appendChild(this._tooltipContainerSpan);let M=r.generateUuid();M="mw-tooltip-"+M,this._tooltipContainerSpan.setAttribute("id",M),this._referenceNode.setAttribute("aria-describedby",M)}_handleHide(x){x&&x.target&&!this._referenceNode.contains(x.target)||this._hideTooltip()}_calculateTooltipZindex(){const x=r.getEffectiveZindex(this._referenceNode),w=r.getElementZindex(this._tooltipContainerSpan);return x==="auto"||w==="auto"||x<w?"auto":x+1}_attachEventListeners(){this._referenceNode.addEventListener("mouseleave",this._handleHide),this._referenceNode.addEventListener("focusout",this._handleHide),this._referenceNode.addEventListener("click",this._handleHide),this._referenceNode.addEventListener("keydown",this._handleHide),this._referenceNode.addEventListener("mouseenter",this._handleShowOnHover),this._referenceNode.addEventListener("focusin",this._handleShowOnFocus),document.addEventListener("keyup",this._handleEscape)}_hideTooltip(){_.set(l.IDLE,this),this._tooltipContainerSpan&&(this._tooltipContainerSpan.setAttribute("mw-tooltip",""),document.body.removeChild(this._tooltipContainerSpan),this._tooltipContainerSpan=null),this._clearTimeoutsAndEvents()}_handleEscape(x){x.key==="Escape"&&this._hideTooltip()}_detachEventListeners(){this._referenceNode.removeEventListener("mouseleave",this._handleHide),this._referenceNode.removeEventListener("focusout",this._handleHide),this._referenceNode.removeEventListener("click",this._handleHide),this._referenceNode.removeEventListener("keydown",this._handleHide),this._referenceNode.removeEventListener("mouseenter",this._handleShowOnHover),this._referenceNode.removeEventListener("focusin",this._handleShowOnFocus),document.removeEventListener("keyup",this._handleEscape)}_handleThePositionOfToolTip(x,w,M,T){this._tooltipContainerSpan.setAttribute("mw-tooltip","show");const A=this._calculateTooltipZindex();A!=="auto"&&(this._tooltipContainerSpan.style.zIndex=A),this._tooltipContainerSpan.style.top=`${w}px`;const C=this._tooltipContainerSpan.getBoundingClientRect(),z=C.left+C.width>=window.innerWidth,H=x+C.width>=window.innerWidth;if(z||H){let q;const P=r.getBrowserVerticalScrollbarWidth();z?q=C.left:H&&(q=x);const Z=q+C.width-window.innerWidth;x=q-Z-P}if(C.top+C.height>=window.innerHeight){const q=C.top+C.height-window.innerHeight,P=r.getBrowserHorizontalScrollbarHeight();w=w-q-P-n.OFFSET_FROM_TOP}M>=0&&T>=0&&M>x&&M<x+C.width&&T>w&&T<w+C.height&&(w=w-C.height+(T-w)-n.OFFSET_FROM_TOP_WITH_Y),this._tooltipContainerSpan.style.top=`${w}px`,this._tooltipContainerSpan.style.left=`${x}px`}destroy(){N.has(this._referenceNode)&&(this._detachEventListeners(),this._referenceNode.hasAttribute("aria-describedby")&&this._referenceNode.removeAttribute("aria-describedby"),this._tooltipContainerSpan&&(document.body.removeChild(this._tooltipContainerSpan),this._tooltipContainerSpan=null),N.delete(this._referenceNode),_.set(l.IDLE,this),_.clear(l.IDLE,this),_.get(l.CURRENT_ACTIVE_ELEMENT)===this&&_.clear(l.CURRENT_ACTIVE_ELEMENT),this._clearTimeoutsAndEvents(),this._referenceNode=null,this._hoverTimeOut=null,this._focusTimeOut=null,this._content=null,Object.defineProperty(this,"content",{set:function(){this._content=null},get:function(){return this._content},enumerable:!0,configurable:!0}))}}return g.default=p,g.default},D,V),D.exports=B},6091:(D,V,f)=>{"use strict";var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};class N{constructor(){this._tooltipDepot=new WeakMap}clear(){this._tooltipDepot=new WeakMap}delete(l){return this._tooltipDepot.delete(l)}get(l){return this._tooltipDepot.get(l)}has(l){return this._tooltipDepot.has(l)}set(l,n){return this._tooltipDepot.set(l,n),this}}return d.default=new N,d.default},D,V),D.exports=B},3636:(D,V,f)=>{"use strict";var R,B;R=[f(1054)],B=f.dj.d(R,function(d){"use strict";var N={};class _{constructor(){this._state={},this._state.waiting=null,this._state.show=null,this._state.idle=[],this._state.activeElement=null}get(n){return this._state[n]?this._state[n]:null}clear(n,r){if(r){const h=this._state[n].indexOf(r);h>-1&&this._state[n].splice(h,1)}else switch(n){case"idle":this._state[n]=[];break;default:this._state[n]=null;break}}set(n,r){switch(n){case"show":this._state[n]?this._state[n]&&this._state[n]!==r&&(this._state[n]._handleHide(),this._state[n]=r,this.clear(d.WAITING),this.clear("idle",r)):(this._state[n]=r,this.clear(d.WAITING),this.clear("idle",r));break;case"idle":this._state[n].indexOf(r)===-1&&(this._state[n].push(r),this.get(d.WAITING)===r&&this.clear(d.WAITING),this.get(d.SHOW)===r&&this.clear(d.SHOW));break;case"waiting":this._state[n]?this._state[n]&&this._state[n]!==r&&(this._state[n]._handleHide(),this._state[n]=r,this.clear("idle",r)):(this._state[n]=r,this.clear("idle",r));break;case"activeElement":this._state[n]=r;break}}}return N.default=new _,N.default},D,V),D.exports=B},1251:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};const N=Object.freeze({OFFSET_FROM_BOTTOM:5,OFFSET_FROM_RIGHT:15,OFFSET_FROM_BOTTOM_WITH_X:10,OFFSET_FROM_TOP:20,OFFSET_FROM_BOTTOM_WITH_Y:20,OFFSET_FROM_TOP_WITH_Y:10});return d.default=N,d.default},D,V),D.exports=B},1054:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};const N=Object.freeze({SHOW:"show",HIDE:"hide",WAITING:"waiting",IDLE:"idle",CURRENT_ACTIVE_ELEMENT:"activeElement"});return d.default=N,d.default},D,V),D.exports=B},5590:(D,V,f)=>{var R,B;R=[f(9751)],B=f.dj.d(R,function(d){"use strict";var N={};const _=Object.freeze({light:d.LIGHT,dark:d.DARK});return N.default=_,N.default},D,V),D.exports=B},2377:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};const N=Object.freeze({WARNING:"warning",ERROR:"error"});return d.default=N,d.default},D,V),D.exports=B},8087:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};const N={B:[],BR:[],CODE:[],EM:[],I:[],S:[],SUB:[],SUP:[],STRONG:[],U:[]},_=function(l){return function(n){const r=function(x,w){const M=[];for(const T of x){const A=T;if(w.hasAttribute(A)){const C=w.getAttribute(A);M.push({key:A,value:C})}}return M},h=function(x){let w;if(x.nodeType===window.Node.ELEMENT_NODE)if(l[x.tagName]){w=document.createElement(x.tagName);const T=l[x.tagName];r(T,x).forEach(C=>{w.setAttribute(C.key,C.value)})}else w=document.createDocumentFragment();else x.nodeType===window.Node.TEXT_NODE?w=document.createTextNode(x.textContent):w=document.createDocumentFragment();return w},u=function(x,w=0){const M=document.createDocumentFragment();if(w>150||!x)return M;for(let T=x.firstChild;T;T=T.nextSibling){const A=h(T);T.nodeType===window.Node.ELEMENT_NODE&&A.appendChild(u(T,w+1)),M.appendChild(A)}return M},p=new DOMParser().parseFromString(n,"text/html");let y;return p.body?y=u(p.body):y=document.createDocumentFragment(),y}};return d.default={sanitizeHtmlForTooltip:_(N)},d.default},D,V),D.exports=B},8065:(D,V,f)=>{"use strict";var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};class N{static getCoordsWrtPage(l){const n=l.getBoundingClientRect();return{top:n.top+window.pageYOffset,left:n.left+window.pageXOffset}}static isElement(l){return l instanceof window.Element||l instanceof window.HTMLElement}static isValidReferenceNode(l){return l&&Array.isArray(l)&&l.length>0?l.every(n=>n instanceof window.Element||n instanceof window.HTMLElement):l instanceof window.Element||l instanceof window.HTMLElement||l instanceof window.NodeList&&l.length>0}static removeChildNodes(l){for(;l.lastChild;)l.removeChild(l.lastChild)}static getBrowserVerticalScrollbarWidth(){return window.innerWidth-document.documentElement.clientWidth}static getBrowserHorizontalScrollbarHeight(){return window.innerHeight-document.documentElement.clientHeight}static getScrollbarWidth(l){return l.offsetWidth-l.clientWidth}static getScrollbarHeight(l){return l.offsetHeight-l.clientHeight}static setTooltipPrivateEventProp(l,n,r){(!l[n]||!l[n][r])&&(l[n]={},l[n][r]="true")}static getTooltipPrivateEventProp(l,n,r){return!!(l[n]&&l[n][r])}static generateUuid(){return"xxxxxxxx".replace(/[xy]/g,function(l){const n=Math.random()*16|0;return(l==="x"?n:n&3|8).toString(16)}).toUpperCase()}static getElementZindex(l){return window.getComputedStyle(l).getPropertyValue("z-index")}static getEffectiveZindex(l){let n=0,r,h=!0;for(;l&&N.isElement(l);)r=N.getElementZindex(l),r!=="auto"&&(r=parseInt(r,10),r>n&&(h=!1,n=r)),l=l.parentNode;return h?"auto":n}static isSelectorValid(l){return l.substring(0,1)==="."||l.substring(0,1)==="#"}static calculateTooltipZindex(l,n){const r=N.getEffectiveZindex(l),h=N.getElementZindex(n);return r==="auto"||h==="auto"||r<h?"auto":r+1}static observeElementInDom(l){let n,r=document.body.contains(l);const h=new Promise(function(g,p){n=g}),u=new window.MutationObserver(function(g){document.body.contains(l)?r=!0:r&&(r=!1,n(l))});return u.observe(document.body,{childList:!0,subtree:!0}),{promise:h,observer:u}}static stopObservingElement(l){l==null||l.disconnect()}static hasMultipleReferenceNode(l){return l&&(Array.isArray(l)||l instanceof window.NodeList)&&l.length>0}}return d.default=N,d.default},D,V),D.exports=B},9751:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){"use strict";var d={};const N=Object.freeze({LIGHT:"light",DARK:"dark"});return d.default=N,d.default},D,V),D.exports=B},4397:(D,V,f)=>{var R,B;R=[f(9751)],B=f.dj.d(R,function(d){"use strict";var N={};let _,l;class n{constructor(){this.themeClass={light:"mw-theme-light",dark:"mw-theme-dark"},this.themeName={"mw-theme-light":d.LIGHT,"mw-theme-dark":d.DARK},window.matchMedia&&(this.windowMediaQuery=window.matchMedia("(prefers-color-scheme: dark)")),this._mediaQueryEventHandler=this._mediaQueryEventHandler.bind(this)}set useSystemMode(u){if(u){this._addSystemModeListener();let g=this._getSystemTheme();this._checkAndUpdateTheme(g)}else this._removeSystemModeListener()}set useSettings(u){u&&(_=u,_.getSetting(["matlab","appearance"],"MATLABTheme").then(g=>{this._settingsValueHandler(g.value)}),_.listenTo(["matlab","appearance"],"MATLABTheme",g=>{this._settingsValueHandler(g.newValue)}))}_settingsValueHandler(u){let g;switch(u){case"System":this._addSystemModeListener(),g=this._getSystemTheme();break;case"Light":this._removeSystemModeListener(),g=d.LIGHT;break;case"Dark":this._removeSystemModeListener(),g=d.DARK;break}this._checkAndUpdateTheme(g)}_checkAndUpdateTheme(u){let g=this.getTheme();g!==u?(this.setTheme(u),this._emitEvent(g,u)):this._isThemeClassPresent(u)||this.setTheme(u),l!==u&&this._setCurrentThemeSettingsValue(u)}_isThemeClassPresent(u,g){return(g||document.getElementsByTagName("body")[0]).classList.contains(this.themeClass[u])}_addSystemModeListener(){this.windowMediaQuery.addEventListener("change",this._mediaQueryEventHandler)}_removeSystemModeListener(){this.windowMediaQuery.removeEventListener("change",this._mediaQueryEventHandler)}_getSystemTheme(){return this.windowMediaQuery.matches?d.DARK:d.LIGHT}_mediaQueryEventHandler(u){u.matches?this._checkAndUpdateTheme(d.DARK):this._checkAndUpdateTheme(d.LIGHT)}_emitEvent(u,g){let p={oldTheme:u,newTheme:g},y=new CustomEvent("themechanged",{detail:p});document.body.dispatchEvent(y)}_setCurrentThemeSettingsValue(u){if(_){const g=["matlab","appearance","CurrentTheme"].join("."),p=u.charAt(0).toUpperCase()+u.slice(1);l=u,_.setSettingValue(g,p,_.SettingLevel.TEMPORARY),_.clearSettingValue(g,_.SettingLevel.PERSONAL)}}setTheme(u,g){if(Object.keys(this.themeClass).includes(u)){let p=g||document.getElementsByTagName("body")[0];if(this._isHTMLElement(p)){for(let y in this.themeClass)p.classList.contains(this.themeClass[y])&&p.classList.remove(this.themeClass[y]);p.classList.add(this.themeClass[u])}}else throw new Error("The requested theme is not supported")}_isHTMLElement(u){return!!(u&&(u instanceof HTMLElement||u.ownerDocument&&u.ownerDocument.defaultView&&u.ownerDocument.defaultView.Element&&u instanceof u.ownerDocument.defaultView.Element))}getTheme(u){let g=u||document.getElementsByTagName("body")[0];return window.getComputedStyle(g).getPropertyValue("--mw-themeName").trim()===d.DARK?d.DARK:d.LIGHT}}var r=new n;return Object.freeze(r),N.default=r,N.default},D,V),D.exports=B},8260:(D,V,f)=>{var R,B;R=[f(5260)],B=f.dj.d(R,function(d){"use strict";var N={};return N.default={generateUuid:function(){return this._uuidFromTemplate("xxxxxxxx").toUpperCase()},generateUUIDv4:function(){return this._uuidFromTemplate("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")},_uuidFromTemplate:function(_){return _.replace(/[xy]/g,function(l){const n=Math.random()*16|0;return(l==="x"?n:n&3|8).toString(16)})},isImageData:function(_){return!!_&&typeof window=="object"&&window.ImageData&&_ instanceof window.ImageData},isArray:function(_){return d.deprecated({deprecated:{module:"mw-utils/Utils",method:"isArray"},geckNumber:1444368}),Array.isArray(_)},getArrayLength:function(_){let l=0;return Array.isArray(_)?(_.forEach(function(n){n&&(l+=1)}),l):!1},isWhitespace:function(_){return/^\s+$/.test(_)},removeSurroundingNewLines:function(_){for(;_.charAt(0)===`
`;)_=_.substring(1);for(;_.charAt(_.length-1)===`
`;)_=_.substring(0,_.length-1);return _},getFirstUniqueElement:function(_,l){let n=null;return l.some(function(r){return _.indexOf(r)===-1?(n=r,!0):!1}),n},unionOfWordSets:function(_,l,n){_=this._stringToArray(_),l=this._stringToArray(l);const r=this.unionOfArrays(_,l);return n?r.join(" "):r},intersectionOfWordSets:function(_,l,n){_=this._stringToArray(_),l=this._stringToArray(l);const r=this.intersectionOfArrays(_,l);return n?r.join(" "):r},differenceOfWordSets:function(_,l,n){_=this._stringToArray(_),l=this._stringToArray(l);const r=this.unique(this.differenceOfArrays(_,l));return n?r.join(" "):r},unionOfArrays:function(_,l){return this.unique(_.concat(l))},intersectionOfArrays:function(_,l){return this.nonunique(_.concat(l))},differenceOfArrays:function(_,l){if(window.Map===void 0)return this._legacyDifferenceOfArrays(_,l);let n,r,h;const u=new Map,g=[];for(h=0;h<l.length;h++)u.set(l[h],null);for(h=0;h<_.length;h++)r=_[h],n=u.has(r),n||g.push(r);return g},_legacyDifferenceOfArrays:function(_,l){return this.unique(_.filter(function(n){return l.indexOf(n)===-1}))},unique:function(_){return _.filter(function(l,n){return _.indexOf(l)===n})},nonunique:function(_){return this.unique(_.filter(function(l,n){return _.indexOf(l)!==n}))},arrayEquals:function(_,l,n){if(_===l)return!0;if(_.length!==l.length)return!1;n||(n=function(r,h){return r===h});for(let r=0,h=_.length;r<h;r++)if(!n(_[r],l[r]))return!1;return!0},removeEmptyElements:function(_){return _.filter(function(l){return!(l===""||l===null||l===void 0)})},_stringToArray:function(_){return this._isString(_)?this.removeEmptyElements(_.split(" ")):_},_isString:function(_){return typeof _=="string"||_ instanceof String}},N.default},D,V),D.exports=B},6300:(D,V,f)=>{Promise.resolve().then(function(){var R=[f(1522),f(8161)];(async B=>{(async()=>{(await B).start()})()}).apply(null,R)}).catch(f.oe)},9392:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.EventDispatcher{constructor(_){super(),this.running=!1,this.update(_)}update(_){this.running=_.Enabled,this.interruptible=_.Interruptible,this._orbitStepSize=_.OrbitStepSize,this._orbitNumSteps=_.OrbitNumSteps,this._iteration=0}setNextFrame(_,l,n){const r=this._orbitStepSize*Math.PI/180,h=new d.Quaternion;h.setFromAxisAngle(n.up,r),l.applyQuaternion(h),n.position.addVectors(_,l),this._iteration+=1,this._orbitNumSteps>0&&this._iteration>=this._orbitNumSteps&&(this.running=!1,this.dispatchEvent({type:"animationFinished"}))}}},D,V),D.exports=B},2981:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return{uniforms:{u_outerColor:{value:new d.Vector3(.2,.2,.2)},u_innerColor:{value:new d.Vector3(.5,.5,.5)},u_focalPoint:{value:new d.Vector2(-.2,.4)},u_noiseAlpha:{value:.1},u_grainScale:{value:.001},u_noiseOffset:{value:0}},vertexShader:`varying vec2 vUv;
        void main() {
            gl_Position = vec4( position, 1.0 );
            vUv = vec2( position.x, position.y ) * 0.5 + 0.5;
        }`,fragmentShader:`
        //---------------------------------------------------------------------
        // Fragment shader for background gradient
        //---------------------------------------------------------------------
        
        // Copyright 2022 The MathWorks, Inc.
        
        uniform vec3 u_outerColor;
        uniform vec3 u_innerColor;
        uniform vec2 u_focalPoint;
        uniform float u_noiseAlpha;
        uniform float u_grainScale;
        uniform float u_noiseOffset;
        varying vec2 vUv;
        
        #ifdef USE_GRADIENT
            vec3 blendColor(vec3 color, vec3 blend);
            float blendValue(float base, float blend);
            float grain (vec2 tex, vec2 res, float frame);
            vec3 mod289(vec3 x);
            vec4 mod289(vec4 x);
            vec4 permute(vec4 x);
            vec4 taylorInvSqrt(vec4 r);
            vec3 fade(vec3 t);
            float perlinNoise(vec3 p, vec3 rep);
        #endif
        
        void main() {
            #ifdef USE_GRADIENT
                vec2 newVector = vec2(vUv - 0.5);
                newVector -= u_focalPoint;
                float distance = length(newVector);
                distance = smoothstep(0.0, 1.0, distance);
                vec3 color = mix(u_innerColor, u_outerColor, distance);
                if (u_noiseAlpha > 0.0 && u_grainScale > 0.0) {
                    float grainSize = 1.0 / u_grainScale;
                    float grainNoise = grain(vUv, vec2(grainSize, grainSize), 0.0);
                    vec3 grainColor = blendColor(color, vec3(grainNoise));
                    gl_FragColor = vec4(mix(color, grainColor, u_noiseAlpha),1.0);
                } else {
                    gl_FragColor = vec4(color,1.0);
                }
            #else
                gl_FragColor = vec4(u_outerColor,1.0);
            #endif
        }
        
        #ifdef USE_GRADIENT
            float blendValue( float base, float blend ) {
                return ( blend < 0.5 ) ? ( 2.0 * base * blend + base * base * ( 1.0 - 2.0 * blend )) : ( sqrt( base ) * ( 2.0 * blend - 1.0 ) + 2.0 * base * ( 1.0 - blend ));
            }
        
            vec3 blendColor( vec3 color, vec3 blend ) {
                return vec3(blendValue(color.r,blend.r), blendValue(color.g,blend.g), blendValue(color.b,blend.b));
            }
        
            float grain (vec2 tex, vec2 res, float frame ) {
                float multiplier = 2.5;
                vec2 mult = tex * res;
                float noise = perlinNoise(vec3(mult, u_noiseOffset), vec3(1.0 / tex * res, 1.0));
                return noise / 2.0 + 0.5;
            }
        
            vec3 mod289(vec3 x) {
                return x - floor(x * (1.0 / 289.0)) * 289.0;
            }
        
            vec4 mod289(vec4 x) {
                return x - floor(x * (1.0 / 289.0)) * 289.0;
            }
        
            vec4 permute(vec4 x) {
                return mod289(((x*34.0)+1.0)*x);
            }
        
            vec4 taylorInvSqrt(vec4 r) {
                return 1.79284291400159 - 0.85373472095314 * r;
            }
        
            vec3 fade(vec3 t) {
                return t*t*t*(t*(t*6.0-15.0)+10.0);
            }
        
            // Classic Perlin noise, periodic variant
            float perlinNoise(vec3 p, vec3 rep) {
                // Integer part, mod period
                vec3 pint0 = mod(floor(p), rep);
                // Integer part + 1, mod period
                vec3 pint1 = mod(pint0 + vec3(1.0), rep);
                pint0 = mod289(pint0);
                pint1 = mod289(pint1);
                // Fractional part for interpolation
                vec3 pfract0 = fract(p);
                // Fractional part - 1.0
                vec3 pfract1 = pfract0 - vec3(1.0);
                vec4 ix = vec4(pint0.x, pint1.x, pint0.x, pint1.x);
                vec4 iy = vec4(pint0.yy, pint1.yy);
                vec4 iz0 = pint0.zzzz;
                vec4 iz1 = pint1.zzzz;
        
                vec4 ixy = permute(permute(ix) + iy);
                vec4 ixy0 = permute(ixy + iz0);
                vec4 ixy1 = permute(ixy + iz1);
        
                vec4 gx0 = ixy0 * (1.0 / 7.0);
                vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
                gx0 = fract(gx0);
                vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
                vec4 sz0 = step(gz0, vec4(0.0));
                gx0 -= sz0 * (step(0.0, gx0) - 0.5);
                gy0 -= sz0 * (step(0.0, gy0) - 0.5);
        
                vec4 gx1 = ixy1 * (1.0 / 7.0);
                vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
                gx1 = fract(gx1);
                vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
                vec4 sz1 = step(gz1, vec4(0.0));
                gx1 -= sz1 * (step(0.0, gx1) - 0.5);
                gy1 -= sz1 * (step(0.0, gy1) - 0.5);
        
                vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
                vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
                vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
                vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
                vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
                vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
                vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
                vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
        
                vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
                g000 *= norm0.x;
                g010 *= norm0.y;
                g100 *= norm0.z;
                g110 *= norm0.w;
                vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
                g001 *= norm1.x;
                g011 *= norm1.y;
                g101 *= norm1.z;
                g111 *= norm1.w;
        
                float n000 = dot(g000, pfract0);
                float n100 = dot(g100, vec3(pfract1.x, pfract0.yz));
                float n010 = dot(g010, vec3(pfract0.x, pfract1.y, pfract0.z));
                float n110 = dot(g110, vec3(pfract1.xy, pfract0.z));
                float n001 = dot(g001, vec3(pfract0.xy, pfract1.z));
                float n101 = dot(g101, vec3(pfract1.x, pfract0.y, pfract1.z));
                float n011 = dot(g011, vec3(pfract0.x, pfract1.yz));
                float n111 = dot(g111, pfract1);
        
                vec3 fadexyz = fade(pfract0);
                vec4 nz = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fadexyz.z);
                vec2 nyz = mix(nz.xy, nz.zw, fadexyz.y);
                float nxyz = mix(nyz.x, nyz.y, fadexyz.x);
                return 2.2 * nxyz;
            }
        #endif
            `}},D,V),D.exports=B},6427:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class{constructor(_,l){this.loaded=!1,this.memory=0,this.numElements=0,this.id=_,this.level=l.Level,this.parent=null,this.weight=0,this.overview=!1,this._mesh=null,this._depthMesh=null,this._center=new d.Vector3(l.Center[0],l.Center[1],l.Center[2]),this._vector=new d.Vector3,this._radius=l.Radius,this._sphere=new d.Sphere,this.info={id:-1,blockIndex:_,level:l.Level,index:l.Index,numBlocksToRead:1,outOfCore:!1,distance:1/0}}load(_,l,n,r,h){this.loaded=!0,this.visible=!0}unload(){this.memory=0,this.visible=!1,this.loaded=!1,this.overview=!1}isInView(_,l,n,r){return l.intersectsSphere(this._sphere)&&!this._isCulled(r)?this.loaded?(this.visible=!0,!1):(this.info.distance=this._measureDistance(_,n),!0):!1}setWeight(_,l,n,r,h){switch(this._sphere.set(this._center,this._radius),this._sphere.applyMatrix4(r),n.style){case"level":this.weight=this._validateLevel(n);break;case"threshold":if(this.level===1){this.weight=Number.MAX_VALUE;break}if(_.isPerspectiveCamera){const u=_.position.x-this._center.x,g=_.position.y-this._center.y,p=_.position.z-this._center.z,y=Math.sqrt(u*u+g*g+p*p),x=this._radius*h.height*.5/(Math.tan(_.fov/_.zoom*Math.PI/360)*y);this.weight=x}else{const u=_.position.x-this._center.x,g=_.position.y-this._center.y,p=_.position.z-this._center.z,y=Math.sqrt(u*u+g*g+p*p),x=2*this._radius*h.height/(y/_.zoom);this.weight=x}break}}copyMaterial(_,l,n,r){this._depthMesh!==null&&(this._depthMesh.material.dispose(),this._depthMesh.material=l.clone(),this._depthMesh.material.visible=!0),this._mesh!==null&&(this._mesh.material.dispose(),this._mesh.material=_.clone(),this._mesh.material.visible=!0,this.copyUniforms(_.uniforms,r))}copyGlobalUniforms(_){this._mesh.material.uniforms.u_depthTexture=_.u_depthTexture,this._mesh.material.uniforms.u_previousTexture=_.u_previousTexture,this._mesh.material.uniforms.u_passNumber=_.u_passNumber,this._mesh.material.uniforms.u_viewportSize=_.u_viewportSize,this._mesh.material.uniforms.u_cropMin=_.u_cropMin,this._mesh.material.uniforms.u_cropMax=_.u_cropMax,this._mesh.material.uniforms.u_colorBoxMatrix=_.u_colorBoxMatrix,this._mesh.material.uniforms.u_colorBoxColor=_.u_colorBoxColor,this._depthMesh.material.uniforms.u_depthTexture=_.u_depthTexture,this._depthMesh.material.uniforms.u_previousTexture=_.u_previousTexture,this._depthMesh.material.uniforms.u_passNumber=_.u_passNumber,this._depthMesh.material.uniforms.u_viewportSize=_.u_viewportSize,this._depthMesh.material.uniforms.u_cropMin=_.u_cropMin,this._depthMesh.material.uniforms.u_cropMax=_.u_cropMax}copyUniforms(_,l){}setClippingPlanes(_){this._depthMesh!==null&&(this._depthMesh.material.clippingPlanes=_),this._mesh!==null&&(this._mesh.material.clippingPlanes=_)}renderOrder(_,l){this._mesh!==null&&(this._mesh.renderOrder=_)}hideLevels(_,l){this.level!==_&&(this.level!==l?this.visible=!1:this.depthWrite=!1)}showLevels(_){this.level===_&&(this.visible=!0,this.depthWrite=!0)}_clearTransferFunctionTextures(){this._mesh!==null&&(this._mesh.material.uniforms.u_transferFunction.value!==null&&(this._mesh.material.uniforms.u_transferFunction.value.dispose(),this._mesh.material.uniforms.u_transferFunction.value=null),this._mesh.material.uniforms.u_overlayTransferFunction.value!==null&&(this._mesh.material.uniforms.u_overlayTransferFunction.value.dispose(),this._mesh.material.uniforms.u_overlayTransferFunction.value=null))}dispose(){this._mesh!==null&&(this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh.parent.remove(this._mesh),this._mesh=null),this._depthMesh!==null&&(this._depthMesh.geometry.dispose(),this._depthMesh.material.dispose(),this._depthMesh.parent.remove(this._depthMesh),this._depthMesh=null),this.memory=0}set visible(_){this._mesh!==null&&(this._mesh.visible=_),this._depthMesh!==null&&(this._depthMesh.visible=_)}get visible(){return this._mesh===null?!1:this._mesh.visible}set depthWrite(_){this._mesh!==null&&(this._mesh.material.depthWrite=_),this._depthMesh!==null&&(this._depthMesh.depthWrite=_)}get depthWrite(){return this._mesh===null?!1:this._mesh.material.depthWrite}_validateLevel(_){return this.level===_.level?1:0}_isCulled(_){let l=!1;if(_.numCropBoxes>0&&(this._vector.copy(this._sphere.center).clamp(_.cropMin,_.cropMax),_.cropExclude||this._vector.distanceToSquared(this._sphere.center)>this._sphere.radius*this._sphere.radius&&(l=!0)),!l&&_.numClippingPlanes>0)if(_.clipIntersection){l=!0;for(let n=0;n<_.clippingPlanes.length;n++)l=l&&_.clippingPlanes[n].distanceToPoint(this._sphere.center)<-this._sphere.radius}else for(let n=0;n<_.clippingPlanes.length;n++)l=l||_.clippingPlanes[n].distanceToPoint(this._sphere.center)<-this._sphere.radius;return l}_measureDistance(_,l){return _.isPerspectiveCamera?_.position.distanceTo(this._sphere.center):(this._sphere.center.sub(_.position).negate(),l.dot(this._sphere.center))}}},D,V),D.exports=B},1155:(D,V,f)=>{var R,B;R=[f(3681),f(539),f(9202),f(2883),f(6613),f(4547)],B=f.dj.d(R,function(d,N,_,l,n,r){return class{constructor(u="image",g=.5){this._center=new d.Sphere,this.numLevels=0,this._level=0,this._scaleByLevel=[],this._levelMode="auto",this._blocks=[],this._blocksForLoading=[],this._levelChanged=!1,this._type=u,this._sendDataToServer=!1,this._opaque=!1,this.outOfCore=!1,this.levelOfDetail=!1,this.threshold=g,this.numBlocks=0,this._enabled=!0,this._blockPriorityQueue=new n,this._blocksOutsideView=[],this._lru=new r}set enabled(u){u?this._enabled=!0:(this._blocksForLoading=[],this._enabled=!1)}get enabled(){return this._enabled}setBlockList(u,g,p=!1){switch(this.levelOfDetail=p,u){case"full":if(this.clear(),this.numLevels=g.NumLevels,this.numLevels>0){for(let y=0;y<g.InstructionSet.length;y++)this._blocks.push(this._initTile(y,g.InstructionSet[y]));this.numBlocks=g.InstructionSet.length}if(this.levelOfDetail)for(let y=0;y<g.InstructionSet.length;y++)g.InstructionSet[y].Parent>-1&&(this._blocks[y].parent=this._blocks[g.InstructionSet[y].Parent]);break;case"partial":this.unloadFineLevels();break;case"reload":if(this.outOfCore)this.unload(!0);else for(let y=0;y<this._blocks.length;y++)this._blocks[y].loaded=!1,this._blocks[y].overview=!1;break}}setBoundingSphere(u,g,p){this._center.radius=g,this._center.center.fromArray(u),this._scaleByLevel=p}getScale(){return this._scaleByLevel.length>0?this._level>0?this._scaleByLevel[this._level-1]:this._scaleByLevel[0]:1}setResolutionLevel(u){if(u==="auto")this._levelMode="auto";else{this._levelMode="manual";const g=this._level;u==="fine"?this._level=1:u==="coarse"?this._level=this.numLevels:this._level=u,g!==this._level&&(this._levelChanged=!0)}}setRenderOrder(u){for(let g=0;g<this._blocks.length;g++)this._blocks[g].renderOrder(u,this.numLevels)}setOpaque(u){u!==this._opaque&&(this._opaque=u,this._opaque||this._hideOtherLevels(this._level))}packageData(u,g){this._levelMode==="auto"&&this._sendDataToServer&&u.push({id:g,level:this._level}),this._sendDataToServer=!1}copyMaterial(u,g,p,y){for(let x=0;x<this._blocks.length;x++)this._blocks[x].copyMaterial(u,g,p,y)}copyUniforms(u,g){for(let p=0;p<this._blocks.length;p++)this._blocks[p].copyUniforms(u,g)}setClippingPlanes(u){for(let g=0;g<this._blocks.length;g++)this._blocks[g].setClippingPlanes(u)}resetBlocks(u,g,p,y,x,w,M){this.outOfCore&&this.unload(!0),this._updateBlocksInView(u,g,p,y,x,w,M)}loadBlock(u,g,p,y,x,w){this.outOfCore&&this.unload(!0),this._blocks[g].load(u,p,y,x,w)}_setLevel(u,g,p,y){if(this._levelMode==="auto"){const x=this._level;if(this.numLevels>1)if(u.isPerspectiveCamera){const w=2*u.position.distanceTo(this._center.center),M=.5*u.zoom*this._center.radius;w<=M?this._level=1:w>=2*M?this._level=this.numLevels:this._level=Math.round((this.numLevels-1)*(w/M-1))+1}else{const w=Math.max(Math.abs((u.right-u.left)/y.width),Math.abs((u.top-u.bottom)/y.height))/u.zoom;if(this.outOfCore||this._type==="volume"){this._level=this.numLevels;for(let M=0;M<this.numLevels;M++)if(this._scaleByLevel[M]>=w){this._level=M+1;break}}else{this._level=1;for(let M=0;M<this.numLevels;M++)this._scaleByLevel[M]<w&&(this._level=M+1)}}else this._level=this.numLevels;if(x!==this._level){for(let w=0;w<this._blocks.length;w++)this._blocks[w].showLevels(this.numLevels);this._levelChanged=!0,this._sendDataToServer=!0}}}_updateBlocksInView(u,g,p,y,x,w,M){if(this._blocksForLoading=[],this._blocksOutsideView=[],this._blockPriorityQueue.clear(),!this._enabled)return;let T="level";this._type==="pointcloud"&&(T="threshold"),T==="level"&&this._setLevel(u,g,p,y);const A={level:this._level,numLevels:this.numLevels,threshold:this.threshold,style:T};for(let C=0;C<this._blocks.length;C++)this._blocks[C].setWeight(u,x,A,w,y),this._blockPriorityQueue.push({index:C,level:this._blocks[C].level,weight:this._blocks[C].weight});for(;this._blockPriorityQueue.length()>0;){const z=this._blockPriorityQueue.pop().index;this._blocks[z].weight>A.threshold?this._blocks[z].isInView(u,g,p,M)?this._blocksForLoading.push(this._blocks[z].info):this._blocksOutsideView.push(z):((A.style==="threshold"||this.outOfCore)&&(this._blocks[z].visible=!1),this._blocksOutsideView.push(z))}this._blocksForLoading.length===0&&this._hideOtherLevels(this._level),this._blockPriorityQueue.clear()}getNextBlock(u,g){return this._blocksForLoading[u].outOfCore=this.outOfCore,this._blocksForLoading[u].id=g,this._blocksForLoading.splice(u,1)[0]}findNextBlock(){if(!this._enabled)return null;if(this._blocksForLoading.length>0){let u=0;if(this._blocksForLoading.length>1)if(this._type!=="pointcloud")for(let g=1;g<this._blocksForLoading.length;g++)this._blocksForLoading[g].distance<this._blocksForLoading[u].distance&&(u=g);else{const g=this._blocksForLoading[u].level;for(let p=1;p<this._blocksForLoading.length;p++)this._blocksForLoading[p].level===g&&this._blocksForLoading[p].distance<this._blocksForLoading[u].distance&&(u=p)}return this._lru.put(this._blocksForLoading[u].blockIndex),{numBlocksToRead:this._blocksForLoading.length,distance:this._blocksForLoading[u].distance,id:-1,index:u}}else return this._hideOtherLevels(this._level),null}getBlock(u){return this._blocks[u]}_hideOtherLevels(u){if(this._levelChanged){this._levelChanged=!1;const g=this._opaque===!0?this.numLevels:0;for(let p=0;p<this._blocks.length;p++)this._blocks[p].hideLevels(u,g)}}clear(){this._blocksForLoading=[],this._blocksOutsideView=[];for(let u=0;u<this._blocks.length;u++)this._blocks[u].dispose();this._blocks=[],this.numBlocks=0}clearBlockQueue(){this._blocksForLoading=[]}getMemoryUsed(){let u=0;for(let g=0;g<this._blocks.length;g++)u+=this._blocks[g].memory;return u}getNumElements(){let u=0;for(let g=0;g<this._blocks.length;g++)if(this._blocks[g].level===this._level&&(u+=this._blocks[g].numElements,this.outOfCore))return u;return u}unload(u,g=1e3){if(u)if(this.outOfCore===!0)this.unloadEverything();else for(let p=0;p<this._blocks.length;p++)this._blocks[p].loaded===!0&&this._blocks[p].visible===!1&&this._blocks[p].unload();else if(this._type!=="pointcloud")for(let p=0;p<this._blocks.length;p++)this._blocks[p].level===this.numLevels||this._blocks[p].level===this._level||this._blocks[p].unload();else{let p=this.getMemoryUsed();for(;p>g;){let y=-1;this._blocksOutsideView.length>0&&(y=this._blocksOutsideView.pop()),y>=0&&(p=p-this._blocks[y].memory,this._blocks[y].unload())}}}unloadEverything(){for(let u=0;u<this._blocks.length;u++)this._blocks[u].unload()}unloadFineLevels(){for(let u=0;u<this._blocks.length;u++)this._blocks[u].level!==this.numLevels&&this._blocks[u].unload()}unloadCoarseLevel(){for(let u=0;u<this._blocks.length;u++)this._blocks[u].level===this.numLevels&&this._blocks[u].unload()}_initTile(u,g){switch(this._type){case"image":return new N(u,g);case"volume":return new _(u,g);case"pointcloud":return new l(u,g)}}}},D,V),D.exports=B},7450:(D,V,f)=>{var R,B;R=[f(3681),f(7031),f(1155)],B=f.dj.d(R,function(d,N,_){return class extends N{constructor(n,r,h,u,g){super(n,h,u,g),this._mesh.material.visible=!1}refreshData(n,r,h){this._setNumChannels(r.NumChannels),this._useData=r.DataModified,this._includeOverlay=r.OverlayDataModified;const u=this._includeOverlay===!0?"#define USE_OVERLAY":"",g=this._useData===!0?"#define BLEND_OVERLAY":"";this._overlayDefines=[u,g].join(`
`),this._updateOffset(Array.from(r.Offset)),this._updateScale(Array.from(r.Scale)),this._updateGeometry(null,0),this._clearTextures(),this._updateFragmentShader(),r.UseBinaryChannel===!0&&this._blocks.loadBlock(n,0,this._mesh,this._depthMesh,this._globalUniforms,this._getPropertiesForTiles())}_constructProperties(n,r){super._constructProperties(n,r),this._scale=new d.Vector3(1,1,1),this._priorScale=new d.Vector3(1,1,1),this._blocks=new _,this._tform=new d.Matrix4,this._matrix=new d.Matrix4,this._useData=!1}remove(){this._blocks.clear(),super.remove()}_updateFragmentShader(){super._updateFragmentShader(),this._blocks.copyMaterial(this._mesh.material,this._depthMesh.material,this._globalUniforms,this._getPropertiesForTiles())}_clearTextures(){this._texture!==null&&this._texture.dispose(),this._isDataEmpty=!0,this._texture=null,this._mesh.material.uniforms.u_data.value=this._texture,this._overlayTexture!==null&&this._overlayTexture.dispose(),this._isOverlayEmpty=!0,this._overlayTexture=null,this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture,this._alphaTexture!==null&&this._alphaTexture.dispose(),this._alphaTexture=null,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture}_setProperties(n){this._blocks.setBlockList(n.ResetRequired,n.BlockList),this._blocks.setBoundingSphere(n.Center,n.Radius,n.ScaleFactor),this._blocks.setResolutionLevel(n.ResolutionLevel),this._blocks.setOpaque(n.Opaque),super._setProperties(n),this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles())}autoMagFilter(n){if(this._mesh!==null&&this._magFilterStyle==="auto"){const r=Math.min(this._mesh.matrix.elements[0],this._mesh.matrix.elements[5])*this._blocks.getScale(),h=n*r>1e3?d.NearestFilter:d.LinearFilter;this._magFilter!==h&&(this._magFilter=h,this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles()))}}_updateOffset(n){this._priorOffset.copy(this._offset),this._offset.fromArray(n)}_updateScale(n){this._priorScale.copy(this._scale),this._scale.fromArray(n)}_updateGeometry(n,r){(this._scale.distanceToSquared(this._priorScale)>1e-4||this._offset.distanceToSquared(this._priorOffset)>1e-4)&&(this._mesh.geometry.translate(-this._priorScale.x/2-this._priorOffset.x,-this._priorScale.y/2-this._priorOffset.y,-this._priorScale.z/2-this._priorOffset.z),this._mesh.geometry.scale(this._scale.x/this._priorScale.x,this._scale.y/this._priorScale.y,this._scale.z/this._priorScale.z),this._mesh.geometry.translate(this._scale.x/2+this._offset.x,this._scale.y/2+this._offset.y,this._scale.z/2+this._offset.z),this.quality(r))}_setClippingUniforms(n){super._setClippingUniforms(n),this._blocks.setClippingPlanes(n)}renderOrder(n){super.renderOrder(n),this._blocks.setRenderOrder(n)}resetBlocks(n,r,h,u,g){const p={numCropBoxes:this._numCropBoxes,numClippingPlanes:this._mesh.material.clippingPlanes.length,clippingPlanes:this._mesh.material.clippingPlanes,cropMin:this._globalUniforms.u_cropMin.value,cropMax:this._globalUniforms.u_cropMax.value,clipIntersection:this._clipIntersectionDefines!=="",cropExclude:this._cropDefines!==""};this._blocks.resetBlocks(n,r,h,u,g,this._tform,p)}clearBlockQueue(){this._blocks.clearBlockQueue()}loadBlock(n,r){this._blocks.loadBlock(n,r.blockIndex,this._mesh,this._depthMesh,this._globalUniforms,this._getPropertiesForTiles())}getNextBlock(n,r){return this._blocks.getNextBlock(n,r)}findNextBlock(){return this._mesh.visible?this._blocks.findNextBlock():null}crop(n,r){super.crop(n,r),this._blocks.copyMaterial(this._mesh.material,this._depthMesh.material,this._globalUniforms,this._getPropertiesForTiles())}updateWindowLevel(n){super.updateWindowLevel(n),this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles())}getMemoryUsed(){return this._blocks.getMemoryUsed()}getMemoryRequired(){let n=0;this._useData&&(n+=this._numChannels),this._includeOverlay&&(n+=1),this._useAlphaData&&(n+=1);const r=this._blocks.getNumElements();return n*r/1e6}unload(n,r){this._mesh.visible?this._blocks.unload(n,r):this._blocks.unload(!0,r)}packageData(n,r){this._blocks.packageData(n,r)}_getPropertiesForTiles(){return{NumChannels:this._numChannels,UseData:this._useData,UseOverlay:this._includeOverlay,UseAlpha:this._useAlphaData,Mipmaps:this._mipmaps,MinFilter:this._filter,MagFilter:this._magFilter,OverlayFilter:this._overlayFilter,NumLevels:this._blocks.numLevels}}}},D,V),D.exports=B},4297:(D,V,f)=>{var R,B;R=[f(3681),f(4047),f(7387)],B=f.dj.d(R,function(d,N,_){return class extends N{refreshData(n,r){}_constructProperties(n,r){super._constructProperties(n,r),this._blocks=new _("pointcloud",n.Threshold,n.PointBudget,n.MaxLevel),this._tform=new d.Matrix4}_setProperties(n){this._blocks.setBlockList(n.ResetRequired,n.BlockList),this._blocks.setBoundingSphere(n.Center,n.Radius,n.ScaleFactor),this._blocks.setPointBudget(n.PointBudget),this._blocks.setPointSize(n.PointSize),this._blocks.attenuateSize(n.AttenuateSize),super._setProperties(n)}unload(n,r){this._blocks.unload(n,r)}renderOrder(n){super.renderOrder(n),this._blocks.setRenderOrder(n)}resetBlocks(n,r,h,u,g){const p={numCropBoxes:this._numCropBoxes};this._blocks.resetBlocks(n,r,h,u,g,this._tform,p),this._blocks.trimByPointBudget(n,r,h,p)}loadBlock(n,r){this._blocks.loadBlock(n,r.blockIndex,this._mesh,this._depthMesh,this._globalUniforms)}getNextBlock(n,r){return this._blocks.getNextBlock(n,r)}findNextBlock(){if(!this._mesh.visible)return null;let n=this._blocks.findNextBlock();return n!==null&&this._blocks.stopLoadingByPointBudget(n.index)&&(n=null),n}}},D,V),D.exports=B},1756:(D,V,f)=>{var R,B;R=[f(3681),f(8633),f(2158),f(1155)],B=f.dj.d(R,function(d,N,_,l){return class extends _{constructor(r,h,u,g,p,y){super(r,u,p,y),this._overview=new N(g,u,p,y),this._deferredScene=h,this._blocks.outOfCore&&this._deferredScene.add(this._mesh)}refreshData(r,h,u){this._setNumChannels(h.NumChannels),this._includeOverlay=h.OverlayDataModified,this._includeVolume=h.DataModified,this._overlayDefines=this._includeOverlay?"#define USE_OVERLAY":"",this._volumeDefines=this._includeVolume?"#define USE_VOLUME":"",this._updateOffset(Array.from(h.Offset)),this._updateScale(Array.from(h.Scale)),this._updateGeometry(h,u),this._clearTextures(),this._updateFragmentShader(),this._blocks.outOfCore&&this._overview.refreshData(r,h,u)}refreshProperties(r){this._setProperties(r),this._blocks.outOfCore&&this._overview.refreshProperties(r)}remove(){this._blocks.clear(),this._overview.remove(),super.remove()}clipIntersection(r){this._blocks.outOfCore&&this._overview.clipIntersection(r),super.clipIntersection(r)}lighting(r){this._blocks.outOfCore&&this._overview.lighting(r),super.lighting(r)}cameraStyle(r){this._blocks.outOfCore&&this._overview.cameraStyle(r),super.cameraStyle(r)}updateOnInteraction(r){this._blocks.outOfCore?(this._blocks.enabled=!r,this._overview.updateOnInteraction(r&&this._mesh.visible)):this._blocks.enabled=!0}_setProperties(r){this._outOfCoreRendering(r.OutOfCoreRendering),this._blocks.setBlockList(r.ResetRequired,r.BlockList),this._blocks.setBoundingSphere(r.Center,r.Radius,r.ScaleFactor),this._blocks.setResolutionLevel(r.ResolutionLevel),super._setProperties(r),this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles())}_updateOffset(r){this._priorOffset.copy(this._offset),this._offset.fromArray(r)}_updateScale(r){this._priorScale.copy(this._scale),this._scale.fromArray(r)}_updateRayTrace(){let r=!1;this._includeOverlay&&(r=!0),this._includeVolume&&(this._renderingStyle===1||this._renderingStyle===2||this._renderingStyle===3?r=!1:r=!0),this._rayTraceDefines=r?"#define USE_RAY_TRACE":""}_updateGeometry(r,h){(this._size.distanceToSquared(this._priorSize)>1e-4||this._offset.distanceToSquared(this._priorOffset)>1e-4||this._scale.distanceToSquared(this._priorScale)>1e-4)&&(this._mesh.geometry.translate(-this._priorScale.x/2-this._priorOffset.x,-this._priorScale.y/2-this._priorOffset.y,-this._priorScale.z/2-this._priorOffset.z),this._mesh.geometry.scale(this._scale.x/this._priorScale.x,this._scale.y/this._priorScale.y,this._scale.z/this._priorScale.z),this._mesh.geometry.translate(this._scale.x/2+this._offset.x,this._scale.y/2+this._offset.y,this._scale.z/2+this._offset.z),this._mesh.material.uniforms.u_size.value.set(this._size.x,this._size.y,this._size.z),this.quality(h))}_setClippingUniforms(r){super._setClippingUniforms(r),this._blocks.copyMaterial(this._mesh.material,this._depthMesh.material,this._globalUniforms,this._getPropertiesForTiles())}renderOrder(r){super.renderOrder(r),this._blocks.setRenderOrder(r)}resetBlocks(r,h,u,g,p){const y={numCropBoxes:this._numCropBoxes,numClippingPlanes:this._mesh.material.clippingPlanes.length,clippingPlanes:this._mesh.material.clippingPlanes,numSlicePlanes:this._renderingStyle===1?this._mesh.material.uniforms.slicePlanes.value.length/4:0,slicePlanes:this._mesh.material.uniforms.slicePlanes.value,tform:this._tform,cropMin:this._globalUniforms.u_cropMin.value,cropMax:this._globalUniforms.u_cropMax.value,clipIntersection:this._clipIntersectionDefines!=="",cropExclude:this._cropDefines!==""};this._blocks.resetBlocks(r,h,u,g,p,this._tform,y)}clearBlockQueue(){this._blocks.clearBlockQueue()}loadBlock(r,h){if(this._blocks.loadBlock(r,h.blockIndex,this._mesh,this._depthMesh,this._globalUniforms,this._getPropertiesForTiles()),this._blocks.outOfCore&&this._overview.stitchingNeeded){const u=this._blocks.getBlock(h.blockIndex);!u.overview&&u.level===this._blocks.numLevels&&(u.overview=!0,this._overview.stitchBuffer(r,this._getPropertiesForOverviewStitching(u)))}}getNextBlock(r,h){return this._blocks.getNextBlock(r,h)}findNextBlock(){return this._mesh.visible?this._blocks.findNextBlock():null}crop(r,h){this._blocks.outOfCore&&this._overview.crop(r,h),super.crop(r,h),this._blocks.copyMaterial(this._mesh.material,this._depthMesh.material,this._globalUniforms,this._getPropertiesForTiles())}colorInBox(r){this._blocks.outOfCore?this._overview.colorInBox(r):super.colorInBox(r)}getMemoryUsed(){return this._blocks.getMemoryUsed()+this._overview.getMemoryUsed()}quality(r){this._blocks.outOfCore&&this._overview!==void 0&&this._overview.quality(r),super.quality(r)}globalClippingPlanes(r,h){this._blocks.outOfCore&&this._overview!==void 0&&this._overview.globalClippingPlanes(r,h),super.globalClippingPlanes(r,h)}localClippingPlanes(r){this._blocks.outOfCore&&this._overview!==void 0&&this._overview.localClippingPlanes(r),super.localClippingPlanes(r)}copyClippingPlaneObjects(r){this._blocks.outOfCore&&this._overview.copyClippingPlaneObjects(r),super.copyClippingPlaneObjects(r)}updateWindowLevel(r){super.updateWindowLevel(r),this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles())}getMemoryRequired(){let r=0;this._includeVolume&&(r+=this._numChannels),this._includeOverlay&&(r+=1),this._useAlphaData&&(r+=1);const h=this._blocks.getNumElements();return this._blocks.outOfCore?r*h/1e6+this._overview.getMemoryRequired():r*h/1e6}unload(r,h){this._blocks.unload(r,h)}packageData(r,h){this._blocks.packageData(r,h)}_getPropertiesForTiles(){return{NumChannels:this._numChannels,UseData:this._includeVolume,UseOverlay:this._includeOverlay,UseAlpha:this._useAlphaData,MinFilter:this._filter,MagFilter:this._filter,OverlayFilter:this._overlayFilter,NumLevels:this._blocks.numLevels}}_getPropertiesForOverviewStitching(r){return{NumChannels:this._numChannels,DataModified:this._includeVolume,OverlayDataModified:this._includeOverlay,Size:r.size,TotalSize:r.totalSize,LocalOffset:r.localOffset}}_lightScattering(){}_slicePlanes(r,h){this._blocks.outOfCore&&this._overview!==void 0&&this._overview._slicePlanes(r,h),super._slicePlanes(r,this._scaleFactor)}copySlicePlaneObjects(r){super.copySlicePlaneObjects(r),this._blocks.outOfCore&&this._overview.copySlicePlaneObjects(r),this._blocks.copyUniforms(this._mesh.material.uniforms,this._getPropertiesForTiles())}_updateMatrix(r){this._tform.copy(r),this._mesh.matrix=r,this._depthMesh!==null&&(this._depthMesh.matrix=r,this._depthMesh.matrixWorldNeedsUpdate=!0),this._mesh.matrixWorldNeedsUpdate=!0}_constructProperties(r,h){super._constructProperties(r,h),this._scale=new d.Vector3(1,1,1),this._priorScale=new d.Vector3(1,1,1),this._blocks=new l("volume"),this._blendOp=d.NormalBlending,this._tform=new d.Matrix4,this._blockedDefines="#define USE_BLOCKED_RENDERING"}_outOfCoreRendering(r){const h=this._blendOp;this._blendOp=r===!0?d.NoBlending:d.NormalBlending,h!==this._blendOp&&(this._mesh.material.blending=this._blendOp,this._needsUpdate=!0,this._blocks.outOfCore=r,r?this._deferredScene!==void 0&&this._deferredScene.add(this._mesh):(this._overview.remove(),this._scene.add(this._mesh)))}_clearTextures(){this._texture!==null&&this._texture.dispose(),this._isDataEmpty=!0,this._texture=null,this._mesh.material.uniforms.u_data.value=this._texture,this._overlayTexture!==null&&this._overlayTexture.dispose(),this._isOverlayEmpty=!0,this._overlayTexture=null,this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture,this._alphaTexture!==null&&this._alphaTexture.dispose(),this._alphaTexture=null,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture}_updateFragmentShader(){super._updateFragmentShader(),this._blocks.copyMaterial(this._mesh.material,this._depthMesh.material,this._globalUniforms,this._getPropertiesForTiles())}_getFragmentShader(r){let h=super._getFragmentShader(r);return h=[this._blockedDefines,h].join(`
`),h}}},D,V),D.exports=B},6337:(D,V,f)=>{var R,B;R=[f(3681),f(5069),f(4576)],B=f.dj.d(R,function(d,N,_){return class extends d.EventDispatcher{constructor(n,r,h,u,g,p,y){super(),this._globalData=y,this.cameraStyle=n.Camera.Style;const x=r.clientWidth,w=r.clientHeight;this._perspectiveCamera=new d.PerspectiveCamera(n.Camera.ViewAngle,x/w,.1,Number.MAX_SAFE_INTEGER),this._orthographicCamera=new d.OrthographicCamera(-x/2,x/2,w/2,-w/2,0,Number.MAX_SAFE_INTEGER),this._activeCamera=this.cameraStyle==="orthographic"?this._orthographicCamera:this._perspectiveCamera,this._farScaleFactor=this.cameraStyle==="orthographic"?1:2,this._activeCamera.up.set(0,0,1),this._activeCamera.updateProjectionMatrix(),this._perspectiveCamera.layers.enable(1),this._orthographicCamera.layers.enable(1),this._frustum=new d.Frustum,this.boundingBox=new d.Box3(new d.Vector3,new d.Vector3),this._createElements(r,h),this._light=p,this._toolbar=new N(this._container,n.Mode,n.Tooltips),this._annotations=new _(g,this._container,u,this.boundingBox,n.Mode,n.Annotations),this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,ANIMATE:3,SCISSORS:4,ANNOTATE:5,WINDOWLEVEL:6,SELECT:7,PLANETRANSLATE:8,PLANEROTATE:9,ANNOTATESNAP:10,ANNOTATEROTATE:11,CUBOID:12,CROPTRANSLATE:13,RECTANGLE:14,SCRIBBLE:15,CROSSHAIR:16,PAINT:17},this._projectionScreenMatrix=new d.Matrix4,this._enabled=!1,this._enableRequired=!1,this._hasContext=!0,this.screen={left:0,top:0,width:0,height:0},this._priorScreen=null,this._windowResized=!1,this.target=new d.Vector3,this._autoUpdate=[!0,!0,!0,!0,!0],this._renderEvent={type:"render"},this._renderFrontLayerEvent={type:"renderFrontLayer"},this._startEvent={type:"interactionStarted"},this._defaultCameraEvent={type:"defaultCameraRestored"},this._resizeEvent={type:"windowResizing"},this._resizeEndEvent={type:"windowResized"},this._measureEvent={type:"measurePerformance"},this._resetEvent={type:"resetPerformance"},this._iterativeEvent={type:"updateIteration"},this._lazyLoadingEvent={type:"refreshLazyLoading"},this.EPS=1e-6,this._state=this.STATE.NONE,this._interactionStarted=!1,this._cameraInitialized=!1,this.updateRequested=!1,this.iterativeUpdateRequested=!1,this.picking=!0,this._serverSidePickRequested=!1,this._contextMenuVisible=!1,this._lazyLoadingEnabled=!0,this.lazyLoadingRequired=!1,this.lazyLoadingRequested=!1,this._latentEventsEnabled=!1,this._latentEventRequested=!1,this._latentEventData=null,this._lastPosition=new d.Vector3,this._lastTarget=new d.Vector3,this._lastUpVector=new d.Vector3,this._lastZoom=1,this._keyPressed=!1,this._shiftPressed=!1,this._ctrlPressed=!1,this._altPressed=!1,this._aPressed=!1,this._xPressed=!1,this._yPressed=!1,this._zPressed=!1,this._mouseTarget=new d.Vector3,this._fulcrum=new d.Vector3,this._pointerEventCache=[],this._pinchGesture=!1,this._rectangleGesture=!1,this._autoPan=!1,this._doubleClick=!1,this._eye=new d.Vector3,this._movePrevious=new d.Vector2,this._moveCurrent=new d.Vector2,this._zoomStart=new d.Vector2,this._zoomEnd=new d.Vector2,this._panStart=new d.Vector2,this._panEnd=new d.Vector2,this._annotationStart=new d.Vector2,this._annotationEnd=new d.Vector2,this._windowLevelStart=new d.Vector2,this._windowLevelEnd=new d.Vector2,this._motionInitiated=!1,this._mouseLocation=new d.Vector2,this.boundingSphere=new d.Sphere,this._tightRadius=0,this._tightAspectRatio=1,this._tightFrustum=!1,this.zoomPercent=0,this._lastDepth=0,this._lastNonZeroDepth=0,this._lastNonZeroDepthScreenCoords=new d.Vector2,this._hitTarget=new d.Vector3,this._clickTarget=new d.Vector3,this._screenCoordinates=new d.Vector2,this._fillWithColor=!1,this._blockContextMenu=!1,this._scrollTimeout=null,this._resizeTimeout=null,this._annotationTimeout=null,this._clickTimeout=null,this._interactionTimestamp=Date.now(),this._lazyLoadingTimestamp=Date.now(),this._serverSidePickTimestamp=Date.now(),this._lazyLoadingEventLatency=200,this._duringInteractionEventLatency=n.HardwareSupport?50:100,this._afterInteractionEventLatency=250,this._resizeEventLatency=500,this._wireUpEventListeners();const M=this._container.getBoundingClientRect(),T=this._container.ownerDocument.documentElement;this.screen.width=Math.round(M.width),this.screen.height=Math.round(M.height),this.screen.left=M.left+window.scrollX-T.clientLeft,this.screen.top=M.top+window.scrollY-T.clientTop,this.resize(),this.update(),this._resetResizeSensor()}get camera(){return this._activeCamera}update(){this._eye.subVectors(this._activeCamera.position,this.target),this._annotations.updateEye(this._eye,this._activeCamera.up),this._toolbar.enableRotate&&this._rotateCamera(),this._toolbar.enableZoom&&this._zoomCamera(),this._toolbar.enablePan&&this._panCamera(),this._annotations.enabled&&this._updateAnnotation(),this._toolbar.enableWindowLevel&&this._updateWindowLevel(),this._toolbar.state===this.STATE.ANIMATE&&this._toolbar.setNextFrame(this.target,this._eye,this._activeCamera),this._windowResized||this._didCameraChange()||this.updateRequested?(this._activeCamera.lookAt(this.target),this._light.refresh(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius),this._setCameraFar(),this._clearDepth(),this.updateRequested=!1,this._annotations.updateRequested=!1,this._interactionStarted&&this.dispatchEvent(this._measureEvent),this._windowResized?(this.dispatchEvent(this._resizeEvent),this._windowResized=!1,this._state===this.STATE.SCISSORS&&this._annotations.cleanUpScissors()):(this.dispatchEvent(this._renderEvent),this.copyCameraProperties())):this._annotations.updateRequested?(this._annotations.updateRequested=!1,this.dispatchEvent(this._renderFrontLayerEvent)):this._interactionStarted?this.dispatchEvent(this._resetEvent):this.iterativeUpdateRequested===!0&&this.dispatchEvent(this._iterativeEvent),this._enableRequired&&(this._enableRequired=!1,this._toolbar.enable(),this._annotations.enable(),this._enabled=!0),this._latentEventsEnabled&&this._sendLatentEvent(),this.lazyLoadingRequired&&this._lazyLoadingEnabled&&this._sendLazyLoadingEvent(),this._serverSidePickRequested&&this._sendServerSidePickEvent(),this._keyPressed=!1}mode(n,r){this._toolbar.update(n),this._annotations.updateInteractions(n,r),this._updatePointer(!1),this._updateColorFill(),this._contextMenuVisible=!1}updateObjectInfo(n){this._annotations.updateObjectInfo(n)}annotate(n){this._annotations.update(n),this._contextMenuVisible=!1}clear(){this._annotations.clear()}updateAnnotationSettings(n){this._annotations.updateAnnotationSettings(n)}setUnits(n){this._annotations.setUnits(n),this._contextMenuVisible=!1}setCrosshair(n){this._annotations.setCrosshair(n)}updateCrop(n,r){this._toolbar.updateCrop(n),this._annotations.updateCrop(n,r,this._globalData.cropType)}setZoomPercent(n){this.cameraStyle==="orthographic"&&(this._activeCamera.zoom=Math.max(Math.min(n*(this._activeCamera.right-this._activeCamera.left)/(100*this.screen.width),this._toolbar.zoomLimits.y),this._toolbar.zoomLimits.x),this._activeCamera.updateProjectionMatrix(),this._updateZoomPercent())}renderText(){this._annotations.renderText(this._activeCamera,this.screen)}editAnnotation(n){this._contextMenuVisible=!1,this._annotations.editAnnotation(n.Index)}getFrustum(){return this._updateProjectionMatrix(),this._frustum.setFromProjectionMatrix(this._projectionScreenMatrix),this._frustum}getEyeVector(){const n=new d.Vector3;return n.subVectors(this._activeCamera.position,this.target).normalize(),n}contextLost(){this.enabled=!1,this._annotations.disable(),this._hasContext=!1}resize(){if(this.cameraStyle==="orthographic"&&this._toolbar.preserveZoom&&this._priorScreen!==null){const n=(this._activeCamera.right-this._activeCamera.left)/(this._priorScreen.width/this.screen.width),r=(this._activeCamera.top-this._activeCamera.bottom)/(this._priorScreen.height/this.screen.height);this._activeCamera.right=n/2,this._activeCamera.left=-n/2,this._activeCamera.top=r/2,this._activeCamera.bottom=-r/2,this._activeCamera.updateProjectionMatrix()}else this._updateFrustum(),this._activeCamera.updateProjectionMatrix(),this._updateZoomPercent();this._priorScreen!==null&&(this._priorScreen=null),this._annotations.resize(this.screen),this._toolbar.resize(this.screen)}packageCameraProperties(){return this._updateProjectionMatrix(),this.cameraStyle==="perspective"?{CameraPosition:[this._activeCamera.position.x,this._activeCamera.position.y,this._activeCamera.position.z],CameraTarget:[this.target.x,this.target.y,this.target.z],CameraUpVector:[this._activeCamera.up.x,this._activeCamera.up.y,this._activeCamera.up.z],CameraZoom:this._activeCamera.zoom,LightPosition:this._light.getPosition(),CameraViewAngle:this._activeCamera.fov,ProjectionMatrix:this._projectionScreenMatrix.elements,ScreenInfo:[this.screen.width,this.screen.height],NearFar:[this._activeCamera.near,this._activeCamera.far],OrthographicFrustum:[],ObjectInfo:[]}:{CameraPosition:[this._activeCamera.position.x,this._activeCamera.position.y,this._activeCamera.position.z],CameraTarget:[this.target.x,this.target.y,this.target.z],CameraUpVector:[this._activeCamera.up.x,this._activeCamera.up.y,this._activeCamera.up.z],CameraZoom:this._activeCamera.zoom,LightPosition:this._light.getPosition(),ProjectionMatrix:this._projectionScreenMatrix.elements,ScreenInfo:[this.screen.width,this.screen.height],NearFar:[this._activeCamera.near,this._activeCamera.far],OrthographicFrustum:[this._activeCamera.left,this._activeCamera.right,this._activeCamera.bottom,this._activeCamera.top],ObjectInfo:[]}}packageCameraPropertiesIfChanged(){return this._didCameraChange()?this.packageCameraProperties():this.packageProjectionMatrix()}packageProjectionMatrix(){return this._updateProjectionMatrix(),this.cameraStyle==="perspective"?{ProjectionMatrix:this._projectionScreenMatrix.elements,ScreenInfo:[this.screen.width,this.screen.height],LightPosition:this._light.getPosition(),NearFar:[this._activeCamera.near,this._activeCamera.far],OrthographicFrustum:[],ObjectInfo:[]}:{ProjectionMatrix:this._projectionScreenMatrix.elements,ScreenInfo:[this.screen.width,this.screen.height],LightPosition:this._light.getPosition(),NearFar:[this._activeCamera.near,this._activeCamera.far],OrthographicFrustum:[this._activeCamera.left,this._activeCamera.right,this._activeCamera.bottom,this._activeCamera.top],ObjectInfo:[]}}setCamera(n,r,h,u,g,p,y){let x=!1;n!==this.cameraStyle&&(this._activeCamera=n==="orthographic"?this._orthographicCamera:this._perspectiveCamera,this.cameraStyle=n,this._farScaleFactor=this.cameraStyle==="orthographic"?1:2,x=!0,this._updateFrustum(),this._activeCamera.updateProjectionMatrix()),this.cameraStyle==="perspective"&&(this._activeCamera.fov=p),this._activeCamera.position.set(r[0],r[1],r[2]),this._activeCamera.up.set(u[0],u[1],u[2]),this.target.set(h[0],h[1],h[2]),this._activeCamera.lookAt(this.target),this._activeCamera.zoom=g,this._autoUpdate=y,this.cameraStyle==="perspective"&&(x===!0&&this._autoUpdate[4]===!0?this._resetCameraFOV():this._activeCamera.fov=p),this._setCameraFar(),x===!0&&this._activeCamera.updateMatrixWorld(!0),this._updateZoomPercent()}setLight(n){this._light.update(n),this._light.reset(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius)}fitCameraToBoundingSphere(){const r=this.boundingSphere.radius,h=this.target,u=new d.Vector3;this.boundingBox.getCenter(u),this.boundingBox.getBoundingSphere(this.boundingSphere);const g=new d.Vector3;this.boundingBox.getSize(g),this._tightRadius=Math.max(g.x,Math.max(g.y,g.z))/2;const p=this._activeCamera.position;if((this._autoUpdate[0]||this._autoUpdate[1]||r<=0)&&this._updateFrustum(),this._toolbar.defaultPosition.copy(this._toolbar.defaultCameraVector).normalize().multiplyScalar(2*this.boundingSphere.radius).add(u),this._toolbar.defaultTarget.copy(u),this._interactionStarted===!1||this._cameraInitialized===!1){const y=new d.Vector3;this._autoUpdate[0]&&(p.x===0&&p.y===0&&p.z===0||p.x===1&&p.y===1&&p.z===1?(this._autoUpdate[2]&&this._activeCamera.up.copy(this._toolbar.defaultUp),y.copy(this._toolbar.defaultCameraVector).normalize().multiplyScalar(2*this.boundingSphere.radius).add(u)):y.subVectors(p,h).normalize().multiplyScalar(2*this.boundingSphere.radius).add(u),this._activeCamera.position.copy(y),this._light.reset(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius)),this._autoUpdate[1]&&(this._activeCamera.position.equals(u)?(this._activeCamera.lookAt(this.boundingBox.min),this.target.copy(this.boundingBox.min)):(this._activeCamera.lookAt(u),this.target.copy(u)),this._fulcrum.copy(this._toolbar.defaultTarget)),this._autoUpdate[3]&&this._setDefaultZoom(),this.cameraStyle==="perspective"&&this._autoUpdate[4]&&this._resetCameraFOV(),this._cameraInitialized=!0}this._annotations.updateBoundingBox(u,2*this.boundingSphere.radius),this._light.refresh(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius),this._setCameraFar(),this._activeCamera.updateMatrixWorld(!0)}updatePlanes(n,r,h,u,g,p,y){this._annotations.updatePlanes(n,r,h,p,y),this._toolbar.contextualUpdate(this._annotations.getClipState(),this._annotations.getSliceState()&&r.length<6,u,g),this._contextMenuVisible=!1}setColor(n){this._container.style.backgroundColor="rgb("+Math.round(n[0]*255)+", "+Math.round(n[1]*255)+", "+Math.round(n[2]*255)+")",this._toolbar.setColor(n),this._annotations.setColor(n)}set enabled(n){n?this._enableRequired=!0:(this._enableRequired=!1,this._toolbar.disable(),this._enabled=!1)}get enabled(){return this._enabled}set lazyLoading(n){n?(this._lazyLoadingTimestamp=Date.now(),this._lazyLoadingEnabled=!0,this.lazyLoadingRequested=!0):this._lazyLoadingEnabled=!1}get lazyLoading(){return this._lazyLoadingEnabled&&this.lazyLoadingRequired}setScreenPosition(){this._onOverflowOrUnderflow()}copyCameraProperties(){this._lastPosition.copy(this._activeCamera.position),this._lastTarget.copy(this.target),this._lastUpVector.copy(this._activeCamera.up),this._lastZoom=this._activeCamera.zoom}enableInteractions(n,r){this.enabled=n&&!r,r&&(this._toolbar.hide(),this._annotations.disable())}setBoundingBox(n){const r=new d.Vector3(n[0][0],n[0][1],n[0][2]),h=new d.Vector3(n[1][0],n[1][1],n[1][2]);this.boundingBox.set(r,h)}copyAnnotations(n){this._annotations.copy()}setDepthAtLocation(n,r){this._lastDepth=n,n>0&&n<.999999&&(this._lastNonZeroDepth=n,this._lastNonZeroDepthScreenCoords.copy(r),this._depthToWorld(this._lastNonZeroDepth,r,this._hitTarget))}_depthToWorld(n,r,h){const u=new d.Vector4((r.x-.5)*2,(1-r.y-.5)*2,(n-.5)*2,1);u.applyMatrix4(this._activeCamera.projectionMatrixInverse),u.divideScalar(u.w),u.applyMatrix4(this._activeCamera.matrixWorld),h.copy(u)}_setClickLocation(n){this._lastDepth>0&&this._lastDepth<.999999?this._depthToWorld(this._lastDepth,n,this._clickTarget):this._clickTarget.copy(this.target)}_setFulcrumLocation(n){this._setClickLocation(n),this._lastDepth>0&&this._lastDepth<.999999&&this._fulcrum.copy(this._clickTarget)}_clearDepth(){this._lastDepth=0,this._fillWithColor===!1&&(this._lastNonZeroDepth=0,this._hitTarget.set(0,0,0))}_onOverflowOrUnderflow(){const n=this._container.getBoundingClientRect(),r=this._container.ownerDocument.documentElement,h=n.left+window.scrollX-r.clientLeft,u=n.top+window.scrollY-r.clientTop,g=Math.round(n.width),p=Math.round(n.height);(g!==this.screen.width||this.screen.height!==p)&&(this._priorScreen===null&&(this._priorScreen={left:this.screen.left,top:this.screen.top,width:this.screen.width,height:this.screen.height}),this.screen.width=g,this.screen.height=p,this.screen.left=h,this.screen.top=u,this._interactionStarted===!1&&this._broadcastStartEvent(),window.clearTimeout(this._resizeTimeout),this._resizeTimeout=window.setTimeout(this._broadcastResizeEndEvent.bind(this),this._resizeEventLatency),this._windowResized=!0),this._resetResizeSensor()}_resetResizeSensor(){this._expand.scrollLeft=1e7,this._expand.scrollTop=1e7,this._shrink.scrollLeft=1e7,this._shrink.scrollTop=1e7}_updateFrustum(){const n=this.screen.height,r=this.screen.width/this.screen.height,h=this.boundingSphere.radius===0?n:this.boundingSphere.radius;this.cameraStyle==="orthographic"?r>1?(this._activeCamera.top=h,this._activeCamera.bottom=-h,this._activeCamera.left=-h*r,this._activeCamera.right=h*r):(this._activeCamera.left=-h,this._activeCamera.right=h,this._activeCamera.top=h/r,this._activeCamera.bottom=-h/r):this._activeCamera.aspect=r}_updateProjectionMatrix(){this.boundingSphere.radius>0?this._projectionScreenMatrix.multiplyMatrices(this._activeCamera.projectionMatrix,this._activeCamera.matrixWorldInverse):this._projectionScreenMatrix.identity()}_didCameraChange(){return this._lastZoom!==this._activeCamera.zoom||this._lastPosition.distanceToSquared(this._activeCamera.position)>this.EPS||this._lastTarget.distanceToSquared(this.target)>this.EPS||this._lastUpVector.distanceToSquared(this._activeCamera.up)>this.EPS}_setCameraFar(){const n=this.boundingSphere.distanceToPoint(this._activeCamera.position),r=this.cameraStyle==="orthographic"?0:.1,h=Number.MAX_SAFE_INTEGER;this.boundingSphere.radius>0?this._tightFrustum===!0?(this._activeCamera.near=Math.max(r,n),this._activeCamera.far=Math.max(0,n)+2*this.boundingSphere.radius):(this._activeCamera.near=r,this._activeCamera.far=Math.max(0,2*n)+2*this.boundingSphere.radius):(this._activeCamera.near=r,this._activeCamera.far=h),this._activeCamera.updateProjectionMatrix()}_restoreDefaultCameraView(){this.copyCameraProperties(),this._activeCamera.position.copy(this._toolbar.defaultPosition),this.target.copy(this._toolbar.defaultTarget),this._fulcrum.copy(this._toolbar.defaultTarget),this._activeCamera.up.copy(this._toolbar.defaultUp),this._activeCamera.lookAt(this.target),this._setDefaultZoom(),this._light.refresh(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius),this._setCameraFar(),this._activeCamera.updateMatrixWorld(!0),this._broadcastDefaultViewEvent()}_setDefaultZoom(){if(this._toolbar.defaultFit&&this.boundingSphere.radius>0)if(this.cameraStyle==="orthographic"){const n=this._activeCamera.position.clone().sub(this.target).normalize(),r=this._activeCamera.up.clone().normalize(),h=new d.Vector3(1,0,0),u=new d.Vector3(0,1,0),g=new d.Vector3(0,0,1);let p=-1,y=-1;if(Math.abs(n.dot(g))>.9999?p=2:Math.abs(n.dot(h))>.9999?p=0:Math.abs(n.dot(u))>.9999&&(p=1),Math.abs(r.dot(u))>.9999?y=1:Math.abs(r.dot(h))>.9999?y=0:Math.abs(r.dot(g))>.9999&&(y=2),y===-1||p===-1)this._tightAspectRatio=1,this._activeCamera.zoom=this.boundingSphere.radius/this._tightRadius;else{let x,w;const M=new d.Vector3;switch(this.boundingBox.getSize(M),p){case 0:x=y===1?M.z:M.y;break;case 1:x=y===2?M.x:M.z;break;case 2:x=y===0?M.y:M.x;break}switch(y){case 0:w=M.x;break;case 1:w=M.y;break;case 2:w=M.z;break}this._tightAspectRatio=x/w;const T=this.screen.width/this.screen.height;let A;this._tightAspectRatio===T?A=x>w?w/2:x/2:this._tightAspectRatio>=T?T>1?A=x/2/T:A=x/2:T>1?A=w/2:A=w/2*T,this._activeCamera.zoom=this.boundingSphere.radius/A}}else this._tightAspectRatio=1,this._activeCamera.zoom=this.boundingSphere.radius/this._tightRadius;else this._activeCamera.zoom=1;this._updateZoomPercent()}_updateZoomPercent(){const n=this.zoomPercent;this.cameraStyle==="orthographic"?this.zoomPercent=this._activeCamera.zoom*(100*this.screen.width)/(this._activeCamera.right-this._activeCamera.left):this.zoomPercent=0,this.zoomPercent!==n&&this.dispatchEvent({type:"zoomPercentUpdated"})}_snapToAxes(n){this.copyCameraProperties();const r=this._toolbar.defaultTarget.distanceTo(this._toolbar.defaultPosition),h=new d.Vector3;switch(n.message){case 0:h.set(1,0,0),this._activeCamera.up.set(0,0,1);break;case 1:h.set(0,1,0),this._activeCamera.up.set(0,0,1);break;case 2:h.set(0,0,1),this._activeCamera.up.set(0,1,0);break}const u=new d.Vector3;let g=1;this._toolbar.rotateStyle==="pov"?(u.copy(this.target).sub(this._activeCamera.position).normalize(),u.dot(h)>0?g=u.dot(h)>.999?-1:1:g=u.dot(h)<-.999?1:-1,this.target.copy(h.multiplyScalar(g).multiplyScalar(this.target.distanceTo(this._activeCamera.position)).add(this._activeCamera.position))):(u.copy(this._activeCamera.position).sub(this.target).normalize(),g=u.dot(h)>.999?-1:1,this._activeCamera.position.copy(h.multiplyScalar(g).multiplyScalar(r).add(this._toolbar.defaultTarget)),this.target.copy(this._toolbar.defaultTarget)),this._activeCamera.lookAt(this.target),this._setDefaultZoom(),this._light.refresh(this._activeCamera.position,this._activeCamera.up,this.target,this.boundingSphere.radius),this._setCameraFar(),this._activeCamera.updateMatrixWorld(!0),this._broadcastDefaultViewEvent()}_rotateCamera(){const n=new d.Vector3,r=new d.Quaternion;n.set(this._moveCurrent.x-this._movePrevious.x,this._moveCurrent.y-this._movePrevious.y,0);let h=n.length();if(h){const u=new d.Vector3,g=new d.Vector3,p=new d.Vector3,y=new d.Vector3,x=new d.Vector3;switch(this._toolbar.rotateStyle){case"cursor":x.copy(this._clickTarget);break;case"orbit":x.copy(this.boundingSphere.center);break;case"fulcrum":x.copy(this._fulcrum);break;default:x.copy(this.target)}if(g.subVectors(this._activeCamera.position,x).normalize(),p.copy(this._activeCamera.up).normalize(),y.crossVectors(p,g).normalize(),p.setLength(this._moveCurrent.y-this._movePrevious.y),y.setLength(this._moveCurrent.x-this._movePrevious.x),n.copy(p.add(y)),this._toolbar.rotateStyle==="roll")p.set(1,0,0),y.set(this._moveCurrent.x-this._movePrevious.x,this._moveCurrent.y-this._movePrevious.y,0).normalize(),u.crossVectors(p,y).normalize(),p.set(0,0,1),u.dot(p)>0&&(h*=-1),h*=.5,u.copy(g);else{const w=new d.Vector3;w.subVectors(this._activeCamera.position,x),u.crossVectors(n,w).normalize()}if(h*=this._toolbar.rotateSpeed,this._toolbar.rotateStyle==="pov"&&(h=-h/2),r.setFromAxisAngle(u,h),this._toolbar.rotateStyle==="pov"){const w=Math.abs(g.dot(this._activeCamera.up));g.applyQuaternion(r);const M=Math.abs(g.dot(this._activeCamera.up));(M<.95||w>M)&&(this._eye.applyQuaternion(r),this.target.subVectors(this._activeCamera.position,this._eye),this._activeCamera.up.set(0,0,1))}else if(this._toolbar.rotateStyle==="roll")this._activeCamera.up.applyQuaternion(r);else{this._eye.applyQuaternion(r),this._activeCamera.up.applyQuaternion(r);const w=new d.Vector3,M=new d.Vector3;w.subVectors(this._activeCamera.position,x),M.subVectors(this.target,x),w.applyQuaternion(r),M.applyQuaternion(r),this._activeCamera.position.addVectors(x,w),this.target.addVectors(x,M)}this._movePrevious.copy(this._moveCurrent)}}_zoomCamera(){if(this._zoomEnd.distanceToSquared(this._zoomStart)>this.EPS){if(this._toolbar.zoomStyle==="dolly"){const n=(this._zoomEnd.y-this._zoomStart.y)*this._toolbar.dollySpeed,r=this._eye.clone();this._toolbar.dollyStyle==="hover"&&(r.z=0),this._toolbar.dollyStyle==="cursor"?(r.subVectors(this._activeCamera.position,this._mouseTarget).setLength(this._eye.length()),r.multiplyScalar(1.5*n)):r.multiplyScalar(n),this._toolbar.rotateStyle==="target"?n>0?this._activeCamera.position.add(r):this._activeCamera.position.lerp(this.target,Math.abs(1.5*n)):(this.target.add(r),this._activeCamera.position.add(r)),this._toolbar.dollyStyle==="hover"&&this._clampToAltitude()}else{const n=1+(this._zoomEnd.y-this._zoomStart.y)*this._toolbar.zoomSpeed;if(n!==1&&n>0){const r=Math.max(Math.min(this._activeCamera.zoom/n,this._toolbar.zoomLimits.y),this._toolbar.zoomLimits.x);this._toolbar.isZoomStyleCursor()&&this.cameraStyle==="orthographic"&&this._keyPressed===!1&&r!==this._activeCamera.zoom&&(n<1?this._cursorBasedZoom(n):this._toolbar.zoomStyle==="restricted-cursor"&&(this._cursorBasedZoom(n),r<1?(this.target.copy(this._toolbar.defaultTarget),this._activeCamera.position.copy(this._toolbar.defaultPosition)):r<3&&(this.target.lerp(this._toolbar.defaultTarget,Math.pow((3-r)/2,10)),this._activeCamera.position.lerp(this._toolbar.defaultPosition,Math.pow((3-r)/2,10))))),this._activeCamera.zoom=r,this._updateZoomPercent()}}this._scrollTimeout!==null&&this._keyPressed===!1?this._zoomStart.lerp(this._zoomEnd,.5):this._zoomStart.copy(this._zoomEnd)}}_panCamera(){const n=new d.Vector2;if(this._autoPan&&(this._state===this.STATE.PAN||this._state===this.STATE.ANNOTATESNAP&&this._activeCamera.zoom>2)){this._panEnd.set(.5,.5),this._panStart.copy(this._panEnd);const r=new d.Vector2(.05,.05);(this._screenCoordinates.x<0||this._screenCoordinates.x>1||this._screenCoordinates.y<0||this._screenCoordinates.y>1)&&(this._panStart.x=this._screenCoordinates.x,r.x=r.x*Math.abs(this._screenCoordinates.x-.5),this._panStart.y=this._screenCoordinates.y,r.y=r.y*Math.abs(this._screenCoordinates.y-.5)),n.copy(this._panEnd).sub(this._panStart).multiply(r)}else n.copy(this._panEnd).sub(this._panStart);if(n.lengthSq()){const r=this._convertScreenMotionToWorldMotion(n,this._toolbar.panSpeed/this._activeCamera.zoom*(this._toolbar.rotateStyle==="pov"?.5:2));this._activeCamera.position.add(r),this.target.add(r),this._toolbar.rotateStyle==="fulcrum"&&this._fulcrum.add(r),this._toolbar.zoomStyle==="dolly"&&this._toolbar.dollyStyle==="hover"&&this._clampToAltitude(),this._autoPan&&(this._clampToBoundingBox(),this._setInteractionTimeout()),this._panStart.copy(this._panEnd)}}_updateWindowLevel(){if(this._windowLevelEnd.distanceToSquared(this._windowLevelStart)){const n=new d.Vector2;n.copy(this._windowLevelEnd).sub(this._windowLevelStart).multiplyScalar(this._toolbar.windowLevelSpeed),this._windowLevelStart.copy(this._windowLevelEnd),this._latentEventData=n,this._triggerLatentEvent(),this.updateRequested=!0}}_convertScreenMotionToWorldMotion(n,r){const h=new d.Vector3,u=new d.Vector3;return this.cameraStyle==="orthographic"?(n.x*=(this._activeCamera.right-this._activeCamera.left)/this._activeCamera.zoom,n.y*=(this._activeCamera.top-this._activeCamera.bottom)/this._activeCamera.zoom,h.setFromMatrixColumn(this._activeCamera.matrix,0),h.multiplyScalar(-n.x),u.setFromMatrixColumn(this._activeCamera.matrix,1),u.multiplyScalar(n.y),h.add(u)):(n.multiplyScalar(this._eye.length()*r),h.copy(this._eye).cross(this._activeCamera.up).setLength(n.x),h.add(u.copy(this._activeCamera.up).setLength(n.y))),h}_clampToBoundingBox(){const n=new d.Vector3;this.boundingBox.clampPoint(this.target,n),n.sub(this.target),n.lengthSq()>0&&(this._activeCamera.position.add(n),this.target.add(n))}_clampToAltitude(){const n=this._toolbar.altitude==="auto"?this.boundingBox.min.z:this._toolbar.altitude;if(this._activeCamera.position.z<n){const r=n-this._activeCamera.position.z;this._activeCamera.position.z+=r,this.target.z+=r}}_cursorBasedZoom(n){const r=new d.Vector3,h=this._mouseTarget.clone().sub(this.target),u=h.clone();h.projectOnVector(this._eye),u.sub(h).add(this.target),r.lerpVectors(this.target,u,1-n).sub(this.target),this.target.add(r),this._activeCamera.position.add(r)}_resetCameraFOV(){const n=this.screen.height,r=this.screen.width/this.screen.height,h=this.boundingSphere.radius===0?n:this.boundingSphere.radius,u=this.boundingSphere.distanceToPoint(this._activeCamera.position)+h;u>1.5*h?this._activeCamera.fov=2*Math.asin(h/u)*(180/Math.PI):this._activeCamera.fov=45,this._activeCamera.aspect=r}_updateAnnotation(){const n=new d.Vector3(this._annotationEnd.x-this._annotationStart.x,this._annotationEnd.y-this._annotationStart.y,0);n.lengthSq()&&(this._state===this.STATE.ANNOTATESNAP||this._state===this.STATE.CROSSHAIR?this._snapToLocation(n):this._state===this.STATE.SCRIBBLE?this._doScribble(n):this._state===this.STATE.PAINT?this._doPaint(n):this._moveAnnotation(n),this._annotationStart.copy(this._annotationEnd),this._annotations.updateRequested=!0)}_snapToLocation(n){const r=this._eye.clone().normalize(),h=this._convertScreenMotionToWorldMotion(n,1);if(this._ctrlPressed||this._pinchGesture||this._state===this.STATE.CROSSHAIR)this._annotations.applyTransformation(n,this.boundingBox,this._shiftPressed,this._ctrlPressed||this._pinchGesture,this._activeCamera,r,h);else if(this._lastDepth>0&&this._lastDepth<.999999){const u=new d.Vector3;this._depthToWorld(this._lastDepth,this._lastNonZeroDepthScreenCoords,u),this.picking&&this._sendPickEvent(u),this._annotations.applyTransformation(u,this.boundingBox,this._shiftPressed,this._ctrlPressed,this._activeCamera,r,h)}else if(this._annotations.clampToSceneLimits){const u=new d.Vector3;this._depthToWorld(0,this._screenCoordinates,u),this.picking&&this._sendPickEvent(u),this._annotations.applyTransformation(u,this.boundingBox,this._shiftPressed,this._ctrlPressed,this._activeCamera,r,h)}else return;this._triggerLatentEvent()}_doScribble(n){if(this._lastDepth>0&&this._lastDepth<.999999){const r=new d.Vector3;this._depthToWorld(this._lastDepth,this._lastNonZeroDepthScreenCoords,r),this._annotations.draw(r,n,"freehand",this.boundingBox,this._shiftPressed)}}_doPaint(n){this._annotations.draw(null,this._annotationEnd,"paint",this.boundingBox,!1)}_moveAnnotation(n){const r=new d.Vector3,h=this._eye.clone().normalize();if(this._state===this.STATE.PLANEROTATE||this._altPressed===!0&&this._state===this.STATE.CUBOID){let u=n.length();const g=new d.Vector3,p=new d.Quaternion,y=new d.Vector3;r.copy(this._activeCamera.up).normalize(),y.crossVectors(r,h).normalize(),r.setLength(n.y),y.setLength(-n.x),n.copy(r.add(y)),g.crossVectors(n,this._eye).normalize(),u*=this._toolbar.rotateSpeed,p.setFromAxisAngle(g,u),this._annotations.applyQuaternion(p,this._shiftPressed),this._triggerLatentEvent(),this._state===this.STATE.PLANEROTATE?this.updateRequested=!0:this._fillWithColor===!0&&this._broadcastColorFillEvent(!0)}else{const u=this._convertScreenMotionToWorldMotion(n,1);this._annotations.applyTransformation(n,this.boundingBox,this._shiftPressed,this._ctrlPressed,this._activeCamera,h,u,this._annotationStart,this._annotationEnd),this._triggerLatentEvent(),this._state===this.STATE.CROPTRANSLATE||this._state===this.STATE.PLANETRANSLATE?this.updateRequested=!0:this._fillWithColor===!0&&this._broadcastColorFillEvent(!0)}}_onPointerDown(n){if(this._contextMenuVisible=!1,this._toolbar.onPointerDown(),this._enabled===!1){this._hasContext||this.dispatchEvent({type:"restoreContext",message:{}});return}if(this._pointerEventCache.push(n),this._pinchGesture=this._pointerEventCache.length===2,this._pointerEventCache.length===1&&(this._clickTimeout!==null?(clearTimeout(this._clickTimeout),this._clickTimeout=null,this._doubleClick=!0):this._clickTimeout=setTimeout(this._endDoubleClick.bind(this),this._afterInteractionEventLatency)),this._motionInitiated=!1,this._updateMouseLocation(n),(this._annotations.depthRequired===!0||this._toolbar.isStateDepthable())&&this._broadcastDepthRequestEvent(13),this._state===this.STATE.NONE)if(this._toolbar.state===this.STATE.ANIMATE&&this._toolbar.interruptAnimation(),this._contextMenuVisible||this._annotations.onPointerMove(this._screenCoordinates.clone(),this._activeCamera,this._toolbar.isStateHittable(),this._toolbar.state===this.STATE.ANNOTATE,this.boundingSphere.radius,this.screen),this._toolbar.isStateHittable()&&n.button===0&&this._annotations.hitObject())this._state=this._annotations.getState(this._screenCoordinates,this._activeCamera);else if(this._toolbar.state===this.STATE.NONE)switch(n.button){case 0:this._toolbar.enableDefault&&(this._toolbar.defaultLeftClick==="auto"?this._toolbar.enablePan&&n.ctrlKey?this._state=this.STATE.PAN:this._toolbar.enableRotate?this._state=this.STATE.ROTATE:this._toolbar.enablePan?this._state=this.STATE.PAN:this._toolbar.enableZoom?this._state=this.STATE.ZOOM:this._state=this.STATE.NONE:this._toolbar.defaultLeftClick==="pan"&&this._toolbar.enablePan?this._state=this.STATE.PAN:this._state=this.STATE.NONE);break;case 1:this._toolbar.enableDefault&&(this._toolbar.defaultMiddleClick==="auto"&&this._toolbar.enableZoom?this._state=this.STATE.ZOOM:this._toolbar.defaultMiddleClick==="rotate"&&this._toolbar.enableRotate?this._state=this.STATE.ROTATE:this._toolbar.defaultMiddleClick==="pan"&&this._toolbar.enablePan?this._state=this.STATE.PAN:this._state=this.STATE.NONE);break;default:this._state=this.STATE.NONE}else this._state=this._toolbar.state;switch(this._state){case this.STATE.ROTATE:if(!this._toolbar.enableRotate)return;this._pointerEventCache.length===1?(this._initializeRotate(n),this._toolbar.rotateStyle==="cursor"&&(this._broadcastDepthRequestEvent(25),this._setClickLocation(this._screenCoordinates))):this._pointerEventCache.length===2&&this._initializePinch();break;case this.STATE.ZOOM:if(!this._toolbar.enableZoom)return;if(this.cameraStyle==="orthographic"&&this._toolbar.enablePan&&this._toolbar.isZoomStyleCursor()&&!this._shiftPressed&&!this._pinchGesture){const r=new d.Vector3;this._depthToWorld(.001,this._screenCoordinates,r);const h=this._screenCoordinates.clone();h.y-=1;const u=new d.Vector3;this._depthToWorld(.001,h,u),u.sub(r).normalize(),this._annotations.updateProjection(u),this._annotations.draw(r,this._screenCoordinates,"zoom",this.boundingBox,!1),this._rectangleGesture=!0;return}else this._pointerEventCache.length===1?this._initializeZoom():this._pointerEventCache.length===2&&(this._rectangleGesture=!1,this._globalData.uniforms.u_screenRectangle.value.set(0,0,1,1),this._annotations.stopDrawing(),this._initializePinch());break;case this.STATE.PAN:if(!this._toolbar.enablePan)return;this._toolbar.panStyle==="nudge"?this._autoPan=!0:(this._autoPan=!1,this._pointerEventCache.length===1?this._initializePan():this._pointerEventCache.length===2&&this._initializePinch());break;case this.STATE.CUBOID:this._onAnnotationClick(this._screenCoordinates),this._updateColorFill(),this._fillWithColor===!0&&(this._interactionStarted=!0);return;case this.STATE.CROSSHAIR:this._onAnnotationClick(this._screenCoordinates),this._snapCrosshairToMouse(this._screenCoordinates);return;case this.STATE.ANNOTATESNAP:case this.STATE.ANNOTATEROTATE:this._doubleClick&&this._annotations.onDoubleClick(),this._autoPan=!0,this._onAnnotationClick(this._screenCoordinates);return;case this.STATE.PLANETRANSLATE:case this.STATE.PLANEROTATE:case this.STATE.CROPTRANSLATE:this._onAnnotationClick(this._screenCoordinates);break;case this.STATE.SCISSORS:n.button===2&&(this._blockContextMenu=!0,this._annotations.stopDrawing(),this._state=this.STATE.NONE,this._toolbar.clearState());return;case this.STATE.ANNOTATE:if(this._annotations.isNclickAnnotation(this._toolbar.annotateStyle)&&(this._doubleClick||n.button===2||this._annotations.isClickOnFirstPoint(this._screenCoordinates.clone(),this._activeCamera,this.boundingSphere.radius,this.screen))){n.button===2&&(this._blockContextMenu=!0),this._cleanUpAnnotations(!0,this._getClickType(n));return}if((n.button===0||this._toolbar.annotateStyle==="angle"&&n.button===2)&&this._lastNonZeroDepth>0){this.picking&&this._sendPickEvent(this._hitTarget);const r=!this._annotations.drawing;switch(this._annotations.draw(this._hitTarget,this._screenCoordinates,this._toolbar.annotateStyle,this.boundingBox,!1),this._toolbar.annotateStyle){case"rectangle":this._state=this.STATE.RECTANGLE;break;case"freehand":this._state=this.STATE.SCRIBBLE;break;case"paint":this._state=this.STATE.PAINT,this._annotationStart.copy(this._screenCoordinates),this._annotationEnd.copy(this._annotationStart),this.dispatchEvent({type:"paintBrushStarted",activated:!0});return;default:this._state=this.STATE.ANNOTATESNAP}this._onAnnotationClick(this._screenCoordinates),r&&this._broadcastClickedAnnotationEvent(),this._autoPan=!0}return;case this.STATE.WINDOWLEVEL:this._windowLevelStart.copy(this._screenCoordinates),this._windowLevelEnd.copy(this._windowLevelStart),this._startLatentEvents();return;default:return}this._interactionStarted=!0}_onPointerMove(n){if((!this._enabled||this._contextMenuVisible)&&!(this._pointerEventCache.length>0))return;if(n.preventDefault(),this._pointerEventCache.length>1){const h=this._pointerEventCache.findIndex(u=>u.pointerId===n.pointerId);if(this._pointerEventCache[h]=n,h===1)this._getMouseOnScreen((this._pointerEventCache[0].pageX+this._pointerEventCache[1].pageX)/2,(this._pointerEventCache[0].pageY+this._pointerEventCache[1].pageY)/2),this._depthToWorld(1,this._screenCoordinates,this._mouseTarget);else return}else this._getMouseOnScreen(n.pageX,n.pageY);(this._annotations.depthRequired===!0||this._toolbar.isStateDepthable())&&this._broadcastDepthRequestEvent(13),this._toolbar.show(),this._toolbar.isStateAnnotatable()?this._toolbar.annotateStyle==="paint"?this._annotations.showPaintBrush():this._lastNonZeroDepth>0&&(this._toolbar.annotateStyle==="cuboid"?(this._annotations.showCuboid(this._hitTarget,this.boundingSphere.radius),this._fillWithColor===!0&&this._broadcastColorFillEvent(!1)):this._toolbar.annotateStyle!=="rectangle"&&this._toolbar.annotateStyle!=="circle"&&this._annotations.showMarker(this._hitTarget)):this._annotations.hideDrawingTools(),this._toolbar.objectInfo&&(this._annotations.updateRequested=!0);const r=new d.Vector3;switch(this._state){case this.STATE.NONE:this._contextMenuVisible||this._annotations.onPointerMove(this._screenCoordinates.clone(),this._activeCamera,this._toolbar.isStateHittable(),this._toolbar.state===this.STATE.ANNOTATE,this.boundingSphere.radius,this.screen),this._updatePointer(this._annotations.hitObject()),this._toolbar.objectInfo&&(this._serverSidePickRequested=!0);return;case this.STATE.SCISSORS:this._depthToWorld(.001,this._screenCoordinates,r),this._annotations.followDrawing(r,this._screenCoordinates,this.boundingBox,this._shiftPressed);return;case this.STATE.ANNOTATE:this._annotations.isMulticlickAnnotation(this._toolbar.annotateStyle)&&this._lastNonZeroDepth>0&&(this._annotations.followDrawing(this._hitTarget,this._screenCoordinates,this.boundingBox,this._shiftPressed),this._triggerLatentEvent());return;case this.STATE.ZOOM:if(!this._toolbar.enableZoom)return;if(this._rectangleGesture){this._depthToWorld(.001,this._screenCoordinates,r),this._annotations.followDrawing(r,this._screenCoordinates,this.boundingBox,!1);const h=this._annotations.getZoomBox();(h.width>.02&&h.height>.02||!(this._globalData.uniforms.u_screenRectangle.value.x===0&&this._globalData.uniforms.u_screenRectangle.value.y===0&&this._globalData.uniforms.u_screenRectangle.value.z===1&&this._globalData.uniforms.u_screenRectangle.value.w===1))&&(this._globalData.uniforms.u_screenRectangle.value.x=h.x-h.z/2,this._globalData.uniforms.u_screenRectangle.value.y=1-(h.y+h.w/2),this._globalData.uniforms.u_screenRectangle.value.z=h.x+h.z/2,this._globalData.uniforms.u_screenRectangle.value.w=1-(h.y-h.w/2));return}break;case this.STATE.RECTANGLE:this._lastNonZeroDepth>0&&this._annotations.followDrawing(this._hitTarget,this._screenCoordinates,this.boundingBox,!1);return;case this.STATE.SELECT:return}switch(!this._motionInitiated&&(n.pageX!==this._mouseLocation.x||n.pageY!==this._mouseLocation.y)&&(this._motionInitiated=!0,this._state===this.STATE.ANNOTATESNAP||this._state===this.STATE.SCRIBBLE||this._state===this.STATE.CROSSHAIR||this._state===this.STATE.PAINT||this._state===this.STATE.CUBOID&&this._fillWithColor===!1||this._broadcastStartEvent()),this._state){case this.STATE.ROTATE:if(!this._toolbar.enableRotate)return;this._pointerEventCache.length>1?this._pinchGestures():this._getMouseOnCircle(n.pageX,n.pageY);break;case this.STATE.ZOOM:if(!this._toolbar.enableZoom)return;this._pointerEventCache.length>1?this._pinchGestures():this._zoomEnd.copy(this._screenCoordinates);break;case this.STATE.PAN:if(!this._toolbar.enablePan)return;this._autoPan||(this._pointerEventCache.length>1?this._pinchGestures():this._panEnd.copy(this._screenCoordinates));break;case this.STATE.PLANETRANSLATE:case this.STATE.PLANEROTATE:case this.STATE.ANNOTATESNAP:case this.STATE.CROSSHAIR:case this.STATE.SCRIBBLE:case this.STATE.CROPTRANSLATE:case this.STATE.CUBOID:case this.STATE.PAINT:this._annotationEnd.copy(this._screenCoordinates);return;case this.STATE.WINDOWLEVEL:this._windowLevelEnd.copy(this._screenCoordinates);return;default:return}this._triggerLatentEvent()}_onPointerLeave(n){this._enabled!==!1&&(n.preventDefault(),this._toolbar.onPointerLeave(),this._annotations.onPointerLeave(this._contextMenuVisible),this._serverSidePickRequested=!1,this._fillWithColor===!0&&(this._fillWithColor=!1,this.dispatchEvent({type:"colorBoxUpdated",message:this._fillWithColor}),this.updateRequested=!0))}_onKeyRelease(n){switch(this._onKeyPressAndRelease(n),n.key){case"Escape":this._state===this.STATE.SCISSORS?this._annotations.cleanUpScissors():this._annotations.isMulticlickAnnotation(this._toolbar.annotateStyle)&&(this._state=this.STATE.NONE,this._annotations.continueAnnotating||this._toolbar.clearState(),this._clearDepth(),this._annotations.abortDrawing());break;case"Backspace":(this._state===this.STATE.SCISSORS||this._annotations.isNclickAnnotation(this._toolbar.annotateStyle))&&this._annotations.undoDrawing();break}}_onKeyPress(n){switch(this._onKeyPressAndRelease(n),n.key){case"+":case"=":this._onKeyZoom(.025);break;case"-":case"_":this._onKeyZoom(-.025);break;case"ArrowRight":this._onKeyArrow(new d.Vector2(-.05,0));break;case"ArrowLeft":this._onKeyArrow(new d.Vector2(.05,0));break;case"ArrowUp":this._onKeyArrow(new d.Vector2(0,.05));break;case"ArrowDown":this._onKeyArrow(new d.Vector2(0,-.05));break}this._keyPressed=!0}_onKeyPressAndRelease(n){if(n.shiftKey!==this._shiftPressed)switch(this._shiftPressed=n.shiftKey,this._state){case this.STATE.PLANEROTATE:case this.STATE.CUBOID:{const r=new d.Quaternion;r.identity(),this._annotations.applyQuaternion(r,this._shiftPressed),this._triggerLatentEvent(),this._state===this.STATE.PLANEROTATE?this.updateRequested=!0:this._fillWithColor===!0&&this._broadcastColorFillEvent(!0);break}case this.STATE.ANNOTATE:this._annotations.isMulticlickAnnotation(this._toolbar.annotateStyle)&&this._lastNonZeroDepth>0&&(this._getMouseOnScreen(n.pageX,n.pageY),this._annotations.followDrawing(this._hitTarget,this._screenCoordinates,this.boundingBox,this._shiftPressed));break}switch(n.ctrlKey!==this._ctrlPressed&&(this._ctrlPressed=n.ctrlKey),n.altKey!==this._altPressed&&(this._altPressed=n.altKey),n.key){case"a":case"A":this._aPressed=n.type==="keydown";break;case"x":case"X":this._xPressed=n.type==="keydown";break;case"y":case"Y":this._yPressed=n.type==="keydown";break;case"z":case"Z":this._zPressed=n.type==="keydown";break}}_onPointerEnter(n){n.preventDefault(),this._getMouseOnScreen(n.pageX,n.pageY),this._updateColorFill(),this._annotations.onPointerEnter(this._contextMenuVisible)}_onPointerUp(n){if(this._enabled===!1&&!(this._pointerEventCache.length>0)){this._state=this.STATE.NONE,this._pointerEventCache=[],this._autoPan=!1,this._doubleClick=!1;return}if(n.preventDefault(),this._removeEvent(n),this._pinchGesture=this._pointerEventCache.length===2,this._pointerEventCache.length>0){this._updateMouseLocation(this._pointerEventCache[0]),this._pointerEventCache.length===1?(this._depthToWorld(1,this._screenCoordinates,this._mouseTarget),this._initializePan(),this._initializeZoom(),this._initializeRotate(this._pointerEventCache[0])):this._pointerEventCache.length===2&&(this._state===this.STATE.PAN||this._state===this.STATE.ZOOM||this._state===this.STATE.ROTATE)&&this._initializePinch();return}this._updateMouseLocation(n);const r=this._state;this._state=this.STATE.NONE;let h=!1,u=!1;const g=this._getClickType(n);switch(this._doubleClick=!1,r){case this.STATE.SCISSORS:if(g==="double")this._annotations.stopDrawing(),this._toolbar.clearState();else if(this._state=this.STATE.SCISSORS,n.button===0){const p=new d.Vector3;this._depthToWorld(.001,this._screenCoordinates,p),this._annotations.draw(p,this._screenCoordinates,this._toolbar.annotateStyle==="scissors"?"scissors":"",this.boundingBox,this._shiftPressed)}return;case this.STATE.CUBOID:case this.STATE.ANNOTATEROTATE:case this.STATE.SCRIBBLE:case this.STATE.CROSSHAIR:case this.STATE.ANNOTATESNAP:case this.STATE.RECTANGLE:if(this._autoPan=!1,r===this.STATE.CUBOID&&(this._fillWithColor===!0&&(u=!0),this._updateColorFill()),this._annotationStart.copy(this._screenCoordinates),this._annotationEnd.copy(this._screenCoordinates),h=!0,this._annotations.drawing)if(this._annotations.clickCounter>=this._toolbar.maxAllowedClicks){this._cleanUpAnnotations(!0,g);return}else{this._state=this._toolbar.state,this._broadcastClickedAnnotationEvent(),this._annotations.onPointerUp(!0);return}if(u)break;this._broadcastEndEvent(!0,!1,g),n.button!==2&&this._annotations.onPointerUp(!1),this._motionInitiated=!1;return;case this.STATE.PLANETRANSLATE:case this.STATE.PLANEROTATE:case this.STATE.CROPTRANSLATE:this._annotationStart.copy(this._screenCoordinates),this._annotationEnd.copy(this._screenCoordinates),h=!0;break;case this.STATE.ZOOM:this._globalData.uniforms.u_screenRectangle.value.set(0,0,1,1),this._annotations.stopDrawing(),this._rectangleGesture=!1;break;case this.STATE.PAN:this._autoPan=!1;break;case this.STATE.WINDOWLEVEL:this._interactionStarted=!1,this._motionInitiated=!1,this.dispatchEvent({type:"interactionEnded",name:g==="double"?"DisplayRangeDouble":"DisplayRangeChanged"});return;case this.STATE.SELECT:this._selectObject("ObjectSelected",g);return;case this.STATE.PAINT:this.dispatchEvent({type:"paintBrushFinished",name:"PaintBrushFinished",message:this._annotations.cleanUpPaintBrush()});return}if(this._interactionStarted&&(this._motionInitiated||h))this._broadcastEndEvent(h,this._motionInitiated,g),this._motionInitiated=!1;else if(this._interactionStarted=!1,n.type==="pointerup"&&n.button!==2)if(r===this.STATE.ZOOM){const p=this._annotations.getZoomBox();if(this.cameraStyle==="orthographic"&&this._toolbar.enablePan&&!this._shiftPressed&&this._toolbar.isZoomStyleCursor()&&p.width>.02&&p.height>.02){const y=Math.max(p.width,p.height),x=new d.Vector2(p.x,p.y);this._activeCamera.zoom/=y,x.subScalar(.5).divideScalar(y).addScalar(.5),this._panStart.copy(x),this._panEnd.set(.5,.5)}else this._toolbar.isStyleCursor()&&this._depthToWorld(1,this._screenCoordinates,this._mouseTarget),this._zoomStart.set(0,0),this._zoomEnd.set(0,-.1);this._broadcastEndEvent(h,!0,g)}else this.dispatchEvent({type:"clickReleased",message:{}});n.button!==2&&this._annotations.onPointerUp(!0)}_onWheel(n){if(this._enabled!==!1){if(this._contextMenuVisible=!1,n.preventDefault(),this._toolbar.state===this.STATE.ANNOTATE&&this._toolbar.annotateStyle==="cuboid"&&(this._aPressed||this._xPressed||this._yPressed||this._zPressed)){this._annotations.scrollCuboid(this.boundingSphere.radius,n.deltaY,this._xPressed||this._aPressed,this._yPressed||this._aPressed,this._zPressed||this._aPressed),this._fillWithColor===!0?this._broadcastColorFillEvent(!1):this._annotations.updateRequested=!0;return}(this._toolbar.state===this.STATE.ZOOM||this._toolbar.enableDefault&&this._toolbar.defaultScroll==="auto"&&this._toolbar.enableZoom&&this._toolbar.isStateZoomable())&&(this._interactionStarted===!1?(this._toolbar.rotateStyle==="fulcrum"&&(this._broadcastDepthRequestEvent(25),this._setFulcrumLocation(this._screenCoordinates)),this._broadcastStartEvent()):this._triggerLatentEvent(),this._zoomStart.y-=n.deltaY*25e-5*(n.ctrlKey===!0?10:1),this._toolbar.isStyleCursor()&&(this._getMouseOnScreen(n.pageX,n.pageY),this._depthToWorld(1,this._screenCoordinates,this._mouseTarget)),this._toolbar.objectInfo&&(this._serverSidePickRequested=!0,this._annotations.updateRequested=!0),this._setInteractionTimeout())}}_setInteractionTimeout(){window.clearTimeout(this._scrollTimeout),this._scrollTimeout=window.setTimeout(this._endWheel.bind(this),this._afterInteractionEventLatency)}_endWheel(){this._scrollTimeout=null,this._state===this.STATE.NONE?this._broadcastEndEvent(!1,!0,"scroll"):this.dispatchEvent({type:"interactionEnded",name:"CameraMoved"}),this._toolbar.objectInfo&&(this._serverSidePickRequested=!1,this._broadcastDepthRequestEvent(13),this._selectObject("ObjectInfoUpdated","none"))}_endDoubleClick(){this._clickTimeout=null}_onContextMenu(n){if(this._blockContextMenu){this._blockContextMenu=!1;return}n.preventDefault(),this._onPointerMove(n);const r=-1;if(this._annotations.isMouseOnObject()){const h=this._annotations.showContextMenu(n);if(h===null)return;this._contextMenuVisible=!0,this.dispatchEvent(h)}else this.dispatchEvent({type:"contextMenuClicked",message:{Position:[n.pageX,n.pageY],ID:r}}),this._toolbar.objectInfo&&(this._contextMenuVisible=!0,this._serverSidePickRequested=!1)}_removeEvent(n){const r=this._pointerEventCache.findIndex(h=>h.pointerId===n.pointerId);this._pointerEventCache.splice(r,1)}_pinchGestures(){if(this._toolbar.enableZoom){const n=Math.sqrt(Math.pow((this._pointerEventCache[0].pageX-this._pointerEventCache[1].pageX)/this.screen.width,2)+Math.pow((this._pointerEventCache[0].pageY-this._pointerEventCache[1].pageY)/this.screen.height,2));this._zoomEnd.set(0,-n)}this._toolbar.enablePan&&this._panEnd.copy(this._screenCoordinates)}_initializePinch(){this._pinchGestures(),this._zoomStart.copy(this._zoomEnd),this._panStart.copy(this._panEnd)}_initializeZoom(){this._toolbar.isStyleCursor()&&this._depthToWorld(1,this._screenCoordinates,this._mouseTarget),this._toolbar.rotateStyle==="fulcrum"&&(this._broadcastDepthRequestEvent(25),this._setFulcrumLocation(this._screenCoordinates)),this._zoomStart.copy(this._screenCoordinates),this._zoomEnd.copy(this._zoomStart)}_initializePan(){this._panStart.copy(this._screenCoordinates),this._panEnd.copy(this._panStart)}_initializeRotate(n){this._getMouseOnCircle(n.pageX,n.pageY),this._movePrevious.copy(this._moveCurrent)}_getMouseOnScreen(n,r){this._screenCoordinates.set((n-this.screen.left)/this.screen.width,(r-this.screen.top)/this.screen.height),this._globalData.uniforms.u_currentPosition.value.set(this._screenCoordinates.x,1-this._screenCoordinates.y)}_getMouseOnCircle(n,r){this._moveCurrent.set((n-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-r))/this.screen.width)}_updateMouseLocation(n){this._pinchGesture?(this._mouseLocation.set((this._pointerEventCache[0].pageX+this._pointerEventCache[1].pageX)/2,(this._pointerEventCache[0].pageY+this._pointerEventCache[1].pageY)/2),this._getMouseOnScreen((this._pointerEventCache[0].pageX+this._pointerEventCache[1].pageX)/2,(this._pointerEventCache[0].pageY+this._pointerEventCache[1].pageY)/2)):(this._mouseLocation.set(n.pageX,n.pageY),this._getMouseOnScreen(n.pageX,n.pageY))}_sendLazyLoadingEvent(){this.lazyLoadingRequested&&Date.now()>this._lazyLoadingTimestamp+this._lazyLoadingEventLatency&&(this._lazyLoadingTimestamp=Date.now(),this.lazyLoadingRequested=!1,this.dispatchEvent(this._lazyLoadingEvent))}_startLatentEvents(){this._interactionTimestamp=Date.now(),this._latentEventRequested=!1,this._latentEventsEnabled=!0}_sendLatentEvent(){if(this._latentEventRequested){let n=!1;switch(Date.now()>this._interactionTimestamp+this._duringInteractionEventLatency&&(this._interactionTimestamp=Date.now(),this._latentEventRequested=!1,n=!0),this._state){case this.STATE.NONE:case this.STATE.ROTATE:case this.STATE.ZOOM:case this.STATE.PAN:this.dispatchEvent({type:"interactionUpdating",name:"CameraMoving",notifyUser:n});break;case this.STATE.PLANEROTATE:case this.STATE.PLANETRANSLATE:this.dispatchEvent(this._annotations.getPlaneChangeEventData(n));break;case this.STATE.CROPTRANSLATE:this.dispatchEvent(this._annotations.getCropChangeEventData(n));break;case this.STATE.WINDOWLEVEL:this.dispatchEvent({type:"interactionUpdating",name:"DisplayRangeChanging",notifyUser:n,data:this._latentEventData});break;case this.STATE.CROSSHAIR:case this.STATE.CUBOID:case this.STATE.SCRIBBLE:this.dispatchEvent(this._annotations.getAnnotationMovingEventData(n));break;case this.STATE.ANNOTATESNAP:window.clearTimeout(this._annotationTimeout),this._annotationTimeout=window.setTimeout(this._broadcastDelayedAnnotationEvent.bind(this),2*this._duringInteractionEventLatency),this.dispatchEvent(this._annotations.getAnnotationMovingEventData(n));break;case this.STATE.ANNOTATE:this._annotations.isMulticlickAnnotation(this._toolbar.annotateStyle)&&(window.clearTimeout(this._annotationTimeout),this._annotationTimeout=window.setTimeout(this._broadcastDelayedAnnotationEvent.bind(this),2*this._duringInteractionEventLatency),this.dispatchEvent(this._annotations.getAnnotationMovingEventData(n)));break}}}_triggerLatentEvent(){this._latentEventRequested=!0}_broadcastDelayedAnnotationEvent(){this._annotationTimeout=null;const n=this._annotations.getAnnotationMovingEventData(!0);n.name="AnnotationMovingDelayed",this.dispatchEvent(n)}_broadcastClickedAnnotationEvent(){window.clearTimeout(this._annotationTimeout),this._annotationTimeout=null;const n=this._annotations.getAnnotationMovingEventData(!0);n.name="AnnotationMovingClicked",this.dispatchEvent(n)}_broadcastStartEvent(){this._interactionStarted=!0,this._startLatentEvents(),this.dispatchEvent(this._startEvent)}_broadcastEndEvent(n,r,h="none"){this._latentEventsEnabled=!1,this._interactionStarted=!1,n?(window.clearTimeout(this._annotationTimeout),this._annotationTimeout=null,this.dispatchEvent(this._annotations.getInteractionEndedEventData(r,h))):this.dispatchEvent({type:"interactionEnded",name:"CameraMoved",clickType:h})}_broadcastColorFillEvent(n){this.dispatchEvent(this._annotations.getColorFillEventData(n,!1)),this.updateRequested=!0}_broadcastResizeEndEvent(){this._interactionStarted=!1,this.dispatchEvent(this._resizeEndEvent)}_broadcastDepthRequestEvent(n){this.dispatchEvent({type:"depthRequested",message:this._screenCoordinates,windowSize:n})}_broadcastDefaultViewEvent(){this._state===this.STATE.SCISSORS&&this._annotations.cleanUpScissors(),this.dispatchEvent(this._defaultCameraEvent)}_sendServerSidePickEvent(){Date.now()>this._serverSidePickTimestamp+this._lazyLoadingEventLatency&&(this._serverSidePickTimestamp=Date.now(),this._interactionStarted||(this._serverSidePickRequested=!1),this._selectObject("ObjectInfoUpdated","none"))}_sendPickEvent(n,r=!1,h=-1,u="none",g="none"){this.dispatchEvent({type:"pointPickRequested",message:{point:n,sendToServer:r,clickType:g,eventName:u,id:h}})}_selectObject(n,r,h=new d.Vector3){this._lastDepth>0&&this._lastDepth<.999999?(this._depthToWorld(this._lastNonZeroDepth,this._lastNonZeroDepthScreenCoords,h),this._sendPickEvent(h,!0,-1,n,r)):this._interactionStarted||this._sendPickEvent(null,!0,-1,n,r)}_modeChanged(n){this._state===this.STATE.SCISSORS&&(this._state=this.STATE.NONE,this._annotations.cleanUpScissors()),this._annotations.drawing&&!n.cleanupInProgress&&(this._toolbar.state===this.STATE.NONE&&n.priorState===this.STATE.ANNOTATE?this._cleanUpAnnotations(!1):this._toolbar.state===this.STATE.NONE?(this._toolbar.state=this.STATE.ANNOTATE,this._state=this.STATE.ANNOTATE):n.priorState===this.STATE.ANNOTATE?this._toolbar.state===this.STATE.SCISSORS||this._toolbar.state===this.STATE.SELECT?this._cleanUpAnnotations(!1):this._annotations.unfollowDrawing():this._toolbar.state===this.STATE.ANNOTATE&&(this._state=this.STATE.ANNOTATE)),this._updateColorFill(),this._annotations.hideDrawingTools(),this._updatePointer(!1),this.dispatchEvent(n)}_getClickType(n){if(this._doubleClick)return"double";switch(n.button){case 0:return n.shiftKey?"shift":n.ctrlKey?"ctrl":n.altKey?"alt":"left";case 1:return"middle";case 2:return"right"}}_updatePointer(n){switch(this._toolbar.state){case this.STATE.PAN:this._canvas.style.cursor="grab";break;case this.STATE.ZOOM:this._canvas.style.cursor="zoom-in";break;case this.STATE.ROTATE:this._canvas.style.removeProperty("cursor"),this._canvas.className="iptRotateCursor";break;case this.STATE.SCISSORS:this._canvas.style.cursor="crosshair";break;case this.STATE.WINDOWLEVEL:this._canvas.style.cursor="move";break;case this.STATE.ANNOTATE:n===!0?this._canvas.style.cursor="default":this._canvas.style.cursor="crosshair";break;default:this._canvas.style.cursor="default";break}}_updateColorFill(){const n=this._annotations.fillWithColor===!0&&(this._state===this.STATE.CUBOID||this._toolbar.state===this.STATE.ANNOTATE&&this._toolbar.annotateStyle==="cuboid");n!==this._fillWithColor&&(this._fillWithColor=n,this.dispatchEvent({type:"colorBoxUpdated",message:this._fillWithColor}),this._fillWithColor===!1&&(this.updateRequested=!0))}_cleanUpAnnotations(n=!0,r="none"){n&&(this._state=this.STATE.NONE,this._annotations.continueAnnotating||this._toolbar.clearState(!0)),this._broadcastEndEvent(!0,!1,r),this._clearDepth(),this._annotations.stopDrawing(),this._autoPan=!1}_onAnnotationClick(n){this._annotations.onPointerDown(this._shiftPressed,this._ctrlPressed),this._annotationStart.copy(n),this._annotationEnd.copy(this._annotationStart),this._startLatentEvents()}_snapCrosshairToMouse(n){const r=this._annotations.getCrosshairPosition();r.project(this._activeCamera),r.x=(r.x+1)/2,r.y=1-(r.y+1)/2;const h=new d.Vector2;h.x=n.x-r.x,h.y=n.y-r.y;const u=this._convertScreenMotionToWorldMotion(h,1);this._annotations.applyTransformation(h,this.boundingBox,this._shiftPressed,this._ctrlPressed,this._activeCamera,this._eye.clone().normalize(),u),this._triggerLatentEvent(),this._annotations.updateRequested=!0}_broadcastEvent(n){this.dispatchEvent(n)}_onKeyZoom(n){this._ctrlPressed&&(this._toolbar.state===this.STATE.ZOOM||this._toolbar.enableDefault&&this._toolbar.enableZoom&&this._toolbar.isStateZoomable())&&(this._zoomStart.y+=n,this._setInteractionTimeout())}_onKeyArrow(n){let r=!1;this._toolbar.state===this.STATE.NONE?this._toolbar.enableDefault&&(this._toolbar.defaultLeftClick==="auto"?this._toolbar.enableRotate?(n.x=-n.x,n.multiplyScalar(.5),this._moveCurrent.add(n),r=!0):this._toolbar.enablePan&&(this._panEnd.add(n),r=!0):this._toolbar.defaultLeftClick==="pan"&&this._toolbar.enablePan&&(this._panEnd.add(n),r=!0)):this._toolbar.state===this.STATE.ROTATE?(n.x=-n.x,n.multiplyScalar(.5),this._moveCurrent.add(n),r=!0):this._toolbar.state===this.STATE.PAN&&(this._panEnd.add(n),r=!0),r&&this._setInteractionTimeout()}_createElements(n,r){this._container=n,this._canvas=r,this._canvas.setAttribute("tabindex",0),this._xLabel=document.createElement("div"),this._xLabel.className="iptOrientationAxesLabel iptOrientationAxesX",this._container.appendChild(this._xLabel),this._yLabel=document.createElement("div"),this._yLabel.className="iptOrientationAxesLabel iptOrientationAxesY",this._container.appendChild(this._yLabel),this._zLabel=document.createElement("div"),this._zLabel.className="iptOrientationAxesLabel iptOrientationAxesZ",this._container.appendChild(this._zLabel),this._expand=document.createElement("div"),this._expand.className="iptExpandOverflow",this._container.appendChild(this._expand),this._expand.appendChild(document.createElement("div")),this._shrink=document.createElement("div"),this._shrink.className="iptShrinkOverflow",this._container.appendChild(this._shrink),this._shrink.appendChild(document.createElement("div"))}_wireUpEventListeners(){this._pointerDownHandler=this._onPointerDown.bind(this),this._pointerMoveHandler=this._onPointerMove.bind(this),this._pointerUpHandler=this._onPointerUp.bind(this),this._scrollHandler=this._onWheel.bind(this),this._contextMenuHandler=this._onContextMenu.bind(this),this._pointerEnterHandler=this._onPointerEnter.bind(this),this._pointerLeaveHandler=this._onPointerLeave.bind(this),this._keyPressHandler=this._onKeyPress.bind(this),this._keyReleaseHandler=this._onKeyRelease.bind(this),this._overflowHandler=this._onOverflowOrUnderflow.bind(this),this._canvas.addEventListener("pointerdown",this._pointerDownHandler),this._canvas.addEventListener("contextmenu",this._contextMenuHandler),this._container.addEventListener("pointerleave",this._pointerLeaveHandler),this._container.addEventListener("pointerenter",this._pointerEnterHandler),this._container.addEventListener("wheel",this._scrollHandler,{passive:!1}),this._container.ownerDocument.addEventListener("keydown",this._keyPressHandler),this._container.ownerDocument.addEventListener("keyup",this._keyReleaseHandler),this._container.ownerDocument.addEventListener("pointermove",this._pointerMoveHandler),this._container.ownerDocument.addEventListener("pointerup",this._pointerUpHandler),this._expand.addEventListener("scroll",this._overflowHandler),this._shrink.addEventListener("scroll",this._overflowHandler),this._toolbar.addEventListener("homeClicked",this._restoreDefaultCameraView.bind(this)),this._toolbar.addEventListener("axesClicked",this._snapToAxes.bind(this)),this._toolbar.addEventListener("widgetAdded",this._broadcastEvent.bind(this)),this._toolbar.addEventListener("modeChanged",this._modeChanged.bind(this)),this._toolbar.addEventListener("animationFinished",this._broadcastEvent.bind(this)),this._toolbar.addEventListener("messageClosed",this._broadcastEvent.bind(this)),this._annotations.addEventListener("scissorsFinished",this._broadcastEvent.bind(this)),this._annotations.addEventListener("annotationsCopied",this._broadcastEvent.bind(this)),this._annotations.addEventListener("annotationEdited",this._broadcastEvent.bind(this)),this._annotations.addEventListener("paintBrushEnabled",this._broadcastEvent.bind(this)),this._annotations.addEventListener("pointerdown",this._pointerDownHandler),this._light.addEventListener("lightsUpdated",this._broadcastEvent.bind(this))}dispose(){this.iterativeUpdateRequested=!1,this._toolbar.dispose(),this._light.dispose(),this._annotations.dispose(),this._canvas.removeEventListener("pointerdown",this._pointerDownHandler),this._canvas.removeEventListener("contextmenu",this._contextMenuHandler),this._container.removeEventListener("pointerleave",this._pointerLeaveHandler),this._container.removeEventListener("pointerenter",this._pointerEnterHandler),this._container.removeEventListener("wheel",this._scrollHandler,{passive:!1}),this._canvas.ownerDocument.removeEventListener("keydown",this._keyPressHandler),this._container.ownerDocument.removeEventListener("keyup",this._keyReleaseHandler),this._container.ownerDocument.removeEventListener("pointermove",this._pointerMoveHandler),this._container.ownerDocument.removeEventListener("pointerup",this._pointerUpHandler),this._expand.removeEventListener("scroll",this._overflowHandler),this._shrink.removeEventListener("scroll",this._overflowHandler),this._container.innerHTML=""}}},D,V),D.exports=B},329:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class{constructor(_,l,n,r){this._needsUpdate=!1,this._mesh=null,this._texture=null,this._overlayTexture=null,this._alphaTexture=null,this._scene=_,this._depthScene=l,this._depthMesh=null,this._layer=0,this._globalUniforms=r.uniforms,this._localClipping=!1,this._isDataEmpty=!0,this._isOverlayEmpty=!0,this._clippingPlanes=Object.freeze([]),this._numCropBoxes=r.cropBox.length>0?1:0,this._cropExclude=r.cropBoxExclude,this._colorInBox=!1,this._clipIntersection=!1,this._pickable=!0,this._globalData=r,this._constructProperties(n,r),this.add(n,r)}refreshProperties(_){this._setProperties(_)}remove(){this._scene.remove(this._mesh),this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._depthMesh!==null&&(this._depthScene.remove(this._depthMesh),this._depthMesh.material.dispose()),this._texture!==null&&this._texture.dispose(),this._overlayTexture!==null&&this._overlayTexture.dispose(),this._alphaTexture!==null&&this._alphaTexture.dispose()}getMemoryUsed(){return 0}getMemoryRequired(){return this.getMemoryUsed()}unload(_,l){}resetBlocks(){}clearBlockQueue(){}findNextBlock(){return null}quality(_){}globalClippingPlanes(_,l){}clipIntersection(_){}lighting(_){}cameraStyle(_){}updateOnInteraction(_){}crop(_,l){}colorInBox(_){}add(_,l){}packageData(_,l){}updateWindowLevel(_){}getWindowLevel(){return null}pick(_,l,n,r,h,u){if(this._pickable&&this._mesh!==null&&!this._clipped(n)){const g=[];this._mesh.raycast(_,g),g.length>0&&(g.sort((p,y)=>p.distance-y.distance),l.push({point:g[0].point.toArray(),distance:n.distanceTo(g[0].point),object:u,picked:!0,id:g[0].faceIndex}))}}_clipped(_){let l=!1;if(this._numCropBoxes>0)switch(this._globalData.cropType){case"box":{const n=_.clone().clamp(this._globalUniforms.u_cropMin.value,this._globalUniforms.u_cropMax.value);this._cropDefines===""?n.distanceToSquared(_)>0&&(l=!0):n.distanceToSquared(_)===0&&(l=!0);break}case"sphere":{this._cropDefines===""?this._globalUniforms.u_cropCenter.value.distanceToSquared(_)>this._globalUniforms.u_cropRadius.value*this._globalUniforms.u_cropRadius.value&&(l=!0):this._globalUniforms.u_cropCenter.value.distanceToSquared(_)<=this._globalUniforms.u_cropRadius.value*this._globalUniforms.u_cropRadius.value&&(l=!0);break}case"cylinder":{const n=Math.pow(this._globalUniforms.u_cropCenter.value.x-_.x,2)+Math.pow(this._globalUniforms.u_cropCenter.value.y-_.y,2),r=Math.abs(this._globalUniforms.u_cropCenter.value.z-_.z);this._cropDefines===""?(n>this._globalUniforms.u_cropRadius.value*this._globalUniforms.u_cropRadius.value||r>this._globalUniforms.u_cropHeight/2)&&(l=!0):n<=this._globalUniforms.u_cropRadius.value*this._globalUniforms.u_cropRadius.value&&r<=this._globalUniforms.u_cropHeight/2&&(l=!0);break}default:break}if(!l&&this._mesh.material.clippingPlanes.length>0){const n=this._mesh.material.clippingPlanes;if(this._clipIntersection){l=!0;for(let r=0;r<n.length;r++)l=l&&n[r].distanceToPoint(_)<0}else for(let r=0;r<n.length;r++)l=l||n[r].distanceToPoint(_)<0}return l}_constructProperties(){}copyClippingPlaneObjects(_){this._clippingPlanes=_,this._localClipping&&(this._mesh.material.clippingPlanes=this._clippingPlanes,this._depthMesh!==null&&(this._depthMesh.material.clippingPlanes=this._clippingPlanes))}autoMagFilter(_){}_setGlobalUniforms(_){_.u_depthTexture=this._globalUniforms.u_depthTexture,_.u_previousTexture=this._globalUniforms.u_previousTexture,_.u_passNumber=this._globalUniforms.u_passNumber,_.u_viewportSize=this._globalUniforms.u_viewportSize,_.u_cropMin=this._globalUniforms.u_cropMin,_.u_cropMax=this._globalUniforms.u_cropMax,_.u_colorBoxMatrix=this._globalUniforms.u_colorBoxMatrix,_.u_colorBoxColor=this._globalUniforms.u_colorBoxColor,_.u_cropCenter=this._globalUniforms.u_cropCenter,_.u_cropRadius=this._globalUniforms.u_cropRadius,_.u_cropHeight=this._globalUniforms.u_cropHeight}_visible(_){this._mesh.visible=_,this._depthMesh!==null&&(this._depthMesh.visible=_)}_transform(_){const l=this._initTransform(_);this._updateMatrix(l)}getTransform(){return this._mesh.matrix}_initTransform(_){const l=new d.Matrix4;return l.set(_[0][0],_[0][1],_[0][2],_[0][3],_[1][0],_[1][1],_[1][2],_[1][3],_[2][0],_[2][1],_[2][2],_[2][3],_[3][0],_[3][1],_[3][2],_[3][3]),l}_updateMatrix(_){this._mesh.matrix=_,this._depthMesh!==null&&(this._depthMesh.matrix=_)}_initColor(_){return new d.Color(_[0],_[1],_[2])}renderOrder(_){this._mesh.renderOrder=_,this._depthMesh!==null&&(this._depthMesh.renderOrder=_)}_initPlanes(_){const l=new Float32Array(_),n=[];let r=0;if(l.length>0){r=l.length/4;for(let h=0;h<r;h++)n[h]=new d.Plane(new d.Vector3(l[h*4],l[h*4+1],l[h*4+2]),l[h*4+3]);this._clippingPlanes=n}else this._clippingPlanes=Object.freeze([])}_setLayer(_){this._layer=_,this._mesh.layers.set(this._layer),this._depthMesh!==null&&this._depthMesh.layers.set(this._layer)}_setPickable(_){this._pickable=_}_setCropTypeDefines(_){switch(_){case"box":return"#define CROP_TYPE 0";case"sphere":return"#define CROP_TYPE 1";case"cylinder":return"#define CROP_TYPE 2";default:return"#define CROP_TYPE 0"}}}},D,V),D.exports=B},7031:(D,V,f)=>{var R,B;R=[f(3681),f(329),f(9170)],B=f.dj.d(R,function(d,N,_){return class extends N{refreshData(n,r,h){let u=r.NumChannels!==this._numChannels;this._setNumChannels(r.NumChannels);const g=Array.from(r.Size),p=Array.from(r.OverlaySize),y=r.DataModified,x=r.OverlayDataModified,w=r.AlphaDataModified,M=r.UseAlphaData;if(!y&&!x&&!w)return;const T=new Uint8Array(n);this._updateSize(g,p),this._updateGeometry(r,h);let A=0;y&&(this._texture!==null&&this._texture.dispose(),this._isDataEmpty=Math.max(...g)===0,this._isDataEmpty?this._texture=null:(A=this._numChannels*this._size.x*this._size.y*this._size.z,this._initTexture(T.slice(0,A),this._size)),this._mesh.material.uniforms.u_data.value=this._texture),w&&(this._alphaTexture!==null&&this._alphaTexture.dispose(),M?(this._initAlphaTexture(T.slice(A,A+this._size.x*this._size.y*this._size.z),this._size),A+=this._size.x*this._size.y*this._size.z):this._alphaTexture=null,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture),x&&(this._overlayTexture!==null&&this._overlayTexture.dispose(),this._isOverlayEmpty=Math.max(...p)===0,this._isOverlayEmpty?(this._overlayTexture=null,this._includeOverlay&&(this._includeOverlay=!1,this._overlayDefines="",u=!0)):(this._initOverlayTexture(T.slice(A,T.length),this._size),this._includeOverlay||(this._includeOverlay=!0,this._overlayDefines="#define USE_OVERLAY",u=!0)),this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture),u&&this._updateFragmentShader()}add(n,r){this._texture=null,this._overlayTexture=null,this._alphaTexture=null;const h=d.UniformsUtils.clone(this._shader.uniforms);h.u_data.value=this._texture,h.u_overlayData.value=this._overlayTexture,h.u_alphaData.value=this._alphaTexture,this._setGlobalUniforms(h);const u=new d.PlaneGeometry;u.scale(this._size.x,this._size.y,this._size.z),u.translate(this._size.x/2+this._offset.x,this._size.y/2+this._offset.y,this._size.z/2+this._offset.z),this._mesh=new d.Mesh(u,this._initMaterial(h)),this._mesh.visible=n.Visible,this._mesh.matrixAutoUpdate=!1,this._mesh.matrix=this._initTransform(Array.from(n.Transform)),this._mesh.layers.set(this._layer),this._scene.add(this._mesh),this.quality(r.renderingStepSize),this._initDepthMesh(h,u,n),this.globalClippingPlanes(r.globalClippingPlanes,r.globalClipping),this._setProperties(n)}clipIntersection(n){this._clipIntersection=n,this._clipIntersectionDefines=n===!0?"#define CLIP_INTERSECTION":"",this._updateFragmentShader()}_updateSize(n,r){this._priorSize.copy(this._size),Math.max(...n)>0?this._size.set(n[0],n[1],1):Math.max(...r)>0?this._size.set(r[0],r[1],1):this._size.set(1,1,1)}_setNumChannels(n){switch(n){case 1:this._shaderDefines="",this._numChannels=1;break;case 2:this._shaderDefines="",this._numChannels=1;break;case 3:this._shaderDefines="#define RGB_SHADER",this._numChannels=3;break;case 4:this._shaderDefines=["#define RGB_SHADER","#define RGBA_SHADER"].join(`
`),this._numChannels=4;break}}crop(n,r){this._numCropBoxes=r===!0?1:0,this._cropDefines=n===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(this._globalData.cropType),this._updateFragmentShader()}getMemoryUsed(){let n=0;return this._texture!==null&&(n+=this._size.x*this._size.y*this._numChannels/1e6),this._overlayTexture!==null&&(n+=this._size.x*this._size.y/1e6),this._alphaTexture!==null&&(n+=this._size.x*this._size.y/1e6),n}colorInBox(n){this._colorBoxDefines=n===!0?"#define COLOR_BOX":"",this._updateFragmentShader()}globalClippingPlanes(n,r){this._localClipping=!r,r?this._setClippingUniforms(n):this._setClippingUniforms(this._clippingPlanes)}updateWindowLevel(n){const r=Math.max(this._mesh.material.uniforms.u_clim.value.y-this._mesh.material.uniforms.u_clim.value.x+n.x,0),h=this._mesh.material.uniforms.u_clim.value.x+r/2+n.y;this._mesh.material.uniforms.u_clim.value.x=h-r/2,this._mesh.material.uniforms.u_clim.value.y=this._mesh.material.uniforms.u_clim.value.x+r}getWindowLevel(){return this._mesh!==null?this._mesh.material.uniforms.u_clim.value.toArray():null}_setClippingUniforms(n){this._mesh.material.clippingPlanes=n,this._depthMesh.material.clippingPlanes=n}_initDepthMesh(n,r,h){const u=new d.ShaderMaterial({transparent:!0,clipping:!0,uniforms:n,defines:this._shader.defines,premultipliedAlpha:!0,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader(!0),side:d.DoubleSide});this._depthMesh=new d.Mesh(r,u),this._depthMesh.visible=h.Visible,this._depthMesh.matrixAutoUpdate=!1,this._depthMesh.matrix=this._initTransform(Array.from(h.Transform)),this._depthMesh.layers.set(this._layer),this._depthScene.add(this._depthMesh)}localClippingPlanes(n){this._initPlanes(n),this._localClipping&&this._setClippingUniforms(this._clippingPlanes)}copyClippingPlaneObjects(n){this._clippingPlanes=n,this._localClipping&&this._setClippingUniforms(this._clippingPlanes)}setSliceProperties(n){this._setSize(Array.from(n.Size)),this._transform(Array.from(n.Transform)),this._setLayer(n.Layer),this._mesh.material.uniforms.u_sliceAlpha.value=n.Alpha}setPropertiesFromVolume(n){this._clim(n.ColorLimits),this._climOverlay(n.OverlayColorLimits),this._colormap(Array.from(n.Colormap),Array.from(n.Alphamap)),this._overlayTransferFunction(Array.from(n.OverlayColormap),Array.from(n.OverlayAlphamap)),this.localClippingPlanes(n.ClippingPlanes),this._needsUpdate&&(this._needsUpdate=!1,this._updateFragmentShader())}setVolumeInverseMatrix(n){this._mesh.material.uniforms.u_inverseVolumeModelMatrix.value.copy(n)}setVolumeDataTextures(n,r,h,u){this._mesh.material.uniforms.u_data.value=n,this._mesh.material.uniforms.u_overlayData.value=r,this._mesh.material.uniforms.u_alphaData.value=h,this._mesh.material.uniforms.u_volumeSize.value.copy(u)}setVolumeDefines(n,r,h){this._shaderDefines=n,this._overlayDefines=r,this._alphaDataDefines=h,this._volumeDefines="#define SAMPLE_VOLUME",this._updateFragmentShader()}_setSize(n){this._updateSize(n,n),this._updateGeometry(null,0)}_initColormapTexture(n,r){const g=new Uint8Array(1024);for(let y=0;y<256;y++)g[y*4]=n[0][y],g[y*4+1]=n[1][y],g[y*4+2]=n[2][y],g[y*4+3]=r[y];const p=new d.DataTexture(g,1,256,d.RGBAFormat,d.UnsignedByteType);return p.needsUpdate=!0,p}_overlayTransferFunction(n,r){this._mesh.material.uniforms.u_overlayTransferFunction.value!==null&&this._mesh.material.uniforms.u_overlayTransferFunction.value.dispose(),this._mesh.material.uniforms.u_overlayTransferFunction.value=this._initColormapTexture(n,r)}_updateFragmentShader(){this._mesh.material.fragmentShader=this._getFragmentShader(!1),this._mesh.material.needsUpdate=!0,this._depthMesh!==null&&(this._depthMesh.material.fragmentShader=this._getFragmentShader(!0),this._depthMesh.material.needsUpdate=!0)}_getFragmentShader(n){let r=this._replaceConstants(this._shader.fragmentShader,this._numCropBoxes);return r=[this._hardwareDefines,this._shaderDefines,this._overlayDefines,this._alphaDataDefines,this._clipIntersectionDefines,this._volumeDefines,this._cropDefines,this._colorBoxDefines,this._cropTypeDefines,r].join(`
`),n&&(r=["#define DEPTH_SHADER",r].join(`
`)),r}_replaceConstants(n,r){return n.replace(/NUM_CROP_BOXES/g,r)}_initMaterial(n){return new d.ShaderMaterial({transparent:!0,clipping:!0,uniforms:n,defines:this._shader.defines,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader(!1),blending:this._blendOp,depthTest:!0,depthFunc:d.AlwaysDepth,depthWrite:!0,side:d.DoubleSide})}_setProperties(n){this._visible(n.Visible),this._transform(Array.from(n.Transform)),this._setAlphaData(n.UseAlphaData),this._clim(n.ColorLimits),this._climOverlay(n.OverlayColorLimits),this._setPickable(n.Pickable),this._setLayer(n.Layer),this._colormap(Array.from(n.Colormap),Array.from(n.Alphamap)),this._overlayTransferFunction(Array.from(n.OverlayColormap),Array.from(n.OverlayAlphamap)),this.localClippingPlanes(n.ClippingPlanes),this._interpolation(n.Interpolation,n.Mipmaps),this._needsUpdate&&(this._needsUpdate=!1,this._updateFragmentShader())}_initTexture(n,r){switch(this._texture=new d.DataTexture(n,r.x,r.y),this._texture.type=d.UnsignedByteType,this._texture.generateMipmaps=this._mipmaps,this._texture.unpackAlignment=1,this._texture.minFilter=this._filter,this._texture.magFilter=this._magFilter,this._numChannels){case 1:this._texture.format=d.RedFormat;break;case 2:this._texture.format=d.RGFormat;break;case 3:this._texture.format=d.RGBFormat;break;case 4:this._texture.format=d.RGBAFormat;break}}_initOverlayTexture(n,r){this._overlayTexture=new d.DataTexture(n,r.x,r.y),this._overlayTexture.format=d.RedFormat,this._overlayTexture.type=d.UnsignedByteType,this._overlayTexture.minFilter=this._overlayFilter,this._overlayTexture.magFilter=d.NearestFilter,this._overlayTexture.generateMipmaps=this._mipmaps,this._overlayTexture.unpackAlignment=1,this._overlayTexture.needsUpdate=!0}_initAlphaTexture(n,r){this._alphaTexture=new d.DataTexture(n,r.x,r.y),this._alphaTexture.format=d.AlphaFormat,this._alphaTexture.type=d.UnsignedByteType,this._alphaTexture.minFilter=this._filter,this._alphaTexture.magFilter=d.NearestFilter,this._alphaTexture.generateMipmaps=this._mipmaps,this._alphaTexture.unpackAlignment=1,this._alphaTexture.needsUpdate=!0}_interpolation(n,r){if(this._mipmaps=r,this._magFilterStyle=n,this._mipmaps===!0?this._filter=n==="nearest"?d.LinearMipmapNearestFilter:d.LinearMipmapLinearFilter:this._filter=n==="nearest"?d.NearestFilter:d.LinearFilter,this._overlayFilter=d.NearestFilter,n==="auto"){const h=Math.min(this._mesh.matrix.elements[0],this._mesh.matrix.elements[5]);this._magFilter=this._globalUniforms.u_zoomPercent*h>1e3?d.NearestFilter:d.LinearFilter}else n==="bilinear"?this._magFilter=d.LinearFilter:this._magFilter=d.NearestFilter;this._texture!==null&&(this._texture.minFilter!==this._filter||this._texture.magFilter!==this._magFilter)&&(this._texture.minFilter=this._filter,this._texture.magFilter=this._magFilter,this._texture.generateMipmaps=this._mipmaps,this._texture.needsUpdate=!0),this._overlayTexture!==null&&this._overlayTexture.minFilter!==this._overlayFilter&&(this._overlayTexture.minFilter=this._overlayFilter,this._overlayTexture.generateMipmaps=!1,this._overlayTexture.needsUpdate=!0),this._alphaTexture!==null&&this._alphaTexture.minFilter!==this._filter&&(this._alphaTexture.minFilter=this._filter,this._alphaTexture.generateMipmaps=this._mipmaps,this._alphaTexture.needsUpdate=!0)}autoMagFilter(n){if(this._mesh!==null&&this._texture!==null&&this._magFilterStyle==="auto"){const r=Math.min(this._mesh.scale.x,this._mesh.scale.y),h=n*r>1e3?d.NearestFilter:d.LinearFilter;this._texture.magFilter!==h&&(this._magFilter=h,this._texture.magFilter=h,this._texture.needsUpdate=!0)}}_colormap(n,r){this._mesh.material.uniforms.u_transferFunction.value!==null&&this._mesh.material.uniforms.u_transferFunction.value.dispose(),this._mesh.material.uniforms.u_transferFunction.value=this._initColormapTexture(n,r)}_clim(n){this._mesh.material.uniforms.u_clim.value.fromArray(n)}_climOverlay(n){this._mesh.material.uniforms.u_overlayclim.value.fromArray(n)}_setAlphaData(n){n!==this._useAlphaData&&(this._useAlphaData=n,this._alphaDataDefines=this._useAlphaData===!0?"#define USE_ALPHA_DATA":"",this._needsUpdate=!0)}_getBufferLength(n){let r=0;const h=n.OverlaySize,u=n.Size;return Math.max(...u)>0&&(r+=u[0]*u[1]*u[2]*n.NumChannels),Math.max(...h)>0&&(r+=h[0]*h[1]*h[2]),r}_constructProperties(n,r){this._size=new d.Vector3(1,1,1),this._priorSize=new d.Vector3(1,1,1),this._offset=new d.Vector3(.5,.5,.5),this._priorOffset=new d.Vector3(.5,.5,.5),this._includeOverlay=!1,this._overlayFilter=d.NearestFilter,this._useAlphaData=!1,this._alphaTexture=null,this._scaleFactor=[1,1,1],this._blendOp=d.NormalBlending,this._magFilterStyle="auto",this._layer=n.Layer,this._shader=_,this._filter=d.LinearFilter,this._magFilter=d.NearestFilter,this._mipmaps=n.Mipmaps,this._setNumChannels(n.NumChannels),this._clipIntersection=r.clipIntersection,this._clipIntersectionDefines=r.clipIntersection===!0?"#define CLIP_INTERSECTION":"",this._cropDefines=r.cropBoxExclude===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(r.cropType),this._colorBoxDefines="",this._alphaDataDefines="",this._overlayDefines="",this._volumeDefines="",this._hardwareDefines=r.hardwareSupport===!0?"#define HARDWARE_WEBGL":""}_updateGeometry(n,r){(this._size.distanceToSquared(this._priorSize)>1e-4||this._offset.distanceToSquared(this._priorOffset)>1e-4)&&(this._mesh.geometry.translate(-this._priorSize.x/2-this._priorOffset.x,-this._priorSize.y/2-this._priorOffset.y,-this._priorSize.z/2-this._priorOffset.z),this._mesh.geometry.scale(this._size.x/this._priorSize.x,this._size.y/this._priorSize.y,this._size.z/this._priorSize.z),this._mesh.geometry.translate(this._size.x/2+this._offset.x,this._size.y/2+this._offset.y,this._size.z/2+this._offset.z),this.quality(r))}}},D,V),D.exports=B},9170:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return{defines:{TOLERANCE:1e-6},uniforms:{u_visible:{value:1},u_clim:{value:new d.Vector2(0,1)},u_data:{value:null},u_transferFunction:{value:null},u_alphaData:{value:null},u_overlayData:{value:null},u_overlayTransferFunction:{value:null},u_overlayclim:{value:new d.Vector2(0,1)},u_passNumber:{value:0},u_depthTexture:{value:null},u_previousTexture:{value:null},u_viewportSize:{value:new d.Vector2(1,1)},u_cropMin:{value:new d.Vector3(0,0,0)},u_cropMax:{value:new d.Vector3(1,1,1)},u_volumeSize:{value:new d.Vector3(0,0,0)},u_sliceAlpha:{value:1},u_inverseVolumeModelMatrix:{value:new d.Matrix4}},vertexShader:`varying vec2 vUv;
        varying vec3 vClipPosition;
        varying vec3 vWorldCoords; 
        
        void main() {
            vec4 mvPosition = vec4( position, 1.0 );
        
            vec4 worldCoords = modelMatrix * mvPosition;
            vWorldCoords = worldCoords.xyz;
        
            mvPosition = modelViewMatrix * mvPosition;
            vClipPosition = - mvPosition.xyz;
        
            gl_Position = projectionMatrix * mvPosition;
        
            vUv = uv;
        }`,fragmentShader:`
        //---------------------------------------------------------------------
        // Fragment shader for grayscale and rgb volume rendering
        //---------------------------------------------------------------------
        
        // Copyright 2023 The MathWorks, Inc.
        
        precision highp float;
        precision highp sampler2D;
        precision highp sampler3D;
        
        #ifdef SAMPLE_VOLUME
            uniform sampler3D u_data;
            uniform sampler3D u_overlayData;
            uniform sampler3D u_alphaData;
            uniform vec3 u_volumeSize;
            uniform mat4 u_inverseVolumeModelMatrix;
            uniform float u_sliceAlpha;
        #else
            uniform sampler2D u_data;
            uniform sampler2D u_overlayData;
            uniform sampler2D u_alphaData;
        #endif
        
        uniform sampler2D u_transferFunction;
        
        uniform mat4 modelMatrix;
        uniform mat4 modelViewMatrix;
        
        // Overlay uniforms
        uniform sampler2D u_overlayTransferFunction;
        
        uniform sampler2D u_depthTexture;
        uniform int u_passNumber;
        uniform vec2 u_viewportSize;
        uniform sampler2D u_previousTexture;
        
        varying vec2 vUv;
        varying vec3 vClipPosition;
        varying vec3 vWorldCoords; 
        
        #ifndef RGB_SHADER
            // Uniform to control dynamic range
            uniform vec2 u_clim;
        #endif
        
        uniform vec2 u_overlayclim;
        
        #if NUM_CLIPPING_PLANES > 0
            uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
        #endif
        
        #if NUM_CROP_BOXES > 0
            uniform vec3 u_cropMin;
            uniform vec3 u_cropMax;
            uniform vec3 u_cropCenter;
            uniform float u_cropRadius;
            uniform float u_cropHeight;
        #endif
        
        #ifdef COLOR_BOX
            uniform mat4 u_colorBoxMatrix;
            uniform vec3 u_colorBoxColor;
        #endif
        
        #ifdef SAMPLE_VOLUME
        
            vec3 worldToTex (vec3 loc) {
                // Convert world coordinates into local texture coodinates
                // of the volume
                vec4 localCoords = u_inverseVolumeModelMatrix * vec4( loc, 1.0 );
                return (localCoords.xyz - 0.5) / u_volumeSize;
            }
        
        #endif
        
        vec4 packDepthToRGBA( float depth ) {
            vec3 packFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0 );
            float shiftRight8 = 1.0 / 256.0; // Handle overflow
            float packUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
            
            vec4 rgba = vec4( fract(depth * packFactors), depth);
            rgba.yzw -= rgba.xyz * shiftRight8;
            return rgba * packUpscale;
        }
        
        void setDepth () {
            if (u_passNumber == 2 ) {
                float prevDepth = texture(u_previousTexture, gl_FragCoord.xy / u_viewportSize).x;
                if (gl_FragCoord.z < prevDepth + TOLERANCE) {
                    discard;
                }
            }
            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
            gl_FragDepth = gl_FragCoord.z;
        }
        
        void testDepth () {
            if (u_passNumber == 1 ) {
                float priorDepth = texture( u_depthTexture, gl_FragCoord.xy / u_viewportSize ).x;
                float accumulatedDepth = texture( u_previousTexture, gl_FragCoord.xy / u_viewportSize ).x;
        
                // Should be between current depth and previous depth to be included
                if (gl_FragCoord.z > priorDepth + TOLERANCE  || gl_FragCoord.z < accumulatedDepth + TOLERANCE ) {
                    discard;
                }
            }
        }
        
        #ifdef COLOR_BOX
        
            vec4 colorInBox (vec4 color) {
                vec4 pos = u_colorBoxMatrix * vec4(vWorldCoords, 1.0);
                vec3 s = step(vec3(-0.5), pos.xyz) - step(vec3(0.5), pos.xyz);
                if ((s.x * s.y * s.z) > 0.0) {
                    color.rgb = u_colorBoxColor;
                }
                return color;
            }
        
        #endif
        
        #ifdef USE_OVERLAY
        
            #ifdef SAMPLE_VOLUME
                float sampleOverlay (vec3 coords) {
                    return texture(u_overlayData, worldToTex(coords)).r;
                }
            #else
                float sampleOverlay (vec2 texcoords) {
                    return texture(u_overlayData, texcoords.xy).r;
                }
            #endif
        
            vec4 applyOverlayColormap (float val) {
                float scaledVal = (val - u_overlayclim[0]) / (u_overlayclim[1] - u_overlayclim[0]);
                vec4 color = texture(u_overlayTransferFunction, vec2(0,scaledVal));
                return color;
            }
        
            float getOverlayAlpha (float val) {
                vec4 color = applyOverlayColormap(val);
                return color.a;
            }
        
        #endif
        
        #ifdef RGB_SHADER
        
            #ifdef USE_VOLUME
                vec4 sampleTexture (vec3 coords) {
                    vec4 color = texture(u_data, worldToTex(coords)).rgba;
                    #ifndef RGBA_SHADER
                        #ifdef USE_ALPHA_DATA
                            // Sample color at location, then sample alpha data at
                            // same location
                            color.a = texture(u_alphaData, worldToTex(coords)).a;
                        #else
                            color.a = u_sliceAlpha;
                        #endif
                    #endif
                    #ifdef COLOR_BOX
                        return colorInBox( color );
                    #else
                        return color;
                    #endif
                }
            #else
                vec4 sampleTexture (vec2 texcoords) {
                    vec4 color = texture(u_data, texcoords.xy).rgba;
                    #ifndef RGBA_SHADER
                        #ifdef USE_ALPHA_DATA
                            // Sample color at location, then sample alpha data at
                            // same location
                            color.a = texture(u_alphaData, texcoords.xy).a;
                        #else
                            color.a = texture(u_transferFunction, vec2(0.0,0.0)).a;
                        #endif
                    #endif
                    #ifdef COLOR_BOX
                        return colorInBox( color );
                    #else
                        return color;
                    #endif
                }
            #endif
        
        #else
        
            #ifdef SAMPLE_VOLUME
                float sampleIntensity (vec3 coords) {
                    return texture(u_data, worldToTex(coords)).r;
                }
        
                vec4 applyColormap (float val, vec3 coords) {
                    float scaledVal = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);
                    vec4 color = texture(u_transferFunction, vec2(0,scaledVal));
                    #ifdef USE_ALPHA_DATA
                        color.a = texture(u_alphaData, worldToTex(coords)).a;
                    #else
                        color.a = u_sliceAlpha;
                    #endif
                    #ifdef COLOR_BOX
                        return colorInBox( color );
                    #else
                        return color;
                    #endif
                }
        
                vec4 sampleTexture (vec3 coords) {
                    return applyColormap( sampleIntensity(coords), coords );
                }
            #else
                float sampleIntensity (vec2 texcoords) {
                    return texture(u_data, texcoords.xy).r;
                }
        
                vec4 applyColormap (float val, vec2 texcoords) {
                    float scaledVal = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);
                    vec4 color = texture(u_transferFunction, vec2(0,scaledVal));
                    #ifdef USE_ALPHA_DATA
                        color.a = texture(u_alphaData, texcoords.xy).a;
                    #else
                        color.a = texture(u_transferFunction, vec2(0,val)).a;
                    #endif
                    #ifdef COLOR_BOX
                        return colorInBox( color );
                    #else
                        return color;
                    #endif
                }
        
                vec4 sampleTexture (vec2 texcoords) {
                    return applyColormap( sampleIntensity(texcoords), texcoords );
                }
            #endif
            
        #endif
        
        bool outsideCropBox () {
            #if NUM_CROP_BOXES > 0
                
                #if CROP_TYPE == 0
                    vec3 s = step(u_cropMin, vWorldCoords) - step(u_cropMax, vWorldCoords);
                    #ifdef CROP_EXCLUDE
                        return bool(s.x * s.y * s.z);
                    #else
                        return bool(1.0 - (s.x * s.y * s.z));
                    #endif
                #endif
        
                // For a point p on the object and a point c as the center of the sphere,
                // Check if abs(p.xyz - r.xyz) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the sphere. Otherwise it lies within the sphere.
        
                #if CROP_TYPE == 1
                    float dist = distance(vWorldCoords, u_cropCenter);
                    #ifdef CROP_EXCLUDE
                        return (dist <= u_cropRadius);
                    #else
                        return (dist > u_cropRadius);
                    #endif
                #endif
        
                // For a point p on the object and a point c as the center of the cylinder,
                // Check if abs(p.xy - r.xy) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the curved surface of the cylinder along the x-y plane. 
                // Otherwise it lies within the curved surface of the cylinder.
                // Check if abs(p.z - c.z) > height / 2.0f (distance of p from the center along the z-axis is greater than height of the cylinder/2)
                // If so, then the point lies outside the end caps of the cylinder.
                // If either of these conditions are met, then the point lies outside the cylinder.
        
                #if CROP_TYPE == 2
                    float distanceXYPlane = distance(vec2(vWorldCoords.x, vWorldCoords.y), vec2(u_cropCenter.x, u_cropCenter.y));
                    float distanceZAxis = abs(vWorldCoords.z - u_cropCenter.z);
        
                    #ifdef CROP_EXCLUDE
                        return (distanceXYPlane <= u_cropRadius && distanceZAxis <= (u_cropHeight / 2.0f));
                    #else
                        return (distanceXYPlane > u_cropRadius || distanceZAxis > (u_cropHeight / 2.0f));
                    #endif
                #endif
            #else
                return false;
            #endif
        }
        
        bool clipped () {
            // Returns true if the location in world coordinates should be 
            // clipped (discard or not rendered).
            bool culled = outsideCropBox();
            #if NUM_CLIPPING_PLANES > 0
        
            vec4 plane;
        
                #ifdef CLIP_INTERSECTION
                    culled = true;
        
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        culled = dot( vClipPosition, plane.xyz ) > plane.w && culled;
                    }
                    #pragma unroll_loop_end
                #else
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        culled = dot( vClipPosition, plane.xyz ) > plane.w || culled;
                    }
                    #pragma unroll_loop_end
                #endif
            #endif
            return culled;
        }
        
        void main() {
        
            if (clipped()) {
                discard;
            }
        
            #ifdef DEPTH_SHADER
                setDepth();
            #else
                testDepth();
            #endif
        
            #ifdef USE_OVERLAY
                #ifdef BLEND_OVERLAY
                    // Sample from overlay texture
                    #ifdef SAMPLE_VOLUME
                        vec4 overlay =  applyOverlayColormap(sampleOverlay( vWorldCoords ));
                        vec4 color = sampleTexture( vWorldCoords );
                    #else
                        vec4 overlay =  applyOverlayColormap(sampleOverlay( vUv ));
                        vec4 color = sampleTexture( vUv );
                    #endif
                    gl_FragColor.rgb = (color.rgb * (1.0 - overlay.a) ) + (overlay.rgb * overlay.a);
                    gl_FragColor.a = color.a;
                #else
                    #ifdef SAMPLE_VOLUME
                        gl_FragColor = applyOverlayColormap(sampleOverlay( vWorldCoords ));
                    #else
                        gl_FragColor = applyOverlayColormap(sampleOverlay( vUv ));
                    #endif
                #endif
            #else
                #ifdef SAMPLE_VOLUME
                    gl_FragColor = sampleTexture( vWorldCoords );
                #else
                    gl_FragColor = sampleTexture( vUv );
                #endif
            #endif
        
            if (gl_FragColor.a < 0.05) {
                discard;
            }
        
        }`}},D,V),D.exports=B},539:(D,V,f)=>{var R,B;R=[f(3681),f(6427)],B=f.dj.d(R,function(d,N){return class extends N{constructor(l,n){super(l,n),this._size=new d.Vector3(n.Size[0],n.Size[1],n.Size[2]),this._scale=new d.Vector3(n.Scale[0],n.Scale[1],n.Scale[2]),this._offset=new d.Vector3(n.Offset[0],n.Offset[1],n.Offset[2]),this.numElements=n.Size[0]*n.Size[1]*n.Size[2],this._texture=null,this._overlayTexture=null,this._alphaTexture=null}load(l,n,r,h,u){if(this._mesh===null){const g=new d.PlaneGeometry;g.scale(this._size.x*this._scale.x,this._size.y*this._scale.y,this._size.z*this._scale.z),g.translate(this._size.x*this._scale.x/2+.5+this._offset.x,this._size.y*this._scale.y/2+.5+this._offset.y,this._size.z*this._scale.z/2+.5+this._offset.z),this._mesh=new d.Mesh(g,n.material.clone()),this._depthMesh=new d.Mesh(g,r.material.clone()),this._clearTransferFunctionTextures(),this.copyGlobalUniforms(h),this._mesh.renderOrder=u.NumLevels>1&&this.level===u.NumLevels?n.renderOrder-1:n.renderOrder,n.add(this._mesh),r.add(this._depthMesh)}else this._mesh.material.dispose(),this._depthMesh.material.dispose(),this._mesh.material=n.material.clone(),this._depthMesh.material=r.material.clone(),this.copyGlobalUniforms(h);this._mesh.material.visible=!0,this._depthMesh.material.visible=!0,this.copyUniforms(n.material.uniforms,u),this.memory=l.byteLength/1e6,this._initTextures(l,u),this.loaded=!0,this.visible=!0}renderOrder(l,n){super.renderOrder(n>1&&this.level===n?l-1:l,n)}_initTextures(l,n){this._clearTextures();const r=new Uint8Array(l);let h=0;n.UseData&&(h=n.NumChannels*this._size.x*this._size.y*this._size.z,this._initTexture(r.slice(0,h),this._size,n)),n.UseAlpha&&(this._initAlphaTexture(r.slice(h,h+this._size.x*this._size.y*this._size.z),this._size,n),h+=this._size.x*this._size.y*this._size.z),n.UseOverlay&&this._initOverlayTexture(r.slice(h,r.length),this._size,n),this._setTextures()}copyMaterial(l,n,r,h){super.copyMaterial(l,n,r,h),this._mesh!==null&&(this.copyGlobalUniforms(r),this._setTextures())}copyUniforms(l,n){this._mesh!==null&&(this._mesh.material.uniforms.u_transferFunction.value=l.u_transferFunction.value,this._mesh.material.uniforms.u_clim.value=l.u_clim.value,this._mesh.material.uniforms.u_overlayclim.value=l.u_overlayclim.value,this._mesh.material.uniforms.u_overlayTransferFunction.value=l.u_overlayTransferFunction.value,this._interpolation(n))}_initTexture(l,n,r){switch(this._texture=new d.DataTexture(l,n.x,n.y),this._texture.type=d.UnsignedByteType,this._texture.generateMipmaps=r.Mipmaps,this._texture.unpackAlignment=1,this._texture.minFilter=r.MinFilter,this._texture.magFilter=r.MagFilter,r.NumChannels){case 1:this._texture.format=d.RedFormat;break;case 2:this._texture.format=d.RGFormat;break;case 3:this._texture.format=d.RGBFormat;break;case 4:this._texture.format=d.RGBAFormat;break}}_initOverlayTexture(l,n,r){this._overlayTexture=new d.DataTexture(l,n.x,n.y),this._overlayTexture.format=d.RedFormat,this._overlayTexture.type=d.UnsignedByteType,this._overlayTexture.minFilter=r.OverlayFilter,this._overlayTexture.magFilter=d.NearestFilter,this._overlayTexture.generateMipmaps=!1,this._overlayTexture.unpackAlignment=1,this._overlayTexture.needsUpdate=!0}_initAlphaTexture(l,n,r){this._alphaTexture=new d.DataTexture(l,n.x,n.y),this._alphaTexture.format=d.AlphaFormat,this._alphaTexture.type=d.UnsignedByteType,this._alphaTexture.minFilter=r.MinFilter,this._alphaTexture.magFilter=d.NearestFilter,this._alphaTexture.generateMipmaps=r.Mipmaps,this._alphaTexture.unpackAlignment=1,this._alphaTexture.needsUpdate=!0}_setTextures(){this._mesh.material.uniforms.u_data.value=this._texture,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture,this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture}_interpolation(l){this._texture!==null&&(this._texture.minFilter!==l.MinFilter||this._texture.magFilter!==l.MagFilter)&&(this._texture.minFilter=l.MinFilter,this._texture.magFilter=l.MagFilter,this._texture.generateMipmaps=l.Mipmaps,this._texture.needsUpdate=!0),this._overlayTexture!==null&&this._overlayTexture.minFilter!==l.OverlayFilter&&(this._overlayTexture.minFilter=l.OverlayFilter,this._overlayTexture.generateMipmaps=!1,this._overlayTexture.needsUpdate=!0),this._alphaTexture!==null&&this._alphaTexture.minFilter!==l.MinFilter&&(this._alphaTexture.minFilter=l.MinFilter,this._alphaTexture.generateMipmaps=l.Mipmaps,this._alphaTexture.needsUpdate=!0)}_clearTextures(){this._texture!==null&&(this._texture.dispose(),this._texture=null),this._overlayTexture!==null&&(this._overlayTexture.dispose(),this._overlayTexture=null),this._alphaTexture!==null&&(this._alphaTexture.dispose(),this._alphaTexture=null)}_measureDistance(l,n){return l.position.distanceTo(this._sphere.center)}unload(){super.unload(),this.dispose()}dispose(){this._clearTransferFunctionTextures(),this._clearTextures(),super.dispose()}}},D,V),D.exports=B},9101:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){const N=new d.Box3,_=new d.Vector3;return class extends d.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const n=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],r=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],h=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(h),this.setAttribute("position",new d.Float32BufferAttribute(n,3)),this.setAttribute("uv",new d.Float32BufferAttribute(r,2))}applyMatrix4(n){const r=this.attributes.instanceStart,h=this.attributes.instanceEnd;return r!==void 0&&(r.applyMatrix4(n),h.applyMatrix4(n),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(n){let r;n instanceof Float32Array?r=n:Array.isArray(n)&&(r=new Float32Array(n));const h=new d.InstancedInterleavedBuffer(r,6,1);return this.setAttribute("instanceStart",new d.InterleavedBufferAttribute(h,3,0)),this.setAttribute("instanceEnd",new d.InterleavedBufferAttribute(h,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(n){let r;n instanceof Float32Array?r=n:Array.isArray(n)&&(r=new Float32Array(n));const h=new d.InstancedInterleavedBuffer(r,6,1);return this.setAttribute("instanceColorStart",new d.InterleavedBufferAttribute(h,3,0)),this.setAttribute("instanceColorEnd",new d.InterleavedBufferAttribute(h,3,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new d.Box3);const n=this.attributes.instanceStart,r=this.attributes.instanceEnd;n!==void 0&&r!==void 0&&(this.boundingBox.setFromBufferAttribute(n),N.setFromBufferAttribute(r),this.boundingBox.union(N))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new d.Sphere),this.boundingBox===null&&this.computeBoundingBox();const n=this.attributes.instanceStart,r=this.attributes.instanceEnd;if(n!==void 0&&r!==void 0){const h=this.boundingSphere.center;this.boundingBox.getCenter(h);let u=0;for(let g=0,p=n.count;g<p;g++)_.fromBufferAttribute(n,g),u=Math.max(u,h.distanceToSquared(_)),_.fromBufferAttribute(r,g),u=Math.max(u,h.distanceToSquared(_));this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}},D,V),D.exports=B},4547:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){return class{constructor(){this.cache=new Map,this.head={idx:0,prev:null,next:null},this.tail={idx:0,prev:null,next:null},this.head.next=this.tail,this.tail.prev=this.head}_remove(N){const _=N.prev,l=N.next;_.next=l,l.prev=_}_add(N){const _=this.tail.prev;_.next=N,this.tail.prev=N,N.prev=_,N.next=this.tail}put(N){this.cache.has(N)&&this._remove(this.cache.get(N));const _={idx:N,prev:null,next:null};this._add(_),this.cache.set(N,_)}getNext(){if(this.cache.size>0){const N=this.head.next,_=N.idx;return this._remove(N),this.cache.delete(N.key),_}else return 0}}},D,V),D.exports=B},5060:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.EventDispatcher{constructor(_,l){super(),this._scene=_,this._globalData=l,this._lights=[],this._quaternions=[],this._modes=[],this._initialized=!1,this._ambientLight=new d.AmbientLight(16777215,.3),this._scene.add(this._ambientLight),this._numLights=1,this._numVisibleLights=1,this._add()}getPosition(){const _=[];for(let l=0;l<this._numLights;l++)this._lights[l].position.toArray(_,l*3);return _}reset(_,l,n,r){const h=new d.Vector3;let u=!1;for(let g=0;g<this._numLights;g++)this._resetLight(_,l,n,r,h,this._lights[g],this._quaternions[g],this._modes[g]),u===!1&&this._lights[g].visible===!0&&(u=!0,this._globalData.uniforms.u_primaryLight.value=this._lights[g].position,this._globalData.uniforms.u_primaryLightIntensity.value=this._lights[g].intensity);this._initialized=!0,this._updateSecondayLights()}refresh(_,l,n,r){const h=new d.Vector3;let u=!1;for(let g=0;g<this._numLights;g++)this._refreshLight(_,l,n,r,h,this._lights[g],this._quaternions[g],this._modes[g]),u===!1&&this._lights[g].visible===!0&&(u=!0,this._globalData.uniforms.u_primaryLight.value=this._lights[g].position,this._globalData.uniforms.u_primaryLightIntensity.value=this._lights[g].intensity);this._updateSecondayLights()}update(_){let l=!1;const n=this._numVisibleLights,r=Array.from(_.LightColor);_.Lighting!==this._globalData.lighting&&(this._globalData.lighting=_.Lighting,l=!0),this._updateAmbient(_.Lighting,r,_.AmbientLight),this._updatePoint(_.Lighting,r,_.NumLights,_.Light),n!==this._numVisibleLights&&(l=!0),this._globalData.numLights=this._numVisibleLights,l===!0&&this._broadcastEvent()}_updateAmbient(_,l,n){this._globalData.uniforms.u_lightColor.value.set(l[0],l[1],l[2],1),this._globalData.uniforms.u_ambientStrength.value=n;const r=new d.Color(l[0],l[1],l[2]);this._ambientLight.color=r,this._ambientLight.intensity=_===!0?n:1}_updatePoint(_,l,n,r){const h=new d.Color(l[0],l[1],l[2]);let u=0;if(n>this._lights.length)for(let g=this._lights.length;g<n;g++)this._add();else if(n<this._lights.length)for(let g=n;g<this._lights.length;g++)this._lights[g].visible=!1,this._globalData.uniforms.lights[g].visible=!1;if(n===1)this._lights[0].color=h,this._lights[0].intensity=r.Intensity,this._lights[0].visible=_&&r.Enabled,this._globalData.uniforms.u_primaryLightIntensity.value=r.Intensity,this._modes[0]=r.PositionMode,this._globalData.uniforms.lights[0].size=r.Size,this._globalData.uniforms.lights[0].intensity=r.Intensity,this._globalData.uniforms.lights[0].visible=r.Enabled,u+=r.Enabled===!0?1:0,r.PositionMode==="manual"&&this._lights[0].position.fromArray(Array.from(r.Position));else for(let g=0;g<n;g++)this._lights[g].color=h,this._lights[g].intensity=r[g].Intensity,this._lights[g].visible=_&&r[g].Enabled,this._modes[g]=r[g].PositionMode,this._globalData.uniforms.lights[g].size=r[g].Size,this._globalData.uniforms.lights[g].intensity=r[g].Intensity,this._globalData.uniforms.lights[g].visible=r[g].Enabled,u+=r[g].Enabled===!0?1:0,r[g].PositionMode==="manual"&&this._lights[g].position.fromArray(Array.from(r[g].Position));this._numVisibleLights=u,this._numLights=n}_resetLight(_,l,n,r,h,u,g,p){if(p==="auto")if(this._initialized){const y=new d.Vector3;h.copy(_).sub(n).normalize(),y.copy(u.position).sub(n).normalize(),g.setFromUnitVectors(h,y),this._refreshLight(_,l,n,r,h,u,g,p)}else u.position.copy(_),g.identity();else this._refreshLight(_,l,n,r,h,u,g,p)}_refreshLight(_,l,n,r,h,u,g,p){switch(p){case"headlight":u.position.copy(_),g.identity();break;case"right":if(r>0){const y=new d.Vector3,x=l.clone();h.copy(_).sub(n).normalize(),y.crossVectors(h,x.normalize()).negate(),h.add(y).add(x).multiplyScalar(r),u.position.addVectors(n,h),g.identity()}break;case"left":if(r>0){const y=new d.Vector3,x=l.clone();h.copy(_).sub(n).normalize(),y.crossVectors(h,x.normalize()),h.add(y).add(x).multiplyScalar(r),u.position.addVectors(n,h),g.identity()}break;case"target-behind":h.copy(_).sub(n),u.position.subVectors(n,h),g.identity();break;case"target-above":h.copy(l).normalize().multiplyScalar(r),u.position.addVectors(n,h),g.identity();break;case"target-below":h.copy(l).normalize().negate().multiplyScalar(r),u.position.addVectors(n,h),g.identity();break;case"target-right":if(r>0){const y=new d.Vector3,x=l.clone();h.copy(_).sub(n).normalize(),y.crossVectors(h,x.normalize()).negate().multiplyScalar(r),u.position.addVectors(n,y),g.identity()}break;case"target-left":if(r>0){const y=new d.Vector3,x=l.clone();h.copy(_).sub(n).normalize(),y.crossVectors(h,x.normalize()).multiplyScalar(r),u.position.addVectors(n,y),g.identity()}break;case"camera-above":h.copy(l).normalize().multiplyScalar(r),u.position.addVectors(_,h),g.identity();break;case"auto":r>0&&(h.copy(_).sub(n).normalize(),h.applyQuaternion(g).multiplyScalar(r),u.position.addVectors(n,h));break}}_updateSecondayLights(){let _=null,l=null;if(this._numVisibleLights>1){let n=!1,r=0;_=new Array((this._numVisibleLights-1)*3),l=new Array(this._numVisibleLights-1);for(let h=0;h<this._numLights;h++)this._lights[h].visible===!0&&(n===!0?(this._lights[h].position.toArray(_,r*3),l[r]=this._lights[h].intensity,r+=1):n=!0)}this._globalData.uniforms.u_secondaryLight.value=_,this._globalData.uniforms.u_secondaryLightIntensity.value=l}_broadcastEvent(){this.dispatchEvent({type:"lightsUpdated",message:{numLights:this._numVisibleLights}})}_add(){const _=new d.PointLight,l=new d.Quaternion;this._scene.add(_),this._lights.push(_),this._quaternions.push(l),this._modes.push("new");const n={visible:_.visible,position:_.position,intensity:_.intensity,object:_,size:.2};this._globalData.uniforms.lights.push(n)}dispose(){this._numLights=0,this._globalData.uniforms.lights=[],this._ambientLight=null,this._lights=[],this._quaternions=[],this._modes=[]}}},D,V),D.exports=B},7498:(D,V,f)=>{var R,B;R=[f(3681),f(1145)],B=f.dj.d(R,function(d,N){return class extends N{refreshData(l,n){const r=new Float32Array(l);this._isDataEmpty=r.length===0,this._memoryUsed=r.length*4/1e6,this._mesh.geometry.dispose();const h=this._initGeometry(r,n.NumVertices,n.ColorByVertex,n.NumSeparators);this._mesh.geometry=h,this._depthMesh.geometry=h}add(l,n){const r=this._initGeometry([],0,l.ColorByVertex,0);this._initMesh(l,r),this.globalClippingPlanes(n.globalClippingPlanes,n.globalClipping),this._setProperties(l)}_constructMesh(l,n,r){this._mesh=new d.LineSegments(l,this._initMaterial(!1,n,r)),this._depthMesh=new d.LineSegments(l,this._initMaterial(!0,n,r))}_initMaterial(l,n,r){const h=new d.LineBasicMaterial({color:r,opacity:n.Alpha,transparent:!0,premultipliedAlpha:l,depthTest:!0,depthWrite:!0,clipIntersection:this._clipIntersection,side:d.FrontSide});return l?(h.blending=d.NoBlending,h.onBeforeCompile=this._addDepthToShader.bind(this)):h.onBeforeCompile=this._addPeelToShader.bind(this),h.customProgramCacheKey=this._setProgramCacheKey.bind(this),h}_colorStyle(l,n,r){l===!1&&(this._mesh.material.color=n),this._colorByVertex!==l&&(this._setMaterialColor(l,n,r),this._colorByVertex=l)}_setMaterialColor(l,n,r){l?this._mesh.material.color=new d.Color(1,1,1):this._mesh.material.color=n,this._mesh.material.vertexColors=l,this._mesh.material.needsUpdate=!0}_setProperties(l){this._mesh.material.opacity=l.Alpha;const n=this._initColor(Array.from(l.Color));this._colorStyle(l.ColorByVertex,n,n),this._visible(l.Visible),this._transform(Array.from(l.Transform)),this.localClippingPlanes(l.ClippingPlanes),this._setPickable(l.Pickable),this._setLayer(l.Layer)}_initEmissive(l){return this._initColor(Array.from(l.Color))}_initGeometry(l,n,r,h){const u=new d.BufferGeometry,g=[];if(h>0)for(let p=0;p<h-1;p++)for(let y=l[p];y<l[p+1]-1;y++)g.push(y,y+1);else for(let p=0;p<n-1;p++)g.push(p,p+1);return r?(u.setIndex(g),u.setAttribute("position",new d.Float32BufferAttribute(l.slice(h,3*n+h),3)),u.setAttribute("color",new d.Float32BufferAttribute(l.slice(3*n+h,6*n+h),3))):(u.setIndex(g),u.setAttribute("position",new d.Float32BufferAttribute(l.slice(h,3*n+h),3))),u.computeBoundingBox(),u.computeBoundingSphere(),u}}},D,V),D.exports=B},3139:(D,V,f)=>{var R,B;R=[f(7290),f(210),f(1668)],B=f.dj.d(R,function(d,N,_){return class{constructor(n){this._messageServiceChannel="/images-threejs-ui/"+n,this._started=!1,this.viewer=new d(this._messageServiceChannel),this._binaryChannel=_.createStream(n+"Binary"),this._connectedHandle=N.on("connected",this.start.bind(this)),N.start()}stop(){this._started===!0&&(N.unsubscribe(this._messageServiceChannel,this._messageReceived,this),N.stop(),this._started=!1)}start(){this._connectedHandle.remove(),this._started!==!0&&N.subscribe(this._messageServiceChannel,this._messageReceived,this).then(this._connectBinaryChannels.bind(this))}_connectBinaryChannels(){this._binaryChannel.start(this._binaryDataReceived.bind(this)).then(this._validateViewer.bind(this))}_validateViewer(){this.viewer.validateWebGraphics(),this._started=!0}_binaryDataReceived(n){try{this.viewer.setBinaryData(n.data)}catch(r){console.log("Error during binary channel data update"),this._throwError(n,r)}}_messageReceived(n){if(n.data==="stop"){this.stop();return}try{const r=n.data.Args===void 0?{}:n.data.Args;r.Token=n.data.Token,this.viewer[n.data.Type](r)}catch(r){console.log("Error during message service communication"),this._throwError(n,r)}}_throwError(n,r){const h={Token:"ErrorThrown",Message:{Name:r.name,Message:r.message,Stack:n.data.Type}};N.publish(this._messageServiceChannel,h)}}},D,V),D.exports=B},7385:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.EventDispatcher{constructor(){super(),this._hardLimit=3800,this.limit=1e3,this.used=0}setLimit(_){this.limit=_*1e3}clear(){this.used=0}refresh(_,l){if(this._gatherMemoryUsage(_,l),this.used>this._hardLimit){for(let n=0;n<_.length;n++)_[n].unload(!0);this._gatherMemoryUsage()}else if(this.used>this.limit){for(let n=0;n<_.length;n++)_[n].unload(!1);this._gatherMemoryUsage(_,l)}}_gatherMemoryUsage(_,l){this.used=0;for(let n=0;n<_.length;n++)this.used+=_[n].getMemoryUsed()}}},D,V),D.exports=B},8633:(D,V,f)=>{var R,B;R=[f(3681),f(2158)],B=f.dj.d(R,function(d,N){return class extends N{refreshData(l,n,r){this.stitchingNeeded=!n.UseBinaryChannel,this._clearTextures(),n.UseBinaryChannel===!0?(this._clearBuffer(),super.refreshData(l,n,r)):this._initBuffer(n,r)}updateOnInteraction(l){l&&(this._textureUpdateNeeded===!0&&(this._textureUpdateNeeded=!1,this._instructionSet!==null&&super.refreshData(this._buffer,this._instructionSet,this._stepSize)),this._visible(l))}stitchBuffer(l,n){const r=new Uint8Array(l);let h=[Math.ceil(this._instructionSet.Size[0]*(n.Size.x/n.TotalSize.x)),Math.ceil(this._instructionSet.Size[1]*(n.Size.y/n.TotalSize.y)),Math.ceil(this._instructionSet.Size[2]*(n.Size.z/n.TotalSize.z))],u=[Math.floor(n.LocalOffset.x*(this._instructionSet.Size[0]/n.TotalSize.x)),Math.floor(n.LocalOffset.y*(this._instructionSet.Size[1]/n.TotalSize.y)),Math.floor(n.LocalOffset.z*(this._instructionSet.Size[2]/n.TotalSize.z))],g=n.Size.toArray(),p=Array.from(this._instructionSet.Size);const y=g[0]*g[1]*g[2];let x=p[0]*p[1]*p[2],w=u[0]+p[0]*u[1]+p[0]*p[1]*u[2],M=0;if(n.DataModified===!0)switch(n.NumChannels){case 1:for(let T=0;T<h[2];T++)for(let A=0;A<h[1];A++)for(let C=0;C<h[0];C++)M=Math.round((C+.5)*(g[0]/h[0])-.5)+g[0]*Math.round((A+.5)*(g[1]/h[1])-.5)+g[0]*g[1]*Math.round((T+.5)*(g[2]/h[2])-.5),this._buffer[C+p[0]*A+p[0]*p[1]*T+w]=r[M];break;case 2:for(let T=0;T<h[2];T++)for(let A=0;A<h[1];A++)for(let C=0;C<h[0];C++)M=Math.round((C+.5)*(g[0]/h[0])-.5)+g[0]*Math.round((A+.5)*(g[1]/h[1])-.5)+g[0]*g[1]*Math.round((T+.5)*(g[2]/h[2])-.5),this._buffer[C+p[0]*A+p[0]*p[1]*T+w]=r[M],this._buffer[C+p[0]*A+p[0]*p[1]*T+w+x]=r[M+y];break;case 3:for(let T=0;T<h[2];T++)for(let A=0;A<h[1];A++)for(let C=0;C<h[0];C++)M=Math.round((C+.5)*(g[0]/h[0])-.5)+g[0]*Math.round((A+.5)*(g[1]/h[1])-.5)+g[0]*g[1]*Math.round((T+.5)*(g[2]/h[2])-.5),this._buffer[(C+p[0]*A+p[0]*p[1]*T+w)*n.NumChannels]=r[M*n.NumChannels],this._buffer[(C+p[0]*A+p[0]*p[1]*T+w)*n.NumChannels+1]=r[M*n.NumChannels+1],this._buffer[(C+p[0]*A+p[0]*p[1]*T+w)*n.NumChannels+2]=r[M*n.NumChannels+2];break;case 4:for(let T=0;T<h[2];T++)for(let A=0;A<h[1];A++)for(let C=0;C<h[0];C++)M=Math.round((C+.5)*(g[0]/h[0])-.5)+g[0]*Math.round((A+.5)*(g[1]/h[1])-.5)+g[0]*g[1]*Math.round((T+.5)*(g[2]/h[2])-.5),this._buffer[(C+p[0]*A+p[0]*p[1]*T+w)*n.NumChannels]=r[M*n.NumChannels],this._buffer[(C+p[0]*A+p[0]*p[1]*T+w)*n.NumChannels+1]=r[M*n.NumChannels+1],this._buffer[(C+p[0]*A+p[0]*p[1]*T+w)*n.NumChannels+2]=r[M*n.NumChannels+2],this._buffer[(C+p[0]*A+p[0]*p[1]*T+w)*n.NumChannels+3]=r[M*n.NumChannels+3];break}if(n.OverlayDataModified===!0){let T=0,A=0;h=[Math.ceil(this._instructionSet.OverlaySize[0]*(n.Size.x/n.TotalSize.x)),Math.ceil(this._instructionSet.OverlaySize[1]*(n.Size.y/n.TotalSize.y)),Math.ceil(this._instructionSet.OverlaySize[2]*(n.Size.z/n.TotalSize.z))],u=[Math.floor(n.LocalOffset.x*(this._instructionSet.OverlaySize[0]/n.TotalSize.x)),Math.floor(n.LocalOffset.y*(this._instructionSet.OverlaySize[1]/n.TotalSize.y)),Math.floor(n.LocalOffset.z*(this._instructionSet.OverlaySize[2]/n.TotalSize.z))],g=n.Size.toArray(),p=Array.from(this._instructionSet.OverlaySize),x=p[0]*p[1]*p[2],w=u[0]+p[0]*u[1]+p[0]*p[1]*u[2],n.DataModified===!0&&(T=n.NumChannels*y,A=n.NumChannels*x);for(let C=0;C<h[2];C++)for(let z=0;z<h[1];z++)for(let H=0;H<h[0];H++)M=Math.round((H+.5)*(g[0]/h[0])-.5)+g[0]*Math.round((z+.5)*(g[1]/h[1])-.5)+g[0]*g[1]*Math.round((C+.5)*(g[2]/h[2])-.5),this._buffer[H+p[0]*z+p[0]*p[1]*C+w+A]=r[M+T]}this._textureUpdateNeeded=!0}_clearBuffer(){this._textureUpdateNeeded=!1,this._buffer=null}_initBuffer(l,n){this._instructionSet=l,this._stepSize=n,this._buffer!==null&&(this._textureUpdateNeeded=!0),this._buffer=new Uint8Array(this._getBufferLength(l))}_clearTextures(){this._texture!==null&&this._texture.dispose(),this._isDataEmpty=!0,this._texture=null,this._mesh.material.uniforms.u_data.value=this._texture,this._overlayTexture!==null&&this._overlayTexture.dispose(),this._isOverlayEmpty=!0,this._overlayTexture=null,this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture,this._alphaTexture!==null&&this._alphaTexture.dispose(),this._alphaTexture=null,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture}_initDepthMesh(l,n,r){}_lightScattering(){}_constructProperties(l,n){super._constructProperties(l,n),this._scale=new d.Vector3(1,1,1),this._priorScale=new d.Vector3(1,1,1),this._tform=new d.Matrix4,this._buffer=null,this._instructionSet=null,this._stepSize=null,this._textureUpdateNeeded=!1,this.stitchingNeeded=!1}_updateGeometry(l,n){super._updateGeometry(l,n),this._applyAdditionalTransformation(l)}_applyAdditionalTransformation(l){const n=Array.from(l.OverviewOffset),r=Array.from(l.OverviewScale);this._mesh.material.uniforms.u_scaleFactor.value.fromArray(r);const h=new d.Matrix4,u=new d.Matrix4;h.makeScale(r[0],r[1],r[2]),u.setPosition(n[0]+.5,n[1]+.5,n[2]+.5),this._matrix.makeTranslation(-.5,-.5,-.5),this._matrix.premultiply(h),this._matrix.premultiply(u),this._updateMatrix(this._tform)}_updateMatrix(l){this._tform.copy(l);const n=new d.Matrix4;n.multiplyMatrices(this._tform,this._matrix),this._mesh.matrix=n,this._depthMesh!==null&&(this._depthMesh.matrix=n,this._depthMesh.matrixWorldNeedsUpdate=!0),this._mesh.matrixWorldNeedsUpdate=!0}}},D,V),D.exports=B},2883:(D,V,f)=>{var R,B;R=[f(3681),f(6427)],B=f.dj.d(R,function(d,N){return class extends N{constructor(l,n){super(l,n),this.info={id:-1,blockIndex:l,level:n.Level,index:n.Index,numBlocksToRead:1,outOfCore:!1,distance:1/0,numPoints:n.NumPoints}}load(l,n,r,h){const u=new Float32Array(l),g=Math.round(u.length/6);if(this._mesh===null){const p=new d.BufferGeometry;p.setAttribute("position",new d.Float32BufferAttribute(u.slice(0,g*3),3)),p.setAttribute("color",new d.Float32BufferAttribute(u.slice(g*3,u.length),3)),p.setDrawRange(0,g),p.computeBoundingBox(),this._mesh=new d.Points(p,n.material.clone()),this._mesh.material.vertexColors=!0,this._depthMesh=new d.Points(p,r.material.clone()),this._mesh.renderOrder=n.renderOrder,n.add(this._mesh),r.add(this._depthMesh)}else this._mesh.material.dispose(),this._depthMesh.material.dispose(),this._mesh.material=n.material.clone(),this._depthMesh.material=r.material.clone();this.memory=l.byteLength/1e6,this.loaded=!0,this.visible=!0}isInView(l,n,r,h){return n.intersectsSphere(this._sphere)&&!this._isCulled(h)?this.loaded?(this.visible=!0,!1):(l.isPerspectiveCamera?this.info.distance=l.position.distanceTo(this._sphere.center)/l.zoom:(this._sphere.center.sub(l.position).negate(),this.info.distance=r.dot(this._sphere.center)),!0):!1}isInViewCheck(l,n,r,h){return!!(n.intersectsSphere(this._sphere)&&!this._isCulled(h))}unload(){this._mesh!==null&&(this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh.geometry=null,this._mesh.parent.remove(this._mesh),this._mesh=null),this._depthMesh!==null&&(this._depthMesh.geometry.dispose(),this._depthMesh.material.dispose(),this._depthMesh.geometry=null,this._depthMesh.parent.remove(this._depthMesh),this._depthMesh=null),this.visible=!1,this.loaded=!1,this.memory=0}setPointSize(l){this._mesh!==null&&(this._mesh.material.size=l,this._depthMesh.material.size=l)}attenuateSize(l){if(this._mesh!==null){const n=this._mesh.material.sizeAttenuation!==l;this._mesh.material.sizeAttenuation=l,this._depthMesh.material.sizeAttenuation=l,n===!0&&(this._mesh.material.needsUpdate=!0,this._depthMesh.material.needsUpdate=!0)}}}},D,V),D.exports=B},7387:(D,V,f)=>{var R,B;R=[f(3681),f(1155)],B=f.dj.d(R,function(d,N){return class extends N{constructor(l,n,r,h){super(l,n),this._pointBudget=r,this.numPointsToLoad=0,this._maxLevel=h}getNumPointsLoaded(){let l=0;for(let n=0;n<this._blocks.length;n++)this._blocks[n].loaded&&(l+=this._blocks[n].info.numPoints);return l}setPointBudget(l){this._pointBudget=l}trimByPointBudget(l,n,r,h){let u=this.getNumPointsLoaded();for(;u>this._pointBudget;){const g=this._lru.getNext();this._blocks[g].isInViewCheck(l,n,r,h)&&this._blocks[g].weight>this.threshold?this._lru.put(this._blocks[g].info.blockIndex):this._blocks[g].unload(),u=u-this._blocks[g].info.numPoints}this._numPointsToLoad=0,console.log(this.getNumPointsLoaded())}stopLoadingByPointBudget(l){let n=!1;return this._numPointsToLoad=this._numPointsToLoad+this._blocksForLoading[l].numPoints,(this._numPointsToLoad>this._pointBudget||this._blocksForLoading[l].level>this._maxLevel)&&(this._blocksForLoading=[],n=!0),n}setPointSize(l){for(let n=0;n<this._blocks.length;n++)this._blocks[n].setPointSize(l)}attenuateSize(l){for(let n=0;n<this._blocks.length;n++)this._blocks[n].attenuateSize(l)}}},D,V),D.exports=B},4047:(D,V,f)=>{var R,B;R=[f(3681),f(1145)],B=f.dj.d(R,function(d,N){return class extends N{add(l,n){this._count=-1;const r=this._emptyGeometry();this._initMesh(l,r),this.globalClippingPlanes(n.globalClippingPlanes,n.globalClipping),this._setProperties(l)}refreshData(l,n){const r=new Float32Array(l);if(this._isDataEmpty=r.length===0,this._memoryUsed=r.length*4/1e6,this._isDataEmpty===!0)this._mesh.geometry.dispose(),this._mesh.geometry=this._emptyGeometry();else{const h=n.ColorByVertex===!0?Math.round(r.length/6):Math.round(r.length/3);this._count===h&&n.ColorByVertex===this._mesh.geometry.hasAttribute("color")?this._mesh.geometry=this._updateGeometry(r,h,n):(this._mesh.geometry.dispose(),this._mesh.geometry=this._initGeometry(r,h,n))}this._depthMesh.geometry=this._mesh.geometry}pick(l,n,r,h,u,g){if(this._pickable&&this._mesh!==null&&!this._clipped(r)){this._mesh.geometry.boundingSphere===null&&this._mesh.geometry.computeBoundingSphere();const p=this._mesh.geometry.boundingSphere.clone(),y=new d.Vector3,x=new d.Vector3,w=new d.Matrix4().copy(this._mesh.matrixWorld).invert(),M=l.camera.position.clone().applyMatrix4(w),T=l.ray.clone().applyMatrix4(w);let A=Number.MAX_SAFE_INTEGER,C,z=1,H=!1,q=this._mesh.material.size;if(this._mesh.material.sizeAttenuation||(q=Math.max(1.5*q,5),l.camera.type==="OrthographicCamera"?q*=h.radius/(Math.min(u.width,u.height)*l.camera.zoom):(H=!0,q*=Math.tan(l.camera.fov*Math.PI/360)/(u.height*l.camera.zoom))),p.applyMatrix4(this._mesh.matrixWorld),p.radius+=this._mesh.material.size,l.ray.intersectsSphere(p)===!1)return;q=q/((this._mesh.scale.x+this._mesh.scale.y+this._mesh.scale.z)/3);const P=q*q;let Z=!1,K=-1,Y=this._mesh.geometry.attributes.position.count;Y>this._dataStriding&&this._stridingFactor>1&&(Y=Math.ceil(Y/this._stridingFactor));for(let k=0;k<Y;k++)y.fromBufferAttribute(this._mesh.geometry.attributes.position,k),H&&(z=M.distanceToSquared(y)),C=T.distanceSqToPoint(y),C<P*z&&(Z=!0,C<A&&(A=C,K=k));Z&&(x.fromBufferAttribute(this._mesh.geometry.attributes.position,K).applyMatrix4(this._mesh.matrixWorld),A=x.distanceTo(r),n.push({point:x.toArray(),distance:A,object:g,picked:!0,id:K}))}}_constructProperties(l,n){super._constructProperties(l,n),this._setCustomCode()}_emptyGeometry(){const l=new d.BufferGeometry;return l.setAttribute("position",new d.Float32BufferAttribute([],3)),l.setAttribute("color",new d.Float32BufferAttribute([],3)),this._count=0,l.computeBoundingBox(),l}_initGeometry(l,n,r){const h=new d.BufferGeometry;return r.ColorByVertex?(h.setAttribute("position",new d.Float32BufferAttribute(l.slice(0,n*3),3)),h.setAttribute("color",new d.Float32BufferAttribute(l.slice(n*3,l.length),3))):h.setAttribute("position",new d.Float32BufferAttribute(l,3)),this._count=n,this._shuffle(h,r.ColorByVertex),h.setDrawRange(0,this._count),h.computeBoundingBox(),h}_updateGeometry(l,n,r){const h=this._mesh.geometry,u=h.getAttribute("position");if(u.copyArray(l.slice(0,n*3)),u.needsUpdate=!0,r.ColorByVertex){const g=h.getAttribute("color");g.copyArray(l.slice(n*3,l.length)),g.needsUpdate=!0}return this._shuffle(h,r.ColorByVertex),h.computeBoundingBox(),h}_shuffle(l,n){if(l.attributes.position.count>this._dataStriding&&this._stridingFactor>1){const r=l.attributes.position.count,h=Math.ceil(r/this._stridingFactor);let u,g,p,y,x;if(n===!0)for(u=0;u<h;u++)g=Math.floor(Math.random()*(r-u))+u,p=l.attributes.position.array[u*3],y=l.attributes.position.array[u*3+1],x=l.attributes.position.array[u*3+2],l.attributes.position.array[u*3]=l.attributes.position.array[g*3],l.attributes.position.array[u*3+1]=l.attributes.position.array[g*3+1],l.attributes.position.array[u*3+2]=l.attributes.position.array[g*3+2],l.attributes.position.array[g*3]=p,l.attributes.position.array[g*3+1]=y,l.attributes.position.array[g*3+2]=x,p=l.attributes.color.array[u*3],y=l.attributes.color.array[u*3+1],x=l.attributes.color.array[u*3+2],l.attributes.color.array[u*3]=l.attributes.color.array[g*3],l.attributes.color.array[u*3+1]=l.attributes.color.array[g*3+1],l.attributes.color.array[u*3+2]=l.attributes.color.array[g*3+2],l.attributes.color.array[g*3]=p,l.attributes.color.array[g*3+1]=y,l.attributes.color.array[g*3+2]=x;else for(u=0;u<h;u++)g=Math.floor(Math.random()*(r-u))+u,p=l.attributes.position.array[u*3],y=l.attributes.position.array[u*3+1],x=l.attributes.position.array[u*3+2],l.attributes.position.array[u*3]=l.attributes.position.array[g*3],l.attributes.position.array[u*3+1]=l.attributes.position.array[g*3+1],l.attributes.position.array[u*3+2]=l.attributes.position.array[g*3+2],l.attributes.position.array[g*3]=p,l.attributes.position.array[g*3+1]=y,l.attributes.position.array[g*3+2]=x}}updateOnInteraction(l){l&&this._mesh.geometry.attributes.position.count>this._dataStriding&&this._stridingFactor>1?(this._mesh.geometry.setDrawRange(0,Math.ceil(this._mesh.geometry.attributes.position.count/this._stridingFactor)),this._mesh.material.size=this._stridePointSize,this._depthMesh.material.size=this._stridePointSize):(this._mesh.geometry.setDrawRange(0,this._count),this._setPointSize(this._pointSize))}_constructMesh(l,n,r){this._mesh=new d.Points(l,this._initMaterial(!1,n,r)),this._depthMesh=new d.Points(l,this._initMaterial(!0,n,r))}_initMaterial(l,n,r){const h=new d.PointsMaterial({color:r,opacity:n.Alpha,transparent:!0,depthTest:!0,depthWrite:!0,premultipliedAlpha:l,clipIntersection:this._clipIntersection,side:d.DoubleSide});return h.size=n.PointSize,l?(h.blending=d.NoBlending,h.onBeforeCompile=this._addDepthToShader.bind(this)):h.onBeforeCompile=this._addPeelToShader.bind(this),h.customProgramCacheKey=this._setProgramCacheKey.bind(this),h}_setMaterialColor(l,n,r){l?this._mesh.material.color=new d.Color(1,1,1):this._mesh.material.color=n,this._mesh.material.vertexColors=l,this._mesh.material.needsUpdate=!0}_initEmissive(l){return this._initColor(Array.from(l.Color))}_setPointSize(l){this._mesh.material.size=l,this._depthMesh.material.size=l,this._pointSize=l}_setCustomCode(){this._customCode=`
                float dist = length(2.0 * gl_PointCoord - 1.0);
                if (dist > 1.0) {
                    discard;
                }`}_attenuateSize(l){const n=this._mesh.material.sizeAttenuation!==l;this._mesh.material.sizeAttenuation=l,this._depthMesh.material.sizeAttenuation=l,n===!0&&(this._mesh.material.needsUpdate=!0,this._depthMesh.material.needsUpdate=!0)}_setProperties(l){this._dataStriding=l.DataStriding,this._stridingFactor=l.StridingFactor,this._stridePointSize=l.StridePointSize,this._mesh.material.opacity=l.Alpha;const n=this._initColor(Array.from(l.Color));this._colorStyle(l.ColorByVertex,n,n),this._setPointSize(l.PointSize),this._attenuateSize(l.AttenuateSize),this._setPickable(l.Pickable),this._setLayer(l.Layer),this._visible(l.Visible),this._transform(Array.from(l.Transform)),this.localClippingPlanes(l.ClippingPlanes)}}},D,V),D.exports=B},6613:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){return class{constructor(){this.heap=[]}getLeftChildIndex(N){return 2*N+1}getRightChildIndex(N){return 2*N+2}getParentIndex(N){return Math.floor((N-1)/2)}hasLeftChild(N){return this.getLeftChildIndex(N)<this.heap.length}hasRightChild(N){return this.getRightChildIndex(N)<this.heap.length}hasParent(N){return this.getParentIndex(N)>=0}leftChild(N){return this.heap[this.getLeftChildIndex(N)]}rightChild(N){return this.heap[this.getRightChildIndex(N)]}parent(N){return this.heap[this.getParentIndex(N)]}swap(N,_){const l=this.heap[N];this.heap[N]=this.heap[_],this.heap[_]=l}peek(){return this.heap.length===0?null:this.heap[0]}peekBottom(){return this.heap.length===0?null:this.heap[this.heap.length-1]}removeBottom(){return this.heap.length===0?null:this.heap.length===1?this.heap.pop():this.heap.pop()}pop(){if(this.heap.length===0)return null;if(this.heap.length===1)return this.heap.pop();const N=this.heap[0];return this.heap[0]=this.heap.pop(),this.heapifyDown(),N}push(N){this.heap.push(N),this.heapifyUp()}heapifyUp(){let N=this.heap.length-1;for(;this.hasParent(N)&&(this.parent(N).level>this.heap[N].level||this.parent(N).level===this.heap[N].level&&this.parent(N).weight<this.heap[N].weight);){const _=this.getParentIndex(N);this.swap(_,N),N=_}}heapifyDown(){let N=0;for(;this.hasLeftChild(N);){let _=this.getLeftChildIndex(N);if(this.hasRightChild(N)&&(this.rightChild(N).level<this.leftChild(N).level||this.rightChild(N).level===this.leftChild(N).level&&this.rightChild(N).weight>this.leftChild(N).weight)&&(_=this.getRightChildIndex(N)),this.heap[N].level<this.heap[_].level||this.heap[N].level===this.heap[_].level&&this.heap[N].weight>this.heap[_].weight)break;this.swap(N,_),N=_}}length(){return this.heap.length}clear(){this.heap=[]}}},D,V),D.exports=B},1145:(D,V,f)=>{var R,B;R=[f(3681),f(329)],B=f.dj.d(R,function(d,N){return class extends N{refreshData(l,n){const r=new Float32Array(l);this._isDataEmpty=r.length===0,this._memoryUsed=r.length*4/1e6,this._mesh.geometry.dispose();const h=n.ColorByVertex===!0?Math.round(r.length/2):Math.round(r.length),u=this._initGeometry(r,h,n.ColorByVertex);this._mesh.geometry=u,this._depthMesh.geometry=u}add(l,n){const r=this._initGeometry([],0,l.ColorByVertex);this._rendererType(l,l.Wireframe),this._initMesh(l,r),this.globalClippingPlanes(n.globalClippingPlanes,n.globalClipping),this._setProperties(l)}getMemoryUsed(){return this._memoryUsed}globalClippingPlanes(l,n){this._localClipping=!n,n?(this._mesh.material.clippingPlanes=l,this._depthMesh.material.clippingPlanes=l):(this._mesh.material.clippingPlanes=this._clippingPlanes,this._depthMesh.material.clippingPlanes=this._clippingPlanes)}clipIntersection(l){this._clipIntersection=l,this._mesh.material.clipIntersection=l,this._depthMesh.material.clipIntersection=l}crop(l,n){this._cropExclude=l,this._numCropBoxes=n===!0?1:0,this._mesh.material.needsUpdate=!0,this._depthMesh.material.needsUpdate=!0}colorInBox(l){this._colorInBox=l,this._mesh.material.needsUpdate=!0}_constructProperties(l,n){this._renderingStyle=0,this._wireframe=!1,this._colorByVertex=!1,this._clipIntersection=n.clipIntersection,this._clippingPlanes=Object.freeze([]),this._side=d.DoubleSide,this._customCode="",this._memoryUsed=0}_rendererType(l,n){const r=this._renderingStyle;this._wireframe=n,n===!0?this._renderingStyle=1:this._renderingStyle=0,this._mesh!==null&&(this._renderingStyle!==r&&this._initMesh(l,this._mesh.geometry),this._renderingStyle===1&&(this._mesh.material.wireframe=this._wireframe,this._depthMesh.material.wireframe=this._wireframe))}_initMesh(l,n){let r=null;this._mesh!==null&&(this._scene.remove(this._mesh,this._depthMesh),r=this._mesh.material.clippingPlanes,this._mesh.material.dispose(),this._depthMesh.material.dispose());const h=this._initColor(Array.from(l.Color)),u=this._initEmissive(l);this._constructMesh(n,l,h),this._setMaterialColor(this._colorByVertex,h,u),this._mesh.material.vertexColors=this._colorByVertex,this._mesh.visible=l.Visible,this._mesh.matrixAutoUpdate=!1,this._mesh.matrix=this._initTransform(Array.from(l.Transform)),this._scene.add(this._mesh),this._depthMesh.visible=l.Visible,this._depthMesh.matrixAutoUpdate=!1,this._depthMesh.matrix=this._initTransform(Array.from(l.Transform)),this._depthScene.add(this._depthMesh),r!==null&&(this._mesh.material.clippingPlanes=r,this._depthMesh.material.clippingPlanes=r)}_constructMesh(l,n,r){switch(this._renderingStyle){case 0:this._mesh=new d.Mesh(l,this._initMaterial(!1,n,r)),this._depthMesh=new d.Mesh(l,this._initMaterial(!0,n,r));break;case 1:this._mesh=new d.Mesh(l,this._initMaterial(!1,n,r)),this._depthMesh=new d.Mesh(l,this._initMaterial(!0,n,r));break}}_initEmissive(l){return this._initColor(Array.from(l.EmissiveColor))}_initMaterial(l,n,r){let h;switch(this._renderingStyle){case 0:h=new d.MeshPhysicalMaterial({color:r,opacity:n.Alpha,transparent:!0,premultipliedAlpha:l,depthTest:!0,depthWrite:!0,clipIntersection:this._clipIntersection,side:this._side});break;case 1:h=new d.MeshStandardMaterial({color:r,opacity:n.Alpha,transparent:!0,wireframe:this._wireframe,premultipliedAlpha:l,depthTest:!0,depthWrite:!0,clipIntersection:this._clipIntersection,side:this._side});break}return l?(h.blending=d.NoBlending,h.onBeforeCompile=this._addDepthToShader.bind(this)):h.onBeforeCompile=this._addPeelToShader.bind(this),h.customProgramCacheKey=this._setProgramCacheKey.bind(this),h}_colorStyle(l,n,r){l===!1&&(this._mesh.material.color=n,this._mesh.material.emissive=r),this._colorByVertex!==l&&(this._setMaterialColor(l,n,r),this._colorByVertex=l)}_setMaterialColor(l,n,r){l?(this._mesh.material.color=new d.Color(1,1,1),this._renderingStyle===0&&(this._mesh.material.emissive=r)):(this._mesh.material.color=n,this._renderingStyle===0&&(this._mesh.material.emissive=r)),this._mesh.material.vertexColors=l,this._mesh.material.needsUpdate=!0}_specular(l,n){this._renderingStyle===0&&(this._mesh.material.roughness=1-l,this._mesh.material.metalness=n)}_clearcoat(l,n){if(this._renderingStyle===0){this._mesh.material.clearcoatRoughness=n;const r=this._mesh.material.clearcoat!==l&&(l===0||this._mesh.material.clearcoat===0);this._mesh.material.clearcoat=l,r&&(this._mesh.material.needsUpdate=!0)}}_setSide(l){switch(l){case"both":this._side=d.DoubleSide;break;case"front":this._side=d.FrontSide;break;case"back":this._side=d.BackSide;break}this._mesh.material.side=this._side,this._depthMesh.material.side=this._side}_setProperties(l){if(this._transform(Array.from(l.Transform)),Object.prototype.hasOwnProperty.call(l,"Visible")){this._mesh.material.opacity=l.Alpha;const n=this._initColor(Array.from(l.Color)),r=this._initEmissive(l);this._rendererType(l,l.Wireframe,l.Points),this._colorStyle(l.ColorByVertex,n,r),this._visible(l.Visible),this._specular(l.Shininess,l.Metalness),this._clearcoat(l.Clearcoat,l.ClearcoatRoughness),this.localClippingPlanes(l.ClippingPlanes),this._setLayer(l.Layer),this._setSide(l.Side)}}_initGeometry(l,n,r){const h=new d.BufferGeometry;return r?(h.setAttribute("position",new d.Float32BufferAttribute(l.slice(0,n),3)),h.setAttribute("color",new d.Float32BufferAttribute(l.slice(n,l.length),3))):h.setAttribute("position",new d.Float32BufferAttribute(l,3)),h.computeBoundingBox(),h.computeVertexNormals(),h}localClippingPlanes(l){this._initPlanes(l),this._localClipping&&(this._mesh.material.clippingPlanes=this._clippingPlanes,this._depthMesh.material.clippingPlanes=this._clippingPlanes)}_addDepthToShader(l){this._compileCustomCode(l,`if (u_passNumber == 2 ) {
                float prevDepth = texture( u_previousTexture, gl_FragCoord.xy / u_viewportSize ).x;
                if (gl_FragCoord.z < prevDepth + TOLERANCE ){
                    discard;
                }
            }
            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
            }`)}_addPeelToShader(l){this._compileCustomCode(l,`if (u_passNumber == 1 ) {
                    float priorDepth = texture( u_depthTexture, gl_FragCoord.xy / u_viewportSize ).x;
                    float accumulatedDepth = texture( u_previousTexture, gl_FragCoord.xy / u_viewportSize ).x;

                    // Should be between current depth and previous depth to be included
                    if (gl_FragCoord.z > priorDepth + TOLERANCE  || gl_FragCoord.z < accumulatedDepth + TOLERANCE ) {
                        discard;
                    }
                }
            }`)}_compileCustomCode(l,n){this._setGlobalUniforms(l.uniforms);const r=this._numCropBoxes>0||this._colorInBox===!0?"varying vec3 v_worldCoords;":"",h=this._numCropBoxes>0?`uniform vec3 u_cropMin;
            uniform vec3 u_cropMax;
            uniform vec3 u_cropCenter;
            uniform float u_cropRadius;
            uniform float u_cropHeight;`:"",u=this._colorInBox===!0?`uniform mat4 u_colorBoxMatrix;
            uniform vec3 u_colorBoxColor;`:"",g=l.fragmentShader.includes("<packing>")===!0?"":"#include <packing>";l.fragmentShader=[g,r,h,u,`#define TOLERANCE 0.000001
                uniform vec2 u_viewportSize;
                uniform sampler2D u_depthTexture;
                uniform sampler2D u_previousTexture;
                uniform int u_passNumber;
                ${l.fragmentShader}`].join(`
`);let p="",y="";this._colorInBox===!0&&(p=`vec4 pos = u_colorBoxMatrix * vec4(v_worldCoords, 1.0);
                vec3 s = step(vec3(-0.5), pos.xyz) - step(vec3(0.5), pos.xyz);
                if ((s.x * s.y * s.z) > 0.0) {
                    gl_FragColor.rgb = u_colorBoxColor;
                }`),this._numCropBoxes>0&&(this._cropExclude===!0?(this._globalData.cropType==="box"&&(y=`vec3 s = step(u_cropMin, v_worldCoords) - step(u_cropMax, v_worldCoords);
                        if (s.x * s.y * s.z > 0.0) {
                            discard;
                        }`),this._globalData.cropType==="sphere"&&(y=`float distanceFromWorldCoordsToCenter = distance(v_worldCoords, u_cropCenter);
                        if (distanceFromWorldCoordsToCenter <= u_cropRadius) {
                            discard;
                        }`),this._globalData.cropType==="cylinder"&&(y=`float distanceXYPlane = distance(vec2(v_worldCoords.x, v_worldCoords.y), vec2(u_cropCenter.x, u_cropCenter.y));
                        float distanceZAxis = abs(v_worldCoords.z - u_cropCenter.z);
                        if (distanceXYPlane <= u_cropRadius && distanceZAxis <= (u_cropHeight / 2.0f)) {
                            discard;
                        }`)):(this._globalData.cropType==="box"&&(y=`vec3 s = step(u_cropMin, v_worldCoords) - step(u_cropMax, v_worldCoords);
                        if (1.0 - (s.x * s.y * s.z) > 0.0) {
                            discard;
                        }`),this._globalData.cropType==="sphere"&&(y=`float distanceFromWorldCoordsToCenter = distance(v_worldCoords, u_cropCenter);
                        if (distanceFromWorldCoordsToCenter > u_cropRadius) {
                            discard;
                        }`),this._globalData.cropType==="cylinder"&&(y=`float distanceXYPlane = distance(vec2(v_worldCoords.x, v_worldCoords.y), vec2(u_cropCenter.x, u_cropCenter.y));
                        float distanceZAxis = abs(v_worldCoords.z - u_cropCenter.z);
                        if (distanceXYPlane > u_cropRadius || distanceZAxis > (u_cropHeight / 2.0f)) {
                            discard;
                        }`)));const x=[this._customCode,p,y,n].join(`
`);l.fragmentShader=l.fragmentShader.replace(/}$/gm,x),l.vertexShader=`varying vec3 v_worldCoords; 
                ${l.vertexShader}`,l.vertexShader=l.vertexShader.replace(/}$/gm,`vec4 worldCoords = modelMatrix * vec4(position, 1.0);
                v_worldCoords = worldCoords.xyz;
            }`)}_setProgramCacheKey(){return this._numCropBoxes>0?this._cropExclude===!0?this._colorInBox===!0?"5":"2":this._colorInBox===!0?"4":"1":this._colorInBox===!0?"3":"0"}}},D,V),D.exports=B},5069:(D,V,f)=>{var R,B;R=[f(3681),f(9392),f(5753),f(5663),f(4397),f(9751)],B=f.dj.d(R,function(d,N,_,l,n,r){return class extends d.EventDispatcher{constructor(u,g,p){super(),this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,ANIMATE:3,SCISSORS:4,ANNOTATE:5,WINDOWLEVEL:6,SELECT:7},this.state=this.STATE.NONE,this._visible=!0,this._opaque=!1,this._enabled=!0,this.defaultTarget=new d.Vector3,this.defaultPosition=new d.Vector3,this.defaultUp=new d.Vector3(0,0,1),this.defaultCameraVector=new d.Vector3,this._enableAxes=!0,this._enableHome=!0,this.enableDefault=!0,this.defaultLeftClick="auto",this.defaultMiddleClick="auto",this.defaultScroll="auto",this.defaultFit=!1,this._enableSelect=!1,this.objectInfo=!1,this.enableRotate=!0,this.rotateSpeed=4,this.rotateStyle=g.Rotate.Style,this.enableZoom=!0,this.zoomSpeed=2,this.dollySpeed=g.Zoom.DollySpeed,this.zoomStyle=g.Zoom.Style,this.dollyStyle=g.Zoom.DollyStyle,this.altitude=g.Zoom.Altitude,this.zoomLimits=new d.Vector2(.001,5e5),this.preserveZoom=g.Zoom.PreserveOnResize,this.enablePan=!0,this.panStyle=g.Pan.Style,this.panSpeed=.5,this._enableClipping=!0,this._enableSlice=!0,this._allowClipping=!0,this._allowSlice=!0,this._showScissors=!0,this._showCrop=!0,this._allowCrop=!0,this._allowScissors=!0,this._animation=new N(g.Animate),this._enablePoint=!0,this._enableLine=!0,this._enableAngle=!0,this._enablePolygon=!0,this._enableCuboid=!0,this._annotateNumElements=2,this._annotateHeadliner="line",this._annotateChild="point",this._annotateShowDropdown=!1,this._annotateUseDropDown=!0,this._annotateDropDownVisible=!1,this.maxAllowedClicks=0,this.enableWindowLevel=!0,this._allowWindowLevel=!0,this.windowLevelSpeed=1,this._augmentUseDropDown=!1,this._augmentDropDownVisible=!1,this._showAugment=!0,this._augmentStyle="default",this._toolbarNumElements=0,this._colorSum=1,this._buttonSize=24,this._tooltips=p,this._wireUpToolbarElements(u),this._message=new _(u),this._message.addEventListener("messageClosed",this._messageClosed.bind(this)),this.update(g)}update(u){this._animation.update(u.Animate),this.defaultCameraVector.set(u.Default.CameraVector[0],u.Default.CameraVector[1],u.Default.CameraVector[2]);const g=this.defaultPosition.distanceTo(this.defaultTarget);this.defaultPosition.copy(this.defaultCameraVector).setLength(g).add(this.defaultTarget),this.defaultUp.set(u.Default.CameraUpVector[0],u.Default.CameraUpVector[1],u.Default.CameraUpVector[2]),Math.abs(this.defaultCameraVector.normalize().dot(this.defaultUp))>.999&&this.defaultUp.set(0,-1,0),this.defaultLeftClick=u.Default.LeftClick,this.defaultMiddleClick=u.Default.MiddleClick,this.defaultScroll=u.Default.Scroll,this.rotateStyle=u.Rotate.Style,this.panStyle=u.Pan.Style,this.zoomStyle=u.Zoom.Style,this.dollyStyle=u.Zoom.DollyStyle,this.dollySpeed=u.Zoom.DollySpeed,this.altitude=u.Zoom.Altitude,this.zoomLimits.set(u.Zoom.Limits[0],u.Zoom.Limits[1]),this.preserveZoom=u.Zoom.PreserveOnResize,this._visible=u.Toolbar!=="off",this._hover=u.Toolbar==="hover",this.state=u.CurrentMode,this.enableRotate=u.Rotate.Enabled,this.enableZoom=u.Zoom.Enabled,this.enablePan=u.Pan.Enabled,this.enableDefault=u.Default.Enabled,this._enableAxes=u.Default.SnapToAxes,this.defaultFit=u.Default.Fit,this._enableSelect=u.Select.Enabled,this.objectInfo=u.Select.ObjectInfo,this._enableClipping=u.Clipping.Add&&u.Clipping.Enabled,this._enableSlice=u.Slice.Add&&u.Slice.Enabled,this.enableWindowLevel=u.WindowLevel.Enabled,this._showCrop=u.Crop.Visible,this._showAnnotate=u.Annotate.Visible,u.Annotate.Style==="default"?(this.state===this.STATE.ANNOTATE?(this.annotateStyle=this._annotateHeadliner,this._annotateShowDropdown=!1):(this.annotateStyle=u.Annotate.Style,this._annotateShowDropdown=!0),this._annotateUseDropDown=!0):(this.annotateStyle=u.Annotate.Style,this._annotateShowDropdown=!1,this._annotateUseDropDown=!1),this._showScissors=u.Scissors.Visible&&this.annotateStyle!=="scissors",this.zoomStyle==="dolly"?this.rotateStyle==="pov"?(this._zoomElement.className="iptToolbarButton iptToolbarWalk",this._zoomTooltip.content={text:this._tooltips[27]}):this.rotateStyle==="target"||this.rotateStyle==="fulcrum"?(this._zoomElement.className="iptToolbarButton iptToolbarZoom",this._zoomTooltip.content={text:this._tooltips[3]}):(this._zoomElement.className="iptToolbarButton iptToolbarDolly",this._zoomTooltip.content={text:this._tooltips[8]}):(this._zoomElement.className="iptToolbarButton iptToolbarZoom",this._zoomTooltip.content={text:this._tooltips[3]}),this._updateMessage(u.Message),this._updateAnnotateButton(),this._updateAugmentButton(),this._updateToolbar()}clearState(u=!1){this._updateState(this.STATE.NONE,u),this._annotateUseDropDown&&(this.annotateStyle="default",this._updateAnnotateButton()),this._hideDropDowns(),this._showInternal()}show(){this._opaque||!this._enabled||!this._visible||this._message.visible||(this._opaque=!0,this._showInternal(),this._fadeToolbar(!1))}hide(){this._opaque=!1,this._hideInternal()}blur(){this._opaque&&this._enabled&&this._visible&&(this._opaque=!1,this._toolbarBackgroundElement.style.opacity=0)}onPointerDown(){this._message.hide(),this._hideDropDowns(),this.show()}onPointerLeave(){this._hover&&this.hide()}contextualUpdate(u,g,p,y){const x=this._allowClipping;this._allowClipping=u;const w=this._allowSlice;this._allowSlice=g;const M=this._allowWindowLevel;this._allowWindowLevel=y;const T=this._allowScissors;this._allowScissors=p,this._allowScissors!==T?(this.state===this.STATE.SCISSORS&&this._updateState(this.STATE.NONE),this._updateAugmentButton(),this._updateToolbar()):this._allowWindowLevel!==M?(this.state===this.STATE.WINDOWLEVEL&&this._updateState(this.STATE.NONE),this._updateAugmentButton(),this._updateToolbar()):(this._updateAugmentButton(),(this._toolbarNumElements===0||this._allowClipping!==x||this._allowSlice!==w)&&this._updateToolbar())}updateCrop(u){const g=this._allowCrop;this._allowCrop=!u,this._allowCrop!==g&&(this._updateAugmentButton(),this._updateToolbar()),this._toolbarNumElements===0&&this._updateToolbar()}resize(u){this._message.resize(u)}setColor(u){this._colorSum=u[0]+u[1]+u[2],this._colorSum>2?n.setTheme(r.LIGHT):n.setTheme(r.DARK),this._message.setColor(this._colorSum),this._rotateElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._panElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._zoomElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._homeElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._clippingElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._augmentElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._cropElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._scissorsElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._windowLevelElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._selectElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._annotateElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._annotateLineElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._annotatePointElement.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._augmentArrow.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._annotateArrow.style.filter=this._colorSum>2?"invert(0%)":"invert(100%)",this._xAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#B7312C":"#FF7A74",this._yAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#008013":"#94EF84",this._zAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#1656A7":"#54B6FF",this._toolbarBackgroundElement.style.backgroundColor=this._colorSum>2?"white":"black",this._augmentBackgroundElement.style.backgroundColor=this._colorSum>2?"white":"black",this._annotateBackgroundElement.style.backgroundColor=this._colorSum>2?"white":"black"}enable(){this._enabled=!0,this._visible&&!this._hover&&this.show(),this._makeAxisLabelsPickable()}disable(){this._visible||this.hide(),this._enabled=!1,this._enableAxisLabels("none")}interruptAnimation(){this._animation.interruptible===!0&&this._updateState(this.STATE.NONE)}setNextFrame(u,g,p){this._animation.running===!0&&this._animation.setNextFrame(u,g,p)}_updateState(u,g=!1){const p=this.state;this.state=u,this.state!==p&&this.dispatchEvent({type:"modeChanged",message:this.state,priorState:p,cleanupInProgress:g}),this._makeAxisLabelsPickable()}isStateZoomable(){return this.state===this.STATE.NONE||this.state===this.STATE.ROTATE||this.state===this.STATE.PAN||this.state===this.STATE.WINDOWLEVEL||this.state===this.STATE.SELECT||this.isStateAnnotatable()}isStateHittable(){return this.state===this.STATE.NONE||this.isStateAnnotatable()}isStateAnnotatable(){return this.state===this.STATE.ANNOTATE}isStateDepthable(){return this.objectInfo===!0||this.state===this.STATE.SELECT||this.isStateAnnotatable()}isZoomStyleCursor(){return this.zoomStyle==="cursor"||this.zoomStyle==="restricted-cursor"}isStyleCursor(){return this.isZoomStyleCursor()||this.zoomStyle==="dolly"&&this.dollyStyle==="cursor"}_updateToolbar(){let u=0;this._toolbarNumElements=0,this._visible?(this.hide(),this._message.enabled&&this._message.icon!=="none"?(this._messageElement.style.right=u+"px",this._messageElement.style.pointerEvents="auto",this._messageElement.style.opacity=.9,u=u+this._buttonSize,this._toolbarNumElements+=1):(this._messageElement.style.visibility="hidden",this._messageElement.style.pointerEvents="none"),this.enableRotate||this.enableZoom||this.enablePan?(this._enableHome=!0,this._homeElement.style.right=u+"px",this._homeElement.style.visibility="visible",this._homeElement.style.pointerEvents="auto",u=u+this._buttonSize,this._toolbarNumElements+=1):(this._enableHome=!1,this._homeElement.style.visibility="hidden",this._homeElement.style.pointerEvents="none"),this.enableZoom?(this._zoomElement.style.right=u+"px",u=u+this._buttonSize,this._zoomElement.style.visibility="visible",this._zoomElement.style.pointerEvents="auto",this._toolbarNumElements+=1):(this._zoomElement.style.visibility="hidden",this._zoomElement.style.pointerEvents="none"),this.enablePan?(this._panElement.style.right=u+"px",this._panElement.style.visibility="visible",this._panElement.style.pointerEvents="auto",u=u+this._buttonSize,this._toolbarNumElements+=1):(this._panElement.style.visibility="hidden",this._panElement.style.pointerEvents="none"),this.enableRotate?(this._rotateElement.style.right=u+"px",this._rotateElement.style.visibility="visible",this._rotateElement.style.pointerEvents="auto",u=u+this._buttonSize,this._toolbarNumElements+=1):(this._rotateElement.style.visibility="hidden",this._rotateElement.style.pointerEvents="none"),this._enableSelect?(this._selectElement.style.right=u+"px",this._selectElement.style.visibility="visible",this._selectElement.style.pointerEvents="auto",u=u+this._buttonSize,this._toolbarNumElements+=1):(this._selectElement.style.visibility="hidden",this._selectElement.style.pointerEvents="none"),this._showAnnotate?(this._updateAnnotateDropdown(u),u=u+this._buttonSize,this._toolbarNumElements+=1):(this._annotateElement.style.visibility="hidden",this._annotateElement.style.pointerEvents="none"),this._showAugment?(this._updateAugmentDropdown(u),u=u+this._buttonSize,this._toolbarNumElements+=1):(this._augmentElement.style.visibility="hidden",this._augmentElement.style.pointerEvents="none"),this._hideDropDowns(),this._toolbarElement.style.width=this._toolbarNumElements*this._buttonSize+"px",this._makeAxisLabelsPickable(),this._opaque||!this._hover?this.show():this.hide()):this.hide()}_updateElement(u,g,p,y){return p?(g!==u&&(u.style.top=y+"px",y=y+this._buttonSize),u.style.visibility="visible",u.style.pointerEvents="auto"):(u.style.visibility="hidden",u.style.pointerEvents="none"),y}_updateAugmentButton(){const u=this._showAugment;this.state===this.STATE.SCISSORS?(this._augmentElement.className="iptToolbarButton iptToolbarScissors",this._augmentTooltip.content={text:this._tooltips[10]},this._showAugment=!0,this._augmentUseDropDown=!1,this._augmentStyle="scissors"):this.state===this.STATE.WINDOWLEVEL?(this._augmentElement.className="iptToolbarButton iptToolbarWindowLevel",this._augmentTooltip.content={text:this._tooltips[20]},this._showAugment=!0,this._augmentUseDropDown=!1,this._augmentStyle="window-level"):this._allowSlice?this._enableSlice?(this._augmentElement.className="iptToolbarButton iptToolbarSlice",this._augmentTooltip.content={text:this._tooltips[6]},this._showAugment=!0,this._augmentUseDropDown=!1,this._augmentStyle="slice"):(this._showAugment=!1,this._augmentUseDropDown=!1,this._augmentStyle="none"):(this._showScissors&&this._allowScissors)+(this._enableClipping&&this._allowClipping)+(this._showCrop&&this._allowCrop)+(this.enableWindowLevel&&this._allowWindowLevel)>1?(this._augmentElement.className="iptToolbarButton iptToolbarAugment",this._augmentTooltip.content={text:this._tooltips[7]},this._showAugment=!0,this._augmentUseDropDown=!0,this._augmentStyle="default"):this._showScissors&&this._allowScissors?(this._augmentElement.className="iptToolbarButton iptToolbarScissors",this._augmentTooltip.content={text:this._tooltips[10]},this._showAugment=!0,this._augmentUseDropDown=!1,this._augmentStyle="scissors"):this._enableClipping&&this._allowClipping?(this._augmentElement.className="iptToolbarButton iptToolbarClipping",this._augmentTooltip.content={text:this._tooltips[5]},this._showAugment=!0,this._augmentUseDropDown=!1,this._augmentStyle="clip"):this._showCrop&&this._allowCrop?(this._augmentElement.className="iptToolbarButton iptToolbarCrop",this._augmentTooltip.content={text:this._tooltips[9]},this._showAugment=!0,this._augmentUseDropDown=!1,this._augmentStyle="crop"):this.enableWindowLevel&&this._allowWindowLevel?(this._augmentElement.className="iptToolbarButton iptToolbarWindowLevel",this._augmentTooltip.content={text:this._tooltips[20]},this._showAugment=!0,this._augmentUseDropDown=!1,this._augmentStyle="window-level"):(this._showAugment=!1,this._augmentUseDropDown=!1),this._augmentUseDropDown||this._hideAugmentDropDown(),u!==this._showAugment&&this._updateToolbar()}_updateAugmentDropdown(u){let g=this._buttonSize+2;this._augmentDropdownElement.style.right=u+"px",this._showScissors&&this._allowScissors&&(this._scissorsElement.style.top=g+"px",g=g+this._buttonSize),this._enableClipping&&this._allowClipping&&(this._clippingElement.style.top=g+"px",g=g+this._buttonSize),this._showCrop&&this._allowCrop&&(this._cropElement.style.top=g+"px",g=g+this._buttonSize),this.enableWindowLevel&&this._allowWindowLevel&&(this._windowLevelElement.style.top=g+"px",g=g+this._buttonSize),this._augmentElement.style.visibility="visible",this._augmentElement.style.pointerEvents="auto",this._augmentBackgroundElement.style.top=this._buttonSize+6+"px",this._augmentBackgroundElement.style.height=g-(this._buttonSize+6)+"px"}_updateAnnotateDropdown(u){this._annotateElement.style.visibility="visible",this._annotateElement.style.pointerEvents="auto",this._annotateDropdownElement.style.right=u+"px",this._annotateLineElement.style.top=this._buttonSize+2+"px",this._annotatePointElement.style.top=2*this._buttonSize+2+"px",this._annotateBackgroundElement.style.top=this._buttonSize+6+"px",this._annotateBackgroundElement.style.height=3*this._buttonSize-(this._buttonSize+6)+"px"}_showInternal(){this._message.enabled&&!this._message.visible&&this._message.icon!=="none"&&(this._messageElement.style.visibility="visible"),this.enableRotate&&(this._rotateElement.style.opacity=.5,this._rotateElement.style.pointerEvents="auto"),this.enablePan&&(this._panElement.style.opacity=.5,this._panElement.style.pointerEvents="auto"),this.enableZoom&&(this._zoomElement.style.opacity=.5,this._zoomElement.style.pointerEvents="auto"),this._enableHome&&(this._homeElement.style.opacity=.5,this._homeElement.style.pointerEvents="auto"),this._enableSelect&&(this._selectElement.style.opacity=.5,this._selectElement.style.pointerEvents="auto"),this._showAnnotate&&(this._annotateElement.style.opacity=.5,this._annotateElement.style.pointerEvents="auto",this._annotateShowDropdown&&!this._annotateDropDownVisible&&this.state!==this.STATE.ANNOTATE?this._annotateArrow.style.opacity=.5:this._annotateArrow.style.opacity=0),this._showAugment&&(this._augmentElement.style.opacity=.5,this._augmentElement.style.pointerEvents="auto",this._augmentUseDropDown&&!this._augmentDropDownVisible?this._augmentArrow.style.opacity=.5:this._augmentArrow.style.opacity=0),this._toolbarNumElements>0&&(this._toolbarBackgroundElement.style.visibility="visible"),this._setSelectedOpacity()}_hideInternal(){this._message.visible&&(this._messageElement.style.visibility="hidden"),this.enableRotate&&(this._rotateElement.style.opacity=0,this._rotateElement.style.pointerEvents="none"),this.enablePan&&(this._panElement.style.opacity=0,this._panElement.style.pointerEvents="none"),this.enableZoom&&(this._zoomElement.style.opacity=0,this._zoomElement.style.pointerEvents="none"),this._enableHome&&(this._homeElement.style.opacity=0,this._homeElement.style.pointerEvents="none"),this._enableSelect&&(this._selectElement.style.opacity=0,this._selectElement.style.pointerEvents="none"),this._showAnnotate&&(this._annotateElement.style.opacity=0,this._annotateElement.style.pointerEvents="none"),this._showAugment&&(this._augmentElement.style.opacity=0,this._augmentElement.style.pointerEvents="none"),this._toolbarBackgroundElement.style.visibility="hidden",this._hideDropDowns(),this._augmentArrow.style.opacity=0,this._annotateArrow.style.opacity=0}_makeAxisLabelsPickable(){this._enableAxisLabels(this._enableAxes&&this.state!==this.STATE.ANIMATE?"visible":"none")}_enableAxisLabels(u){this._xAxisElement.style.pointerEvents=u,this._yAxisElement.style.pointerEvents=u,this._zAxisElement.style.pointerEvents=u}_setSelectedOpacity(){switch(this.state){case this.STATE.ROTATE:this._rotateElement.style.opacity=1;break;case this.STATE.ZOOM:this._zoomElement.style.opacity=1;break;case this.STATE.PAN:this._panElement.style.opacity=1;break;case this.STATE.SCISSORS:this.annotateStyle==="scissors"?this._annotateElement.style.opacity=1:this._augmentElement.style.opacity=1;break;case this.STATE.ANNOTATE:this._annotateElement.style.opacity=1;break;case this.STATE.WINDOWLEVEL:this._augmentElement.style.opacity=1;break;case this.STATE.SELECT:this._selectElement.style.opacity=1;break;default:break}}_homeClicked(){this.state===this.STATE.ANIMATE&&this._updateState(this.STATE.NONE),this.dispatchEvent({type:"homeClicked"})}_messageClicked(){this._message.show(),this.hide()}_rotateClicked(){this._updateState(this.state===this.STATE.ROTATE?this.STATE.NONE:this.STATE.ROTATE),this._hideDropDowns(),this._showInternal()}_panClicked(){this._updateState(this.state===this.STATE.PAN?this.STATE.NONE:this.STATE.PAN),this._hideDropDowns(),this._showInternal()}_zoomClicked(){this._updateState(this.state===this.STATE.ZOOM?this.STATE.NONE:this.STATE.ZOOM),this._hideDropDowns(),this._showInternal()}_clippingClicked(){this._updateState(this.STATE.NONE),this._hideDropDowns(),this._showInternal(),this.dispatchEvent({type:"widgetAdded",name:"ClippingPlaneAdded"})}_sliceClicked(){this._updateState(this.STATE.NONE),this._hideDropDowns(),this._showInternal(),this.dispatchEvent({type:"widgetAdded",name:"SlicePlaneAdded"})}_cropClicked(){this._updateState(this.STATE.NONE),this._hideDropDowns(),this._showInternal(),this.dispatchEvent({type:"widgetAdded",name:"CropBoxAdded"})}_scissorsClicked(){this._updateState(this.state===this.STATE.SCISSORS?this.STATE.NONE:this.STATE.SCISSORS),this._updateAugmentButton(),this._hideDropDowns(),this._showInternal()}_windowLevelClicked(){this._updateState(this.state===this.STATE.WINDOWLEVEL?this.STATE.NONE:this.STATE.WINDOWLEVEL),this._updateAugmentButton(),this._hideDropDowns(),this._showInternal()}_selectClicked(){this._updateState(this.state===this.STATE.SELECT?this.STATE.NONE:this.STATE.SELECT),this._hideDropDowns(),this._showInternal()}_augmentClicked(){if(this.state===this.STATE.SCISSORS)this._updateState(this.STATE.NONE);else if(this.state===this.STATE.WINDOWLEVEL)this._updateState(this.STATE.NONE);else switch(this._augmentStyle){case"default":this._augmentDropDownVisible?this._hideAugmentDropDown():this._showAugmentDropDown();break;case"scissors":this._updateState(this.STATE.SCISSORS);break;case"window-level":this._updateState(this.STATE.WINDOWLEVEL);break;case"slice":this._updateState(this.STATE.NONE),this.dispatchEvent({type:"widgetAdded",name:"SlicePlaneAdded"});break;case"clip":this._clippingClicked();return;case"crop":this._cropClicked();return}this._hideAnnotateDropDown(),this._updateAugmentButton(),this._showInternal()}_annotateClicked(){this.annotateStyle==="default"?this._annotateDropDownVisible?this._hideAnnotateDropDown():this._showAnnotateDropDown():this.annotateStyle==="scissors"?this._updateState(this.state===this.STATE.SCISSORS?this.STATE.NONE:this.STATE.SCISSORS):this.state===this.STATE.ANNOTATE?(this._annotateUseDropDown&&(this.annotateStyle="default"),this._updateState(this.STATE.NONE)):this._updateState(this.STATE.ANNOTATE),this._hideAugmentDropDown(),this._updateAnnotateButton(),this._showInternal()}_annotateLineClicked(){this.annotateStyle="line",this._updateState(this.state===this.STATE.ANNOTATE?this.STATE.NONE:this.STATE.ANNOTATE),this._updateAnnotateButton(),this._hideDropDowns(),this._showInternal()}_annotatePointClicked(){this.annotateStyle="point",this._updateState(this.state===this.STATE.ANNOTATE?this.STATE.NONE:this.STATE.ANNOTATE),this._updateAnnotateButton(),this._hideDropDowns(),this._showInternal()}_xClicked(){this.dispatchEvent({type:"axesClicked",message:0})}_yClicked(){this.dispatchEvent({type:"axesClicked",message:1})}_zClicked(){this.dispatchEvent({type:"axesClicked",message:2})}_xHovered(u){u.type==="pointerenter"?this._xAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#FF7A74":"#FF9D9A":this._xAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#B7312C":"#FF7A74"}_yHovered(u){u.type==="pointerenter"?this._yAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#94EF84":"#CBFFBE":this._yAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#008013":"#94EF84"}_zHovered(u){u.type==="pointerenter"?this._zAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#54B6FF":"#83CAFF":this._zAxisElement.style.color=this._colorSum<.7||this._colorSum>2?"#1656A7":"#54B6FF"}_homeHovered(u){this._onHover(u.type,this._homeElement,!1)}_messageHovered(u){u.type==="pointerenter"?(this._messageElement.style.opacity=1,this._fadeToolbar(!0)):(this._messageElement.style.opacity=.9,this._fadeToolbar(!1))}_rotateHovered(u){this._onHover(u.type,this._rotateElement,this.state===this.STATE.ROTATE)}_panHovered(u){this._onHover(u.type,this._panElement,this.state===this.STATE.PAN)}_zoomHovered(u){this._onHover(u.type,this._zoomElement,this.state===this.STATE.ZOOM)}_clippingHovered(u){u.type==="pointerenter"?this._onHover(u.type,this._clippingElement,!1):this._augmentDropDownVisible&&this._onHover(u.type,this._clippingElement,!1)}_cropHovered(u){u.type==="pointerenter"?this._onHover(u.type,this._cropElement,!1):this._augmentDropDownVisible&&this._onHover(u.type,this._cropElement,!1)}_scissorsHovered(u){u.type==="pointerenter"?this._onHover(u.type,this._scissorsElement,!1):this._augmentDropDownVisible&&this._onHover(u.type,this._scissorsElement,!1)}_windowLevelHovered(u){u.type==="pointerenter"?this._onHover(u.type,this._windowLevelElement,!1):this._augmentDropDownVisible&&this._onHover(u.type,this._windowLevelElement,!1)}_selectHovered(u){this._onHover(u.type,this._selectElement,this.state===this.STATE.SELECT)}_augmentHovered(u){this._onHover(u.type,this._augmentElement,this.state===this.STATE.SCISSORS||this.state===this.STATE.WINDOWLEVEL)}_annotateHovered(u){this.annotateStyle==="scissors"?this._onHover(u.type,this._annotateElement,this.state===this.STATE.SCISSORS):this._onHover(u.type,this._annotateElement,this.state===this.STATE.ANNOTATE)}_annotateLineHovered(u){u.type==="pointerenter"?this._onHover(u.type,this._annotateLineElement,!1):this._annotateDropDownVisible&&this._onHover(u.type,this._annotateLineElement,!1)}_annotatePointHovered(u){u.type==="pointerenter"?this._onHover(u.type,this._annotatePointElement,!1):this._annotateDropDownVisible&&this._onHover(u.type,this._annotatePointElement,!1)}_onHover(u,g,p){this._enabled&&(u==="pointerenter"?(g.style.opacity=p?1:.7,this._fadeToolbar(!0)):(g.style.opacity=p?1:.5,this._fadeToolbar(!1)))}_fadeToolbar(u){const g=u===!0?this._colorSum>2?.8:.6:.4;this._toolbarBackgroundElement.style.opacity=g,this._annotateBackgroundElement.style.opacity=g,this._augmentBackgroundElement.style.opacity=g}_showAugmentDropDown(){this._augmentUseDropDown&&(this._enableClipping&&this._allowClipping&&(this._clippingElement.style.opacity=.5,this._clippingElement.style.pointerEvents="auto"),this._showScissors&&this._allowScissors&&(this._scissorsElement.style.opacity=.5,this._scissorsElement.style.pointerEvents="auto"),this._showCrop&&this._allowCrop&&(this._cropElement.style.opacity=.5,this._cropElement.style.pointerEvents="auto"),this.enableWindowLevel&&this._allowWindowLevel&&(this._windowLevelElement.style.opacity=.5,this._windowLevelElement.style.pointerEvents="auto"),this._augmentArrow.style.opacity=0,this._augmentBackgroundElement.style.visibility="visible",this._augmentDropDownVisible=!0,this._updateToolbarBevel())}_hideAugmentDropDown(){this._scissorsElement.style.opacity=0,this._scissorsElement.style.pointerEvents="none",this._clippingElement.style.opacity=0,this._clippingElement.style.pointerEvents="none",this._cropElement.style.opacity=0,this._cropElement.style.pointerEvents="none",this._windowLevelElement.style.opacity=0,this._windowLevelElement.style.pointerEvents="none",this._opaque===!0&&this._augmentUseDropDown?this._augmentArrow.style.opacity=.5:this._augmentArrow.style.opacity=0,this._augmentBackgroundElement.style.visibility="hidden",this._toolbarBackgroundElement.style.borderRadius="6px 6px 6px 6px",this._augmentDropDownVisible=!1,this._updateToolbarBevel()}_showAnnotateDropDown(){this._annotateShowDropdown&&(this._annotateLineElement.style.opacity=.5,this._annotateLineElement.style.pointerEvents="auto",this._annotatePointElement.style.opacity=.5,this._annotatePointElement.style.pointerEvents="auto",this._annotateArrow.style.opacity=0,this._annotateBackgroundElement.style.visibility="visible",this._annotateDropDownVisible=!0,this._updateToolbarBevel())}_hideAnnotateDropDown(){this._annotateLineElement.style.opacity=0,this._annotateLineElement.style.pointerEvents="none",this._annotatePointElement.style.opacity=0,this._annotatePointElement.style.pointerEvents="none",this._opaque===!0&&this._showAnnotate&&this._annotateShowDropdown&&this.state!==this.STATE.ANNOTATE?this._annotateArrow.style.opacity=.5:this._annotateArrow.style.opacity=0,this._annotateBackgroundElement.style.visibility="hidden",this._annotateDropDownVisible=!1,this._updateToolbarBevel()}_hideDropDowns(){this._hideAnnotateDropDown(),this._hideAugmentDropDown()}_updateToolbarBevel(){this._annotateDropDownVisible||this._augmentDropDownVisible?this._toolbarNumElements>1?this._augmentDropDownVisible?this._toolbarBackgroundElement.style.borderRadius="6px 6px 6px 0px":this._showAugment?this._toolbarBackgroundElement.style.borderRadius="6px 6px 6px 6px":this._toolbarBackgroundElement.style.borderRadius="6px 6px 6px 0px":this._toolbarNumElements>0?this._toolbarBackgroundElement.style.borderRadius="6px 6px 0px 0px":this._toolbarBackgroundElement.style.borderRadius="6px 6px 6px 6px":this._toolbarBackgroundElement.style.borderRadius="6px 6px 6px 6px"}_animationStopped(u){this.dispatchEvent(u)}_updateAnnotateButton(){switch(this.annotateStyle){case"thumbnail":case"point":this._annotateElement.className="iptToolbarButton iptToolbarPoint",this._annotateTooltip.content={text:this._tooltips[11]},this.maxAllowedClicks=1;break;case"line":this._annotateElement.className="iptToolbarButton iptToolbarLine",this._annotateTooltip.content={text:this._tooltips[12]},this.maxAllowedClicks=1;break;case"angle":this._annotateElement.className="iptToolbarButton iptToolbarAngle",this._annotateTooltip.content={text:this._tooltips[13]},this.maxAllowedClicks=3;break;case"elevation":this._annotateElement.className="iptToolbarButton iptToolbarHeight",this._annotateTooltip.content={text:this._tooltips[16]},this.maxAllowedClicks=1;break;case"polyline":case"polygon":this._annotateElement.className="iptToolbarButton iptToolbarPolygon",this._annotateTooltip.content={text:this._tooltips[14]},this.maxAllowedClicks=Number.MAX_SAFE_INTEGER;break;case"cuboid":this._annotateElement.className="iptToolbarButton iptToolbarCuboid",this._annotateTooltip.content={text:this._tooltips[15]},this.maxAllowedClicks=1;break;case"rectangle":this._annotateElement.className="iptToolbarButton iptToolbarRectangle",this._annotateTooltip.content={text:this._tooltips[18]},this.maxAllowedClicks=1;break;case"freehand":this._annotateElement.className="iptToolbarButton iptToolbarFreehand",this._annotateTooltip.content={text:this._tooltips[19]},this.maxAllowedClicks=Number.MAX_SAFE_INTEGER;break;case"scissors":this._annotateElement.className="iptToolbarButton iptToolbarCut",this._annotateTooltip.content={text:this._tooltips[17]},this.maxAllowedClicks=Number.MAX_SAFE_INTEGER;break;case"paint":this._annotateElement.className="iptToolbarButton iptToolbarPaint",this._annotateTooltip.content={text:this._tooltips[23]},this.maxAllowedClicks=1;break;case"caliper":this._annotateElement.className="iptToolbarButton iptToolbarLine",this._annotateTooltip.content={text:this._tooltips[24]},this.maxAllowedClicks=1;break;case"circle":this._annotateElement.className="iptToolbarButton iptToolbarPoint",this._annotateTooltip.content={text:this._tooltips[25]},this.maxAllowedClicks=1;break;case"t-square":this._annotateElement.className="iptToolbarButton iptToolbarLine",this._annotateTooltip.content={text:this._tooltips[26]},this.maxAllowedClicks=Number.MAX_SAFE_INTEGER;break;case"default":this._annotateElement.className="iptToolbarButton iptToolbarAnnotate",this._annotateTooltip.content={text:this._tooltips[2]},this.maxAllowedClicks=0;break}}_updateMessage(u){if(this._message.update(u),this._message.enabled)switch(this._message.icon){case"warning":this._messageElement.className="iptToolbarButton iptToolbarWarning";break;case"error":this._messageElement.className="iptToolbarButton iptToolbarError";break;case"info":this._messageElement.className="iptToolbarButton iptToolbarInfo";break}}_messageClosed(u){this._updateToolbar(),u.message?this.dispatchEvent(u):this.show()}_wireUpToolbarElements(u){this._toolbarElement=document.createElement("div"),this._toolbarElement.className="iptToolbar",u.appendChild(this._toolbarElement),this._toolbarBackgroundElement=document.createElement("div"),this._toolbarBackgroundElement.className="iptBackground",this._toolbarBackgroundElement.style.transitionProperty="opacity",this._toolbarBackgroundElement.style.transitionDuration="2s",this._toolbarBackgroundElement.style.transitionTimingFunction="ease-in-out",this._toolbarElement.appendChild(this._toolbarBackgroundElement),this._augmentDropdownElement=document.createElement("div"),this._augmentDropdownElement.className="iptToolbarDropdown",this._toolbarElement.appendChild(this._augmentDropdownElement),this._augmentBackgroundElement=document.createElement("div"),this._augmentBackgroundElement.className="iptBackground",this._augmentBackgroundElement.style.borderRadius="0px 0px 6px 6px",this._augmentBackgroundElement.style.transitionProperty="opacity",this._augmentBackgroundElement.style.transitionDuration="2s",this._augmentBackgroundElement.style.transitionTimingFunction="ease-in-out",this._augmentDropdownElement.appendChild(this._augmentBackgroundElement),this._augmentElement=document.createElement("div"),this._augmentElement.className="iptToolbarButton iptToolbarAugment",this._augmentDropdownElement.appendChild(this._augmentElement),this._scissorsElement=document.createElement("div"),this._scissorsElement.className="iptToolbarButton iptToolbarScissors",this._augmentDropdownElement.appendChild(this._scissorsElement),this._windowLevelElement=document.createElement("div"),this._windowLevelElement.className="iptToolbarButton iptToolbarWindowLevel",this._augmentDropdownElement.appendChild(this._windowLevelElement),this._clippingElement=document.createElement("div"),this._clippingElement.className="iptToolbarButton iptToolbarClipping",this._augmentDropdownElement.appendChild(this._clippingElement),this._cropElement=document.createElement("div"),this._cropElement.className="iptToolbarButton iptToolbarCrop",this._augmentDropdownElement.appendChild(this._cropElement),this._augmentArrow=document.createElement("div"),this._augmentArrow.className="iptToolbarArrow",this._augmentDropdownElement.appendChild(this._augmentArrow),this._homeElement=document.createElement("div"),this._homeElement.className="iptToolbarButton iptToolbarHome",this._toolbarElement.appendChild(this._homeElement),this._annotateDropdownElement=document.createElement("div"),this._annotateDropdownElement.className="iptToolbarDropdown",this._annotateDropdownElement.style.height="44px",this._toolbarElement.appendChild(this._annotateDropdownElement),this._annotateBackgroundElement=document.createElement("div"),this._annotateBackgroundElement.className="iptBackground",this._annotateBackgroundElement.style.borderRadius="0px 0px 6px 6px",this._annotateBackgroundElement.style.transitionProperty="opacity",this._annotateBackgroundElement.style.transitionDuration="2s",this._annotateBackgroundElement.style.transitionTimingFunction="ease-in-out",this._annotateDropdownElement.appendChild(this._annotateBackgroundElement),this._annotateElement=document.createElement("div"),this._annotateElement.className="iptToolbarButton iptToolbarAnnotate",this._annotateDropdownElement.appendChild(this._annotateElement),this._annotateLineElement=document.createElement("div"),this._annotateLineElement.className="iptToolbarButton iptToolbarLine",this._annotateDropdownElement.appendChild(this._annotateLineElement),this._annotatePointElement=document.createElement("div"),this._annotatePointElement.className="iptToolbarButton iptToolbarPoint",this._annotateDropdownElement.appendChild(this._annotatePointElement),this._annotateArrow=document.createElement("div"),this._annotateArrow.className="iptToolbarArrow",this._annotateDropdownElement.appendChild(this._annotateArrow),this._rotateElement=document.createElement("div"),this._rotateElement.className="iptToolbarButton iptToolbarRotate",this._toolbarElement.appendChild(this._rotateElement),this._panElement=document.createElement("div"),this._panElement.className="iptToolbarButton iptToolbarPan",this._toolbarElement.appendChild(this._panElement),this._zoomElement=document.createElement("div"),this._zoomElement.className="iptToolbarButton iptToolbarZoom",this._toolbarElement.appendChild(this._zoomElement),this._selectElement=document.createElement("div"),this._selectElement.className="iptToolbarButton iptToolbarSelect",this._toolbarElement.appendChild(this._selectElement),this._messageElement=document.createElement("div"),this._messageElement.className="iptToolbarButton iptToolbarError",this._toolbarElement.appendChild(this._messageElement),this._xAxisElement=u.getElementsByClassName("iptOrientationAxesX")[0],this._yAxisElement=u.getElementsByClassName("iptOrientationAxesY")[0],this._zAxisElement=u.getElementsByClassName("iptOrientationAxesZ")[0];try{this._rotateTooltip=l.createTooltip({referenceNode:this._rotateElement,content:{text:this._tooltips[4]}}),this._panTooltip=l.createTooltip({referenceNode:this._panElement,content:{text:this._tooltips[1]}}),this._homeTooltip=l.createTooltip({referenceNode:this._homeElement,content:{text:this._tooltips[0]}}),this._zoomTooltip=l.createTooltip({referenceNode:this._zoomElement,content:{text:this._tooltips[3]}}),this._clipTooltip=l.createTooltip({referenceNode:this._clippingElement,content:{text:this._tooltips[5]}}),this._cropTooltip=l.createTooltip({referenceNode:this._cropElement,content:{text:this._tooltips[9]}}),this._scissorsTooltip=l.createTooltip({referenceNode:this._scissorsElement,content:{text:this._tooltips[10]}}),this._windowLevelTooltip=l.createTooltip({referenceNode:this._windowLevelElement,content:{text:this._tooltips[20]}}),this._annotateTooltip=l.createTooltip({referenceNode:this._annotateElement,content:{text:this._tooltips[2]}}),this._annotateLineElementTooltip=l.createTooltip({referenceNode:this._annotateLineElement,content:{text:this._tooltips[12]}}),this._annotatePointElementTooltip=l.createTooltip({referenceNode:this._annotatePointElement,content:{text:this._tooltips[11]}}),this._messageTooltip=l.createTooltip({referenceNode:this._messageElement,content:{text:this._tooltips[21]}}),this._selectTooltip=l.createTooltip({referenceNode:this._selectElement,content:{text:this._tooltips[22]}}),this._augmentTooltip=l.createTooltip({referenceNode:this._augmentElement,content:{text:this._tooltips[7]}})}catch(g){}this._xAxisElement.addEventListener("click",this._xClicked.bind(this)),this._yAxisElement.addEventListener("click",this._yClicked.bind(this)),this._zAxisElement.addEventListener("click",this._zClicked.bind(this)),this._xAxisElement.addEventListener("pointerenter",this._xHovered.bind(this)),this._yAxisElement.addEventListener("pointerenter",this._yHovered.bind(this)),this._zAxisElement.addEventListener("pointerenter",this._zHovered.bind(this)),this._xAxisElement.addEventListener("pointerleave",this._xHovered.bind(this)),this._yAxisElement.addEventListener("pointerleave",this._yHovered.bind(this)),this._zAxisElement.addEventListener("pointerleave",this._zHovered.bind(this)),this._homeElement.addEventListener("click",this._homeClicked.bind(this)),this._rotateElement.addEventListener("click",this._rotateClicked.bind(this)),this._panElement.addEventListener("click",this._panClicked.bind(this)),this._zoomElement.addEventListener("click",this._zoomClicked.bind(this)),this._clippingElement.addEventListener("click",this._clippingClicked.bind(this)),this._cropElement.addEventListener("click",this._cropClicked.bind(this)),this._scissorsElement.addEventListener("click",this._scissorsClicked.bind(this)),this._windowLevelElement.addEventListener("click",this._windowLevelClicked.bind(this)),this._annotateElement.addEventListener("click",this._annotateClicked.bind(this)),this._augmentElement.addEventListener("click",this._augmentClicked.bind(this)),this._annotateLineElement.addEventListener("click",this._annotateLineClicked.bind(this)),this._annotatePointElement.addEventListener("click",this._annotatePointClicked.bind(this)),this._messageElement.addEventListener("click",this._messageClicked.bind(this)),this._selectElement.addEventListener("click",this._selectClicked.bind(this)),this._homeElement.addEventListener("pointerenter",this._homeHovered.bind(this)),this._rotateElement.addEventListener("pointerenter",this._rotateHovered.bind(this)),this._panElement.addEventListener("pointerenter",this._panHovered.bind(this)),this._zoomElement.addEventListener("pointerenter",this._zoomHovered.bind(this)),this._clippingElement.addEventListener("pointerenter",this._clippingHovered.bind(this)),this._cropElement.addEventListener("pointerenter",this._cropHovered.bind(this)),this._scissorsElement.addEventListener("pointerenter",this._scissorsHovered.bind(this)),this._windowLevelElement.addEventListener("pointerenter",this._windowLevelHovered.bind(this)),this._annotateElement.addEventListener("pointerenter",this._annotateHovered.bind(this)),this._augmentElement.addEventListener("pointerenter",this._augmentHovered.bind(this)),this._annotateLineElement.addEventListener("pointerenter",this._annotateLineHovered.bind(this)),this._annotatePointElement.addEventListener("pointerenter",this._annotatePointHovered.bind(this)),this._messageElement.addEventListener("pointerenter",this._messageHovered.bind(this)),this._selectElement.addEventListener("pointerenter",this._selectHovered.bind(this)),this._homeElement.addEventListener("pointerleave",this._homeHovered.bind(this)),this._rotateElement.addEventListener("pointerleave",this._rotateHovered.bind(this)),this._panElement.addEventListener("pointerleave",this._panHovered.bind(this)),this._zoomElement.addEventListener("pointerleave",this._zoomHovered.bind(this)),this._clippingElement.addEventListener("pointerleave",this._clippingHovered.bind(this)),this._cropElement.addEventListener("pointerleave",this._cropHovered.bind(this)),this._scissorsElement.addEventListener("pointerleave",this._scissorsHovered.bind(this)),this._windowLevelElement.addEventListener("pointerleave",this._windowLevelHovered.bind(this)),this._annotateElement.addEventListener("pointerleave",this._annotateHovered.bind(this)),this._augmentElement.addEventListener("pointerleave",this._augmentHovered.bind(this)),this._annotateLineElement.addEventListener("pointerleave",this._annotateLineHovered.bind(this)),this._annotatePointElement.addEventListener("pointerleave",this._annotatePointHovered.bind(this)),this._animation.addEventListener("animationFinished",this._animationStopped.bind(this)),this._messageElement.addEventListener("pointerleave",this._messageHovered.bind(this)),this._selectElement.addEventListener("pointerleave",this._selectHovered.bind(this))}dispose(){this._message.dispose(),this._homeElement.removeEventListener("click",this._homeClicked.bind(this)),this._rotateElement.removeEventListener("click",this._rotateClicked.bind(this)),this._panElement.removeEventListener("click",this._panClicked.bind(this)),this._zoomElement.removeEventListener("click",this._zoomClicked.bind(this)),this._clippingElement.removeEventListener("click",this._clippingClicked.bind(this)),this._messageElement.removeEventListener("click",this._messageClicked.bind(this)),this._selectElement.removeEventListener("click",this._selectClicked.bind(this)),this._homeElement.removeEventListener("pointerenter",this._homeHovered.bind(this)),this._rotateElement.removeEventListener("pointerenter",this._rotateHovered.bind(this)),this._panElement.removeEventListener("pointerenter",this._panHovered.bind(this)),this._zoomElement.removeEventListener("pointerenter",this._zoomHovered.bind(this)),this._clippingElement.removeEventListener("pointerenter",this._clippingHovered.bind(this)),this._messageElement.removeEventListener("pointerenter",this._messageHovered.bind(this)),this._selectElement.removeEventListener("pointerenter",this._selectHovered.bind(this)),this._homeElement.removeEventListener("pointerleave",this._homeHovered.bind(this)),this._rotateElement.removeEventListener("pointerleave",this._rotateHovered.bind(this)),this._panElement.removeEventListener("pointerleave",this._panHovered.bind(this)),this._zoomElement.removeEventListener("pointerleave",this._zoomHovered.bind(this)),this._clippingElement.removeEventListener("pointerleave",this._clippingHovered.bind(this)),this._messageElement.removeEventListener("pointerleave",this._messageHovered.bind(this)),this._selectElement.removeEventListener("pointerleave",this._selectHovered.bind(this)),this._rotateTooltip.destroy(),this._panTooltip.destroy(),this._homeTooltip.destroy(),this._zoomTooltip.destroy(),this._clipTooltip.destroy(),this._cropTooltip.destroy(),this._scissorsTooltip.destroy(),this._windowLevelTooltip.destroy(),this._annotateTooltip.destroy(),this._messageTooltip.destroy(),this._selectTooltip.destroy(),this._augmentTooltip.destroy()}}},D,V),D.exports=B},7290:(D,V,f)=>{var R,B;R=[f(3681),f(210),f(9782),f(6337),f(2158),f(1145),f(4047),f(4297),f(1756),f(7031),f(7450),f(7498),f(665),f(2487),f(9632),f(5872),f(5060),f(6508),f(7385)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u,g,p,y,x,w,M,T,A,C,z,H){return class{constructor(P){this._renderer=null,this._composer=null,this._scene=null,this._depthScene=null,this._deferredScene=null,this._overviewScene=null,this._annotationScene=null,this._controls=null,this._memory=null,this._wireframe=null,this._grid=null,this._canvas=null,this._context=null,this._hasContext=!1,this._scaleBar=null,this._spinner=null,this._children=[],this._messageServiceChannel=P,this._token=null,this._binaryChannelInstructionSet=[],this._animationID=null,this._nextBlockToRead=null,this._numBlocksToRead=0,this._hasReadingStarted=!1,this._waitingForBlock=!1,this._waitingToSync=!1,this._dropServerInteractionEvents=!1,this._sendObjectDataToServer=!1,this.ready=!1,this._isEmpty=!0,this._busy=!1,this._fitCameraToSceneRequired=!1,this._alwaysUpdateOnInteraction=!1,this._globalData={globalClipping:!0,globalClippingPlanes:Object.freeze([]),clipIntersection:!1,cropBox:Object.freeze([]),cropBoxExclude:!1,cropType:"box",lighting:!0,numLights:1,volumeIterator:-1,hardwareSupport:!0,webGPUSupport:!1,renderingStepSize:1,cameraStyle:"orthographic",uniforms:{u_passNumber:{value:0},u_depthTexture:{value:new d.DepthTexture},u_previousTexture:{value:new d.DepthTexture},u_viewportSize:{value:new d.Vector2(1,1)},u_cameraPosition:{value:new d.Vector3},u_cameraTarget:{value:new d.Vector3},u_primaryLight:{value:new d.Vector3},u_lightColor:{value:new d.Vector4},u_ambientStrength:{value:.3},u_primaryLightIntensity:{value:.6},u_secondaryLight:{value:null},u_secondaryLightIntensity:{value:null},u_lightRaySteps:{value:.5},u_deferredTexture:{value:new d.Texture},u_currentPosition:{value:new d.Vector2},u_cropMin:{value:new d.Vector3},u_cropMax:{value:new d.Vector3},u_colorBoxMatrix:{value:new d.Matrix4},u_colorBoxColor:{value:new d.Color},u_screenRectangle:{value:new d.Vector4(0,0,1,1)},u_zoomPercent:{value:0},u_cropCenter:{value:new d.Vector3},u_cropRadius:{value:0},u_cropHeight:{value:0},lights:[]}},this._currentObjectData={id:-1,slicePlanes:Object.freeze([]),clippingPlanes:Object.freeze([])},this._renderingQuality=10,this._renderingQualityDuringMotion=5,this._renderingQualityMin=9,this._renderingQualityCeiling=9,this._dynamicallyAdjustQuality=!0,this._autoScatterQuality=!0,this._updateAutoMagFilter=!1,this._renderingPixelRatio=1,this._timestamp=performance.now(),this._rollingFrameRate=[],this._renderFrontLayerOnly=!1,window.addEventListener("unload",this.dispose.bind(this))}start(P){this._cleanUp(),this._init(P),this._updateScene(P),this._updateAxes(P.Axes),this._controls.updateAnnotationSettings(P.Annotations),this.animate(),this.ready=!0,this._publishResponse("ClientStarted",{})}drawnow(P){if(!this.ready)return;this._waitingToSync=!0,this._composer.waitingToDraw=!0,this._dropServerInteractionEvents=!1,this._token=P.Token;const Z=Array.from(P.BoundingBox);if(this._busyInternal(P.Busy===!0,!this._isEmpty),this._remove(P.RemovedIndices),Object.prototype.hasOwnProperty.call(P.Mode,"Default")&&this._modeInternal(P.Mode,!1),this._composer.setDepth(P.NumDepthPasses,P.DepthRequired,P.SeparateDepthPassRequired),this._controls.copyCameraProperties(),Object.prototype.hasOwnProperty.call(P.Scene,"Quality")&&this._updateScene(P.Scene),Object.prototype.hasOwnProperty.call(P.Axes,"Box")&&this._updateAxes(P.Axes),this._nextBlockToRead=null,this._binaryChannelInstructionSet=P.InstructionSet,this._renderFrontLayerOnly=!1,Object.prototype.hasOwnProperty.call(P.Annotations,"DataUpdateRequired")&&(this._controls.updateAnnotationSettings(P.Annotations),P.Annotations.DataUseBinaryChannel&&this._binaryChannelInstructionSet.unshift({Index:-1,Type:"Annotations"})),(this._binaryChannelInstructionSet.length>0||P.RemovedIndices.length>0)&&(this._controls.lazyLoading=!1),P.NumObjects>0){for(let K=0;K<P.NumObjects;K++){const Y=P["ObjectData"+K];if(Y.IsNewObject){let k;switch(Y.Type){case"volume":this._globalData.volumeIterator+=1,k=new n(this._scene,this._depthScene,Y,this._globalData);break;case"surface":k=new r(this._scene,this._depthScene,Y,this._globalData);break;case"points":k=new h(this._scene,this._depthScene,Y,this._globalData),this._alwaysUpdateOnInteraction=!0;break;case"blockedpoints":k=new u(this._scene,this._depthScene,Y,this._globalData),this._sendObjectDataToServer=!0,this._controls.lazyLoadingRequired=!0;break;case"blockedvolume":k=new g(this._scene,this._deferredScene,this._depthScene,this._overviewScene,Y,this._globalData),this._sendObjectDataToServer=!0,this._controls.lazyLoadingRequired=!0;break;case"internalimage":k=new p(this._scene,this._depthScene,Y,this._globalData),this._updateAutoMagFilter=!0;break;case"image":k=new y(this._scene,this._deferredScene,this._depthScene,Y,this._globalData),this._sendObjectDataToServer=!0,this._controls.lazyLoadingRequired=!0,this._updateAutoMagFilter=!0;break;case"line":k=new x(this._scene,this._depthScene,Y,this._globalData);break;case"wideline":k=new w(this._scene,this._depthScene,Y,this._globalData);break}k.renderOrder(this._children.length+1),this._children.push(k)}else this._children[Y.Index].refreshProperties(Y)}this._isEmpty=this._children.length===0,Z.length!==0&&(this._controls.setBoundingBox(Z),this._fitCameraToSceneRequired=!0),this._checkEmptyInstructionSet(P.EmptyInstructionSet)}this._updateCurrentObject(P.CurrentObject),this._lookForReadableBlock()}drawfast(P){this._waitingToSync=!0,this._composer.waitingToDraw=!0,this._dropServerInteractionEvents=!1,Object.prototype.hasOwnProperty.call(P.Mode,"Default")&&this._modeInternal(P.Mode,!0),Object.prototype.hasOwnProperty.call(P.Axes,"Box")&&this._updateAxes(P.Axes),this._nextBlockToRead=null,this._renderFrontLayerOnly=!0,Object.prototype.hasOwnProperty.call(P.Annotations,"DataUpdateRequired")&&(this._controls.updateAnnotationSettings(P.Annotations),P.Annotations.DataUseBinaryChannel&&(this._renderFrontLayerOnly=!(this._binaryChannelInstructionSet.length>0),this._binaryChannelInstructionSet.unshift({Index:-1,Type:"Annotations"}))),this._binaryChannelInstructionSet.length>0&&(this._controls.lazyLoading=!1),this._waitingForBlock||this._lookForReadableBlock()}mode(P){this._modeInternal(P,!0),this._publishResponse(P.Token,{})}setBinaryData(P){if(this.ready)if(this._nextBlockToRead!==null)if(Object.prototype.hasOwnProperty.call(this._nextBlockToRead,"outOfCore")){const Z=this._nextBlockToRead.outOfCore;this._children[this._nextBlockToRead.id].loadBlock(P,this._nextBlockToRead),this._stopLazyLoading(),this._measureMemory(),this._waitingToSync?this._lookForReadableBlock():Z?(this._lookForReadableBlock(),this.renderDeferredLayer()):this._controls.updateRequested=!0}else this._nextBlockToRead.Index===-1?this._controls.annotate(P):this._children[this._nextBlockToRead.Index].refreshData(P,this._nextBlockToRead,this._globalData.renderingStepSize),this._stopLazyLoading(),this._lookForReadableBlock(),this._composer.clearPaintPass();else this._stopLazyLoading(),this._waitingToSync?this._lookForReadableBlock():this._controls.lazyLoadingRequested=!0}stopDataTransfer(){this._stopLazyLoading(),this._waitingToSync&&(this._controls.lazyLoading=!1,this._lookForReadableBlock())}busy(P){this.ready&&(this._busyInternal(P.Busy,!P.Busy),P.Busy||(this._controls.lazyLoadingRequested=!0,this._composer.clearPaintPass()))}clear(P){if(!this.ready)throw new Error("Viewer not ready");this._clearScene(),this._sceneControls(this._composer.getAxesVisibility(),this._scaleBar.visible,this._wireframe.visible),this._controls.enableInteractions(!1,!0),this._setSpinnerProgress(100),this._composer.clearPaintPass(),this.render()}updateObjectInfo(P){this._controls.updateObjectInfo(P)}restartServerInteractions(){this._dropServerInteractionEvents=!1}copyAnnotations(P){this._controls.copyAnnotations()}editAnnotation(P){this._controls.editAnnotation(P)}openDevTools(){window.cefclient.openDevTools()}_publishResponse(P,Z){if(this._messageServiceChannel!==null){const K={Token:P,Message:Z};N.publish(this._messageServiceChannel,K)}}_stopLazyLoading(){this._nextBlockToRead=null,this._waitingForBlock=!1}_busyInternal(P,Z){this._busy=P,this._setSpinnerProgress(P?0:100),this._controls.enableInteractions(Z,this._isEmpty)}_modeInternal(P,Z){this._controls.mode(P,Z),this._composer.setZoomDisplay(P.Select.DisplayObjectInfo)}_remove(P){if(P.length!==0){if(P.length===void 0)this._removeChild(P);else for(let Z=P.length-1;Z>=0;Z--)this._removeChild(P[Z]);for(let Z=0;Z<this._children.length;Z++)this._children[Z].renderOrder(Z+1);this._isEmpty=this._children.length===0}}_removeChild(P){P<this._children.length&&(this._children[P].remove(),this._children.splice(P,1))}_updateCurrentObject(P){if(!Object.prototype.hasOwnProperty.call(P,"ID")){this._currentObjectData.id=-1,this._currentObjectData.clippingPlanes=Object.freeze([]),this._currentObjectData.slicePlanes=Object.freeze([]);return}this._currentObjectData.id=P.ID,this._currentObjectData.clippingPlanes=this._createPlanes(P.ClippingPlanes),this._currentObjectData.slicePlanes=this._createPlanes(P.SlicePlanes),this._globalData.globalClipping?this._controls.updatePlanes(this._globalData.globalClippingPlanes,this._currentObjectData.slicePlanes,P.SlicePlaneInteractions,P.ScissorsAllowed,P.WindowLevelAllowed,this._children[this._currentObjectData.id].getTransform(),Array.from(P.BoundingBox)):this._controls.updatePlanes(this._currentObjectData.clippingPlanes,this._currentObjectData.slicePlanes,P.SlicePlaneInteractions,P.ScissorsAllowed,P.WindowLevelAllowed,this._children[this._currentObjectData.id].getTransform(),Array.from(P.BoundingBox))}_checkEmptyInstructionSet(P){let Z;const K=P.length;for(let Y=0;Y<K;Y++)Z=P.shift(),this._children[Z.Index].refreshData([],Z,this._globalData.renderingStepSize)}_createPlanes(P){const Z=new Float32Array(P),K=[];let Y=0;if(Z.length>0){Y=Z.length/4;for(let k=0;k<Y;k++)K[k]=new d.Plane(new d.Vector3(Z[k*4],Z[k*4+1],Z[k*4+2]),Z[k*4+3]);return K}else return Object.freeze([])}_updateScene(P){if(this._memory.setLimit(P.MemoryLimit),this._renderQuality(P.Quality),this._composer.setAntialiasing(P.Antialiasing),this._clippingPlanes(P.Culling.ClippingPlanes,P.Culling.GlobalClipping,P.Culling.ClipIntersection),this._cropBox(P.Culling.CropRegion,P.Culling.CropExclude,P.Culling.CropType),this._composer.setDepthPeel(P.DepthPeeling,P.ViewDepth),this._composer.setMaxSize(Array.from(P.MaxCanvasSize),this._renderingPixelRatio),this._composer.setDeferredStyle(P.CompositionStyle,P.OutOfCoreRendering),P.OutOfCoreRendering||(this._globalData.uniforms.u_deferredTexture.value=null),this._controls.cameraStyle!==P.Camera.Style){this._globalData.cameraStyle=P.Camera.Style;for(let Z=0;Z<this._children.length;Z++)this._children[Z].cameraStyle(this._globalData.cameraStyle)}this._controls.setCamera(P.Camera.Style,Array.from(P.Camera.Position),Array.from(P.Camera.Target),Array.from(P.Camera.UpVector),P.Camera.Zoom,P.Camera.ViewAngle,Array.from(P.Camera.AutoMode)),this._updateLight(P.Light)}_updateAxes(P){this._scaleBar.units=P.ScaleBarUnits,this._scaleBar.setStyle(P.ScaleBarStyle),this._controls.setUnits(P.ScaleBarUnits),this._composer.setAxesLabels(P.OrientationAxesLabels),this._backgroundColor(Array.from(P.BackgroundColor),Array.from(P.GradientColor),P.GradientBackground),this._composer.setDenoising(P.Denoising,P.DenoisingSigma,P.DenoisingThreshold),this._grid.update(P.Grid),this._sceneControls(P.OrientationAxes,P.ScaleBar,P.Box),this._controls.setCrosshair(P.Crosshair)}_updateLight(P){this._composer.setIterativeControls(P.CinematicRendering,P.NumIterations),this._controls.setLight(P)}_updateChildLighting(P){for(let Z=0;Z<this._children.length;Z++)this._children[Z].lighting(P.message.numLights)}_backgroundColor(P,Z,K){this._composer.setColor(P,Z,K),this._grid.setColor(P),this._controls.setColor(P),this._scaleBar.setColor(P),this._wireframe.setColor(P)}_renderQuality(P){switch(P){case"high":this._renderingQuality=10,this._renderingQualityDuringMotion=8,this._dynamicallyAdjustQuality=!1;break;case"medium":this._renderingQuality=9,this._renderingQualityDuringMotion=8,this._dynamicallyAdjustQuality=!1;break;case"low":this._renderingQuality=5,this._renderingQualityDuringMotion=4,this._dynamicallyAdjustQuality=!1;break;case"auto":this._renderingQuality=9,this._renderingQualityDuringMotion=5,this._dynamicallyAdjustQuality=!0;break;default:this._renderingQuality=P,this._renderingQualityDuringMotion=P,this._dynamicallyAdjustQuality=!1;break}this._setQuality(this._renderingQuality)}_setSpinnerProgress(P){this._spinner.setDeterminant(P)}_sceneControls(P,Z,K){this._composer.setAxesVisibility(P,this._isEmpty,this._controls.screen.width,this._controls.screen.height),this._scaleBar.setVisible(Z,this._isEmpty,this._composer.getAxesVisibility()),this._wireframe.setVisible(K,this._isEmpty),this._grid.setVisible(this._isEmpty)}_clippingPlanes(P,Z,K){const Y=new Float32Array(P),k=[];let ae=0;if(Z)if(Y.length>0){ae=Y.length/4;for(let F=0;F<ae;F++)k[F]=new d.Plane(new d.Vector3(Y[F*4],Y[F*4+1],Y[F*4+2]),Y[F*4+3]);this._globalData.globalClippingPlanes=k}else this._globalData.globalClippingPlanes=Object.freeze([]);if(K!==this._globalData.clipIntersection){this._globalData.clipIntersection=K;for(let F=0;F<this._children.length;F++)this._children[F].clipIntersection(this._globalData.clipIntersection)}const j=this._globalData.globalClipping;if(this._globalData.globalClipping=Z,!(j===!1&&Z===!1))for(let F=0;F<this._children.length;F++)this._children[F].globalClippingPlanes(this._globalData.globalClippingPlanes,Z)}_cropBox(P,Z,K){const Y=this._globalData.cropBox.length>0,k=this._globalData.cropBoxExclude,ae=P.length>0,j=this._globalData.cropBox.length,F=P.length;if(this._globalData.cropBoxExclude=Z,ae)switch(K){case"box":{this._globalData.uniforms.u_cropMin.value.fromArray(P[0]),this._globalData.uniforms.u_cropMax.value.fromArray(P[1]);break}case"sphere":{this._globalData.uniforms.u_cropRadius.value=P[3],this._globalData.uniforms.u_cropCenter.value.x=P[0],this._globalData.uniforms.u_cropCenter.value.y=P[1],this._globalData.uniforms.u_cropCenter.value.z=P[2];break}case"cylinder":{this._globalData.uniforms.u_cropRadius.value=P[3],this._globalData.uniforms.u_cropHeight.value=P[4],this._globalData.uniforms.u_cropCenter.value.x=P[0],this._globalData.uniforms.u_cropCenter.value.y=P[1],this._globalData.uniforms.u_cropCenter.value.z=P[2];break}default:this._globalData.uniforms.u_cropMin.value.fromArray(P[0]),this._globalData.uniforms.u_cropMax.value.fromArray(P[1])}if(this._globalData.cropBox=P,this._globalData.cropType=K,this._controls.updateCrop(ae,P),Y!==ae||j!==F||k!==this._globalData.cropBoxExclude)for(let J=0;J<this._children.length;J++)this._children[J].crop(this._globalData.cropBoxExclude,ae)}_clearScene(){this._controls.lazyLoading=!1,this._stopLazyLoading(),this._updateAutoMagFilter=!1,this._depthScene.clear(),this._deferredScene.clear(),this._overviewScene.clear(),this._controls.clear();for(let P=0;P<this._children.length;P++)this._children[P].remove();this._memory.clear(),this._children=[],this._isEmpty=!0}validateWebGraphics(){let P,Z=null,K=null;try{const Y=document.getElementsByClassName("iptViewer3D")[0],k=Math.min(Math.max(Y.clientWidth,1),3840),ae=Math.min(Math.max(Y.clientHeight,1),2160);this._canvas=new window.OffscreenCanvas(k,ae),this._canvas.style.width=k,this._canvas.style.height=ae}catch(Y){this._canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}try{this._canvas.addEventListener("webglcontextlost",this._handleContextLost.bind(this),!1),this._canvas.addEventListener("webglcontextrestored",this._handleContextRestored.bind(this),!1),this._createContext();const Y=navigator.gpu;try{K=navigator.connection.downlink}catch(k){}this._context!==null?(this._hasContext=!0,Z=this._context.getExtension("WEBGL_debug_renderer_info"),P={Renderer:this._context.getParameter(this._context.RENDERER),Vendor:this._context.getParameter(this._context.VENDOR),Version:this._context.getParameter(this._context.VERSION),UnmaskedVendor:this._context.getParameter(Z.UNMASKED_VENDOR_WEBGL),RendererDevice:this._context.getParameter(Z.UNMASKED_RENDERER_WEBGL),WebGL2Supported:this._context!==null,WebGPUSupported:Y!==void 0,MaxTextureSize:this._context.getParameter(this._context.MAX_TEXTURE_SIZE),Max3DTextureSize:this._context.getParameter(this._context.MAX_3D_TEXTURE_SIZE),DevicePixelRatio:window.devicePixelRatio,DownlinkSpeed:K,Browser:navigator.userAgent}):P={WebGL2Supported:!1}}catch(Y){P={WebGL2Supported:!1,ErrorMessage:Y.message}}this._publishResponse("ClientInitialized",P)}_createContext(){const P={premultipliedAlpha:!1,depth:!0,antialias:!0,stencil:!0,precision:"highp",powerPreference:"high-performance",preserveDrawingBuffer:!0};this._context=this._canvas.getContext("webgl2",P)}_init(P){const Z=document.getElementsByClassName("iptViewer3D")[0],K=Math.min(Math.max(Z.clientWidth,1),3840),Y=Math.min(Math.max(Z.clientHeight,1),2160),k=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");k.style.display="block",k.width=K,k.height=Y,Z.appendChild(k);const ae=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this._scene=new d.Scene,this._depthScene=new d.Scene,this._deferredScene=new d.Scene,this._overviewScene=new d.Scene,this._annotationScene=new d.Scene;const j=new d.Scene;this._globalData.hardwareSupport=P.HardwareSupport,this._globalData.webGPUSupport=P.WebGPUSupport;const F=Array.from(P.Axes.BackgroundColor),J=new d.Color(F[0],F[1],F[2]);this._renderer=new d.WebGLRenderer({canvas:this._canvas,context:this._context,premultipliedAlpha:!1,antialias:!0,stencil:!0,precision:"highp",powerPreference:"high-performance",preserveDrawingBuffer:!0}),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(K,Y),this._renderer.localClippingEnabled=!0,this._renderer.autoClear=!1,this._memory=new H,this._scaleBar=new M(Z),this._spinner=new _(Z,P.IsPublishing),this._wireframe=new T(j),this._grid=new A(P.Axes.Grid),j.add(this._grid);const te=new C(this._scene,this._globalData);this._controls=new l(P,Z,k,ae,this._annotationScene,te,this._globalData),this._globalData.cameraStyle=this._controls.cameraStyle,this._composer=new z(this._renderer,Z,k,ae,J,this._scene,this._depthScene,this._annotationScene,this._deferredScene,this._overviewScene,j,this._globalData,this._controls.screen),this._globalData.uniforms.u_viewportSize.value.set(this._controls.screen.width,this._controls.screen.height),this._globalData.uniforms.u_cameraPosition.value=this._controls.camera.position,this._globalData.uniforms.u_cameraTarget.value=this._controls.target,this._busyInternal(P.Busy,!P.Busy),this._composer.setZoomDisplay(P.Mode.Select.DisplayObjectInfo),this._controls.addEventListener("interactionStarted",this._startControlChanging.bind(this)),this._controls.addEventListener("interactionUpdating",this._broadcastToServer.bind(this)),this._controls.addEventListener("interactionEnded",this._onInteractionCompletion.bind(this)),this._controls.addEventListener("clickReleased",this._onClickRelease.bind(this)),this._controls.addEventListener("render",this.render.bind(this)),this._controls.addEventListener("renderFrontLayer",this.renderFrontLayer.bind(this)),this._controls.addEventListener("windowResizing",this._onWindowResize.bind(this)),this._controls.addEventListener("windowResized",this._broadcastResizeEvent.bind(this)),this._controls.addEventListener("measurePerformance",this._measurePerformance.bind(this)),this._controls.addEventListener("resetPerformance",this._resetPerformanceMeasurement.bind(this)),this._controls.addEventListener("contextMenuClicked",this._broadcastContextMenuEvent.bind(this)),this._controls.addEventListener("defaultCameraRestored",this._broadcastMovedEvent.bind(this)),this._controls.addEventListener("widgetAdded",this._broadcastWidgetAddedEvent.bind(this)),this._controls.addEventListener("messageClosed",this._broadcastMessageClosedEvent.bind(this)),this._controls.addEventListener("modeChanged",this._reactToModeChange.bind(this)),this._controls.addEventListener("animationFinished",this._animationStopped.bind(this)),this._controls.addEventListener("depthRequested",this._getDepthAtLocation.bind(this)),this._controls.addEventListener("updateIteration",this.renderIterativeLayer.bind(this)),this._controls.addEventListener("lightsUpdated",this._updateChildLighting.bind(this)),this._controls.addEventListener("scissorsFinished",this._broadcastScissorsEvent.bind(this)),this._controls.addEventListener("annotationsCopied",this._broadcastCopyEvent.bind(this)),this._controls.addEventListener("annotationEdited",this._broadcastEditEvent.bind(this)),this._controls.addEventListener("colorBoxChanged",this._reactToColorBoxChange.bind(this)),this._controls.addEventListener("colorBoxUpdated",this._reactToColorBoxUpdate.bind(this)),this._controls.addEventListener("refreshLazyLoading",this._refreshLazyLoading.bind(this)),this._controls.addEventListener("pointPickRequested",this._pick.bind(this)),this._controls.addEventListener("zoomPercentUpdated",this._updateZoomPercent.bind(this)),this._controls.addEventListener("paintBrushEnabled",this._enablePaintBrush.bind(this)),this._controls.addEventListener("paintBrushStarted",this._activatePaintBrush.bind(this)),this._controls.addEventListener("paintBrushFinished",this._onInteractionCompletion.bind(this)),this._controls.addEventListener("restoreContext",this._restoreContext.bind(this)),this._scaleBar.addEventListener("scaleBarEdited",this._reactToScaleBarUpdate.bind(this))}dispose(){this._cleanUp(),this._canvas!==null&&this._canvas.remove()}_cleanUp(){this._animationID!==null&&cancelAnimationFrame(this._animationID),this._renderer!==null&&(this._clearScene(),this._composer.dispose(),this._renderer.dispose(),this._controls.dispose())}_getDepthAtLocation(P){this._controls.setDepthAtLocation(this._composer.getDepthAtLocation(P.message,P.windowSize),P.message)}_updateZoomPercent(){if(this._globalData.uniforms.u_zoomPercent.value=this._controls.zoomPercent,this._updateAutoMagFilter)for(let P=0;P<this._children.length;P++)this._children[P].autoMagFilter(this._globalData.uniforms.u_zoomPercent.value)}_handleContextLost(P){const Z=this._composer.waitingToDraw;this._hasContext=!1,this.ready=!1,this._context=null,P.preventDefault(),cancelAnimationFrame(this._animationID),this._composer.outOfCoreRendering&&(this._controls.lazyLoading=!1),this._setSpinnerProgress(100),this._scaleBar.disable(),this._controls.contextLost(),this._clearScene(),this._composer.dispose(),this._renderer.dispose(),this._publishResponse("WebGLContextLost",Z)}_restoreContext(){this._publishResponse("RestoreWebGLContext",{})}_handleContextRestored(P){}_enablePaintBrush(P){this._composer.enablePaintPass(P.enabled,P.color,P.opacity,P.brushSize)}_activatePaintBrush(P){this._composer.activatePaintPass(P.activated)}_startControlChanging(){this._composer.outOfCoreRendering&&(this._controls.lazyLoading=!1),this._updateChildrenOnInteraction(!0),this._setSpinnerProgress(100),this._setQuality(this._renderingQualityDuringMotion),this._rollingFrameRate=[],this._resetPerformanceMeasurement()}_onInteractionCompletion(P){switch(P.name){case"CameraMoved":this._cleanupInteraction(),this._broadcastMovedEvent(),this._controls.lazyLoadingRequested=!0;break;case"AnnotationMoved":case"AnnotationAdded":P.redraw?this._cleanupInteraction():this._updateChildrenOnInteraction(!1),this._publishResponse(P.name,P.message);break;case"ClippingPlanesChanged":this._cleanupInteraction(),this._publishResponse(P.name,this._packageClippingPlanes(P.message)),this._controls.lazyLoadingRequested=!0;break;case"SlicePlanesChanged":this._cleanupInteraction(),this._publishResponse(P.name,this._packageSlicePlanes(P.message)),this._controls.lazyLoadingRequested=!0;break;case"DisplayRangeChanged":this._cleanupInteraction(),this._publishResponse(P.name,this._children[this._currentObjectData.id].getWindowLevel());break;case"DisplayRangeDouble":this._cleanupInteraction(),this._publishResponse("DisplayRangeChanged","auto");break;case"CropRegionChanged":this._cleanupInteraction(),this._publishResponse(P.name,this._packageCropBox()),this._controls.lazyLoadingRequested=!0;break;case"CrosshairMoved":this._updateChildrenOnInteraction(!1),this._publishResponse(P.name,P.message);break;case"PaintBrushFinished":this._busyInternal(!0,!1),this._composer.activatePaintPass(!1),this._publishResponse(P.name,P.message);break}this._dropServerInteractionEvents=!1}_onClickRelease(){this._controls.iterativeUpdateRequested===!0&&(this._controls.iterativeUpdateRequested=!1,this._setSpinnerProgress(100)),this._publishResponse("ClickReleased",{})}_broadcastMovedEvent(){this._publishResponse("CameraMoved",this._packageEventData(this._controls.packageCameraProperties())),this._controls.lazyLoadingRequested=!0}_broadcastToServer(P){switch(P.name){case"CameraMoving":P.notifyUser&&!this._dropServerInteractionEvents&&(this._dropServerInteractionEvents=!0,this._publishResponse(P.name,this._packageEventData(this._controls.packageCameraProperties()))),this._controls.lazyLoadingRequested=!0;break;case"DisplayRangeChanging":if(this._currentObjectData.id<0)return;this._children[this._currentObjectData.id].updateWindowLevel(P.data),P.notifyUser&&!this._dropServerInteractionEvents&&(this._dropServerInteractionEvents=!0,this._publishResponse(P.name,this._children[this._currentObjectData.id].getWindowLevel()));break;case"CrosshairMoving":case"AnnotationMoving":case"AnnotationMovingDelayed":P.notifyUser&&!this._dropServerInteractionEvents&&(this._dropServerInteractionEvents=!0,this._publishResponse(P.name,P.message));break;case"AnnotationMovingClicked":P.notifyUser&&(this._dropServerInteractionEvents=!0,this._publishResponse(P.name,P.message));break;case"CropRegionChanging":switch(this._controls.lazyLoadingRequested=!0,this._globalData.cropType){case"box":{this._globalData.uniforms.u_cropMin.value.copy(P.message.cropMin),this._globalData.uniforms.u_cropMax.value.copy(P.message.cropMax);break}case"sphere":{this._globalData.uniforms.u_cropCenter.value.copy(P.message.center),this._globalData.uniforms.u_cropRadius.value=P.message.radius;break}case"cylinder":{this._globalData.uniforms.u_cropCenter.value.copy(P.message.center),this._globalData.uniforms.u_cropRadius.value=P.message.radius,this._globalData.uniforms.u_cropHeight.value=P.message.height;break}}P.notifyUser&&!this._dropServerInteractionEvents&&(this._dropServerInteractionEvents=!0,this._publishResponse(P.name,this._packageCropBox())),this._controls.lazyLoadingRequested=!0;break;case"SlicePlanesChanging":if(this._currentObjectData.id<0)return;this._currentObjectData.slicePlanes[P.message.id].copy(P.message.plane),this._children[this._currentObjectData.id].copySlicePlaneObjects(this._currentObjectData.slicePlanes),P.notifyUser&&!this._dropServerInteractionEvents&&(this._dropServerInteractionEvents=!0,this._publishResponse(P.name,this._packageSlicePlanes(P.message.id))),this._controls.lazyLoadingRequested=!0;break;case"ClippingPlanesChanging":if(this._globalData.globalClipping){this._globalData.globalClippingPlanes[P.message.id].copy(P.message.plane);for(let Z=0;Z<this._children.length;Z++)this._children[Z].globalClippingPlanes(this._globalData.globalClippingPlanes,this._globalData.globalClipping)}else{if(this._currentObjectData.id<0)return;this._currentObjectData.clippingPlanes[P.message.id].copy(P.message.plane),this._children[this._currentObjectData.id].copyClippingPlaneObjects(this._currentObjectData.clippingPlanes)}P.notifyUser&&!this._dropServerInteractionEvents&&(this._dropServerInteractionEvents=!0,this._publishResponse(P.name,this._packageClippingPlanes(P.message.id))),this._controls.lazyLoadingRequested=!0;break}}_packageEventData(P){if(this._sendObjectDataToServer)for(let Z=0;Z<this._children.length;Z++)this._children[Z].packageData(P.ObjectInfo,Z);return P=Object.assign({MemoryUsed:this._memory.used},P),P}_broadcastScissorsEvent(P){this._busyInternal(!0,!1),this._publishResponse("ScissorsFinished",P.message)}_broadcastCopyEvent(P){this._publishResponse("AnnotationsCopied",P.message)}_broadcastEditEvent(P){this._publishResponse("AnnotationEdited",P.message)}_broadcastContextMenuEvent(P){this._publishResponse("ContextMenuClicked",P.message)}_broadcastMessageClosedEvent(P){this._publishResponse("MessageClosed",P.message)}_broadcastWidgetAddedEvent(P){this._updateChildrenOnInteraction(!1),this._publishResponse(P.name,{})}_reactToModeChange(P){this._publishResponse("ModeChanged",P.message)}_animationStopped(P){this._publishResponse("AnimationFinished",P.message)}_reactToColorBoxChange(P){this._globalData.uniforms.u_colorBoxColor.value.copy(P.message.boxColor),this._globalData.uniforms.u_colorBoxMatrix.value.copy(P.message.boxMatrix)}_reactToColorBoxUpdate(P){for(let Z=0;Z<this._children.length;Z++)this._children[Z].colorInBox(P.message)}_reactToScaleBarUpdate(P){this._controls.setZoomPercent(P.message),this._broadcastMovedEvent()}_packageClippingPlanes(P){return this._globalData.globalClipping?{ClippingPlane:[this._globalData.globalClippingPlanes[P].normal.x,this._globalData.globalClippingPlanes[P].normal.y,this._globalData.globalClippingPlanes[P].normal.z,this._globalData.globalClippingPlanes[P].constant],Index:P+1}:{ClippingPlane:[this._currentObjectData.clippingPlanes[P].normal.x,this._currentObjectData.clippingPlanes[P].normal.y,this._currentObjectData.clippingPlanes[P].normal.z,this._currentObjectData.clippingPlanes[P].constant],Index:P+1}}_packageSlicePlanes(P){return{SlicePlane:[this._currentObjectData.slicePlanes[P].normal.x,this._currentObjectData.slicePlanes[P].normal.y,this._currentObjectData.slicePlanes[P].normal.z,this._currentObjectData.slicePlanes[P].constant],Index:P+1}}_packageCropBox(){switch(this._globalData.cropType){case"box":return{Min:this._globalData.uniforms.u_cropMin.value.toArray(),Max:this._globalData.uniforms.u_cropMax.value.toArray()};case"sphere":return{Center:this._globalData.uniforms.u_cropCenter.value.toArray(),Radius:this._globalData.uniforms.u_cropRadius.value};case"cylinder":return{Center:this._globalData.uniforms.u_cropCenter.value.toArray(),Radius:this._globalData.uniforms.u_cropRadius.value,Height:this._globalData.uniforms.u_cropHeight.value}}return null}_onWindowResize(){this._controls.resize(),this._composer.setSize(this._controls.screen.width,this._controls.screen.height),this._sceneControls(this._composer.getAxesVisibility(),this._scaleBar.visible,this._wireframe.visible),this._clientInitiatedUpdate(),this._controls.lazyLoadingRequested=!0}_broadcastResizeEvent(){this._cleanupInteraction(),this._publishResponse("WindowResized",this._packageEventData(this._controls.packageCameraProperties()))}_cleanupInteraction(){this._updateChildrenOnInteraction(!1),this._setQuality(this._renderingQuality),this._clientInitiatedUpdate(),this._composer.outOfCoreRendering&&(this._clearBlockQueue(),this._controls.lazyLoading=!0)}_updateChildrenOnInteraction(P){if(this._alwaysUpdateOnInteraction||this._composer.iterativeRendering||this._composer.outOfCoreRendering){this._composer.outOfCoreRendering&&(this._nextBlockToRead=null,this._hasReadingStarted=!1,this._numBlocksToRead=0);for(let Z=0;Z<this._children.length;Z++)this._children[Z].updateOnInteraction(P)}this._composer.updateOnInteraction(P)}_clientInitiatedUpdate(){this._busy||(this._controls.updateRequested=!0)}_refreshLazyLoading(){if(this._waitingToSync)return;if(this._composer.outOfCoreRendering&&this._waitingForBlock){this._nextBlockToRead=null,this._numBlocksToRead=0;return}const P=this._controls.getFrustum(),Z=this._controls.getEyeVector();for(let K=0;K<this._children.length;K++)this._children[K].resetBlocks(this._controls.camera,P,Z,this._controls.screen,this._controls._boundingSphere);this._controls.updateRequested=!0,this._numBlocksToRead=0}_clearBlockQueue(){for(let P=0;P<this._children.length;P++)this._children[P].clearBlockQueue()}_lookForReadableBlock(){if(!(this._nextBlockToRead!==null||this._waitingForBlock)){if(this._waitingToSync)if(this._binaryChannelInstructionSet.length>0){const P={id:this._binaryChannelInstructionSet[0].Index};this._nextBlockToRead=this._binaryChannelInstructionSet.shift(),this._waitingForBlock=!0,this._publishResponse("BinaryDataRequested",P)}else this._waitingToSync=!1,this._renderFrontLayerOnly?(this._scaleBar.render(this._controls.camera,this._controls.screen.width,this._controls.screen.height),this._busyInternal(!1,!0),this.renderFrontLayer(),this._publishResponse(this._token,{}),this._controls.lazyLoading||(this._controls.lazyLoading=!0)):(this._fitCameraToSceneRequired&&(this._wireframe.setPosition(this._controls.boundingBox),this._grid.setPosition(this._controls.boundingBox),this._controls.fitCameraToBoundingSphere()),this._setQuality(this._renderingQuality),this._updateChildrenOnInteraction(!1),this._sceneControls(this._composer.getAxesVisibility(),this._scaleBar.visible,this._wireframe.visible),this._busyInternal(!1,!0),this._measureMemory(),this._fitCameraToSceneRequired?(this._fitCameraToSceneRequired=!1,this._publishResponse(this._token,this._packageEventData(this._controls.packageCameraPropertiesIfChanged()))):this._publishResponse(this._token,this._packageEventData(this._controls.packageProjectionMatrix())),this._controls.updateRequested=!0,this._controls.lazyLoading?this._controls.lazyLoadingRequested=!0:(this._clearBlockQueue(),this._controls.lazyLoading=!0));else if(this._controls.lazyLoading){let P=null,Z=null,K=0;for(let Y=this._children.length-1;Y>=0;Y--)P=this._children[Y].findNextBlock(),P!==null&&(K+=P.numBlocksToRead,(Z===null||P.distance<Z.distance)&&(Z=P,Z.id=Y));Z!==null?(this._hasReadingStarted||(this._hasReadingStarted=!0),this._numBlocksToRead===0&&(this._numBlocksToRead=K),this._setSpinnerProgress(this._numBlocksToRead>10?Math.max(Math.floor((this._numBlocksToRead-K)/this._numBlocksToRead*100),1):0),this._waitingForBlock=!0,this._nextBlockToRead=this._children[Z.id].getNextBlock(Z.index,Z.id),this._publishResponse("DeferredDataRequested",{MemoryUsed:this._memory.used,Data:this._nextBlockToRead})):(this._composer.clearPaintPass(),this._hasReadingStarted&&(this._hasReadingStarted=!1,this._numBlocksToRead=0,this._composer.outOfCoreRendering&&(this._composer.clearOverview=!0),this._setSpinnerProgress(100),this._publishResponse("DeferredDataRequested",this._packageEventData({ObjectInfo:[],Data:null})),this._composer.outOfCoreRendering||(this._controls.updateRequested=!0)))}}}_pick(P){if(P.message.point===null||P.message.clickType==="double"){P.message.sendToServer&&this._publishResponse(P.message.eventName,{objectInfo:[],clickType:P.message.clickType,id:P.message.id});return}const Z=P.message.point.clone(),K=Z.clone().sub(this._controls.camera.position).normalize(),Y=new d.Raycaster(this._controls.camera.position,K);Y.camera=this._controls.camera;const k=[];for(let ae=0;ae<this._children.length;ae++)this._children[ae].pick(Y,k,Z,this._controls.boundingSphere,this._controls.screen,ae);k.sort((ae,j)=>ae.distance-j.distance);for(let ae=0;ae<k.length;ae++)if(k[ae].picked&&k[ae].distance<.1*this._controls.boundingSphere.radius){Z.fromArray(k[ae].point);break}P.message.point.copy(Z),P.message.sendToServer&&this._publishResponse(P.message.eventName,{objectInfo:k,clickType:P.message.clickType,id:P.message.id})}_measureMemory(){this._memory.refresh(this._children,this._renderer.info)}_measurePerformance(){if(!this._dynamicallyAdjustQuality)return;const P=1e3/(performance.now()-this._timestamp);if(this._rollingFrameRate.push(P),this._rollingFrameRate.length>5){this._rollingFrameRate.splice(0,1);let Z=0;for(let K=0;K<this._rollingFrameRate.length;K++)Z+=this._rollingFrameRate[K];Z/=this._rollingFrameRate.length,Z<10?this._renderingQualityDuringMotion>4?this._reduceQuality(2):this._renderingQualityDuringMotion>2?this._reduceQuality(1):Z<5&&this._reduceQuality(1):Z<20?this._renderingQualityDuringMotion>3&&this._reduceQuality(1):Z>55&&this._renderingQualityDuringMotion<7&&this._renderingQualityDuringMotion<this._renderingQualityCeiling&&(this._renderingQualityDuringMotion=Math.min(this._renderingQualityDuringMotion+1,7),this._setQuality(this._renderingQualityDuringMotion),this._rollingFrameRate=[])}this._timestamp=performance.now()}_reduceQuality(P){this._renderingQualityDuringMotion>1&&(this._renderingQualityDuringMotion=Math.max(this._renderingQualityDuringMotion-P,0),this._renderingQualityMin===this._renderingQualityDuringMotion&&(this._renderingQualityCeiling=this._renderingQualityDuringMotion),this._renderingQualityMin=Math.min(this._renderingQualityMin,this._renderingQualityDuringMotion),this._setQuality(this._renderingQualityDuringMotion),this._rollingFrameRate=[])}_resetPerformanceMeasurement(){this._timestamp=performance.now()}_setQuality(P){switch(P){case 0:this._setQualityParameters(16,4,.05,1,!1,.001,!1);break;case 1:this._setQualityParameters(8,4,.1,1,!1,.001,this._composer.depthPeelAllowed);break;case 2:this._setQualityParameters(6,4,.1,2,!1,.001,this._composer.depthPeelAllowed);break;case 3:this._setQualityParameters(4,4,.1,2,!1,.001,this._composer.depthPeelAllowed);break;case 4:this._setQualityParameters(4,2,.2,2,!1,.001,this._composer.depthPeelAllowed);break;case 5:this._setQualityParameters(2,2,.2,2,!1,.001,this._composer.depthPeelAllowed);break;case 6:this._setQualityParameters(2,1.5,.2,3,!1,.001,this._composer.depthPeelAllowed);break;case 7:this._setQualityParameters(2,1,.4,4,!1,.001,this._composer.depthPeelAllowed);break;case 8:this._setQualityParameters(1,1,.5,5,!1,.001,this._composer.depthPeelAllowed);break;case 9:this._setQualityParameters(1,this._globalData.hardwareSupport&&!this._composer.depthPeelAllowed?.5:1,1,25,!0,1e-4,this._composer.depthPeelAllowed);break;case 10:this._setQualityParameters(1,this._globalData.hardwareSupport?.2:.5,1,50,!0,1e-4,this._composer.depthPeelAllowed);break;case 11:this._setQualityParameters(1,this._globalData.hardwareSupport?.1:.2,1,100,!0,1e-4,this._composer.depthPeelAllowed);break}}_setQualityParameters(P,Z,K,Y,k,ae,j){const F=this._renderingPixelRatio,J=this._globalData.renderingStepSize;if(this._renderingPixelRatio=P,this._globalData.renderingStepSize=Z,this._globalData.uniforms.u_lightRaySteps.value=K,this._composer.setQualityParameters(Y,k,ae,j),J!==this._globalData.renderingStepSize)for(let te=0;te<this._children.length;te++)this._children[te].quality(this._globalData.renderingStepSize);F!==this._renderingPixelRatio&&this._composer.setPixelRatio(this._renderingPixelRatio)}render(){this._hasContext&&(this._composer.render(this._controls.camera,this._globalData.uniforms),this._scaleBar.render(this._controls.camera,this._controls.screen.width,this._controls.screen.height),this._controls.renderText(),this._controls.iterativeUpdateRequested=this._composer.iterativeRendering,this._lookForReadableBlock())}renderFrontLayer(){this._hasContext&&(this._composer.renderOverlay(this._controls.camera,this._globalData.uniforms),this._controls.renderText())}renderDeferredLayer(){this._hasContext&&this._composer.renderDeferredLayer(this._controls.camera,this._globalData.uniforms)}renderIterativeLayer(){if(!this._hasContext)return;const P=this._composer.getIterativeProgress();this._setSpinnerProgress(P),P>=100?this._controls.iterativeUpdateRequested=!1:this._composer.renderIterativeLayer(this._controls.camera,this._globalData.uniforms)}animate(){this._controls.update(),this._animationID=requestAnimationFrame(this.animate.bind(this))}setScreenPosition(){this._controls.setScreenPosition()}testWebGLContext(){this._renderer.forceContextLoss(),setTimeout(function(){this._renderer.forceContextRestore()}.bind(this),1e3)}}},D,V),D.exports=B},2158:(D,V,f)=>{var R,B;R=[f(3681),f(329),f(7031),f(2591)],B=f.dj.d(R,function(d,N,_,l){return class extends N{refreshData(r,h,u){let g=h.NumChannels!==this._numChannels;this._setNumChannels(h.NumChannels);const p=Array.from(h.Size),y=Array.from(h.OverlaySize),x=h.DataModified,w=h.OverlayDataModified,M=h.AlphaDataModified,T=h.UseAlphaData;if(!x&&!w&&!M)return;const A=new Uint8Array(r);this._priorSize.copy(this._size),this._updateSize(p,y),this._updateGeometry(h,u);let C=0;x&&(this._texture!==null&&this._texture.dispose(),this._isDataEmpty=Math.max(...p)===0,this._isDataEmpty?(this._texture=null,this._includeVolume&&(this._includeVolume=!1,this._volumeDefines="",g=!0)):(C=this._numChannels*this._size.x*this._size.y*this._size.z,this._initTexture(A.slice(0,C),this._size),this._includeVolume||(this._includeVolume=!0,this._volumeDefines="#define USE_VOLUME",g=!0)),this._mesh.material.uniforms.u_data.value=this._texture),M&&(this._alphaTexture!==null&&this._alphaTexture.dispose(),T?(this._initAlphaTexture(A.slice(C,C+this._size.x*this._size.y*this._size.z),this._size),C+=this._size.x*this._size.y*this._size.z):this._alphaTexture=null,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture),w&&(this._overlayTexture!==null&&this._overlayTexture.dispose(),this._isOverlayEmpty=Math.max(...y)===0,this._isOverlayEmpty?(this._overlayTexture=null,this._includeOverlay&&(this._includeOverlay=!1,this._overlayDefines="",g=!0)):(this._initOverlayTexture(A.slice(C,A.length),this._size),this._includeOverlay||(this._includeOverlay=!0,this._overlayDefines="#define USE_OVERLAY",g=!0)),this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture),g&&this._updateFragmentShader(),this._setDataSliceTextures()}add(r,h){this._texture=null,this._overlayTexture=null,this._alphaTexture=null;const u=d.UniformsUtils.clone(this._shader.uniforms);u.u_data.value=this._texture,u.u_overlayData.value=this._overlayTexture,u.u_alphaData.value=this._alphaTexture,u.u_size.value.copy(this._size),this._setGlobalUniforms(u);const g=new d.BoxGeometry;g.scale(this._size.x,this._size.y,this._size.z),g.translate(this._size.x/2+this._offset.x,this._size.y/2+this._offset.y,this._size.z/2+this._offset.z),this._mesh=new d.Mesh(g,this._initMaterial(u)),this._mesh.visible=r.Visible,this._mesh.matrixAutoUpdate=!1,this._mesh.matrix=this._initTransform(Array.from(r.Transform)),this._scene.add(this._mesh),this.quality(h.renderingStepSize),this._initDepthMesh(u,g,r),this.globalClippingPlanes(h.globalClippingPlanes,h.globalClipping),this._setProperties(r)}pick(r,h,u,g,p,y){if(this._pickable&&this._mesh!==null&&!this._clipped(u)){const x=[];if(this._mesh.raycast(r,x),x.length>0)if(x.sort((w,M)=>w.distance-M.distance),this._renderingStyle===1){const w=this._mesh.material.uniforms.slicePlanes.value,M=w.length/4;if(M===0)return;const T=new d.Plane,A=new d.Vector3;let C=Number.MAX_SAFE_INTEGER,z;for(let H=0;H<M;H++)T.setComponents(w[4*H],w[4*H+1],w[4*H+2],w[4*H+3]).applyMatrix4(this._mesh.matrixWorld),z=Math.abs(T.distanceToPoint(u)),z<C&&(C=z,T.projectPoint(u,A));h.push({point:A.toArray(),distance:C,object:y,picked:!0,id:-1})}else h.push({point:u.toArray(),distance:0,object:y,picked:!1,id:-1})}}copySlicePlaneObjects(r){let h=null;const u=r.length,g=new d.Matrix4,p=new d.Plane;if(u>0)if(h=new Float32Array(r.length*4),this._scaleFactor[0]>1||this._scaleFactor[1]>1||this._scaleFactor[2]>1){g.makeScale(1/this._scaleFactor[0],1/this._scaleFactor[1],1/this._scaleFactor[2]);for(let y=0;y<u;y++)p.copy(r[y]).applyMatrix4(g),h[y*4]=p.normal.x,h[y*4+1]=p.normal.y,h[y*4+2]=p.normal.z,h[y*4+3]=p.constant}else for(let y=0;y<u;y++)h[y*4]=r[y].normal.x,h[y*4+1]=r[y].normal.y,h[y*4+2]=r[y].normal.z,h[y*4+3]=r[y].constant;this._mesh.material.uniforms.slicePlanes.value=h,this._numSlicePlanes!==u&&(this._numSlicePlanes=u,this._updateFragmentShader())}clipIntersection(r){if(this._clipIntersection=r,this._clipIntersectionDefines=r===!0?"#define CLIP_INTERSECTION":"",this._updateFragmentShader(),this._useDataSlices)for(let h=0;h<this._dataSlices.length;h++)this._dataSlices[h].clipIntersection(r)}lighting(r){this._lightingDefines=r>0?"#define USE_LIGHTING":"",this._renderingStyle===7&&this._setLayer(this._layer),this._numSecondaryLights=r-1,this._updateFragmentShader()}cameraStyle(r){this._cameraDefines=r==="perspective"?"#define USE_PERSPECTIVE_CAMERA":"",this._updateFragmentShader()}updateWindowLevel(r){const h=Math.max(this._mesh.material.uniforms.u_clim.value.y-this._mesh.material.uniforms.u_clim.value.x+r.x,0),u=this._mesh.material.uniforms.u_clim.value.x+h/2+r.y;this._mesh.material.uniforms.u_clim.value.x=u-h/2,this._mesh.material.uniforms.u_clim.value.y=this._mesh.material.uniforms.u_clim.value.x+h}getWindowLevel(){return this._mesh!==null?this._mesh.material.uniforms.u_clim.value.toArray():null}_updateSize(r,h){const u=this._smallVolumeScaleFactor!==1;Math.max(...r)>0?this._size.set(r[0],r[1],r[2]):Math.max(...h)>0?this._size.set(h[0],h[1],h[2]):this._size.set(1,1,1);const g=Math.sqrt(Math.pow(this._size.x,2)+Math.pow(this._size.y,2)+Math.pow(this._size.z,2));this._smallVolumeScaleFactor=g<50?g/100:1;const p=this._smallVolumeScaleFactor!==1;this._smallVolumeDefines=p===!0?"#define USE_SMALL_VOLUME":"",p!==u&&this._updateFragmentShader()}_setNumChannels(r){switch(r){case 1:this._shaderDefines="",this._numChannels=1;break;case 2:this._shaderDefines="",this._numChannels=1;break;case 3:this._shaderDefines="#define RGB_SHADER",this._numChannels=3;break;case 4:this._shaderDefines=["#define RGB_SHADER","#define RGBA_SHADER"].join(`
`),this._numChannels=4;break}}getMemoryUsed(){let r=0;return this._texture!==null&&(r+=this._size.x*this._size.y*this._size.z*this._numChannels/1e6),this._overlayTexture!==null&&(r+=this._size.x*this._size.y*this._size.z/1e6),this._alphaTexture!==null&&(r+=this._size.x*this._size.y*this._size.z/1e6),r}quality(r){this._mesh.material.uniforms.u_relativeStepSize.value=r*this._smallVolumeScaleFactor}updateOnInteraction(r){this._mesh.material.uniforms.u_interactionStarted.value=r?1:0}crop(r,h){if(this._numCropBoxes=h===!0?1:0,this._cropDefines=r===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(this._globalData.cropType),this._updateFragmentShader(),this._useDataSlices)for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u].crop(r,h)}colorInBox(r){if(this._colorBoxDefines=r===!0?"#define COLOR_BOX":"",this._updateFragmentShader(),this._useDataSlices)for(let h=0;h<this._dataSlices.length;h++)this._dataSlices[h].colorInBox(r)}_depthSensitivity(r){this._mesh.material.uniforms.u_depthSensitivity.value=r}_specular(r,h){this._mesh.material.uniforms.u_specularStrength.value=r,this._mesh.material.uniforms.u_shininess.value=h}globalClippingPlanes(r,h){if(this._localClipping=!h,h?this._setClippingUniforms(r):this._setClippingUniforms(this._clippingPlanes),this._useDataSlices)for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u].globalClippingPlanes(r,h)}_setClippingUniforms(r){const h=r!==null?r.length:0;let u=null;if(h!==0){u=new Float32Array(h*4);for(let g=0;g<h;g++)u[g*4]=r[g].normal.x,u[g*4+1]=r[g].normal.y,u[g*4+2]=r[g].normal.z,u[g*4+3]=r[g].constant}this._mesh.material.clippingPlanes=r,this._mesh.material.uniforms.worldCoordClippingPlanes.value=u,this._depthMesh!==null&&(this._depthMesh.material.clippingPlanes=r,this._depthMesh.material.uniforms.worldCoordClippingPlanes.value=u)}_initDepthMesh(r,h,u){const g=new d.ShaderMaterial({transparent:!0,clipping:!0,uniforms:r,defines:this._shader.defines,premultipliedAlpha:!0,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader(!0),side:d.BackSide});this._depthMesh=new d.Mesh(h,g),this._depthMesh.visible=u.Visible,this._depthMesh.matrixAutoUpdate=!1,this._depthMesh.matrix=this._initTransform(Array.from(u.Transform)),this._depthScene.add(this._depthMesh)}localClippingPlanes(r){if(this._initPlanes(r),this._localClipping&&this._setClippingUniforms(this._clippingPlanes),this._useDataSlices)for(let h=0;h<this._dataSlices.length;h++)this._dataSlices[h].localClippingPlanes(r)}copyClippingPlaneObjects(r){this._clippingPlanes=r,this._localClipping&&this._setClippingUniforms(this._clippingPlanes)}_rendererType(r){const h=this._renderingStyle;switch(r){case"VolumeRendering":this._renderingStyle=0,this._renderingDefines="#define USE_VOLUME_RENDERING";break;case"SlicePlanes":this._renderingStyle=1,this._renderingDefines=`#define USE_SLICE_PLANES
#define BLEND_ADDITIONAL_TECHNIQUES`;break;case"MaximumIntensityProjection":this._renderingStyle=2,this._renderingDefines=`#define USE_MAXIP
#define BLEND_ADDITIONAL_TECHNIQUES`;break;case"MinimumIntensityProjection":this._renderingStyle=3,this._renderingDefines=`#define USE_MINIP
#define BLEND_ADDITIONAL_TECHNIQUES`;break;case"Isosurface":this._renderingStyle=4,this._renderingDefines="#define USE_ISOSURFACE";break;case"GradientOpacity":this._renderingStyle=5,this._renderingDefines="#define USE_GRADIENT_OPACITY";break;case"LightScattering":this._renderingStyle=6,this._renderingDefines=this._hardwareDefines==="#define HARDWARE_WEBGL"?`#define USE_LIGHT_SCATTERING
#define RAY_TRACE_LIGHT`:"";break;case"CinematicRendering":this._renderingStyle=7,this._renderingDefines=`#define USE_CINEMATIC_RENDERING
#define RAY_TRACE_LIGHT`;break}this._renderingStyle!==h&&(this._needsUpdate=!0)}_overlayRendererType(r){const h=this._overlayRenderingStyle;switch(r){case"VolumeOverlay":this._overlayRenderingStyle=0,this._overlayRenderingDefines="#define USE_VOLUME_OVERLAY",this._overlayFilter=d.LinearFilter;break;case"GradientOverlay":this._overlayRenderingStyle=1,this._overlayRenderingDefines="#define USE_GRADIENT_OVERLAY",this._overlayFilter=d.LinearFilter;break;case"LabelOverlay":this._overlayRenderingStyle=2,this._overlayRenderingDefines="#define USE_LABEL_OVERLAY",this._overlayFilter=d.NearestFilter;break;case"DataMask":this._overlayRenderingStyle=3,this._overlayRenderingDefines="#define USE_OVERLAY_MASK",this._overlayFilter=d.NearestFilter;break}this._overlayRenderingStyle!==h&&(this._needsUpdate=!0,this._overlayTexture!==null&&(this._overlayTexture.minFilter=this._overlayTexture.magFilter=this._overlayFilter,this._overlayTexture.needsUpdate=!0))}_updateRayTrace(){let r=!1;this._includeOverlay&&(r=!0),this._includeVolume&&(this._renderingStyle===1?r=!1:this._renderingStyle!==2&&this._renderingStyle!==3&&(r=!0)),this._rayTraceDefines=r?"#define USE_RAY_TRACE":""}_lightScattering(r){r==="auto"?this._mesh.material.uniforms.u_lightRaySteps=this._globalUniforms.u_lightRaySteps:this._mesh.material.uniforms.u_lightRaySteps={value:r}}_initColormapTexture(r,h){const p=new Uint8Array(1024);for(let x=0;x<256;x++)p[x*4]=r[0][x],p[x*4+1]=r[1][x],p[x*4+2]=r[2][x],p[x*4+3]=h[x];const y=new d.DataTexture(p,1,256,d.RGBAFormat,d.UnsignedByteType);return y.needsUpdate=!0,y}_slicePlanes(r,h){let u=null;const g=r.length/4,p=new d.Matrix4,y=new d.Plane;if(g>0)if(h[0]>1||h[1]>1||h[2]>1){u=new Float32Array(r.length),p.makeScale(1/h[0],1/h[1],1/h[2]);for(let x=0;x<g;x++)y.setComponents(r[x*4],r[x*4+1],r[x*4+2],r[x*4+3]).applyMatrix4(p),u[x*4]=y.normal.x,u[x*4+1]=y.normal.y,u[x*4+2]=y.normal.z,u[x*4+3]=y.constant}else u=Array.from(r);this._scaleFactor=h,this._mesh.material.uniforms.slicePlanes.value=u,this._numSlicePlanes!==g&&(this._numSlicePlanes=g,this._needsUpdate=!0)}_overlayTransferFunction(r,h){this._mesh.material.uniforms.u_overlayTransferFunction.value!==null&&this._mesh.material.uniforms.u_overlayTransferFunction.value.dispose(),this._mesh.material.uniforms.u_overlayTransferFunction.value=this._initColormapTexture(r,h)}_updateFragmentShader(){this._mesh.material.fragmentShader=this._getFragmentShader(!1),this._mesh.material.needsUpdate=!0,this._depthMesh!==null&&(this._depthMesh.material.fragmentShader=this._getFragmentShader(!0),this._depthMesh.material.needsUpdate=!0)}_getFragmentShader(r){let h=this._replaceConstants(this._shader.fragmentShader,this._numSlicePlanes,this._numSecondaryLights,this._numCropBoxes);return this._updateRayTrace(),h=[this._hardwareDefines,this._renderingDefines,this._shaderDefines,this._overlayDefines,this._overlayRenderingDefines,this._alphaDataDefines,this._clipIntersectionDefines,this._lightingDefines,this._cameraDefines,this._smallVolumeDefines,this._rayTraceDefines,this._volumeDefines,this._cropDefines,this._colorBoxDefines,this._cropTypeDefines,h].join(`
`),r?h=["#define DEPTH_SHADER",h].join(`
`):h=[this._isosurfaceDefines,h].join(`
`),h}_replaceConstants(r,h,u,g){return r.replace(/NUM_SLICE_PLANES/g,h).replace(/NUM_SECONDARY_LIGHTS/g,u).replace(/NUM_CROP_BOXES/g,g)}_initMaterial(r){return new d.ShaderMaterial({transparent:!0,clipping:!0,uniforms:r,defines:this._shader.defines,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader(!1),blending:this._blendOp,depthTest:!0,depthFunc:d.AlwaysDepth,depthWrite:!0,side:d.BackSide})}_setProperties(r){if(this._setDataSlices(r,r.DataSlices),this._visible(r.Visible),this._slicePlanes(new Float32Array(r.SlicePlanes),Array.from(r.DownsampleLevel)),this._transform(Array.from(r.Transform)),this._gradientOpacity(Array.from(r.GradientOpacityLimits)),this._isosurface(r.Isovalue),this._rendererType(r.RenderingStyle),this._overlayRendererType(r.OverlayRenderingStyle),this._lightScattering(r.ScatterQuality),this._setAlphaData(r.UseAlphaData),this._rgbAnchorColor(r.RGBAnchorColor),this._colormap(Array.from(r.Colormap),Array.from(r.Alphamap)),this._clim(r.ColorLimits),this._climOverlay(r.OverlayColorLimits),this._overlayTransferFunction(Array.from(r.OverlayColormap),Array.from(r.OverlayAlphamap)),this.localClippingPlanes(r.ClippingPlanes),this._interpolation(r.Interpolation),this._depthSensitivity(r.DepthSensitivity),this._specular(r.Specular,r.Shininess),this._anisotropy(),this._setPickable(r.Pickable),this._setLayer(r.Layer),this._useDataSlices)for(let h=0;h<this._dataSlices.length;h++)this._dataSlices[h].setPropertiesFromVolume(r);this._needsUpdate&&(this._needsUpdate=!1,this._updateFragmentShader())}_initTexture(r,h){switch(this._texture=new d.DataTexture3D(r,h.x,h.y,h.z),this._texture.type=d.UnsignedByteType,this._texture.generateMipmaps=!1,this._texture.unpackAlignment=1,this._texture.minFilter=this._filter,this._texture.magFilter=this._filter,this._numChannels){case 1:this._texture.format=d.RedFormat;break;case 2:this._texture.format=d.RGFormat;break;case 3:this._texture.format=d.RGBFormat;break;case 4:this._texture.format=d.RGBAFormat;break}}_initOverlayTexture(r,h){this._overlayTexture=new d.DataTexture3D(r,h.x,h.y,h.z),this._overlayTexture.format=d.RedFormat,this._overlayTexture.type=d.UnsignedByteType,this._overlayTexture.minFilter=this._overlayFilter,this._overlayTexture.magFilter=this._overlayFilter,this._overlayTexture.generateMipmaps=!1,this._overlayTexture.unpackAlignment=1,this._overlayTexture.needsUpdate=!0}_initAlphaTexture(r,h){this._alphaTexture=new d.DataTexture3D(r,h.x,h.y,h.z),this._alphaTexture.format=d.AlphaFormat,this._alphaTexture.type=d.UnsignedByteType,this._alphaTexture.minFilter=this._filter,this._alphaTexture.magFilter=this._filter,this._alphaTexture.generateMipmaps=!1,this._alphaTexture.unpackAlignment=1,this._alphaTexture.needsUpdate=!0}_interpolation(r){this._filter=r==="bilinear"?d.LinearFilter:d.NearestFilter,this._texture!==null&&this._texture.magFilter!==this._filter&&(this._texture.minFilter=this._texture.magFilter=this._filter,this._texture.needsUpdate=!0),this._alphaTexture!==null&&this._alphaTexture.magFilter!==this._filter&&(this._alphaTexture.minFilter=this._alphaTexture.magFilter=this._filter,this._alphaTexture.needsUpdate=!0)}_gradientOpacity(r){this._mesh.material.uniforms.u_gradientOpacityLimits.value=new d.Vector2(r[0],r[1])}_isosurface(r){this._mesh.material.uniforms.u_isovalue.value=r[0];const h=this._isoalpha;this._isoalpha=r[1],this._mesh.material.uniforms.u_isoalpha.value=this._isoalpha,(this._isoalpha===1&&h!==1||this._isoalpha!==1&&h===1)&&(this._isosurfaceDefines=this._isoalpha<1?"#define TRANSPARENT_ISOSURFACE":"",this._needsUpdate=!0)}_colormap(r,h){this._mesh.material.uniforms.u_transferFunction.value!==null&&this._mesh.material.uniforms.u_transferFunction.value.dispose(),this._mesh.material.uniforms.u_transferFunction.value=this._initColormapTexture(r,h)}_clim(r){this._mesh.material.uniforms.u_clim.value.fromArray(r)}_climOverlay(r){this._mesh.material.uniforms.u_overlayclim.value.fromArray(r)}_anisotropy(){const r=new d.Vector3;r.setFromMatrixScale(this._mesh.matrix),r.x=Math.abs(r.x),r.y=Math.abs(r.y),r.z=Math.abs(r.z);let h=r.x;h=r.y<h?r.y:h,h=r.z<h?r.z:h,r.divideScalar(h),this._mesh.material.uniforms.u_anisotropy.value.copy(r)}_setAlphaData(r){r!==this._useAlphaData&&(this._useAlphaData=r,this._alphaDataDefines=this._useAlphaData===!0?"#define USE_ALPHA_DATA":"",this._needsUpdate=!0)}_rgbAnchorColor(r){this._mesh.material.uniforms.u_rgbAnchorColor.value.fromArray(r)}_getBufferLength(r){let h=0;const u=r.OverlaySize,g=r.Size;return Math.max(...g)>0&&(h+=g[0]*g[1]*g[2]*r.NumChannels),Math.max(...u)>0&&(h+=u[0]*u[1]*u[2]),h}_constructProperties(r,h){this._globalData=h,this._size=new d.Vector3(1,1,1),this._priorSize=new d.Vector3(1,1,1),this._offset=new d.Vector3(.5,.5,.5),this._priorOffset=new d.Vector3(.5,.5,.5),this._matrix=new d.Matrix4,this._smallVolumeScaleFactor=1,this._smallVolumeDefines="",this._includeOverlay=!1,this._includeVolume=!1,this._renderingStyle=0,this._overlayRenderingStyle=2,this._overlayFilter=d.NearestFilter,this._useAlphaData=!1,this._isoalpha=1,this._numSlicePlanes=0,this._numSecondaryLights=h.numLights-1,this._scaleFactor=[1,1,1],this._blendOp=d.NoBlending,this._layer=0,this._shader=l,h.volumeIterator<20&&(this._shader.uniforms.u_jitter.value=h.volumeIterator/5e4),this._filter=d.LinearFilter,this._setNumChannels(r.NumChannels),this._isosurfaceDefines="#define REFINE_ISOSURFACE",this._renderingDefines="#define USE_VOLUME_RENDERING",this._clipIntersection=h.clipIntersection,this._clipIntersectionDefines=h.clipIntersection===!0?"#define CLIP_INTERSECTION":"",this._lightingDefines=h.lighting===!0?"#define USE_LIGHTING":"",this._cropDefines=h.cropBoxExclude===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(h.cropType),this._colorBoxDefines="",this._alphaDataDefines="",this._overlayDefines="",this._overlayRenderingDefines="#define USE_LABEL_OVERLAY",this._hardwareDefines=h.hardwareSupport===!0?"#define HARDWARE_WEBGL":"",this._cameraDefines=h.cameraStyle==="perspective"?"#define USE_PERSPECTIVE_CAMERA":"",this._rayTraceDefines="",this._volumeDefines="",this._useDataSlices=!1,this._dataSlices=[]}_setGlobalUniforms(r){super._setGlobalUniforms(r),r.u_lightColor=this._globalUniforms.u_lightColor,r.u_primaryLight=this._globalUniforms.u_primaryLight,r.u_cameraTarget=this._globalUniforms.u_cameraTarget,r.u_ambientStrength=this._globalUniforms.u_ambientStrength,r.u_primaryLightIntensity=this._globalUniforms.u_primaryLightIntensity,r.u_lightRaySteps=this._globalUniforms.u_lightRaySteps,r.u_deferredTexture=this._globalUniforms.u_deferredTexture,r.u_secondaryLight=this._globalUniforms.u_secondaryLight,r.u_secondaryLightIntensity=this._globalUniforms.u_secondaryLightIntensity}_updateGeometry(r,h){(this._size.distanceToSquared(this._priorSize)>1e-4||this._offset.distanceToSquared(this._priorOffset)>1e-4)&&(this._mesh.geometry.translate(-this._priorSize.x/2-this._priorOffset.x,-this._priorSize.y/2-this._priorOffset.y,-this._priorSize.z/2-this._priorOffset.z),this._mesh.geometry.scale(this._size.x/this._priorSize.x,this._size.y/this._priorSize.y,this._size.z/this._priorSize.z),this._mesh.geometry.translate(this._size.x/2+this._offset.x,this._size.y/2+this._offset.y,this._size.z/2+this._offset.z),this._mesh.material.uniforms.u_size.value.set(this._size.x,this._size.y,this._size.z),this.quality(h))}_setLayer(r){this._layer=r;const h=this._renderingStyle===7&&this._lightingDefines!==""?16:0;this._mesh.layers.set(this._layer+h),this._depthMesh!==null&&this._depthMesh.layers.set(this._layer+h)}_setDataSliceTransformation(){const r=this._mesh.matrix.clone();r.invert();for(let h=0;h<this._dataSlices.length;h++)this._dataSlices[h].setVolumeInverseMatrix(r)}_setDataSliceTextures(){for(let r=0;r<this._dataSlices.length;r++)this._dataSlices[r].setVolumeDataTextures(this._texture,this._overlayTexture,this._alphaTexture,this._size),this._dataSlices[r].setVolumeDefines(this._shaderDefines,this._overlayDefines,this._alphaDataDefines)}_setDataSlices(r,h){if(h!==void 0){if(h.NumSlices<this._dataSlices.length)for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u].remove();for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u]._visible(!1);if(h.NumSlices===0){this._useDataSlices=!1;for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u].remove();this._dataSlices=[]}else if(h.NumSlices<this._dataSlices.length)for(let u=h.NumSlices;u<this._dataSlices.length;u++)this._dataSlices[u].remove();else if(h.NumSlices>this._dataSlices.length){let u;for(let g=this._dataSlices.length;g<h.NumSlices;g++)u=new _(this._scene,this._depthScene,r,this._globalData),u._visible(!1),this._dataSlices.push(u)}if(h.NumSlices>0)if(this._useDataSlices=!0,this._setDataSliceTextures(),this._setDataSliceTransformation(),h.NumSlices===1)this._dataSlices[0].setSliceProperties(h.Slices),this._dataSlices[0]._visible(!0);else for(let u=0;u<this._dataSlices.length;u++)this._dataSlices[u].setSliceProperties(h.Slices[u]),this._dataSlices[u]._visible(!0)}}}},D,V),D.exports=B},2591:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return{defines:{TOLERANCE:1e-6},uniforms:{u_size:{value:new d.Vector3(1,1,1)},u_anisotropy:{value:new d.Vector3(1,1,1)},u_scaleFactor:{value:new d.Vector3(1,1,1)},u_visible:{value:1},u_clim:{value:new d.Vector2(0,1)},u_isovalue:{value:.15},u_isoalpha:{value:1},u_primaryLight:{value:new d.Vector3(1,1,1)},u_lightColor:{value:new d.Vector4(1,1,1,1)},u_ambientStrength:{value:.3},u_primaryLightIntensity:{value:.6},u_specularStrength:{value:.2},u_shininess:{value:16},u_cameraTarget:{value:new d.Vector3},u_data:{value:null},u_transferFunction:{value:null},u_alphaData:{value:null},u_relativeStepSize:{value:1},u_lightRaySteps:{value:.5},u_gradientOpacityLimits:{value:new d.Vector2(0,.3)},u_secondaryLight:{value:null},u_secondaryLightIntensity:{value:null},u_rgbAnchorColor:{value:new d.Vector3(0,0,0)},slicePlanes:{value:null},worldCoordClippingPlanes:{value:null},u_overlayData:{value:null},u_overlayTransferFunction:{value:null},u_overlayclim:{value:new d.Vector2(0,1)},u_passNumber:{value:0},u_depthTexture:{value:null},u_previousTexture:{value:null},u_viewportSize:{value:new d.Vector2(1,1)},u_depthSensitivity:{value:.01},u_interactionStarted:{value:0},u_jitter:{value:0},u_offset:{value:new d.Vector3(0,0,0)},u_totalSize:{value:new d.Vector3(1,1,1)},u_deferredTexture:{value:null},u_cropMin:{value:new d.Vector3(0,0,0)},u_cropMax:{value:new d.Vector3(1,1,1)},u_cropCenter:{value:new d.Vector3(.5,.5,.5)},u_cropRadius:{value:0},u_cropHeight:{value:0}},vertexShader:`varying vec4 v_nearpos;
        varying vec4 v_farpos;
        varying vec3 v_position;
        
        flat varying vec3 v_localCameraPosition;
        flat varying vec3 v_localLightPosition;
        flat varying vec3 v_localCameraTarget;
        flat varying mat4 inverseModelMatrix;
        
        uniform vec3 u_primaryLight;
        uniform vec3 u_cameraTarget;
        
        void main() {
            // Prepare transforms to map to "camera view". See also:
            // https://threejs.org/docs/#api/renderers/webgl/WebGLProgram
            mat4 inverseModelViewMatrix = inverse(modelViewMatrix);
            inverseModelMatrix = inverse(modelMatrix);
        
            // Project local vertex coordinate to camera position. Then do a step
            // backward (in cam coords) to the near clipping plane, and project back. Do
            // the same for the far clipping plane. This gives us all the information we
            // need to calculate the ray and truncate it to the viewing cone.
            vec4 pos4 = vec4(position, 1.0);
            vec4 posCameraCoordinates = modelViewMatrix * pos4;
        
            // Intersection of ray and near clipping plane (z = -1 in clip coords)
            posCameraCoordinates.z = -posCameraCoordinates.w;
            v_nearpos = inverseModelViewMatrix * posCameraCoordinates;
        
            // Intersection of ray and far clipping plane (z = +1 in clip coords)
            posCameraCoordinates.z = posCameraCoordinates.w;
            v_farpos = inverseModelViewMatrix * posCameraCoordinates;
        
            // Set position as varying in local coordinates
            v_position = position;
        
            // Set vertex position in world coordinates projected into camera coordinates
            gl_Position = projectionMatrix * viewMatrix * modelMatrix * pos4;
        
            vec4 localCameraPosition = inverse(modelMatrix) * vec4(cameraPosition, 1.0);
            vec4 localLightPosition = inverse(modelMatrix) * vec4(u_primaryLight, 1.0);
            vec4 localCameraTarget = inverse(modelMatrix) * vec4(u_cameraTarget, 1.0);
        
            v_localCameraPosition = localCameraPosition.xyz;
            v_localLightPosition = localLightPosition.xyz;
            v_localCameraTarget = localCameraTarget.xyz;
        }`,fragmentShader:`
        //---------------------------------------------------------------------
        // Fragment shader for grayscale and rgb volume rendering
        //---------------------------------------------------------------------
        
        // Copyright 2021-2023 The MathWorks, Inc.
        
        // Specify precision when using floats and data textures
        precision highp float;
        precision mediump sampler3D;
        
        // Varying uniforms computed by the vertex shader and interpolated
        // for the corresponding fragment
        varying vec3 v_position;
        varying vec4 v_nearpos;
        varying vec4 v_farpos;
        flat varying vec3 v_localCameraPosition;
        flat varying vec3 v_localLightPosition;
        flat varying vec3 v_localCameraTarget;
        flat varying mat4 inverseModelMatrix;
        
        uniform mat4 modelMatrix;
        uniform mat4 modelViewMatrix;
        uniform mat4 projectionMatrix;
        
        // Data texture uniform
        uniform sampler3D u_data;
        uniform sampler3D u_overlayData;
        uniform sampler3D u_alphaData;
        
        // Size (dims 1-3) of data texture
        uniform vec3 u_size;
        
        // Step size along ray through volume. Increase this to take more 
        // steps and improve quality at the cost of performance
        uniform float u_relativeStepSize;
        uniform float u_lightRaySteps;
        
        // Uniforms used with depth peeling
        uniform sampler2D u_depthTexture;
        uniform int u_passNumber;
        uniform vec2 u_viewportSize;
        uniform sampler2D u_previousTexture;
        uniform float u_depthSensitivity;
        uniform float u_interactionStarted;
        
        // Internal constants
        const int refinementSteps = 8;
        #ifdef USE_CINEMATIC_RENDERING
            const int maxLightRaySteps = 200;
        #else
            const int maxLightRaySteps = 100;
        #endif
        
        // Lighting uniforms (position, color, etc. not currently exposed)
        uniform vec4 u_lightColor;
        uniform vec3 u_primaryLight;
        uniform float u_primaryLightIntensity;
        uniform vec3 u_cameraTarget;
        uniform float u_ambientStrength;
        uniform float u_specularStrength;
        uniform float u_shininess;
        
        // Isosurface uniforms
        uniform float u_isovalue;
        #ifdef TRANSPARENT_ISOSURFACE
            uniform float u_isoalpha;
        #endif
        
        // Texture to sample transfer function
        uniform sampler2D u_transferFunction;
        
        #ifdef RGB_SHADER
            uniform vec3 u_rgbAnchorColor;
        #endif
        
        #ifndef RGB_SHADER
            // Uniform to control dynamic range
            uniform vec2 u_clim;
        #endif
        uniform vec2 u_overlayclim;
        
        #ifdef COLOR_BOX
            uniform mat4 u_colorBoxMatrix;
            uniform vec3 u_colorBoxColor;
        #endif
        
        const float gradientWeight = 100.0;
        uniform float u_jitter;
        uniform vec3 u_anisotropy;
        uniform vec3 u_scaleFactor;
        
        #ifdef USE_BLOCKED_RENDERING
            uniform vec3 u_offset;
            uniform vec3 u_totalSize;
            uniform sampler2D u_deferredTexture;
        #endif
        
        // Gradient opacity uniforms
        uniform vec2 u_gradientOpacityLimits;
        
        // Overlay uniforms
        uniform sampler2D u_overlayTransferFunction;
        
        #if NUM_CLIPPING_PLANES > 0
            uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
            uniform vec4 worldCoordClippingPlanes[ NUM_CLIPPING_PLANES ];
        #endif
        
        #if NUM_SLICE_PLANES > 0
            uniform vec4 slicePlanes[ NUM_SLICE_PLANES ];
        #endif
        
        #if NUM_SECONDARY_LIGHTS > 0
            uniform vec3 u_secondaryLight[ NUM_SECONDARY_LIGHTS ];
            uniform float u_secondaryLightIntensity[ NUM_SECONDARY_LIGHTS ];
        #endif
        
        #if NUM_CROP_BOXES > 0
            uniform vec3 u_cropMin;
            uniform vec3 u_cropMax;
            uniform vec3 u_cropCenter;
            uniform float u_cropRadius;
            uniform float u_cropHeight;
        #endif
        
        //---------------------------------------------------------------------
        // Utility functions
        //---------------------------------------------------------------------
        
        vec3 texToLocal (const vec3 loc) {
            // Convert texture coordinates to local coordinates.
            // Texture coordinates span the range [0 1], local
            // coordiantes span the range [0.5 n + 0.5] where n
            // is the number of voxels along that dimension.
            return (loc * u_size) + 0.5;
        }
        
        vec3 localToTex (const vec3 loc) {
            // Convert texture coordinates to local coordinates.
            // Texture coordinates span the range [0 1], local
            // coordiantes span the range [0.5 n + 0.5] where n
            // is the number of voxels along that dimension.
            return (loc - 0.5) / u_size;
        }
        
        vec3 texToWorld (const vec3 loc) {
            // Convert texture coordinates to world coordinates.
            // Texture coordinates span [0 1] across the texture. To convert
            // to local coordinates, we multiple texture coordinates by the
            // size of the texture in each dimension. Then, we use the
            // modelMatrix to convert local coordinates to world coordinates.
            vec4 worldCoords = modelMatrix * vec4( texToLocal(loc), 1.0 );
            return worldCoords.xyz;
        }
        
        vec3 worldToLocal (const vec3 loc) {
            // Convert world coordinates to local coordinates.
            // Texture coordinates span [0 1] across the texture. To convert
            // to local coordinates, we multiple texture coordinates by the
            // size of the texture in each dimension. Then, we use the
            // modelMatrix to convert local coordinates to world coordinates.
            vec4 localCoords = inverseModelMatrix * vec4( loc, 1.0 );
            #ifdef USE_BLOCKED_RENDERING
                return localCoords.xyz + u_offset;
            #else
                return localCoords.xyz;
            #endif
        }
        
        float insideTexture(const vec3 loc) {
            vec3 s = step( vec3(0.0, 0.0, 0.0), loc ) - step( u_size, loc );
            return s.x * s.y * s.z;
        }
        
        float rand(vec2 co){
            return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
        }
        
        float computeDepth (const vec3 loc) {
            // Project local coordinate (after converting from texture to local)
            // into camera position, then apply projection matrix to move into
            // clipping space. Convert clipping space into normalized device 
            // coordinates and compute depth relative to gl_DepthRange. This is
            // how gl_FragCoord.z is computed.
            vec4 locInCameraCoords = modelViewMatrix * vec4( texToLocal(loc), 1.0 );
            vec4 locInClipSpaceCoords = projectionMatrix * locInCameraCoords;
            float normalizedDeviceCoordsDepth = locInClipSpaceCoords.z / locInClipSpaceCoords.w;
        
            return ( ( ( gl_DepthRange.diff * normalizedDeviceCoordsDepth ) + gl_DepthRange.near + gl_DepthRange.far ) / 2.0) - u_jitter;
        }
        
        vec4 packDepthToRGBA (const float depth) {
            vec3 packFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0 );
            float shiftRight8 = 1.0 / 256.0; // Handle overflow
            float packUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
            
            vec4 rgba = vec4( fract(depth * packFactors), depth);
            rgba.yzw -= rgba.xyz * shiftRight8;
            return rgba * packUpscale;
        }
        
        vec4 packTwoFloatsToRGBA (const float a, const float b) {
            float packFactors = 256.0;
            float shiftRight8 = 1.0 / 256.0;
            float packUpscale = 256.0 / 255.0;
            vec4 rgba = vec4(fract(a * packFactors), a, fract(b * packFactors), b);
            rgba.g -= rgba.r * shiftRight8;
            rgba.a -= rgba.b * shiftRight8;
            return rgba * packUpscale;
        }
        
        void setDepth (const vec3 loc) {
            float depth = computeDepth(loc);
        
            if (u_passNumber == 2 ) {
                float prevDepth = texture(u_previousTexture, gl_FragCoord.xy / u_viewportSize).x;
                if (depth < prevDepth + TOLERANCE) {
                    discard;
                }
            }
        
            gl_FragDepth = depth;
            gl_FragColor = packDepthToRGBA(depth);
        }
        
        float sampleDepth (const vec2 screenPosition) {
            return texture(u_depthTexture, screenPosition).x;
        }
        
        void testDepth (const vec3 loc) {
            float depth = computeDepth(loc);
        
            float priorDepth = sampleDepth( gl_FragCoord.xy / u_viewportSize );
            float accumulatedDepth = texture(u_previousTexture, gl_FragCoord.xy / u_viewportSize).x;
        
            // Should be between current depth and previous depth to be included
            if (depth > priorDepth + TOLERANCE || depth < accumulatedDepth + TOLERANCE) {
                discard;
            }
        }
        
        float applyGradientOpacity (const float alpha, const float grad) {
            // When using gradient opacity, the relative step size should be 1.0.
            // Other alpha compositing routines adjust alpha by the relative
            // step size. We aren't doing that here because the step size
            // already impacts the absolute difference between the value of
            // the current location and the value of the previous location.
            return alpha * clamp( abs(grad) / (u_gradientOpacityLimits[1] - u_gradientOpacityLimits[0]), 0.0, 1.0 );
        }
        
        float adjustAlpha (const float alpha, const float dist) {
            return 1.0 - pow(1.0 - alpha, dist);
        }
        
        void blendColorToOutput(const vec4 color) {
            // Premultiply alpha into color to keep gl_FragColor premultipled
            gl_FragColor.rgb += (color.rgb * color.a) * (1.0 - gl_FragColor.a);
            gl_FragColor.a += color.a * (1.0 - gl_FragColor.a);
        }
        
        #ifdef COLOR_BOX
        
            vec4 colorInBox (vec4 color, const vec3 loc) {
                vec4 pos = u_colorBoxMatrix * vec4(texToWorld(loc), 1.0);
                vec3 s = step(vec3(-0.5), pos.xyz) - step(vec3(0.5), pos.xyz);
                if ((s.x * s.y * s.z) > 0.0) {
                    color.rgb = u_colorBoxColor;
                }
                return color;
            }
        
        #endif
        
        #ifdef RGB_SHADER
        
            vec3 rgb2xyz (const vec3 color) {
                vec3 tmp;
                tmp.x = ( color.r > 0.04045 ) ? pow( ( color.r + 0.055 ) / 1.055, 2.4 ) : color.r / 12.92;
                tmp.y = ( color.g > 0.04045 ) ? pow( ( color.g + 0.055 ) / 1.055, 2.4 ) : color.g / 12.92,
                tmp.z = ( color.b > 0.04045 ) ? pow( ( color.b + 0.055 ) / 1.055, 2.4 ) : color.b / 12.92;
                return 100.0 * tmp *
                    mat3( 0.4124, 0.3576, 0.1805,
                        0.2126, 0.7152, 0.0722,
                        0.0193, 0.1192, 0.9505 );
            }
        
            vec3 xyz2lab (const vec3 color) {
                vec3 n = color / vec3( 95.047, 100, 108.883 );
                vec3 v;
                v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );
                v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );
                v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );
                return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));
            }
        
            vec3 rgb2lab (const vec3 color) {
                vec3 lab = xyz2lab( rgb2xyz( color ) );
                return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));
            }
        
            float gradient (const vec3 val1, const vec3 val2) {
                return distance( rgb2lab(val1), rgb2lab(val2) );
            }
        
        #endif
        
        //---------------------------------------------------------------------
        // Texture sampling functions
        //---------------------------------------------------------------------
        #ifdef USE_OVERLAY
            float sampleOverlay (const vec3 texcoords) {
                return texture(u_overlayData, texcoords.xyz).r;
            }
        
            vec4 applyOverlayColormap (const float val) {
                float scaledVal = (val - u_overlayclim[0]) / (u_overlayclim[1] - u_overlayclim[0]);
                return texture(u_overlayTransferFunction, vec2(0,scaledVal));
            }
        
            float getOverlayAlpha (const float val) {
                vec4 color = applyOverlayColormap(val);
                return color.a;
            }
        #endif
        
        #ifdef USE_BLOCKED_RENDERING
            vec4 sampleDeferredTexture (const vec2 screenPosition) {
                return texture(u_deferredTexture, screenPosition);
            }
        
            float atEdgeOfBlockedVolume (const vec3 loc) {
                // Check if location is at the edge of the blocked volume, not just the
                // edge of the local block
                #ifdef USE_SMALL_VOLUME
                    // For small volumes, we take much smaller steps. Scale the
                    // lighting step to match
                    vec3 edge = 1.0 * u_relativeStepSize / u_size;
                #else
                    vec3 edge = 1.0 / u_size;
                #endif
        
                vec3 locInBlock = (loc * u_size) + u_offset;
                vec3 volMax = u_totalSize;
        
                vec3 p1 = step(edge, locInBlock);
                vec3 p2 = step(locInBlock + edge, volMax);
        
                return 1.0 - (p1.x * p1.y * p1.z * p2.x * p2.y * p2.z);
            }
        #endif
        
        #ifdef RGB_SHADER
        
            float sampleIntensity (const vec3 texcoords) {
                // Return luminance for RGB volumes
                return rgb2lab(texture(u_data, texcoords.xyz).rgb).x;
            }
        
            vec4 sampleTexture (const vec3 texcoords) {
                #ifdef RGBA_SHADER
                    vec4 color = texture(u_data, texcoords.xyz);
                #else
                    vec4 color = texture(u_data, texcoords.xyz);
                    #ifdef USE_ALPHA_DATA
                        // Sample color at location, then sample alpha data at
                        // same location
                        color.a = texture(u_alphaData, texcoords.xyz).a;
                    #else
                        // Sample color at location, then sample alphamap based on the minimum
                        // distance in LAB space to black and a specified anchor color
                        float alpha = min(gradient(color.rgb,u_rgbAnchorColor),gradient(color.rgb,vec3(0.0)));
                        color.a = texture(u_transferFunction, vec2(0,alpha)).a;
                    #endif
                #endif
                #ifdef COLOR_BOX
                    return colorInBox( color, texcoords );
                #else
                    return color;
                #endif
            }
        
        #else
        
            float sampleIntensity (const vec3 texcoords) {
                return texture(u_data, texcoords.xyz).r;
            }
        
            vec4 applyColormap (const float val, const vec3 texcoords) {
                float scaledVal = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);
                vec4 color = texture(u_transferFunction, vec2(0,scaledVal));
                #ifdef USE_ALPHA_DATA
                    color.a = texture(u_alphaData, texcoords.xyz).a;
                #else
                    color.a = texture(u_transferFunction, vec2(0,val)).a;
                #endif
                #ifdef COLOR_BOX
                    return colorInBox( color, texcoords );
                #else
                    return color;
                #endif
            }
        
            vec4 sampleTexture (const vec3 texcoords) {
                return applyColormap( sampleIntensity(texcoords), texcoords );
            }
            
        #endif
        
        //---------------------------------------------------------------------
        // Clipping and slicing functions
        //---------------------------------------------------------------------
        bool outsideCropBox (const vec3 loc) {
            #if NUM_CROP_BOXES > 0
                vec3 worldLoc = texToWorld(loc);
        
                #if CROP_TYPE == 0
                    vec3 s = step(u_cropMin, worldLoc) - step(u_cropMax, worldLoc);
                    #ifdef CROP_EXCLUDE
                        return bool(s.x * s.y * s.z);
                    #else
                        return bool(1.0 - (s.x * s.y * s.z));
                    #endif
                #endif        
                
                // For a point p on the object and a point c as the center of the sphere,
                // Check if abs(p.xyz - r.xyz) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the sphere. Otherwise it lies within the sphere.
        
                #if CROP_TYPE == 1
                    float dist = distance(worldLoc, u_cropCenter);
                    #ifdef CROP_EXCLUDE
                        return (dist <= u_cropRadius);
                    #else
                        return (dist > u_cropRadius);
                    #endif
                #endif
        
                // For a point p on the object and a point c as the center of the cylinder,
                // Check if abs(p.xy - r.xy) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the curved surface of the cylinder along the x-y plane. 
                // Otherwise it lies within the curved surface of the cylinder.
                // Check if abs(p.z - c.z) > height / 2.0f (distance of p from the center along the z-axis is greater than height of the cylinder/2)
                // If so, then the point lies outside the end caps of the cylinder.
                // If either of these conditions are met, then the point lies outside the cylinder.
        
                #if CROP_TYPE == 2
                    float distanceXYPlane = distance(vec2(worldLoc.x, worldLoc.y), vec2(u_cropCenter.x, u_cropCenter.y));
                    float distanceZAxis = abs(worldLoc.z - u_cropCenter.z);
                    #ifdef CROP_EXCLUDE
                        return (distanceXYPlane <= u_cropRadius && distanceZAxis <= (u_cropHeight / 2.0f));
                    #else
                        return (distanceXYPlane > u_cropRadius || distanceZAxis > (u_cropHeight / 2.0f));
                    #endif
                #endif
            #else
                return false;
            #endif
        }
        
        bool clipped (const vec3 loc) {
            // Returns true if the location in world coordinates should be 
            // clipped (discard or not rendered).
            bool culled = outsideCropBox(loc);
            #if NUM_CLIPPING_PLANES > 0
        
            // Convert texture coordinates to camera coordinates.
            // Texture coordinates span [0 1] across the texture. To convert
            // to local coordinates, we multiple texture coordinates by the
            // size of the texture in each dimension. Then, we use the
            // modelViewMatrix to convert local coordinates to camera coordinates.
            // the clipping planes are set in camera coordinates
            vec4 cameraCoords = modelViewMatrix * vec4( texToLocal(loc), 1.0 );
            vec3 clipPosition = -cameraCoords.xyz;
            vec4 plane;
        
                #ifdef CLIP_INTERSECTION
                    culled = true;
        
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        culled = dot( clipPosition, plane.xyz ) > plane.w && culled;
                    }
                    #pragma unroll_loop_end
                #else
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        culled = dot( clipPosition, plane.xyz ) > plane.w || culled;
                    }
                    #pragma unroll_loop_end
                #endif
            #endif
        
            #ifdef USE_OVERLAY
                #ifdef USE_OVERLAY_MASK
                    culled = culled || (applyOverlayColormap(sampleOverlay(loc)).a < TOLERANCE);
                #endif
            #endif
            return culled;
        }
        
        vec4 clipNormal (const vec3 loc) {
            // Return a vector that describes the normal vector of
            // the clipping planes impacting the location. With clip
            // intersection turned on, this vector is the sum of vectors
            // that aren't clipping the location. Without clip
            // intersection, the vector is a sum of normals of the planes
            // that are clipping the location.
            vec4 clipNorm;
            #if NUM_CLIPPING_PLANES > 0
        
            // Convert texture coordinates to camera coordinates.
            vec4 cameraCoords = modelViewMatrix * vec4( texToLocal(loc), 1.0 );
            vec3 clipPosition = -cameraCoords.xyz;
        
                #ifdef CLIP_INTERSECTION
                    bool tempCulled = false;
                    bool culled = true;
                    vec4 plane;
                    vec4 worldPlane;
        
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        worldPlane = worldCoordClippingPlanes[ i ];
                        tempCulled = dot( clipPosition, plane.xyz ) > plane.w;
                        culled = tempCulled && culled;
                        clipNorm.xyz += worldToLocal(worldPlane.xyz) * float(!tempCulled);
                    }
                    #pragma unroll_loop_end
        
                    clipNorm.w = float(culled);
                    return clipNorm;
                #else
                    bool tempCulled = false;
                    bool culled = false;
                    vec4 plane;
                    vec4 worldPlane;
        
                    #pragma unroll_loop_start
                    for ( int i = 0; i < NUM_CLIPPING_PLANES; i++ ) {
                        plane = clippingPlanes[ i ];
                        worldPlane = worldCoordClippingPlanes[ i ];
                        tempCulled = dot( clipPosition, plane.xyz ) > plane.w;
                        culled = tempCulled || culled;
                        clipNorm.xyz += worldToLocal(worldPlane.xyz) * float(tempCulled);
                    }
                    #pragma unroll_loop_end
        
                    clipNorm.w = float(culled);
                    return clipNorm;
                #endif
            #else
                return clipNorm;
            #endif
        }
        
        //---------------------------------------------------------------------
        // Lighting functions
        //---------------------------------------------------------------------
        vec3 getDataEdgeNormal (const vec3 loc) {
            // Search the neighborhood of the location to compute the
            // normal if the location is near or the edge of the volume
            vec3 rayStep = 1.7 * u_relativeStepSize / u_size;
            vec4 val1 = clipNormal(loc + vec3(-rayStep.x, 0.0, 0.0));
            vec4 val2 = clipNormal(loc + vec3(+rayStep.x, 0.0, 0.0)); 
            vec4 val3 = clipNormal(loc + vec3(0.0, -rayStep.y, 0.0)); 
            vec4 val4 = clipNormal(loc + vec3(0.0, +rayStep.y, 0.0)); 
            vec4 val5 = clipNormal(loc + vec3(0.0, 0.0, -rayStep.z)); 
            vec4 val6 = clipNormal(loc + vec3(0.0, 0.0, +rayStep.z));
        
            #ifdef CLIP_INTERSECTION
                float sum = val1.a + val2.a + val3.a + val4.a + val5.a + val6.a;
                vec4 totalVal = (val1 + val2 + val3 + val4 + val5 + val6) * float(sum > 0.5);
                return totalVal.xyz;
            #else
                // Don't normalize this vector. Normalizing an all zero vector
                // returns something that isn't all zeros. We expect this to
                // be all zeros often when we aren't near an edge.
                vec4 totalVal = (val1 + val2 + val3 + val4 + val5 + val6);
                return totalVal.xyz;
            #endif
        }
        
        vec3 getCropEdgeNormal (const vec3 loc) {
            // Search the neighborhood of the location to compute the
            // normal if the location is near or the edge of the crop box
            vec3 rayStep = 3.0 * u_relativeStepSize / u_size;
            vec3 val;
            val.x += float(outsideCropBox(loc + vec3(-rayStep.x, 0.0, 0.0)));
            val.x -= float(outsideCropBox(loc + vec3(+rayStep.x, 0.0, 0.0))); 
            val.y += float(outsideCropBox(loc + vec3(0.0, -rayStep.y, 0.0))); 
            val.y -= float(outsideCropBox(loc + vec3(0.0, +rayStep.y, 0.0))); 
            val.z += float(outsideCropBox(loc + vec3(0.0, 0.0, -rayStep.z))); 
            val.z -= float(outsideCropBox(loc + vec3(0.0, 0.0, +rayStep.z)));
            return val;
        }
        
        vec3 getDataGradientNormal (const vec3 loc) {
            // Search the neighborhood of the location to compute the
            // normal based on the intensity of the surrounding
            // neighborhood.
            #ifdef USE_SMALL_VOLUME
                // For small volumes, we take much smaller steps. Scale the
                // lighting step to match
                vec3 rayStep = 1.5 * u_relativeStepSize / u_size;
                vec3 edge = 1.0 * u_relativeStepSize / u_size;
            #else
                vec3 rayStep = 1.5 / u_size;
                vec3 edge = 1.0 / u_size;
            #endif
        
            vec3 val1;
            vec3 val2;
            #ifdef USE_BLOCKED_RENDERING
                // Identify offset if we are near a block edge to move away from the
                // block edge. We can get a better approximation of the gradient for
                // lighting at the offset location than right at the block edge
                vec3 offset = step(rayStep, loc) - step(loc + rayStep, vec3(1.0));
                offset *= rayStep;
        
                // Get location in voxel coordinates relative to the entire blockedImage.
                // We will use this to determine if we are at the edge of the entire volume
                vec3 locInBlock = (loc * u_size) + u_offset;
                vec3 volMax = u_totalSize;
            #else
                vec3 offset;
                vec3 locInBlock = loc;
                vec3 volMax = vec3(1.0, 1.0, 1.0);
            #endif
        
            vec3 atEdge1 = step(edge, locInBlock); // locInBlock - edge < 0.0
            vec3 atEdge2 = step(locInBlock + edge, volMax);
        
            #ifdef USE_ALPHA_DATA
                val1.x = texture(u_alphaData, loc + vec3(-rayStep.x, 0.0, 0.0) + offset).a - (atEdge1.x * gradientWeight);
                val2.x = texture(u_alphaData, loc + vec3(+rayStep.x, 0.0, 0.0) + offset).a - (atEdge2.x * gradientWeight);
                val1.y = texture(u_alphaData, loc + vec3(0.0, -rayStep.y, 0.0) + offset).a - (atEdge1.y * gradientWeight);
                val2.y = texture(u_alphaData, loc + vec3(0.0, +rayStep.y, 0.0) + offset).a - (atEdge2.y * gradientWeight);
                val1.z = texture(u_alphaData, loc + vec3(0.0, 0.0, -rayStep.z) + offset).a - (atEdge1.z * gradientWeight);
                val2.z = texture(u_alphaData, loc + vec3(0.0, 0.0, +rayStep.z) + offset).a - (atEdge2.z * gradientWeight);
            #else
                val1.x = sampleIntensity(loc + vec3(-rayStep.x, 0.0, 0.0) + offset) - (atEdge1.x * gradientWeight);
                val2.x = sampleIntensity(loc + vec3(+rayStep.x, 0.0, 0.0) + offset) - (atEdge2.x * gradientWeight);
                val1.y = sampleIntensity(loc + vec3(0.0, -rayStep.y, 0.0) + offset) - (atEdge1.y * gradientWeight);
                val2.y = sampleIntensity(loc + vec3(0.0, +rayStep.y, 0.0) + offset) - (atEdge2.y * gradientWeight);
                val1.z = sampleIntensity(loc + vec3(0.0, 0.0, -rayStep.z) + offset) - (atEdge1.z * gradientWeight);
                val2.z = sampleIntensity(loc + vec3(0.0, 0.0, +rayStep.z) + offset) - (atEdge2.z * gradientWeight);
            #endif
            vec3 n = val1 - val2;
            return normalize(n);
        }
        
        #ifdef RAY_TRACE_LIGHT
            float lightTransmittance (const vec3 startLoc, const vec3 viewRay) {
                // Measure light transmittance, the ratio of light that reaches the
                // current location to the light that is transmitted through it
                float T = 1.0;
                vec4 color;
        
                // Get light direction in texture coordinates
                vec3 lightTexCoords = localToTex(v_localLightPosition);
                vec3 lightDir = normalize(lightTexCoords - startLoc);
                float dist = length(lightTexCoords - startLoc);
        
                // Standard box intersection calculation. In our case, we are in
                // texture coordinates so the box limits are zeros and ones.
                vec3 inverseLightDir = 1.0 / lightDir;
                vec3 tminTemp = (vec3(0) - startLoc) * inverseLightDir;
                vec3 tmaxTemp = (vec3(1) - startLoc) * inverseLightDir;
                vec3 tmin = min(tminTemp, tmaxTemp);
                vec3 tmax = max(tminTemp, tmaxTemp);
                float t0 = max(tmin.x, max(tmin.y, tmin.z));
                float t1 = min(tmax.x, min(tmax.y, tmax.z));
        
                // If the light is located inside the texture, we should stop at the
                // light and not where the ray intersects the texture bounding box (which 
                // would be past the light)
                t1 = min(t1, dist);
        
                // Get the location in texture coordinates where we should stop the ray trace
                vec3 endLoc = startLoc + (lightDir * t1);
        
                // Limit the number of steps to a constant number. We may want to tweak this 
                // during interactions
                int nsteps = int(float(maxLightRaySteps) * t1 / sqrt(3.0));
        
                // Set the step size
                vec3 rayStep = (endLoc - startLoc) / float(nsteps);
                float relativeStepSize = length(rayStep * u_size) * dot( u_anisotropy * u_scaleFactor, abs(viewRay) ) / dot(vec3(1.0,1.0,1.0),abs(viewRay));
        
                // TODO - We need to figure out how to tweak this coefficient
                #ifdef USE_CINEMATIC_RENDERING
                    const float ABSORPTION = 0.5;
                #else
                    const float ABSORPTION = 0.1;
                #endif
        
                int maxSteps = min(int(float(maxLightRaySteps) * u_lightRaySteps),nsteps);
                vec3 loc = startLoc;
        
                for (int i = 0; i < maxSteps; i++) {
                    // Move to next step towards light source
                    loc += rayStep;
        
                    // Sample transmittance based on the opacity at each step
                    color = sampleTexture(loc);
        
                    // Accumulate absorption
                    T *= exp( -ABSORPTION * float( !clipped(loc) ) * color.a * relativeStepSize);
                }
        
                return T;
            }
        
            float henyeyGreenstein (const float g, const float cosineTheta) {
                // Henyey-Greenstein phase function for modeling light scatter
                return (1.0 - (g * g)) / (4.0 * 3.141592653 * pow(1.0 + (g * g) - (2.0 * g * cosineTheta), 1.5));
            }
        
            float inScatter (const vec3 lightDir, const vec3 viewDir, const float light) {
                // Estimate the amount of light that is scattered back along
                // the camera ray using an approximation of the Henyey-Greenstein 
                // function
                float cosineTheta = dot(-lightDir,viewDir);
                float g = 0.7;
                float hg = henyeyGreenstein(g, cosineTheta);
        
                return light * (1.0 - exp(-hg));
            }    
        #endif
        
        #ifdef USE_OVERLAY
            
            vec3 getOverlayGradientNormal (const vec3 loc) {
                // Search the neighborhood of the location to compute the
                // normal based on the intensity of the surrounding
                // neighborhood.
                #ifdef USE_SMALL_VOLUME
                    // For small volumes, we take much smaller steps. Scale the
                    // lighting step to match
                    vec3 rayStep = 1.5 * u_relativeStepSize / u_size;
                    vec3 edge = 1.0 * u_relativeStepSize / u_size;
                #else
                    vec3 rayStep = 1.5 / u_size;
                    vec3 edge = 1.0 / u_size;
                #endif
                vec3 val1;
                vec3 val2;
        
                #ifdef USE_BLOCKED_RENDERING
                    // Identify offset if we are near a block edge to move away from the
                    // block edge. We can get a better approximation of the gradient for
                    // lighting at the offset location than right at the block edge
                    vec3 offset = step(rayStep, loc) - step(loc + rayStep, vec3(1.0));
                    offset *= rayStep;
        
                    // Get location in voxel coordinates relative to the entire blockedImage.
                    // We will use this to determine if we are at the edge of the entire volume
                    vec3 locInBlock = (loc * u_size) + u_offset;
                    vec3 volMax = u_totalSize;
                #else
                    vec3 offset;
                    vec3 locInBlock = loc;
                    vec3 volMax = vec3(1.0, 1.0, 1.0);
                #endif
        
                vec3 atEdge1 = step(edge, locInBlock); // locInBlock - edge < 0.0
                vec3 atEdge2 = step(locInBlock + edge, volMax);
        
                #ifdef USE_BLOCKED_RENDERING
                    val1.x = getOverlayAlpha(sampleOverlay(loc + vec3(-rayStep.x, 0.0, 0.0) + offset)) - (atEdge1.x * gradientWeight);
                    val2.x = getOverlayAlpha(sampleOverlay(loc + vec3(+rayStep.x, 0.0, 0.0) + offset)) - (atEdge2.x * gradientWeight);
                    val1.y = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, -rayStep.y, 0.0) + offset)) - (atEdge1.y * gradientWeight);
                    val2.y = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, +rayStep.y, 0.0) + offset)) - (atEdge2.y * gradientWeight);
                    val1.z = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, 0.0, -rayStep.z) + offset)) - (atEdge1.z * gradientWeight);
                    val2.z = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, 0.0, +rayStep.z) + offset)) - (atEdge2.z * gradientWeight);
                #else
                    val1.x = getOverlayAlpha(sampleOverlay(loc + vec3(-rayStep.x, 0.0, 0.0))) - (atEdge1.x * gradientWeight);
                    val2.x = getOverlayAlpha(sampleOverlay(loc + vec3(+rayStep.x, 0.0, 0.0))) - (atEdge2.x * gradientWeight);
                    val1.y = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, -rayStep.y, 0.0))) - (atEdge1.y * gradientWeight);
                    val2.y = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, +rayStep.y, 0.0))) - (atEdge2.y * gradientWeight);
                    val1.z = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, 0.0, -rayStep.z))) - (atEdge1.z * gradientWeight);
                    val2.z = getOverlayAlpha(sampleOverlay(loc + vec3(0.0, 0.0, +rayStep.z))) - (atEdge2.z * gradientWeight);
                #endif
                vec3 n = val1 - val2;
                return normalize(n);
            }
        
            vec3 getOverlayNormal (const vec3 loc) {
                vec3 dataGradient = getOverlayGradientNormal(loc);
                vec3 edgeGradient;
                #if NUM_CLIPPING_PLANES > 0
                    edgeGradient += getDataEdgeNormal(loc);
                #endif
                #if NUM_CROP_BOXES > 0
                    edgeGradient += getCropEdgeNormal(loc);
                #endif
                return normalize((gradientWeight * edgeGradient) + dataGradient);
            }
        
        #endif
        
        vec3 getNormal (const vec3 loc) {
            vec3 dataGradient = getDataGradientNormal(loc);
            vec3 edgeGradient;
            #if NUM_CLIPPING_PLANES > 0
                edgeGradient += getDataEdgeNormal(loc);
            #endif
            #if NUM_CROP_BOXES > 0
                edgeGradient += getCropEdgeNormal(loc);
            #endif
            return normalize((gradientWeight * edgeGradient) + dataGradient);
        }
        
        vec4 applyLighting (vec4 color, vec3 loc, vec3 viewRay, vec3 surfaceNormal, float lightStrength) {
            // Calculate color by incorporating lighting
        
            // View direction - viewRay needs to be normalized, but it is already
            // done in the main program
        
            // Flip normal so it points towards viewer
            float Nselect = float(dot(surfaceNormal, viewRay) > 0.0);
            surfaceNormal = (2.0 * Nselect - 1.0) * surfaceNormal; // == Nselect * surfaceNormal - (1.0-Nselect)*surfaceNormal;
        
            // Get light direction and prevent zero division
            #ifdef USE_PERSPECTIVE_CAMERA
                vec3 lightDir = normalize(texToLocal(loc) - v_localLightPosition); 
            #else
                vec3 lightDir = normalize(v_localCameraTarget - v_localLightPosition);
            #endif
        
            float diffuseStrength = u_primaryLightIntensity;
            float specularStrength = u_specularStrength;
            float shininess = u_shininess;
        
            // Make custom modifications to lighting parameters based on the rendering style
            #ifdef USE_OVERLAY
                specularStrength = 0.0;
            #else
                #ifdef USE_ISOSURFACE
                    shininess = 2.0 * u_shininess;
                #endif
            #endif
        
            // Calculate lighting properties
            #ifdef RAY_TRACE_LIGHT
                // For light scattering, diffuse light is approximated by ray tracing
                // from the current location back to the light source
                float lambertTerm = lightStrength * diffuseStrength;
                float scatterTerm = inScatter(normalize(texToLocal(loc) - v_localLightPosition), viewRay, lightStrength * diffuseStrength);
            #else
                float lambertTerm = clamp(dot(surfaceNormal, lightDir), 0.0, 1.0) * diffuseStrength;
                float scatterTerm = 0.0;
            #endif
        
            // An alternate way to compute the specular term is:
            // float specularTerm = pow(max(dot(reflect(-lightDir, surfaceNormal), viewRay), 0.0), shininess);
            // The alternate way produces more sudden reflections at some low angles.
            float specularTerm = pow(clamp(dot(normalize(lightDir + viewRay),surfaceNormal), 0.0, 1.0), shininess) * specularStrength;
        
            #ifdef USE_CINEMATIC_RENDERING
                vec4 finalColor = packTwoFloatsToRGBA( lambertTerm, ((color.a * specularTerm) + scatterTerm) );
            #else
                lambertTerm = clamp(lambertTerm, 0.0, 1.0);
                specularTerm = clamp(specularTerm * diffuseStrength, 0.0, 1.0);
        
                #ifndef RAY_TRACE_LIGHT
                    #if NUM_SECONDARY_LIGHTS > 0
                        vec3 light;
                        float intensity;
                        #pragma unroll_loop_start
                        for ( int i = 0; i < NUM_SECONDARY_LIGHTS; i++ ) {
                            light = u_secondaryLight[ i ];
                            intensity = u_secondaryLightIntensity[ i ];
                            light = worldToLocal(light); 
                            #ifdef USE_PERSPECTIVE_CAMERA
                                lightDir = normalize(texToLocal(loc) - light); 
                            #else
                                lightDir = normalize(v_localCameraTarget - light);
                            #endif
                            lambertTerm += clamp(dot(surfaceNormal, lightDir), 0.0, 1.0) * intensity;
                            specularTerm += pow(clamp(dot(normalize(lightDir + viewRay),surfaceNormal), 0.0, 1.0), shininess) * specularStrength * intensity;
                        }
                        #pragma unroll_loop_end
                        lambertTerm = clamp(lambertTerm, 0.0, 1.0);
                        specularTerm = clamp(specularTerm, 0.0, 1.0);
                    #endif
                #endif
        
                vec4 ambientColor = u_lightColor * u_ambientStrength;
                vec4 diffuseColor = u_lightColor * lambertTerm;
                vec4 specularColor = u_lightColor * specularTerm;
                vec4 scatterColor = u_lightColor * scatterTerm;
        
                // Calculate final color by combining different components
                // Some implementations sum all three light components before multiplying
                // with the color. This keeps the color from getting saturated. If we
                // pull out the specularColor term and add it later, it can create a
                // color lighter than the original color, giving a glossy effect.
                vec4 finalColor = ( color * (ambientColor + diffuseColor) + specularColor + scatterColor );
        
                // Keep the previous transparency
                finalColor.a = color.a;
        
            #endif
        
            return finalColor;
        }
        
        vec4 getMaxIntensityValue (const vec3 startLoc, const vec3 rayStep, const int nsteps, const int maxSteps, inout float maxVal) {
        // define is used to share code between min intensity and max intensity projection.
            vec4 finalLoc = vec4(0.0);
            finalLoc.xyz = startLoc;
            int projectionIndex = 0;
            vec3 loc = startLoc;
        
            // Enter the raycasting loop. In WebGL the loop index cannot be compared with
            // non-constant expression. We use a hard-coded max and an additional condition
            // inside the loop.
            for (int i = 0; i < maxSteps; i++) {
                if (i >= nsteps) {
                    break;
                }
                if ( clipped(loc) ) {
                    loc += rayStep;
                    continue;
                }
        
                // Sample from the 3D texture
                float val = sampleIntensity(loc);
                // Apply MIP operation
                #ifdef USE_MAXIP
                    if ( val > maxVal ) {
                #else
                    if ( val < maxVal ) {
                #endif
                    maxVal = val;
                    projectionIndex = i;
                    finalLoc.a = 1.0;
                    #ifdef USE_BLOCKED_RENDERING
                        finalLoc.xyz = loc;
                    #endif
                }
                // Advance location deeper into the volume
                loc += rayStep;
            }
        
            #ifndef USE_BLOCKED_RENDERING
                // Refine location, gives crispier images
                vec3 iloc = startLoc + rayStep * (float(projectionIndex) - 0.5);
                finalLoc.xyz = iloc;
                vec3 istep = rayStep / float(refinementSteps);
                for (int i = 0; i < refinementSteps; i++) {
                    if ( clipped(iloc) ) {
                        iloc += istep;
                        continue;
                    }
        
                    float val = sampleIntensity(iloc);
                    // Apply MIP operation at refined location
                    #ifdef USE_MAXIP
                        if ( val > maxVal ) {
                    #else
                        if ( val < maxVal ) {
                    #endif
                        maxVal = val;
                        finalLoc.xyz = iloc;
                        finalLoc.a = 1.0;
                    }
        
                    iloc += istep;
                }
            #endif
        
            return finalLoc;
        }
        
        //---------------------------------------------------------------------
        // Ray marching functions
        //---------------------------------------------------------------------
        void renderSlicePlanes (inout vec3 finalLoc, vec3 startLoc, vec3 rayStep, int nsteps, int maxSteps, inout vec4 color) {
        
            // Initial color and transparency
            vec4 plane;
            float denominator;
            float closestT = 1e12;
            vec3 closestIntersection = vec3(0.0,0.0,0.0);
            vec3 loc = vec3(0.0);
            float scale = 1.0;
        
            #ifdef USE_BLOCKED_RENDERING
                // Account for the offest of the local block compared to the entire volume
                vec3 localStart = texToLocal(startLoc) + u_offset;
                vec3 rayDirection = (texToLocal(startLoc + (rayStep * float(nsteps))) + u_offset) - localStart;
            #else
                vec3 localStart = texToLocal(startLoc);
                vec3 rayDirection = texToLocal(startLoc + (rayStep * float(nsteps))) - localStart;
            #endif
        
            #ifdef USE_OVERLAY
                vec4 overlay;
            #endif
        
            #pragma unroll_loop_start
            for ( int i = 0; i < NUM_SLICE_PLANES; i++ ) {
                plane = slicePlanes[ i ];
                denominator = dot(rayDirection,plane.xyz);
        
                if (abs(denominator) > TOLERANCE) {
                    float t = -(dot(localStart, plane.xyz) + plane.w) / denominator;
                    #ifdef USE_BLOCKED_RENDERING
                        loc = localToTex( (localStart + (t * rayDirection) ) - u_offset);
                    #else
                        loc = localToTex(localStart + (t * rayDirection));  
                    #endif
        
                    #ifdef USE_OVERLAY
                        #ifdef USE_OVERLAY_MASK
                            overlay =  applyOverlayColormap(sampleOverlay(loc)); 
                            scale = overlay.a;
                        #endif
                    #endif
        
                    // Check if this intersection is the closest one
                    #ifdef USE_BLOCKED_RENDERING
                    if (t >= 0.0 && insideTexture((localStart + (t * rayDirection) ) - u_offset) * scale > TOLERANCE && t < closestT) {
                    #else
                    if (t >= 0.0 && insideTexture(localStart + (t * rayDirection)) * scale > TOLERANCE && t < closestT) {
                    #endif
                        closestT = t;
                        finalLoc = loc;
                        color = sampleTexture(loc);
                        #ifdef USE_OVERLAY
                            overlay =  applyOverlayColormap(sampleOverlay(loc)); 
                            #ifndef USE_OVERLAY_MASK
                                color.rgb = ( (1.0 - overlay.a) * color.rgb) + ( overlay.a * overlay.rgb );            
                            #endif
                        #endif
                        color.a = 1.0;
                    }
                }
            }
            #pragma unroll_loop_end
        }
        
        void renderIntensityProjection (inout vec3 finalLoc, vec3 startLoc, vec3 rayStep, int nsteps, int maxSteps, inout vec4 color) {
        
            // define is used to share code between min intensity and max intensity projection.
            #ifdef USE_BLOCKED_RENDERING
                #ifdef USE_MAXIP
                    float maxVal = sampleDeferredTexture( gl_FragCoord.xy / u_viewportSize ).x;
                #else
                    float maxVal = 1.0 - sampleDeferredTexture( gl_FragCoord.xy / u_viewportSize ).x;
                #endif
            #else
                #ifdef USE_MAXIP
                    float maxVal = -1e12;
                #else
                    float maxVal = 1e12;
                #endif
            #endif
        
            vec4 locationData =  getMaxIntensityValue(startLoc, rayStep, nsteps, maxSteps, maxVal);
            finalLoc = locationData.xyz;
        
            // Resolve final color
            color = sampleTexture(finalLoc);
        
            #ifdef USE_BLOCKED_RENDERING
                // Write out final location in texture coordinates and the max value
                // This will be used as an input during the second pass
                color.a *= locationData.a;
                if (u_passNumber == 2) {
                    #ifdef USE_MAXIP
                        color = vec4(maxVal, 0.0, 0.0, 1.0);
                    #else
                        color = vec4(1.0 - maxVal, 0.0, 0.0, 1.0);
                    #endif
                }
            #endif
        }
        
        void blendGradientOpacity (inout float priorVal, const vec3 loc, const float notClipped, const vec3 viewRay, const float lightStrength) {
            #ifdef RGB_SHADER
                // Sample from the 3D RGB texture
                vec4 color = sampleTexture(loc);
                float val = rgb2lab(color.rgb).x;
            #else
                // Sample from the 3D texture
                float val = sampleIntensity(loc);
                vec4 color = applyColormap(val, loc);
            #endif
        
            color.a = applyGradientOpacity(color.a * notClipped, distance( val, priorVal ));
        
            #ifndef DEPTH_SHADER
                #ifdef USE_LIGHTING
                    #ifndef RGB_SHADER
                        if (color.a > 0.01) {
                            color = applyLighting(color, loc, viewRay, getNormal(loc), lightStrength);
                        }
                    #endif
                #endif
            #endif
        
            priorVal = val;
        
            blendColorToOutput(color);
        }
        
        void blendVolume (const float anisotropicStepSize, const vec3 loc, const float notClipped, const vec3 viewRay, const float lightStrength) {
        
            vec4 color = sampleTexture(loc);
            color.a = color.a * notClipped;
            color.a = adjustAlpha(color.a, anisotropicStepSize);
        
            #ifndef DEPTH_SHADER
                #ifdef USE_LIGHTING
                    #ifndef RGB_SHADER
                        if (color.a > 0.01) {
                            color = applyLighting(color, loc, viewRay, getNormal(loc), lightStrength);
                        }
                    #endif
                #endif
            #endif
        
            blendColorToOutput(color);
        }
        
        void blendNoLight (const float anisotropicStepSize, const vec3 loc, const float notClipped) {
            vec4 color = sampleTexture(loc);
            color.a = color.a * notClipped;
            color.a = adjustAlpha(color.a, anisotropicStepSize);
        
            blendColorToOutput(color);
        }
        
        void blendIsosurface (inout float insideSurface, const vec3 rayStep, const vec3 loc, const float notClipped, const vec3 viewRay, const float lightStrength, const float atBlockSeam) {
            float val = sampleIntensity(loc);
            vec4 color;
        
            #ifdef TRANSPARENT_ISOSURFACE
                if ( !clipped(loc) && abs(float(val > u_isovalue) - insideSurface) > TOLERANCE ) {
                    insideSurface = 1.0 - insideSurface;
                    #ifndef DEPTH_SHADER
                        #ifdef RGB_SHADER
                            color = sampleTexture(loc);
                        #else
                            color = applyColormap(val, loc);
                        #endif
                    #endif
                    color.a = u_isoalpha;
        
                    #ifndef DEPTH_SHADER
                        #ifdef USE_LIGHTING
                            color = applyLighting(color, loc, viewRay, getNormal(loc), lightStrength);
                        #endif
                    #endif
        
                    #ifdef USE_BLOCKED_RENDERING
                        color.a *= 1.0 - atBlockSeam;
                    #endif
        
                    blendColorToOutput(color);
                }
            #else
                if (float(!clipped(loc)) * float(val > u_isovalue) >= 0.95) {
                    #ifdef HARDWARE_WEBGL
                        // Check the midpoint between steps to give a better rendering but without introducing
                        // to much of a performance hit
                        vec3 iloc = loc - 0.5 * rayStep;
                        float ival = sampleIntensity(iloc);
                        if (float(!clipped(iloc)) * float(ival > u_isovalue) < 0.95) {
                            iloc = loc;
                            ival = val;
                        }
                        #ifdef RGB_SHADER
                            color = sampleTexture(iloc);
                        #else
                            color = applyColormap(ival, iloc);
                        #endif
                        color.a = 1.0;
                        #ifndef DEPTH_SHADER
                            #ifdef USE_LIGHTING
                                color = applyLighting(color, iloc, viewRay, getNormal(iloc), lightStrength);
                            #endif
                        #endif
                    #else
                        #ifdef RGB_SHADER
                            color = sampleTexture(loc);
                        #else
                            color = applyColormap(val, loc);
                        #endif
                        color.a = 1.0;
                        #ifndef DEPTH_SHADER
                            #ifdef USE_LIGHTING
                                color = applyLighting(color, loc, viewRay, getNormal(loc), lightStrength);
                            #endif
                        #endif
                    #endif
        
                    blendColorToOutput(color);
                }
            #endif
        }
        
        #ifdef USE_OVERLAY
            void blendVolumeOverlay (const float anisotropicStepSize, const vec3 loc, const float notClipped, const vec3 viewRay, const float lightStrength) {
                // Sample from overlay texture
                float overlayVal = sampleOverlay(loc);
                vec4 overlay =  applyOverlayColormap(overlayVal);
                overlay.a = overlay.a * notClipped;
                overlay.a = adjustAlpha(overlay.a, anisotropicStepSize);
                // Apply lighting
                #ifndef DEPTH_SHADER
                    #ifdef USE_LIGHTING
                        #ifndef USE_CINEMATIC_RENDERING
                            if (overlay.a > 0.01) {
                                overlay = applyLighting(overlay, loc, viewRay, getOverlayNormal(loc), lightStrength);
                            }
                        #endif
                    #endif
                #endif
                // Blend overlay color
                blendColorToOutput(overlay);
            }
        
            void blendLabelOverlay (inout float priorOverlay, const vec3 loc, const float notClipped, const vec3 viewRay, const float lightStrength, const float atBlockSeam) {
                // Sample from overlay texture
                float overlayVal = sampleOverlay(loc);
                vec4 overlay =  applyOverlayColormap(overlayVal);
                overlay.a = overlay.a * notClipped;
        
                if ( abs(overlayVal - priorOverlay) > TOLERANCE ) {
                    vec4 priorColor =  applyOverlayColormap(priorOverlay);
        
                    priorColor.a = notClipped * (1.0 - pow(1.0 - priorColor.a, 1.0));
                    overlay.a = notClipped * (1.0 - pow(1.0 - overlay.a, 1.0));
        
                    #ifndef DEPTH_SHADER
                        #ifdef USE_LIGHTING
                            #ifndef USE_CINEMATIC_RENDERING
                                vec3 overlayNormal = getOverlayNormal(loc);
                                overlay = applyLighting(overlay, loc, viewRay, overlayNormal, lightStrength);
                                priorColor = applyLighting(priorColor, loc, viewRay, overlayNormal, lightStrength);
                            #endif
                        #endif
                    #endif
        
                    #ifdef USE_BLOCKED_RENDERING
                        priorColor.a *= 1.0 - atBlockSeam;
                        overlay.a *= 1.0 - atBlockSeam;
                    #endif
        
                    // Blend overlay color
                    blendColorToOutput(priorColor);
                    blendColorToOutput(overlay);
                }
        
                priorOverlay = overlayVal;
            }
        
            void blendGradientOverlay (inout float priorOverlay, const vec3 loc, const float notClipped, const vec3 viewRay, const float lightStrength) {
                // Sample from overlay texture
                float overlayVal = sampleOverlay(loc);
                vec4 overlay =  applyOverlayColormap(overlayVal);
                overlay.a = overlay.a * notClipped;
                overlay.a = applyGradientOpacity(overlay.a, overlayVal - priorOverlay);
        
                #ifndef DEPTH_SHADER
                    #ifdef USE_LIGHTING
                        #ifndef USE_CINEMATIC_RENDERING
                            if (overlay.a > 0.01) {
                                overlay = applyLighting(overlay, loc, viewRay, getOverlayNormal(loc), lightStrength);
                            }
                        #endif
                    #endif
                #endif
        
                // Blend overlay color
                blendColorToOutput(overlay);
        
                priorOverlay = overlayVal;
            }
        #endif
        
        //---------------------------------------------------------------------
        // Unified Ray Trace
        //---------------------------------------------------------------------
        void unifiedRayTrace (inout vec3 finalLoc, const vec3 startLoc, const vec3 rayStep, const int nsteps, const vec3 viewRay, const int maxSteps, const vec3 addedLoc, const vec4 color) {
            
            // Initialize variables
            float anisotropicStepSize = u_relativeStepSize * dot( u_anisotropy * u_scaleFactor, abs(viewRay) ) / dot(vec3(1.0,1.0,1.0),abs(viewRay));
            vec3 loc = startLoc;
            bool depthSet = false;
            float notClipped = 1.0;
            float lightStrength = 1.0;
        
            #ifdef USE_BLOCKED_RENDERING
                float insideSurface = 0.0;
                float atBlockSeam = 1.0 - atEdgeOfBlockedVolume(startLoc);
            #else
                float insideSurface = 0.0;
                float atBlockSeam = 0.0;
            #endif
        
            #ifdef BLEND_ADDITIONAL_TECHNIQUES
                float blendCompleted = 1.0;
                float distToBlend = distance(addedLoc,startLoc);
            #endif
        
            #ifdef USE_GRADIENT_OPACITY
                float priorVal = 0.0;
                #ifdef USE_BLOCKED_RENDERING
                    priorVal = sampleIntensity(loc);
                #endif
            #endif
        
            #ifdef USE_OVERLAY
                // For label overlay, we want to start with a negative value, so even
                // hitting a zero will trigger adding the sample to the color. Use a 
                // start value of -1.0. For gradient opacity, just keep it at 0.0
                #ifdef USE_LABEL_OVERLAY
                    float priorOverlay = -1.0;
                #else
                    float priorOverlay = 0.0;
                #endif
            #endif
        
            // Ray trace loop
            for (int i = 0; i < maxSteps; i++) {
                if (i >= nsteps) {
                    return;
                }
        
                notClipped = float(!clipped(loc));
        
                #ifdef USE_VOLUME
                    #ifndef DEPTH_SHADER
                        #ifdef USE_LIGHTING
                            #ifdef USE_LIGHT_SCATTERING
                                lightStrength = lightTransmittance(loc, viewRay);
                            #endif
                        #endif
                    #endif
        
                    #ifdef BLEND_ADDITIONAL_TECHNIQUES
                        if (distToBlend < distance(loc,startLoc) && blendCompleted > 0.5) {
                            blendCompleted = 0.0;
                            blendColorToOutput(color);
                        }
                    #endif
        
                    #ifdef USE_LIGHT_SCATTERING
                        blendVolume(anisotropicStepSize, loc, notClipped, viewRay, lightStrength);
                    #endif
        
                    #ifdef USE_CINEMATIC_RENDERING
                        blendNoLight(anisotropicStepSize, loc, notClipped);
                    #endif
        
                    #ifdef USE_VOLUME_RENDERING
                        blendVolume(anisotropicStepSize, loc, notClipped, viewRay, lightStrength);
                    #endif
        
                    #ifdef USE_GRADIENT_OPACITY
                        blendGradientOpacity(priorVal, loc, notClipped, viewRay, lightStrength);
                    #endif
        
                    #ifdef USE_ISOSURFACE
                        blendIsosurface(insideSurface, rayStep, loc, notClipped, viewRay, lightStrength, atBlockSeam);
                    #endif
                #endif
        
                #ifdef USE_OVERLAY
                    #ifdef USE_VOLUME_OVERLAY
                        blendVolumeOverlay(anisotropicStepSize, loc, notClipped, viewRay, lightStrength);
                    #endif
        
                    #ifdef USE_LABEL_OVERLAY
                        blendLabelOverlay(priorOverlay, loc, notClipped, viewRay, lightStrength, atBlockSeam);
                    #endif
        
                    #ifdef USE_GRADIENT_OVERLAY
                        blendGradientOverlay(priorOverlay, loc, notClipped, viewRay, lightStrength);
                    #endif
                #endif
        
                #ifdef USE_CINEMATIC_RENDERING
                    if (!depthSet && gl_FragColor.a >= u_depthSensitivity) {
                        // Once we hit about 0.5 opacity, stop and use this location for cinematic
                        // lighting effects
                        depthSet = gl_FragColor.a > 0.5;
                        finalLoc = loc;
                    }
                #else
                    if (!depthSet && gl_FragColor.a >= u_depthSensitivity) {
                        depthSet = true;
                        finalLoc = loc;
                    }
                #endif
        
                if (gl_FragColor.a >= 0.95) {
                    // Stopping at 0.95 has a significant impact on performance. If we bump up the opacity to 1
                    // to match the likely final result, it will produce rendering artifacts in cases with large
                    // regions that would result in a near 0.95 opacity. For blocked volumes, 0.95 will produce
                    // stitching artifacts for most volumes near the block seams. The best middle ground is to bump
                    // transparency up for blocked volumes, but not all the way to 1.
                    #ifdef USE_BLOCKED_RENDERING
                        gl_FragColor.a = 0.99;
                    #endif
                    return;
                }
        
                // Advance location deeper into the volume
                loc += rayStep;
                
                #ifdef USE_BLOCKED_RENDERING
                    atBlockSeam = 0.0;
                #endif
            }
        }
        
        //---------------------------------------------------------------------
        // Main function
        //---------------------------------------------------------------------
        void main() {
        
            // Normalize clipping plane info
            vec3 farpos = v_farpos.xyz / v_farpos.w;
            vec3 nearpos = v_nearpos.xyz / v_nearpos.w;
        
            // Calculate unit vector pointing in the view direction through this fragment.
            #ifdef USE_PERSPECTIVE_CAMERA
                vec3 viewRay = normalize(v_position - v_localCameraPosition);
                float dist = dot(v_localCameraPosition - v_position, viewRay);
            #else
                // This technique does not account for the projection matrix
                // Calculate unit vector pointing in the view direction through this fragment.
                vec3 viewRay = normalize(nearpos.xyz - farpos.xyz);
                float dist = dot(nearpos - v_position, viewRay);
            #endif
        
            // The maximum distance through our rendering volume is the length of the
            // cube diagonal in voxels
            int maxSteps = int(ceil(sqrt(pow(u_size.x,2.0) + pow(u_size.y,2.0) + pow(u_size.z,2.0))) / u_relativeStepSize);
        
            // Compute the (negative) distance to the front surface or near clipping plane.
            // v_position is the back face of the cuboid, so the initial distance calculated in the dot
            // product below is the distance from near clip plane to the back of the cuboid
            dist = max(dist, min((0.5 - v_position.x) / viewRay.x, (u_size.x + 0.5 - v_position.x) / viewRay.x));
            dist = max(dist, min((0.5 - v_position.y) / viewRay.y, (u_size.y + 0.5 - v_position.y) / viewRay.y));
            dist = max(dist, min((0.5 - v_position.z) / viewRay.z, (u_size.z + 0.5 - v_position.z) / viewRay.z));
        
            // Now we have the starting position on the front surface
            vec3 front = v_position + viewRay * dist;
        
            // Decide how many steps to take.
            int nsteps = int(-dist / u_relativeStepSize + 0.5);
            if ( nsteps < 1 ) {
                discard;
            }
        
            // Get starting location and step vector in texture coordinates
            vec3 rayStep = ((v_position - front) / u_size) / float(nsteps);
            vec3 startLoc = localToTex(front);
            vec3 finalLoc = startLoc;
            nsteps += 1;
        
            vec4 color = vec4(0.0);
            vec3 addedLoc = vec3(0.0);
            gl_FragColor = vec4(0.0);
        
            #ifdef USE_SLICE_PLANES
                renderSlicePlanes(addedLoc, startLoc, rayStep, nsteps, maxSteps, color);
                finalLoc = addedLoc;
            #endif
        
            #ifdef USE_MAXIP
                renderIntensityProjection(addedLoc, startLoc, rayStep, nsteps, maxSteps, color);
                finalLoc = addedLoc;
            #endif
        
            #ifdef USE_MINIP
                renderIntensityProjection(addedLoc, startLoc, rayStep, nsteps, maxSteps, color);
                finalLoc = addedLoc;
            #endif
        
            // Trace the ray to render the object at this fragment
            #ifdef USE_RAY_TRACE
                unifiedRayTrace(finalLoc, startLoc, rayStep, nsteps, viewRay, maxSteps, addedLoc, color);
            #else
                #ifdef BLEND_ADDITIONAL_TECHNIQUES
                    blendColorToOutput(color);
                #endif
            #endif
        
            if (gl_FragColor.a < 0.05) {
                discard;
            }
        
            // Revert premultiplied alpha
            gl_FragColor.rgb = gl_FragColor.rgb / gl_FragColor.a;
        
            #ifdef DEPTH_SHADER
                setDepth(finalLoc);
            #else
                #ifdef USE_CINEMATIC_RENDERING
                    // Apply light scattering at the final location
                    if (u_passNumber == 4) {
                        gl_FragColor = applyLighting(gl_FragColor, finalLoc, viewRay, getNormal(finalLoc), lightTransmittance( finalLoc, viewRay ) );
                    }
                #endif
                if (u_passNumber == 1) {
                    testDepth(finalLoc);
                }
                gl_FragDepth = computeDepth(finalLoc);
            #endif
            
        }
        `}},D,V),D.exports=B},9202:(D,V,f)=>{var R,B;R=[f(3681),f(6427)],B=f.dj.d(R,function(d,N){return class extends N{constructor(l,n){super(l,n),this.size=new d.Vector3(n.Size[0],n.Size[1],n.Size[2]),this._scale=new d.Vector3(n.Scale[0],n.Scale[1],n.Scale[2]),this._offset=new d.Vector3(n.Offset[0],n.Offset[1],n.Offset[2]),this.totalSize=new d.Vector3(n.TotalSize[0],n.TotalSize[1],n.TotalSize[2]),this.localOffset=new d.Vector3(n.LocalOffset[0],n.LocalOffset[1],n.LocalOffset[2]),this.numElements=n.Size[0]*n.Size[1]*n.Size[2],this._texture=null,this._overlayTexture=null,this._alphaTexture=null,this._matrix=new d.Matrix4;const r=new d.Matrix4,h=new d.Matrix4;r.makeScale(this._scale.x,this._scale.y,this._scale.z),h.setPosition(this._offset.x+.5,this._offset.y+.5,this._offset.z+.5),this._matrix.makeTranslation(-.5,-.5,-.5),this._matrix.premultiply(r),this._matrix.premultiply(h);const u=Math.sqrt(Math.pow(this.size.x,2)+Math.pow(this.size.y,2)+Math.pow(this.size.z,2));this._smallVolumeScaleFactor=u<50?u/100:1,this._smallVolumeDefines=this._smallVolumeScaleFactor<1?"#define USE_SMALL_VOLUME":""}load(l,n,r,h,u){if(this._mesh===null){const g=new d.BoxGeometry;g.scale(this.size.x,this.size.y,this.size.z),g.translate(this.size.x/2+.5,this.size.y/2+.5,this.size.z/2+.5),this._mesh=new d.Mesh(g,n.material.clone()),this._depthMesh=new d.Mesh(g,r.material.clone()),this._mesh.matrixAutoUpdate=!1,this._depthMesh.matrixAutoUpdate=!1,this._clearTransferFunctionTextures(),this._mesh.matrix=this._matrix,this._depthMesh!==null&&(this._depthMesh.matrix=this._matrix,this._depthMesh.matrixWorldNeedsUpdate=!0),this._mesh.matrixWorldNeedsUpdate=!0,this.copyGlobalUniforms(h),this._mesh.renderOrder=n.renderOrder,n.add(this._mesh),r.add(this._depthMesh)}else this._mesh.material.dispose(),this._depthMesh.material.dispose(),this._mesh.material=n.material.clone(),this._depthMesh.material=r.material.clone(),this.copyGlobalUniforms(h);this.copyUniforms(n.material.uniforms,u),this.memory=l.byteLength/1e6,this._initTextures(l,u),this.loaded=!0,this.visible=!0}_initTextures(l,n){this._clearTextures();const r=new Uint8Array(l);let h=0;n.UseData&&(h=n.NumChannels*this.size.x*this.size.y*this.size.z,this._initTexture(r.slice(0,h),this.size,n)),n.UseAlpha&&(this._initAlphaTexture(r.slice(h,h+this.size.x*this.size.y*this.size.z),this.size,n),h+=this.size.x*this.size.y*this.size.z),n.UseOverlay&&this._initOverlayTexture(r.slice(h,r.length),this.size,n),this._setTextures()}copyMaterial(l,n,r,h){super.copyMaterial(l,n,r,h),this._mesh!==null&&(this.copyGlobalUniforms(r),this._setTextures())}copyUniforms(l,n){this._mesh!==null&&(this._mesh.material.uniforms.u_transferFunction.value=l.u_transferFunction.value,this._mesh.material.uniforms.u_clim.value=l.u_clim.value,this._mesh.material.uniforms.u_overlayclim.value=l.u_overlayclim.value,this._mesh.material.uniforms.u_overlayTransferFunction.value=l.u_overlayTransferFunction.value,this._mesh.material.uniforms.u_isovalue.value=l.u_isovalue.value,this._mesh.material.uniforms.u_gradientOpacityLimits.value=l.u_gradientOpacityLimits.value,this._mesh.material.uniforms.u_relativeStepSize.value=l.u_relativeStepSize.value*this._smallVolumeScaleFactor,this._mesh.material.uniforms.u_interactionStarted.value=l.u_interactionStarted.value,this._mesh.material.uniforms.u_depthSensitivity.value=l.u_depthSensitivity.value,this._mesh.material.uniforms.u_specularStrength.value=l.u_specularStrength.value,this._mesh.material.uniforms.u_shininess.value=l.u_shininess.value,this._mesh.material.uniforms.u_anisotropy.value=l.u_anisotropy.value,this._mesh.material.uniforms.u_rgbAnchorColor.value=l.u_rgbAnchorColor.value,this._mesh.material.uniforms.worldCoordClippingPlanes.value=l.worldCoordClippingPlanes.value,this._mesh.material.uniforms.u_size.value.copy(this.size),this._mesh.material.uniforms.u_totalSize.value.copy(this.totalSize),this._mesh.material.uniforms.u_offset.value.copy(this.localOffset),this._mesh.material.uniforms.u_scaleFactor.value.copy(this._scale),this._depthMesh.material.uniforms.u_transferFunction.value=l.u_transferFunction.value,this._depthMesh.material.uniforms.u_clim.value=l.u_clim.value,this._depthMesh.material.uniforms.u_overlayTransferFunction.value=l.u_overlayTransferFunction.value,this._depthMesh.material.uniforms.u_isovalue.value=l.u_isovalue.value,this._depthMesh.material.uniforms.u_gradientOpacityLimits.value=l.u_gradientOpacityLimits.value,this._depthMesh.material.uniforms.u_relativeStepSize.value=l.u_relativeStepSize.value*this._smallVolumeScaleFactor,this._depthMesh.material.uniforms.u_interactionStarted.value=l.u_interactionStarted.value,this._depthMesh.material.uniforms.u_depthSensitivity.value=l.u_depthSensitivity.value,this._depthMesh.material.uniforms.u_anisotropy.value=l.u_anisotropy.value,this._depthMesh.material.uniforms.u_rgbAnchorColor.value=l.u_rgbAnchorColor.value,this._depthMesh.material.uniforms.worldCoordClippingPlanes.value=l.worldCoordClippingPlanes.value,this._depthMesh.material.uniforms.u_size.value.copy(this.size),this._depthMesh.material.uniforms.u_totalSize.value.copy(this.totalSize),this._depthMesh.material.uniforms.u_offset.value.copy(this.localOffset),this._depthMesh.material.uniforms.u_scaleFactor.value.copy(this._scale),this._slicePlanes(l.slicePlanes.value),this._interpolation(n))}_slicePlanes(l){let n=null;const r=l.length/4,h=new d.Matrix4,u=new d.Plane;if(r>0)if(this._scale.x>1||this._scale.y>1||this._scale.z>1){n=new Float32Array(l.length),h.makeScale(1/this._scale.x,1/this._scale.y,1/this._scale.z);for(let g=0;g<r;g++)u.setComponents(l[g*4],l[g*4+1],l[g*4+2],l[g*4+3]).applyMatrix4(h),n[g*4]=u.normal.x,n[g*4+1]=u.normal.y,n[g*4+2]=u.normal.z,n[g*4+3]=u.constant}else n=Array.from(l);this._mesh.material.uniforms.slicePlanes.value=n,this._depthMesh.material.uniforms.slicePlanes.value=n}copyGlobalUniforms(l){super.copyGlobalUniforms(l),this._mesh.material.uniforms.u_lightColor=l.u_lightColor,this._mesh.material.uniforms.u_primaryLight=l.u_primaryLight,this._mesh.material.uniforms.u_cameraTarget=l.u_cameraTarget,this._mesh.material.uniforms.u_ambientStrength=l.u_ambientStrength,this._mesh.material.uniforms.u_primaryLightIntensity=l.u_primaryLightIntensity,this._mesh.material.uniforms.u_lightRaySteps=l.u_lightRaySteps,this._mesh.material.uniforms.u_secondaryLight=l.u_secondaryLight,this._mesh.material.uniforms.u_secondaryLightIntensity=l.u_secondaryLightIntensity,this._mesh.material.uniforms.u_deferredTexture=l.u_deferredTexture}_initTexture(l,n,r){switch(this._texture=new d.DataTexture3D(l,n.x,n.y,n.z),this._texture.type=d.UnsignedByteType,this._texture.generateMipmaps=!1,this._texture.unpackAlignment=1,this._texture.minFilter=r.MinFilter,this._texture.magFilter=r.MagFilter,this._texture.wrapS=d.ClampToEdgeWrapping,this._texture.wrapT=d.ClampToEdgeWrapping,this._texture.wrapR=d.ClampToEdgeWrapping,r.NumChannels){case 1:this._texture.format=d.RedFormat;break;case 2:this._texture.format=d.RGFormat;break;case 3:this._texture.format=d.RGBFormat;break;case 4:this._texture.format=d.RGBAFormat;break}this._texture.needsUpdate=!0}_initOverlayTexture(l,n,r){this._overlayTexture=new d.DataTexture3D(l,n.x,n.y,n.z),this._overlayTexture.format=d.RedFormat,this._overlayTexture.type=d.UnsignedByteType,this._overlayTexture.minFilter=r.OverlayFilter,this._overlayTexture.magFilter=d.NearestFilter,this._overlayTexture.generateMipmaps=!1,this._overlayTexture.unpackAlignment=1,this._overlayTexture.needsUpdate=!0}_initAlphaTexture(l,n,r){this._alphaTexture=new d.DataTexture3D(l,n.x,n.y,n.z),this._alphaTexture.format=d.AlphaFormat,this._alphaTexture.type=d.UnsignedByteType,this._alphaTexture.minFilter=r.MinFilter,this._alphaTexture.magFilter=d.NearestFilter,this._alphaTexture.generateMipmaps=!1,this._alphaTexture.unpackAlignment=1,this._alphaTexture.needsUpdate=!0}_setTextures(){this._mesh.material.uniforms.u_data.value=this._texture,this._mesh.material.uniforms.u_alphaData.value=this._alphaTexture,this._mesh.material.uniforms.u_overlayData.value=this._overlayTexture,this._depthMesh.material.uniforms.u_data.value=this._texture,this._depthMesh.material.uniforms.u_alphaData.value=this._alphaTexture,this._depthMesh.material.uniforms.u_overlayData.value=this._overlayTexture}_interpolation(l){this._texture!==null&&(this._texture.minFilter!==l.MinFilter||this._texture.magFilter!==l.MagFilter)&&(this._texture.minFilter=l.MinFilter,this._texture.magFilter=l.MagFilter,this._texture.needsUpdate=!0),this._overlayTexture!==null&&this._overlayTexture.minFilter!==l.OverlayFilter&&(this._overlayTexture.minFilter=l.OverlayFilter,this._overlayTexture.needsUpdate=!0),this._alphaTexture!==null&&this._alphaTexture.minFilter!==l.MinFilter&&(this._alphaTexture.minFilter=l.MinFilter,this._alphaTexture.needsUpdate=!0)}_clearTextures(){this._texture!==null&&(this._texture.dispose(),this._texture=null),this._overlayTexture!==null&&(this._overlayTexture.dispose(),this._overlayTexture=null),this._alphaTexture!==null&&(this._alphaTexture.dispose(),this._alphaTexture=null)}_isCulled(l){if(l.numSlicePlanes>0){let n=!1;const r=new d.Plane;for(let h=0;h<l.numSlicePlanes;h++)r.setComponents(l.slicePlanes[h*4],l.slicePlanes[h*4+1],l.slicePlanes[h*4+2],l.slicePlanes[h*4+3]),r.applyMatrix4(l.tform),n=n||r.intersectsSphere(this._sphere);return super._isCulled(l)||!n}else return super._isCulled(l)}unload(){super.unload(),this.dispose()}dispose(){this._clearTransferFunctionTextures(),this._clearTextures(),super.dispose()}}},D,V),D.exports=B},665:(D,V,f)=>{var R,B;R=[f(3681),f(7498),f(740),f(9101)],B=f.dj.d(R,function(d,N,_,l){return class extends N{refreshData(r,h){super.refreshData(r,h),this._memoryUsed=r.byteLength*2/1e6}crop(r,h){this._numCropBoxes=h===!0?1:0,this._cropDefines=r===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(this._globalData.cropType),this._updateFragmentShader()}colorInBox(r){this._colorBoxDefines=r===!0?"#define COLOR_BOX":"",this._updateFragmentShader()}pick(r,h,u,g,p,y){if(this._pickable&&this._mesh!==null&&!this._clipped(u)){this._mesh.geometry.boundingSphere===null&&this._mesh.geometry.computeBoundingSphere();const x=this._mesh.geometry.boundingSphere.clone(),w=new d.Vector3,M=new d.Vector3,T=new d.Vector3,A=new d.Vector3,C=new d.Vector3,z=new d.Matrix4().copy(this._mesh.matrixWorld).invert(),H=r.camera.position.clone().applyMatrix4(z),q=r.ray.clone().applyMatrix4(z);let P=Number.MAX_SAFE_INTEGER,Z,K=1,Y=!1,k=this._mesh.material.uniforms.lineWidth.value;if(this._worldCoordDefines!=="#define WORLD_UNITS"&&(k=Math.max(1.5*k,4),r.camera.type==="OrthographicCamera"?k*=g.radius/(Math.min(p.width,p.height)*r.camera.zoom):(Y=!0,k*=Math.tan(r.camera.fov*Math.PI/360)/(p.height*r.camera.zoom))),x.applyMatrix4(this._mesh.matrixWorld),x.radius+=k,r.ray.intersectsSphere(x)===!1)return;k=k/((this._mesh.scale.x+this._mesh.scale.y+this._mesh.scale.z)/3);const ae=k*k;let j=!1,F=-1;for(let J=0;J<this._mesh.geometry.attributes.instanceStart.count-1;J++){w.fromBufferAttribute(this._mesh.geometry.attributes.instanceStart,J),M.fromBufferAttribute(this._mesh.geometry.attributes.instanceStart,J+1);const te=q.distanceSqToSegment(w,M,T,A);Y&&(K=H.distanceToSquared(A)),te<ae*K&&(j=!0,w.distanceToSquared(A)<M.distanceToSquared(A)?(Z=w.applyMatrix4(this._mesh.matrixWorld).distanceTo(u),Z<P&&(P=Z,C.copy(w),F=J)):(Z=M.applyMatrix4(this._mesh.matrixWorld).distanceTo(u),Z<P&&(P=Z,C.copy(M),F=J)))}j&&h.push({point:C.toArray(),distance:Z,object:y,picked:!0,id:F})}}_constructProperties(r,h){super._constructProperties(r,h),this._shader=_,this._cropDefines=h.cropBoxExclude===!0?"#define CROP_EXCLUDE":"",this._cropTypeDefines=this._setCropTypeDefines(h.cropType),this._colorBoxDefines="",this._worldCoordDefines=r.WidthInWorldCoordinates===!0?"#define WORLD_UNITS":"",this._alphaCoverageDefines=r.AlphaToCoverage===!0?"#define USE_ALPHA_TO_COVERAGE":""}_constructMesh(r,h,u){const g=d.UniformsUtils.clone(this._shader.uniforms);this._setGlobalUniforms(g),this._mesh=new d.Mesh(r,this._initMaterial(!1,g,h,u)),this._depthMesh=new d.Mesh(r,this._initMaterial(!0,g,h,u))}_initMaterial(r,h,u,g){return new d.ShaderMaterial({transparent:!0,clipping:!0,uniforms:h,defines:this._shader.defines,vertexShader:this._getVertexShader(r),fragmentShader:this._getFragmentShader(r),premultipliedAlpha:r,clipIntersection:this._clipIntersection,blending:r===!0?d.NoBlending:d.NormalBlending,depthTest:!0,depthWrite:!0,side:d.FrontSide,vertexColors:!0})}_updateFragmentShader(){this._mesh.material.fragmentShader=this._getFragmentShader(!1),this._mesh.material.needsUpdate=!0,this._depthMesh!==null&&(this._depthMesh.material.fragmentShader=this._getFragmentShader(!0),this._depthMesh.material.needsUpdate=!0)}_updateVertexShader(){this._mesh.material.vertexShader=this._getVertexShader(!1),this._mesh.material.needsUpdate=!0,this._depthMesh!==null&&(this._depthMesh.material.vertexShader=this._getVertexShader(!0),this._depthMesh.material.needsUpdate=!0)}_getFragmentShader(r){let h=this._replaceConstants(this._shader.fragmentShader,this._numCropBoxes);return h=[this._worldCoordDefines,this._alphaCoverageDefines,this._cropDefines,this._colorBoxDefines,this._cropTypeDefines,h].join(`
`),r&&(h=["#define DEPTH_SHADER",h].join(`
`)),h}_getVertexShader(r){let h=[this._worldCoordDefines,this._alphaCoverageDefines,this._cropDefines,this._colorBoxDefines,this._shader.vertexShader].join(`
`);return r&&(h=["#define DEPTH_SHADER",h].join(`
`)),h}_replaceConstants(r,h){return r.replace(/NUM_CROP_BOXES/g,h)}_colorStyle(r,h,u){r===!1&&(this._mesh.material.uniforms.diffuse.value=h),this._colorByVertex!==r&&(this._setMaterialColor(r,h,u),this._colorByVertex=r)}_setMaterialColor(r,h,u){r?this._mesh.material.uniforms.diffuse.value=new d.Color(1,1,1):this._mesh.material.uniforms.diffuse.value=h,this._mesh.material.vertexColors=r,this._mesh.material.needsUpdate=!0}_setLineWidth(r){this._mesh.material.uniforms.lineWidth.value=r}_setAlphaToCoverage(r){const h=this._alphaCoverageDefines;this._alphaCoverageDefines=r===!0?"#define USE_ALPHA_TO_COVERAGE":"",h!==this._alphaCoverageDefines&&(this._needsUpdate=!0)}_setWorldCoords(r){const h=this._worldCoordDefines;this._worldCoordDefines=r===!0?"#define WORLD_UNITS":"",h!==this._worldCoordDefines&&(this._needsUpdate=!0)}_setProperties(r){this._needsUpdate=!1,super._setProperties(r),this._mesh.material.uniforms.opacity.value=r.Alpha,this._setLineWidth(r.LineWidth),this._setAlphaToCoverage(r.AlphaToCoverage),this._setWorldCoords(r.WidthInWorldCoordinates),this._needsUpdate&&(this._needsUpdate=!1,this._updateVertexShader(),this._updateFragmentShader())}_initGeometry(r,h,u,g){const p=new l;let y=0,x=0;h>0&&(y=g>0?3*(2*h-2*(g-1)):3*(2*h-2),x=(h-1)*3);const w=g,M=3*h+g,T=new Float32Array(y),A=new Float32Array(y);if(g>0)for(let C=0;C<g-1;C++){for(let z=3*r[C];z<3*(r[C+1]-1);z+=3)T[2*z-C*6]=r[z+w],T[2*z-C*6+1]=r[z+w+1],T[2*z-C*6+2]=r[z+w+2],T[2*z-C*6+3]=r[z+w+3],T[2*z-C*6+4]=r[z+w+4],T[2*z-C*6+5]=r[z+w+5];if(u)for(let z=3*r[C];z<3*(r[C+1]-1);z+=3)A[2*z-C*6]=r[z+M],A[2*z-C*6+1]=r[z+M+1],A[2*z-C*6+2]=r[z+M+2],A[2*z-C*6+3]=r[z+M+3],A[2*z-C*6+4]=r[z+M+4],A[2*z-C*6+5]=r[z+M+5]}else{for(let C=0;C<x;C+=3)T[2*C]=r[C+w],T[2*C+1]=r[C+w+1],T[2*C+2]=r[C+w+2],T[2*C+3]=r[C+w+3],T[2*C+4]=r[C+w+4],T[2*C+5]=r[C+w+5];if(u)for(let C=0;C<x;C+=3)A[2*C]=r[C+M],A[2*C+1]=r[C+M+1],A[2*C+2]=r[C+M+2],A[2*C+3]=r[C+M+3],A[2*C+4]=r[C+M+4],A[2*C+5]=r[C+M+5]}return u?(p.setPositions(T),p.setColors(A)):p.setPositions(T),p.computeBoundingBox(),p.computeBoundingSphere(),p}}},D,V),D.exports=B},740:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return{defines:{TOLERANCE:1e-6},uniforms:{opacity:{value:1},lineWidth:{value:1},diffuse:{value:new d.Vector3(1,1,1)},u_passNumber:{value:0},u_depthTexture:{value:null},u_previousTexture:{value:null},u_viewportSize:{value:new d.Vector2(1,1)},u_cropMin:{value:new d.Vector3(0,0,0)},u_cropMax:{value:new d.Vector3(1,1,1)}},vertexShader:`#include <common>
        #include <color_pars_vertex>
        #include <fog_pars_vertex>
        #include <logdepthbuf_pars_vertex>
        #include <clipping_planes_pars_vertex>
        
        uniform float lineWidth;
        uniform vec2 u_viewportSize;
        
        attribute vec3 instanceStart;
        attribute vec3 instanceEnd;
        
        attribute vec3 instanceColorStart;
        attribute vec3 instanceColorEnd;
        
        #ifdef WORLD_UNITS
            varying vec4 worldPos;
            varying vec3 worldStart;
            varying vec3 worldEnd;
        #else
            varying vec2 vUv;
        #endif
        
        varying vec3 vWorldCoords; 
        
        void trimSegment( const in vec4 start, inout vec4 end ) {
            // Trim end segment so it terminates between the camera plane and the near plane
            // conservative estimate of the near plane
            float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
            float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
            float nearEstimate = - 0.5 * b / a;
            float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );
        
            end.xyz = mix( start.xyz, end.xyz, alpha );
        }
        
        void main() {
        
            #ifdef USE_COLOR
                vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;
            #endif
        
            float aspect = u_viewportSize.x / u_viewportSize.y;
        
            // Camera space
            vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
            vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );
        
            // World space
            vec4 worldStartCoords = modelMatrix * vec4( instanceStart, 1.0 );
            vec4 worldEndCoords = modelMatrix * vec4( instanceEnd, 1.0 );
        
            #ifdef WORLD_UNITS
                worldStart = start.xyz;
                worldEnd = end.xyz;
            #else
                vUv = uv;
            #endif
        
            // Special case for perspective projection and segments that terminate either in, or behind, the camera plane
            bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column
        
            if ( perspective ) {
                if ( start.z < 0.0 && end.z >= 0.0 ) {
                    trimSegment( start, end );
                } else if ( end.z < 0.0 && start.z >= 0.0 ) {
                    trimSegment( end, start );
                }
            }
        
            // Clip space
            vec4 clipStart = projectionMatrix * start;
            vec4 clipEnd = projectionMatrix * end;
        
            // ndc space
            vec3 ndcStart = clipStart.xyz / clipStart.w;
            vec3 ndcEnd = clipEnd.xyz / clipEnd.w;
        
            // Direction
            vec2 dir = ndcEnd.xy - ndcStart.xy;
        
            // Account for clip-space aspect ratio
            dir.x *= aspect;
            dir = normalize( dir );
        
            #ifdef WORLD_UNITS
        
                // Get the offset direction as perpendicular to the view vector
                vec3 worldDir = normalize( end.xyz - start.xyz );
                vec3 offset;
                if ( position.y < 0.5 ) {
                    offset = normalize( cross( start.xyz, worldDir ) );
                } else {
                    offset = normalize( cross( end.xyz, worldDir ) );
                }
        
                // Sign flip
                if ( position.x < 0.0 ) {
                    offset *= - 1.0;
                }
        
                float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );
        
                // Extend the line bounds to encompass  endcaps
                start.xyz += - worldDir * lineWidth * 0.5;
                end.xyz += worldDir * lineWidth * 0.5;
        
                // Shift the position of the quad so it hugs the forward edge of the line
                offset.xy -= dir * forwardOffset;
                offset.z += 0.5;
        
                // End caps
                if ( position.y > 1.0 || position.y < 0.0 ) {
                    offset.xy += dir * 2.0 * forwardOffset;
                }
        
                // adjust for line width
                offset *= lineWidth * 0.5;
        
                // set the world position
                worldPos = ( position.y < 0.5 ) ? start : end;
                worldPos.xyz += offset;
        
                // Project the worldpos
                vec4 clip = projectionMatrix * worldPos;
        
                // Shift the depth of the projected points so the line
                // segments overlap neatly
                vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
                clip.z = clipPose.z * clip.w;
        
            #else
        
                vec2 offset = vec2( dir.y, - dir.x );
                // Undo aspect ratio adjustment
                dir.x /= aspect;
                offset.x /= aspect;
        
                // Sign flip
                if ( position.x < 0.0 ) {
                    offset *= - 1.0;
                }
        
                // End caps
                if ( position.y < 0.0 ) {
                    offset += - dir;
                } else if ( position.y > 1.0 ) {
                    offset += dir;
                }
        
                // Adjust for line width
                offset *= lineWidth;
        
                // Adjust for clip-space to screen-space conversion
                offset /= u_viewportSize.y;
        
                // Select end
                vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;
        
                // Back to clip space
                offset *= clip.w;
                clip.xy += offset;
        
            #endif
        
            gl_Position = clip;
        
            // Approximations for model view and world coordinates
            vec4 mvPosition = ( position.y < 0.5 ) ? start : end; 
            vWorldCoords = ( position.y < 0.5 ) ? worldStartCoords.xyz : worldEndCoords.xyz; 
        
            #include <logdepthbuf_vertex>
            #include <clipping_planes_vertex>
            #include <fog_vertex>
        
        }`,fragmentShader:`uniform vec3 diffuse;
        uniform float opacity;
        uniform float lineWidth;
        
        uniform sampler2D u_depthTexture;
        uniform int u_passNumber;
        uniform vec2 u_viewportSize;
        uniform sampler2D u_previousTexture;
        
        #ifdef WORLD_UNITS
            // Set line width in world units
            varying vec4 worldPos;
            varying vec3 worldStart;
            varying vec3 worldEnd;
        #else
            varying vec2 vUv;
        #endif
        
        varying vec3 vWorldCoords; 
        
        #if NUM_CROP_BOXES > 0
            uniform vec3 u_cropMin;
            uniform vec3 u_cropMax;
            uniform vec3 u_cropCenter;
            uniform float u_cropRadius;
            uniform float u_cropHeight;
        #endif
        
        #ifdef COLOR_BOX
            uniform mat4 u_colorBoxMatrix;
            uniform vec3 u_colorBoxColor;
        #endif
        
        #include <common>
        #include <color_pars_fragment>
        #include <fog_pars_fragment>
        #include <logdepthbuf_pars_fragment>
        #include <clipping_planes_pars_fragment>
        
        vec4 packDepthToRGBA( float depth ) {
            vec3 packFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0 );
            float shiftRight8 = 1.0 / 256.0; // Handle overflow
            float packUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
            
            vec4 rgba = vec4( fract(depth * packFactors), depth);
            rgba.yzw -= rgba.xyz * shiftRight8;
            return rgba * packUpscale;
        }
        
        void setDepth () {
            if (u_passNumber == 2 ) {
                float prevDepth = texture(u_previousTexture, gl_FragCoord.xy / u_viewportSize).x;
                if (gl_FragCoord.z < prevDepth + TOLERANCE) {
                    discard;
                }
            }
            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
            gl_FragDepth = gl_FragCoord.z;
        }
        
        void testDepth () {
            if (u_passNumber == 1 ) {
                float priorDepth = texture( u_depthTexture, gl_FragCoord.xy / u_viewportSize ).x;
                float accumulatedDepth = texture( u_previousTexture, gl_FragCoord.xy / u_viewportSize ).x;
        
                // Should be between current depth and previous depth to be included
                if (gl_FragCoord.z > priorDepth + TOLERANCE  || gl_FragCoord.z < accumulatedDepth + TOLERANCE ) {
                    discard;
                }
            }
        }
        
        #ifdef COLOR_BOX
        
            vec4 colorInBox (vec4 color) {
                vec4 pos = u_colorBoxMatrix * vec4(vWorldCoords, 1.0);
                vec3 s = step(vec3(-0.5), pos.xyz) - step(vec3(0.5), pos.xyz);
                if ((s.x * s.y * s.z) > 0.0) {
                    color.rgb = u_colorBoxColor;
                }
                return color;
            }
        
        #endif
        
        bool outsideCropBox () {
            #if NUM_CROP_BOXES > 0
                
                #if CROP_TYPE == 0
                    vec3 s = step(u_cropMin, vWorldCoords) - step(u_cropMax, vWorldCoords);
                    #ifdef CROP_EXCLUDE
                        return bool(s.x * s.y * s.z);
                    #else
                        return bool(1.0 - (s.x * s.y * s.z));
                    #endif
                #endif
        
                // For a point p on the object and a point c as the center of the sphere,
                // Check if abs(p.xyz - r.xyz) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the sphere. Otherwise it lies within the sphere.
        
                #if CROP_TYPE == 1
                    float dist = distance(vWorldCoords, u_cropCenter);
                    #ifdef CROP_EXCLUDE
                        return (dist <= u_cropRadius);
                    #else
                        return (dist > u_cropRadius);
                    #endif    
                #endif
        
                // For a point p on the object and a point c as the center of the cylinder,
                // Check if abs(p.xy - r.xy) > radius (distance of p from center is greater than radius)
                // If so, then the point lies outside the curved surface of the cylinder along the x-y plane. 
                // Otherwise it lies within the curved surface of the cylinder.
                // Check if abs(p.z - c.z) > height / 2.0f (distance of p from the center along the z-axis is greater than height of the cylinder/2)
                // If so, then the point lies outside the end caps of the cylinder.
                // If either of these conditions are met, then the point lies outside the cylinder.
        
                #if CROP_TYPE == 2
                    float distanceXYPlane = distance(vec2(vWorldCoords.x, vWorldCoords.y), vec2(u_cropCenter.x, u_cropCenter.y));
                    float distanceZAxis = abs(vWorldCoords.z - u_cropCenter.z);
                    #ifdef CROP_EXCLUDE
                        return (distanceXYPlane <= u_cropRadius && distanceZAxis <= (u_cropHeight / 2.0f));
                    #else
                        return (distanceXYPlane > u_cropRadius || distanceZAxis > (u_cropHeight / 2.0f));
                    #endif
                #endif
            #else
                return false;
            #endif
        }
        
        vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {
            float mua;
            float mub;
        
            vec3 p13 = p1 - p3;
            vec3 p43 = p4 - p3;
        
            vec3 p21 = p2 - p1;
        
            float d1343 = dot( p13, p43 );
            float d4321 = dot( p43, p21 );
            float d1321 = dot( p13, p21 );
            float d4343 = dot( p43, p43 );
            float d2121 = dot( p21, p21 );
        
            float denom = d2121 * d4343 - d4321 * d4321;
        
            float numer = d1343 * d4321 - d1321 * d4343;
        
            mua = numer / denom;
            mua = clamp( mua, 0.0, 1.0 );
            mub = ( d1343 + d4321 * ( mua ) ) / d4343;
            mub = clamp( mub, 0.0, 1.0 );
        
            return vec2( mua, mub );
        }
        
        void main() {
        
            #include <clipping_planes_fragment>
        
            #if NUM_CROP_BOXES > 0
                if (outsideCropBox()) {
                    discard;
                }
            #endif
        
            #ifdef DEPTH_SHADER
                setDepth();
            #else
                testDepth();
            #endif
        
            float alpha = opacity;
        
            #ifdef WORLD_UNITS
                // Find the closest points on the view ray and the line segment
                vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
                vec3 lineDir = worldEnd - worldStart;
                vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );
        
                vec3 p1 = worldStart + lineDir * params.x;
                vec3 p2 = rayEnd * params.y;
                vec3 delta = p1 - p2;
                float len = length( delta );
                float norm = len / lineWidth;
        
                #ifdef USE_ALPHA_TO_COVERAGE
                    float dnorm = fwidth( norm );
                    alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );
                #else
                    if ( norm > 0.5 ) {
                        discard;
                    }
                #endif
            #else
                #ifdef USE_ALPHA_TO_COVERAGE
                    // Artifacts appear on some hardware if a derivative is taken within a conditional
                    float a = vUv.x;
                    float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
                    float len2 = a * a + b * b;
                    float dlen = fwidth( len2 );
                    float deriv = float(abs( vUv.y ) > 1.0);
                    alpha = alpha * (1.0 - deriv) + ( (1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 )) * deriv);
                #else
                    if ( abs( vUv.y ) > 1.0 ) {
                        float a = vUv.x;
                        float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
                        float len2 = a * a + b * b;
                        if ( len2 > 1.0 ) {
                            discard;
                        }
                    }
                #endif
            #endif
        
            vec4 diffuseColor = vec4( diffuse, alpha );
        
            #include <logdepthbuf_fragment>
            #include <color_fragment>
        
            #ifdef COLOR_BOX
                gl_FragColor = colorInBox( vec4( diffuseColor.rgb, alpha ) );
            #else
                gl_FragColor = vec4( diffuseColor.rgb, alpha );
            #endif
        
            if (alpha < 0.05) {
                discard;
            }
        
            #include <tonemapping_fragment>
            gl_FragColor = linearToOutputTexel( gl_FragColor );
            #include <fog_fragment>
            #include <premultiplied_alpha_fragment>
        
        }`}},D,V),D.exports=B},6127:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.EventDispatcher{constructor(_,l){super(),this._scene=_,this.objects=[],this._numObjects=0,this._annotationUniforms=l}clear(){this._numObjects=0}add(_,l,n,r,h,u,g){if(this._numObjects+=1,this._numObjects>this.objects.length){const p=this._newObject(h,this._annotationUniforms,u,g);this._scene.add(p),this.objects.push(p)}return this.objects[this._numObjects-1].setLabel(n),this.objects[this._numObjects-1].setPosition(_),this.objects[this._numObjects-1].setColor(r),this.objects[this._numObjects-1].ID=h,this.objects[this._numObjects-1].setVisible(l),this._getObject(this._numObjects-1)}new(_,l,n){this._numObjects+=1;let r;return this._numObjects>this.objects.length?(r=this._newObject(n,this._annotationUniforms,0),this._scene.add(r),this.objects.push(r)):(r=this.objects[this._numObjects-1],r.clear(),r.ID=n),r.setColor(l),r.setLabel(_),r.visible=!0,r}setDepthTest(_){for(let l=0;l<this.objects.length;l++)this.objects[l].material.depthTest=_}setPickable(_){for(let l=0;l<this.objects.length;l++)this.objects[l].pickable=_}setTheme(_){for(let l=0;l<this.objects.length;l++)this.objects[l].setTheme(_)}showLabels(){for(let _=0;_<this._numObjects;_++)this.objects[_].showLabel()}hideLabels(){for(let _=0;_<this._numObjects;_++)this.objects[_].hideLabel()}showLabelsIfSelected(){for(let _=0;_<this._numObjects;_++)this.objects[_].selected?this.objects[_].showLabel():this.objects[_].hideLabel()}refreshLabels(){for(let _=0;_<this._numObjects;_++)this.objects[_].visible&&this.objects[_].refreshLabel()}dispose(){this.clear();for(let _=0;_<this.objects.length;_++)this.objects[_].dispose()}_newObject(_,l,n){return[]}_getObject(_){return this.objects[_]}}},D,V),D.exports=B},8276:(D,V,f)=>{var R,B;R=[f(3681),f(3497)],B=f.dj.d(R,function(d,N){return class extends N{constructor(l=0,n){super(l,n,3),this._numPoints=0,this.type="Angle",this._labelType="angle",this._drawing=!1,this._numCurves=90;const r=new Array(9+this._numCurves*3);this.geometry.setAttribute("position",new d.Float32BufferAttribute(r,3)),this.geometry.setDrawRange(0,0);const h=new d.BufferGeometry;h.setAttribute("position",new d.Float32BufferAttribute(new Array(9).fill(0),3)),this._points.geometry=h}addPoint(l,n,r){this._clampPointToSceneLimits(l,n),this._numPoints+=1;const h=this._points.geometry.attributes.position.array;if(this._numPoints===1)for(let u=0;u<3;u++)h[u*3]=l.x,h[u*3+1]=l.y,h[u*3+2]=l.z;else if(this._numPoints===2){const u=new d.Vector3().fromArray(h,0);h[0]=h[3],h[1]=h[4],h[2]=h[5],u.toArray(h,3),r&&this._snapToAngle(l,u),l.toArray(h,0),u.toArray(h,3),u.toArray(h,6)}else{if(r){const u=new d.Vector3;u.fromArray(h,3),this._snapToAngle(l,u)}h[6]=l.x,h[7]=l.y,h[8]=l.z}this._points.geometry.attributes.position.needsUpdate=!0,this._updateCurve(),this._computeBoundingSphere(),this.refreshLabel()}removePoint(){if(this._numPoints>1){this._numPoints-=1;const l=this._points.geometry.attributes.position.array;l[this._numPoints*3-2]=l[this._numPoints*3-5],l[this._numPoints*3-1]=l[this._numPoints*3-4],l[this._numPoints*3]=l[this._numPoints*3-3],this._points.geometry.attributes.position.needsUpdate=!0,this._updateCurve(),this._computeBoundingSphere(),this.refreshLabel()}}follow(l,n,r,h){this._clampPointToSceneLimits(l,r);const u=this._points.geometry.attributes.position.array;if(this._numPoints===1){if(h){const g=new d.Vector3;g.fromArray(u,3),this._snapToAngle(l,g)}u[3]=l.x,u[4]=l.y,u[5]=l.z}else if(this._numPoints===2){if(h){const g=new d.Vector3;g.fromArray(u,3),this._snapToAngle(l,g)}u[6]=l.x,u[7]=l.y,u[8]=l.z}this._points.geometry.attributes.position.needsUpdate=!0,this._updateCurve(),this._computeBoundingSphere(),this.refreshLabel()}unfollow(){const l=this._points.geometry.attributes.position.array;this._numPoints===1?(l[3]=l[0],l[4]=l[1],l[5]=l[2]):this._numPoints===2&&(l[6]=l[3],l[7]=l[4],l[8]=l[5]),this._points.geometry.attributes.position.needsUpdate=!0,this._updateCurve(),this._label!==null&&this._label.setVisibility(!1)}close(){this._drawing=!1}clear(){this._numPoints=0;const l=new Array(0).fill(0);this.geometry.setAttribute("position",new d.Float32BufferAttribute(l,3)),this._points.geometry.setAttribute("position",new d.Float32BufferAttribute(l,3)),this._points.visible=!1,this.visible=!1}getLastMarker(){return this._numPoints===2?this._points.ID=0:this._numPoints===3?this._points.ID=2:this._points.ID=-1,this}setPosition(l){const n=this._points.geometry.attributes.position.array;for(let r=0;r<l.length;r++)n[r]=l[r];if(this._numPoints=l.length/3,this._drawing&&l.length<9)if(l.length===3){this._numPoints=1;for(let r=0;r<l.length;r++)n[r+3]=l[r],n[r+6]=l[r]}else this._numPoints=2,n[6]=l[3],n[7]=l[4],n[8]=l[5];this._points.geometry.attributes.position.needsUpdate=!0,this._updateCurve(),this._computeBoundingSphere(),this.refreshLabel()}getPosition(){const l=new Array(9);if(this._numPoints>0){const n=this._points.geometry.attributes.position.array;for(let r=0;r<9;r++)l[r]=n[r]}return l}startDrawing(){this._drawing=!0}applyTransformation(l,n,r,h,u,g,p){super.applyTransformation(l,n,r,h,u,g,p),this._updateCurve(),this._computeBoundingSphere(),this.refreshLabel()}_updateCurve(){const l=this._points.geometry.attributes.position.array,n=this.geometry.attributes.position.array;for(let r=0;r<l.length;r++)n[r]=l[r];if(this._numPoints>=2){const r=new d.Vector3().fromArray(n,0),h=new d.Vector3().fromArray(n,3),u=new d.Vector3().fromArray(n,6),g=new d.Vector3,p=new d.Vector3,y=new d.Quaternion,x=new d.Vector3().subVectors(r,h).normalize(),w=new d.Vector3().subVectors(u,h).normalize(),M=x.angleTo(w),T=Math.min(h.distanceTo(r),h.distanceTo(u))/3;g.crossVectors(w,x).normalize();let A=0;for(let C=0;C<this._numCurves;C++)A=C/(this._numCurves-1)*M,y.setFromAxisAngle(g,A),p.copy(w).applyQuaternion(y).multiplyScalar(T).add(h),p.toArray(n,C*3+9);this.geometry.setDrawRange(0,3+this._numCurves)}else{for(let r=0;r<this._numCurves;r++)n[r*3+9]=l[0],n[r*3+10]=l[1],n[r*3+11]=l[2];this.geometry.setDrawRange(0,2)}this.geometry.attributes.position.needsUpdate=!0}refreshLabel(){if(this._showLabel!==!1&&this._numPoints>=2&&this._label!==null){const l=this.geometry.attributes.position.array,n=Math.floor(3+this._numCurves/2);this._label.position.set(l[n*3],l[n*3+1],l[n*3+2]);const r=new d.Vector3,h=new d.Vector3;h.set(l[6]-l[3],l[7]-l[4],l[8]-l[5]),r.set(l[0]-l[3],l[1]-l[4],l[2]-l[5]),this._label.measurement===!0&&this._label.setLabel(r.angleTo(h)*180/Math.PI,this._globalUniforms.units.value),this._globalUniforms.checkExtent.value&&this._label.checkExtent()}}_computeBoundingSphere(){this.geometry.computeBoundingSphere(),this._points.geometry.computeBoundingSphere()}}},D,V),D.exports=B},9190:(D,V,f)=>{var R,B;R=[f(6127),f(8276)],B=f.dj.d(R,function(d,N){return class extends d{_newObject(l,n,r){return new N(l,n)}}},D,V),D.exports=B},4576:(D,V,f)=>{var R,B;R=[f(3681),f(5039),f(4207),f(1571),f(9190),f(6751),f(2218),f(4563),f(4036),f(614),f(5178),f(9127),f(2649),f(5310),f(193),f(9271),f(8311),f(2297),f(9721),f(7234),f(4775),f(6658),f(7045),f(9015),f(1584)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u,g,p,y,x,w,M,T,A,C,z,H,q,P,Z,K,Y,k){return class extends d.EventDispatcher{constructor(j,F,J,te,_e,ne){super();const le=document.createElement("div");le.className="iptLabelContainer",F.appendChild(le),this._annotationUniforms={pointSize:{value:Math.round(8*window.devicePixelRatio)},pointSizeHighlighted:{value:Math.round(10*window.devicePixelRatio)},edgeColor:{value:new d.Color(1,1,1)},selectedColor:{value:new d.Color(1,.839,.039)},units:{value:""},depthTest:{value:ne.DepthTest},pickable:{value:ne.Pickable},labelVisible:{value:ne.LabelVisible},clampToSceneLimits:{value:!1},container:{value:le},is3D:{value:!0},isDarkTheme:{value:!0},checkExtent:{value:!0},eye:{value:new d.Vector3(0,0,1)},up:{value:new d.Vector3(0,0,1)},labelPool:{value:null},sharedMarker:{value:null},sharedPlus:{value:null}},this.updateRequested=!1,this.enabled=!0,this._hitObject=null,this._hitFace=null,this.depthRequired=!1,this._enableAnnotations=!0,this._interactionStarted=!1,this._color=[1,1,1],this._defaultLabel=null,this.continueAnnotating=!1,this.clampToSceneLimits=!1,this.fillWithColor=!1,this._deletable=!0,this._selectable=!1,this._defaultFaceAlpha=0,this._defaultCaliperWidth=50,this._cuboidDefaultSize=new d.Vector3(.2,.2,.2),this._cuboidLastSize=new d.Vector3,this._cuboidRememberSize=!0,this._cuboidRotatable="all",this._paintBrushSize=15,this._paintBrushAlpha=.3141,this._paintBrushPoints=[],this._paintBrushEnabled=!1,this._raycaster=new d.Raycaster,this._scene=j,this._labels=new A(this._annotationUniforms),this._annotationUniforms.labelPool.value=this._labels,this._points=new _(j,this._annotationUniforms),this._lines=new l(j,this._annotationUniforms),this._angles=new n(j,this._annotationUniforms),this._polygons=new r(j,this._annotationUniforms),this._elevation=new h(j,this._annotationUniforms),this._cuboids=new u(j,this._annotationUniforms),this._rectangles=new g(j,this._annotationUniforms),this._freehands=new p(j,this._annotationUniforms),this._caliper=new x(j,this._annotationUniforms),this._tSquare=new M(j,this._annotationUniforms),this._circles=new w(j,this._annotationUniforms),this._thumbnails=new T(j,this._annotationUniforms),this._texts=new y(j,this._annotationUniforms),this._planes=new N(j,_e),this._annotations=[],this._labelDictionary=[],this.clickCounter=0,this._drawingStarted=!1,this.drawing=!1,this._objectBeingDrawn=null,this._objectBeingEdited=null,this._blurHandler=this.stopEditing.bind(this),this._sharedLine=new C(-1,this._annotationUniforms,0),j.add(this._sharedLine),this._sharedLine.visible=!1,this._sharedMarker=new H(-1,this._annotationUniforms),j.add(this._sharedMarker),this._sharedMarker.visible=!1,this._sharedMarker.pickable=!1,this._annotationUniforms.sharedMarker.value=this._sharedMarker,this._sharedCuboid=new z(-1,this._annotationUniforms),j.add(this._sharedCuboid),this._sharedCuboid.visible=!1,this._sharedCuboid.pickable=!1,this._sharedRectangle=new q(-1,this._annotationUniforms),j.add(this._sharedRectangle),this._sharedRectangle.visible=!1,this._sharedRectangle.pickable=!1,this._sharedRectangle.showVertices=!1,this._crosshair=new P(te),j.add(this._crosshair),this._plus=new k(this._annotationUniforms),j.add(this._plus),this._annotationUniforms.sharedPlus.value=this._plus,this._objectInfo=new Y(-1,this._annotationUniforms,J),this._scissorsPoints=[],this._scissorsForCrop=!0,this._crop=new z(-1,this._annotationUniforms),this._crop.type="CropBox",this._crop.visible=!1,this._cropDeletable=!0,this._cropApplied=!1,j.add(this._crop),this._cropSphere=new Z(-1,this._annotationUniforms),this._cropSphere.visible=!1,j.add(this._cropSphere),this._cropCylinder=new K(-1,this._annotationUniforms),this._cropCylinder.visible=!1,j.add(this._cropCylinder),this._cropType="box",this.updateInteractions(_e,!1)}update(j){const F=new Float32Array(j);this.stopEditing();const J=F.length,te=F[0]>0,_e=F[1];let ne=2,le,be,je=1,ze=1,Re=6;if(_e>0){this._texts.clear();for(let nt=0;nt<_e;nt++)le=this._texts.add(F.slice(ne+9,ne+12-F[ne+8]),!!F[ne+1],this._getLabel(F[ne+2]),F.slice(ne+3,ne+6),je,1,F.slice(ne+6,ne+8)),ne+=12-F[ne+8]}else _e===-1&&this._texts.clear();if(te){for(this._clearAnnotations();ne<J;){switch(F[ne]){case 0:le=this._points.add(F.slice(ne+6,ne+9),F[ne+1],this._getLabel(F[ne+2]),F.slice(ne+3,ne+6),je,1),ne+=9;break;case 1:le=this._lines.add(F.slice(ne+6,ne+12),F[ne+1],this._getLabel(F[ne+2]),F.slice(ne+3,ne+6),je,2),ne+=12;break;case 2:le=this._angles.add(F.slice(ne+6,ne+15),F[ne+1],this._getLabel(F[ne+2]),F.slice(ne+3,ne+6),je,3),ne+=15;break;case 3:le=this._elevation.add(F.slice(ne+6,ne+12),F[ne+1],this._getLabel(F[ne+2]),F.slice(ne+3,ne+6),je,2),ne+=12;break;case 4:le=this._polygons.add(F.slice(ne+8,ne+8+F[ne+6]),F[ne+1],this._getLabel(F[ne+2]),F.slice(ne+3,ne+6),je,F[ne+6]/3,F[ne+7]===1),ne+=8+F[ne+6];break;case 5:le=this._cuboids.add(F.slice(ne+6,ne+15),F[ne+1],this._getLabel(F[ne+2]),F.slice(ne+3,ne+6),je),ne+=15;break;case 6:le=this._rectangles.add(F.slice(ne+6,ne+11),F[ne+1],this._getLabel(F[ne+2]),F.slice(ne+3,ne+6),je,1,F.slice(ne+11,ne+12)),ne+=12;break;case 7:le=this._freehands.add(F.slice(ne+7,ne+7+F[ne+6]),F[ne+1],this._getLabel(F[ne+2]),F.slice(ne+3,ne+6),je,F[ne+6]/3),ne+=7+F[ne+6];break;case 9:le=this._caliper.add(F.slice(ne+6,ne+12),F[ne+1],"",F.slice(ne+3,ne+6),je,2,F.slice(ne+12,ne+17+F[ne+15]+F[ne+16])),ne+=17+F[ne+15]+F[ne+16];break;case 10:le=this._circles.add(F.slice(ne+6,ne+10),F[ne+1],this._getLabel(F[ne+2]),F.slice(ne+3,ne+6),je,1,F.slice(ne+10,ne+11)),ne+=11;break;case 11:le=this._tSquare.add(F.slice(ne+7,ne+7+F[ne+6]),F[ne+1],F[ne+2],F.slice(ne+3,ne+6),je,F[ne+6]/3),ne+=7+F[ne+6];break;case 12:le=this._thumbnails.add(F.slice(ne+6,ne+9),F[ne+1],"",F.slice(ne+3,ne+6),je,1,F.slice(ne+9,ne+10+F[ne+9]*F[ne+10]*3)),ne+=11+F[ne+9]*F[ne+10]*3;break}this._annotations.push(le),je++}this._annotationUniforms.checkExtent.value=!(this._annotations.length>10||this._texts.getLength()>5),this._cleanUpHitObject()}else for(;ne<J;){switch(le=F[ne]>this._annotations.length&&this.drawing?this._objectBeingDrawn:this._annotations[F[ne]-1],F[ne+1]){case 0:be=10,ze=3,Re=7;break;case 1:be=13,ze=6,Re=7;break;case 2:be=16,ze=9,Re=7;break;case 3:be=13,ze=6,Re=7;break;case 4:be=9+F[ne+7],ze=F[ne+7],Re=9,le.closed=F[ne+8]===1;break;case 5:be=16,ze=9,Re=7;break;case 6:be=13,ze=5,Re=7,le.setFaceAlpha(F.slice(ne+12,ne+13));break;case 7:be=8+F[ne+7],ze=F[ne+7],Re=8;break;case 9:be=18+F[ne+16]+F[ne+17],ze=6,Re=7,le.setWidth(F.slice(ne+13,ne+14)),le.setProfileHeight(F.slice(ne+14,ne+15)),le.setLabelStyle(F.slice(ne+15,ne+16)),le.setDistance(F.slice(ne+17,ne+18+F[ne+17])),le.setProfile(F.slice(ne+18+F[ne+17],ne+18+F[ne+17]+F[ne+16]));break;case 10:be=12,ze=4,Re=7,le.setFaceAlpha(F.slice(ne+11,ne+12));break;case 11:be=8+F[ne+7],ze=F[ne+7],Re=8;break;case 12:be=12+F[ne+10]*F[ne+11]*3,ze=3,Re=7,le.setImage(F.slice(ne+10,ne+11+F[ne+10]*F[ne+11]*3));break}F[ne+1]===9||F[ne+1]===12?le.setLabel(""):F[ne+1]===11?le.setLabel(F[ne+3]):le.setLabel(this._getLabel(F[ne+3])),le.setColor(F.slice(ne+4,ne+7)),le.setPosition(F.slice(ne+Re,ne+Re+ze)),le.setVisible(F[ne+2]),ne+=be}}setUnits(j){const F=this._annotationUniforms.units.value;j==="voxels"||j==="pixels"?this._annotationUniforms.units.value="":this._annotationUniforms.units.value=j,F!==this._annotationUniforms.units.value&&(this._points.refreshLabels(),this._lines.refreshLabels(),this._angles.refreshLabels(),this._polygons.refreshLabels(),this._elevation.refreshLabels(),this._cuboids.refreshLabels(),this._rectangles.refreshLabels(),this._freehands.refreshLabels(),this._circles.refreshLabels())}clear(){this._texts.clear(),this._clearAnnotations()}_clearAnnotations(){for(let j=0;j<this._annotations.length;j++)this._annotations[j].remove();this._annotations=[],this._annotationUniforms.checkExtent.value=!0,this._points.clear(),this._lines.clear(),this._angles.clear(),this._polygons.clear(),this._elevation.clear(),this._cuboids.clear(),this._rectangles.clear(),this._freehands.clear(),this._caliper.clear(),this._tSquare.clear(),this._circles.clear(),this._thumbnails.clear()}enable(){this.enabled=!0,this._planes.enable()}disable(){this.enabled=!1,this._planes.disable()}renderText(j,F){this._texts.render(j,F),this._objectInfo.render(j,F);const J=new d.Vector2(F.width,F.height);if(this._annotationUniforms.checkExtent.value&&(this._annotations.length>0||this._objectBeingDrawn!==null)){const te=[];for(let _e=0;_e<this._annotations.length;_e++)this._annotations[_e].getExtent(J,j,te);this._objectBeingDrawn!==null&&this._objectBeingDrawn.getExtent(J,j,te),this._texts.getExtent(J,j,te);for(let _e=0;_e<this._annotations.length;_e++)this._annotations[_e].shuffleExtent(J,te,_e);this._objectBeingDrawn!==null&&this._objectBeingDrawn.shuffleExtent(J,te,this._annotations.length)}this._objectBeingDrawn!==null&&this._objectBeingDrawn.renderLabel(J,j);for(let te=0;te<this._annotations.length;te++)this._annotations[te].renderLabel(J,j)}editAnnotation(j){this._objectBeingEdited=this._annotations[j],this._objectBeingEdited.editLabel(this._blurHandler)}stopEditing(){this._objectBeingEdited!==null&&(this._objectBeingEdited.stopEditing(this._blurHandler)&&this.dispatchEvent({type:"annotationEdited",message:{id:this._objectBeingEdited.ID,label:this._objectBeingEdited.getLabel()}}),this._objectBeingEdited=null)}copy(){const j=[];for(let F=0;F<this._annotations.length;F++)this._annotations[F].selected&&j.push(F+1);this.dispatchEvent({type:"annotationsCopied",message:j})}selectAll(){for(let j=0;j<this._annotations.length;j++)this._annotations[j].select(!1);this.updateRequested=!0}deselectAll(){for(let j=0;j<this._annotations.length;j++)this._annotations[j].deselect();this.updateRequested=!0}updateObjectInfo(j){Object.prototype.hasOwnProperty.call(j,"ParsedText")&&this._objectInfo.setLabel(j.ParsedText)}updateCrop(j,F,J){switch(this._cropApplied=j,this._cropApplied&&this._disableCropVolumes(),J){case"box":{if(this._cropApplied){const te=new d.Vector3,_e=new d.Vector3;te.fromArray(F[0]),_e.fromArray(F[1]),this._crop.position.addVectors(te,_e).multiplyScalar(.5),this._crop.scale.subVectors(_e,te),this._crop.visible=this._crop.movable||this._cropDeletable,this._cropType="box",this._crop.visible&&this._crop.show()}else this._crop.visible=!1,this._crop.hide();break}case"sphere":{this._cropApplied?(this._cropSphere.position.set(F[0],F[1],F[2]),this._cropSphere.scale.set(F[3],F[3],F[3]),this._cropSphere.visible=this._cropSphere.movable||this._cropDeletable,this._cropType="sphere",this._cropSphere.visible&&this._cropSphere.show()):(this._cropSphere.visible=!1,this._cropSphere.hide());break}case"cylinder":{this._cropApplied?(this._cropCylinder.position.set(F[0],F[1],F[2]),this._cropCylinder.scale.set(F[3],F[4],F[3]),this._cropCylinder.visible=this._cropCylinder.movable||this._cropDeletable,this._cropType="cylinder",this._cropCylinder.visible&&this._cropCylinder.show()):(this._cropCylinder.visible=!1,this._cropCylinder.hide());break}}this.updateRequested=!0}_disableCropVolumes(){this._crop.visible=!1,this._crop.hide(),this._cropSphere.visible=!1,this._cropSphere.hide(),this._cropCylinder.visible=!1,this._cropCylinder.hide()}updateProjection(j){this._sharedRectangle.setEye(j)}updateEye(j,F){this._annotationUniforms.eye.value.copy(j).normalize(),this._annotationUniforms.up.value.copy(F)}resize(j){this._objectInfo.updateZoomCanvasSize(j)}draw(j,F,J,te,_e){this.drawing===!1&&this.startDrawing(j,J),this.clickCounter+=1,this._objectBeingDrawn===this._sharedLine?(this._scissorsPoints.push((F.x-.5)*2,(1-F.y-.5)*2),this._objectBeingDrawn.addPoint(j,te,_e)):J==="zoom"||J==="rectangle"?this._objectBeingDrawn.start(j,F):J==="paint"?this._paintBrushPoints.push((F.x-.5)*2,(1-F.y-.5)*2):this.isMulticlickAnnotation(J)&&(this._objectBeingDrawn.addPoint(j,te,_e),this._hitObject=this._objectBeingDrawn.getLastMarker()),this.updateRequested=!0}startDrawing(j,F){this.drawing=!0,this.clickCounter=0;let J;const te=this._annotations.length+1;switch(F){case"":case"scissors":this._startScissors(F),this._objectBeingDrawn=this._sharedLine;break;case"point":this._objectBeingDrawn=this._points.add(j.toArray(),1,this._defaultLabel,this._color,te,1),this._hitObject=this._objectBeingDrawn;break;case"line":J=j.toArray(),this._objectBeingDrawn=this._lines.add(J.concat(J),1,this._defaultLabel,this._color,te,2),this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"elevation":J=j.toArray(),this._objectBeingDrawn=this._elevation.add(J.concat(J),1,this._defaultLabel,this._color,te,2),this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"angle":this._objectBeingDrawn=this._angles.new(this._defaultLabel,this._color,te),this._objectBeingDrawn.startDrawing(),this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"polyline":this._objectBeingDrawn=this._polygons.new(this._defaultLabel,this._color,te),this._objectBeingDrawn.closed=!1,this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"polygon":this._objectBeingDrawn=this._polygons.new(this._defaultLabel,this._color,te),this._objectBeingDrawn.closed=!0,this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"cuboid":this._objectBeingDrawn=this._cuboids.new(this._defaultLabel,this._color,te),this._objectBeingDrawn.scale.copy(this._sharedCuboid.scale),this._objectBeingDrawn.setCenter(j.toArray()),this._cuboidRememberSize===!1&&this._cuboidLastSize.copy(this._cuboidDefaultSize),this._hitObject=null;break;case"rectangle":this._objectBeingDrawn=this._rectangles.new(this._defaultLabel,this._color,te),this._objectBeingDrawn.up.copy(this._sharedRectangle.up),this._objectBeingDrawn.setFaceAlpha(this._defaultFaceAlpha),this._objectBeingDrawn.startDrawing(),this._hitObject=this._objectBeingDrawn;break;case"freehand":this._objectBeingDrawn=this._freehands.new(this._defaultLabel,this._color,te),this._hitObject=this._objectBeingDrawn;break;case"zoom":this._setLineColor(this._sharedRectangle),this._objectBeingDrawn=this._sharedRectangle;break;case"caliper":J=j.toArray(),this._objectBeingDrawn=this._caliper.add(J.concat(J),1,"",this._color,te,2),this._objectBeingDrawn.setWidth(this._defaultCaliperWidth),this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"t-square":this._objectBeingDrawn=this._tSquare.new(!0,this._color,te,2),this._hitObject=this._objectBeingDrawn.getLastMarker();break;case"circle":J=j.toArray(),this._objectBeingDrawn=this._circles.add(J.concat(0),1,this._defaultLabel,this._color,te,1,this._defaultFaceAlpha),this._objectBeingDrawn.startDrawing(),this._hitObject=this._objectBeingDrawn;break;case"thumbnail":this._objectBeingDrawn=this._thumbnails.add(j.toArray(),1,this._defaultLabel,this._color,te,1),this._hitObject=this._objectBeingDrawn;break}}stopDrawing(){if(this.hideDrawingTools(),this._objectBeingDrawn!==null)this._objectBeingDrawn.close();else{this.cleanUpObject();return}this._objectBeingDrawn===this._sharedLine?(this._scissorsPoints.length>5&&this.dispatchEvent({type:"scissorsFinished",message:{position:this._scissorsPoints,crop:this._scissorsForCrop}}),this.cleanUpScissors()):this._objectBeingDrawn===this._sharedRectangle?this.cleanUpRectangle():((this._objectBeingDrawn.type==="Polygon"||this._objectBeingDrawn.type==="Freehand"||this._objectBeingDrawn.type==="TSquare"||this._objectBeingDrawn.type==="Polyline")&&!this._objectBeingDrawn.isLengthValid()?this._objectBeingDrawn.remove():(this._annotations.push(this._objectBeingDrawn),this._annotationUniforms.checkExtent.value=!(this._annotations.length>10||this._texts.getLength()>5)),this.cleanUpObject())}abortDrawing(){this._objectBeingDrawn!==null&&(this.hideDrawingTools(),this._objectBeingDrawn.remove(),this.cleanUpObject())}followDrawing(j,F,J,te){this.drawing===!0&&(this._objectBeingDrawn.follow(j,F,J,te),this.updateRequested=!0)}unfollowDrawing(){this.drawing===!0&&(this._objectBeingDrawn.unfollow(),this.updateRequested=!0)}undoDrawing(){this.drawing===!0&&(this._objectBeingDrawn.removePoint(),this.updateRequested=!0)}showMarker(j){this._interactionStarted===!0?this.hideDrawingTools():(this.hideCuboid(),this.hidePaintBrush(),this._sharedMarker.setColor(this._color),this._sharedMarker.onPointerDown(),this._sharedMarker.visible=!0,this._sharedMarker.position.copy(j),this.updateRequested=!0)}showCuboid(j,F){this._interactionStarted===!0?this.hideDrawingTools():(this.hideMarker(),this.hidePaintBrush(),this._sharedCuboid.visible===!1&&(this._sharedCuboid.scale.copy(this._cuboidLastSize).multiplyScalar(2*F),this._sharedCuboid.setColor(this._color)),this._sharedCuboid.visible=!0,this._sharedCuboid.position.copy(j),this.updateRequested=!0)}showPaintBrush(){this.hideMarker(),this.hideCuboid(),this._paintBrushEnabled||(this._paintBrushEnabled=!0,this.dispatchEvent(this.getPaintBrushParameters(!0))),this.updateRequested=!0}scrollCuboid(j,F,J,te,_e){F*=.001;const ne=this._sharedCuboid.scale.clone();ne.divideScalar(j*2),J===!0&&(ne.x=ne.x+F*ne.x),te===!0&&(ne.y=ne.y+F*ne.y),_e===!0&&(ne.z=ne.z+F*ne.z),ne.clampScalar(0,1),this._cuboidLastSize.copy(ne),ne.multiplyScalar(j*2),this._sharedCuboid.scale.copy(ne)}hideDrawingTools(){this.hideMarker(),this.hideCuboid(),this.hidePaintBrush()}clearCounter(){this.clickCounter=0}hideMarker(){this._sharedMarker.visible&&(this._sharedMarker.visible=!1,this.updateRequested=!0)}hideCuboid(){this._sharedCuboid.visible&&(this._sharedCuboid.visible=!1,this.updateRequested=!0)}hidePaintBrush(){this._paintBrushEnabled&&(this._paintBrushEnabled=!1,this.dispatchEvent(this.getPaintBrushParameters(!1)),this.updateRequested=!0)}setCrosshair(j){this._crosshair.setPosition(j)}getCrosshairPosition(){return new d.Vector3().fromArray(this._crosshair.getPosition())}getZoomBox(){return this._sharedRectangle.getScreenDimensions()}isMulticlickAnnotation(j){return this.isNclickAnnotation(j)||j==="angle"}isNclickAnnotation(j){return j==="polyline"||j==="polygon"||j==="freehand"||j==="scissors"||j==="t-square"}isLineTraceableAnnotation(j){return j==="Freehand"||j==="Circle"||j==="Polygon"||j==="Polyline"}isLineHittableAnnotation(j){return this.isLineTraceableAnnotation(j)||j==="Caliper"||j==="Line"||j==="Angle"||j==="Elevation"||j==="TSquare"}_startScissors(j){this._scissorsForCrop=j==="",this._setLineColor(this._sharedLine),this._sharedLine.visible=!0}_setLineColor(j){this._annotationUniforms.isDarkTheme.value?j.setColor([.8,.8,.8]):j.setColor([0,0,0])}setColor(j){this._planes.setColor(j);const F=this._annotationUniforms.isDarkTheme.value;this._annotationUniforms.isDarkTheme.value=j[0]+j[1]+j[2]<=2,this._setLineColor(this._crop),this._setLineColor(this._cropSphere),this._setLineColor(this._cropCylinder),this._annotationUniforms.isDarkTheme.value!==F&&(this._labels.setTheme(this._annotationUniforms.isDarkTheme.value),this._texts.setTheme(this._annotationUniforms.isDarkTheme.value),this._crosshair.setTheme(this._annotationUniforms.isDarkTheme.value),this._objectInfo.setTheme(this._annotationUniforms.isDarkTheme.value),this._caliper.setTheme(this._annotationUniforms.isDarkTheme.value),this._tSquare.setTheme(this._annotationUniforms.isDarkTheme.value),this._thumbnails.setTheme(this._annotationUniforms.isDarkTheme.value))}cleanUpScissors(){this.drawing===!0&&(this.drawing=!1,this._scissorsPoints=[],this._sharedLine.clear(),this._objectBeingDrawn=null,this.clearCounter(),this.updateRequested=!0)}cleanUpRectangle(){this.drawing===!0&&(this.drawing=!1,this._sharedRectangle.visible=!1,this._objectBeingDrawn=null,this.clearCounter(),this.updateRequested=!0)}cleanUpPaintBrush(){const j={position:this._paintBrushPoints,size:this._paintBrushSize};return this._paintBrushPoints=[],this.drawing=!1,this.clearCounter(),j}getPaintBrushParameters(j){return{type:"paintBrushEnabled",enabled:j,color:this._color,opacity:this._paintBrushAlpha,brushSize:this._paintBrushSize}}cleanUpObject(){this.drawing=!1,this.clearCounter(),this._objectBeingDrawn=null,this.onPointerUp(!0)}isMouseOnObject(){return this._hitObject!==null}_getLabel(j){switch(j){case-1:return null;case 0:return"";default:return typeof this._labelDictionary=="string"?this._labelDictionary:this._labelDictionary[j-1]}}showContextMenu(j){if(this._drawingStarted===!0||this._hitObject===null)return null;switch(this._selectable===!0&&(this.deselectAll(),this._isCullingObject(this._hitObject)||this._hitObject.select(!1),this.updateRequested=!0),this._hitObject.type){case"InteractivePlane":return this._planes.isContextMenuAvailable()?{type:"contextMenuClicked",message:{Position:[j.pageX,j.pageY],Type:this._hitObject.type,ID:this._hitObject.ID}}:null;case"CropBox":case"CropSphere":case"CropCylinder":return this._cropDeletable===!0?{type:"contextMenuClicked",message:{Position:[j.pageX,j.pageY],Type:this._hitObject.type,ID:0}}:null;case"Marker":case"Rectangle":case"Cuboid":case"Freehand":case"Circle":case"Polygon":case"Polyline":case"Line":case"Elevation":case"Angle":return this._deletable===!0?{type:"contextMenuClicked",message:{Position:[j.pageX,j.pageY],Type:this._hitObject.type,ID:this._hitObject.ID}}:null;default:return null}}updateInteractions(j,F){switch(this._updateAnnotationInteractions(j.Annotate),this._planes.updateInteractions(j.Clipping,j.Slice,F),this._cropDeletable=j.Crop.Deletable,this._cropType){case"box":this._crop.movable=j.Crop.Movable;break;case"sphere":this._cropSphere.movable=j.Crop.Movable;break;case"cylinder":this._cropCylinder.movable=j.Crop.Movable;break;default:this._crop.movable=j.Crop.Movable;break}this._crop.pickable=this._cropDeletable||this._crop.movable,this._objectInfo.setVisibility(j.Select.DisplayObjectInfo,!1),this._cropApplied?this._crop.visible=this._crop.pickable:this._crop.visible=!1}_updateAnnotationInteractions(j){this._color=Array.from(j.DefaultColor),this._sharedMarker.setColor(this._color),this._sharedCuboid.visible&&this._sharedCuboid.setColor(this._color),typeof j.DefaultLabel=="object"?this._defaultLabel=null:this._defaultLabel=j.DefaultLabel;const F=this._cuboidDefaultSize.clone();this._cuboidDefaultSize.fromArray(j.CuboidDefaultSize),(this._cuboidRememberSize===!1||j.CuboidRememberSize===!1||this._cuboidLastSize.lengthSq()<1e-4||!this._cuboidDefaultSize.equals(F))&&this._cuboidLastSize.copy(this._cuboidDefaultSize),this._cuboidRememberSize=j.CuboidRememberSize,this._cuboidRotatable=j.CuboidRotatable,this._paintBrushSize=j.PaintBrushSize,this._paintBrushAlpha=j.PaintBrushAlpha,this._defaultFaceAlpha=j.PackedFace,this._defaultCaliperWidth=j.CaliperWidth,this._enableAnnotations=j.Enabled,this.continueAnnotating=j.ContinueAnnotating,this.fillWithColor=j.CuboidFillWithColor,this._deletable=j.Deletable,this.clampToSceneLimits=j.ClampToSceneLimits,this._annotationUniforms.clampToSceneLimits.value=this.clampToSceneLimits,this._annotationUniforms.is3D.value=j.View==="3d"}updateBoundingBox(j,F){this._planes.setPosition(j,F),this._crosshair.clamp()}updatePlanes(j,F,J,te,_e){this._planes.update(j,F,J,te,_e),this._hitObject!==null&&this._hitObject.type==="InteractivePlane"&&this._cleanUpHitObject()}getSliceState(){return this._planes.state===this._planes.STATE.SLICE}getClipState(){return this._planes.state===this._planes.STATE.CLIPPING&&this._planes.numPlanes<6}hitObject(){return this.isMouseOnObject()?this._hitObject.type==="InteractivePlane"?this._planes.enableRotate||this._planes.enableTranslate:!0:!1}getState(j,F){if(this._hitObject===null)return-1;switch(this._hitObject.type){case"InteractivePlane":return this._planes.enableRotate&&this._planes.isMouseOnSphere(j,F,this._raycaster,this._hitObject)?9:this._planes.enableTranslate?8:-1;case"Marker":case"Line":case"Elevation":case"Angle":case"Circle":case"Freehand":case"Polygon":case"Polyline":case"Caliper":case"TSquare":case"Thumbnail":return this.depthRequired=!0,10;case"Cuboid":case"Rectangle":return 12;case"Crosshair":return 16;case"CropBox":case"CropSphere":case"CropCylinder":return 13;default:return-1}}applyTransformation(j,F,J,te,_e,ne,le,be,je){if(this._hitObject!==null)switch(this._hitObject.type){case"CropSphere":this._hitObject.applyTransformation(te,_e,le,be,je);break;case"CropCylinder":this._hitObject.applyTransformation(j,te,_e,le,be,this._hitFace,je);break;default:this._hitObject.applyTransformation(j,F,J,te,_e,ne,le)}}applyQuaternion(j,F){this._hitObject!==null&&this._hitObject.applyQuaternion(j,F,this._cuboidRotatable)}append(j){this._hitObject!==null&&this._hitObject.append(j)}onPointerDown(j,F){if(this._interactionStarted=!0,this._selectable===!0){if(j===!1&&F===!1&&this.deselectAll(),this._hitObject===null)return;this._isCullingObject(this._hitObject)||this._hitObject.select(F)}this._planes.onPointerDown(this._hitObject),this._hitObject!==null&&(this._hitObject.type==="Marker"||this._hitObject.type==="CropSphere"||this._hitObject.type==="CropCylinder"||this._hitObject.type==="Circle")&&this._hitObject.onPointerDown()}onPointerLeave(j){this.stopEditing(),j===!1&&(this._planes.onPointerLeave()===!0&&(this.updateRequested=!0),this._crop.visible===!0&&(this._crop.hide(),this.updateRequested=!0),this._cropSphere.visible===!0&&(this._cropSphere.hide(),this.updateRequested=!0),this._cropCylinder.visible===!0&&(this._cropCylinder.hide(),this.updateRequested=!0),this._objectInfo.setVisibility(!1,!0)),this.hideDrawingTools()}onPointerEnter(j){this.drawing===!0&&this._objectBeingDrawn!==null&&(this._hitObject=this._objectBeingDrawn.getLastMarker()),j===!1&&(this._planes.onPointerEnter()===!0&&(this.updateRequested=!0),this._crop.visible===!0&&(this._crop.show(),this.updateRequested=!0),this._cropSphere.visible===!0&&(this._cropSphere.show(),this.updateRequested=!0),this._cropCylinder.visible===!0&&(this._cropCylinder.show(),this.updateRequested=!0),this._objectInfo.setVisibility(!0,!0))}onPointerUp(j=!0){this._interactionStarted=!1,this.depthRequired=!1,this._planes.onPointerUp(this._hitObject),this._hitObject!==null&&(this._hitObject.type==="Marker"||this._hitObject.type==="CropCylinder"||this._hitObject.type==="CropSphere"||this._hitObject.type==="Circle")&&this._hitObject.onPointerUp(),j&&this._cleanUpHitObject(),this.updateRequested=!0}onDoubleClick(){this._hitObject!==null&&(this._hitObject.type==="Polygon"||this._hitObject.type==="Polyline")&&this._hitObject.insertVertex()}onPointerMove(j,F,J,te,_e,ne){if(!this.enabled||this._interactionStarted)return;if(!J){this._cleanUpHitObject();return}this._setRaycaster(j,F,_e,ne);const le=this._raycaster.intersectObjects(this._scene.children);if(le.length>0){let be=null,je=null;for(let ze=0;ze<le.length;ze++)if(!this._isCullingObject(le[ze].object)){be=le[ze].object,je=le[ze].face;break}if(be===null)if(te){this._cleanUpHitObject();return}else be=le[0].object,je=le[0].face;if(this.hideDrawingTools(),this._hitObject!==be){if(this._hitObject){let ze=!1;if(!(this._isCullingObject(this._hitObject)&&!this._isCullingObject(be))){for(let Re=0;Re<le.length;Re++)ze=le[Re].object===this._hitObject?!0:ze;if(ze){this._hitObject.highlight(le[0].point,le[0].index),this.isLineTraceableAnnotation(this._hitObject.type)&&(this.updateRequested=!0);return}}this._hitObject.show()}this._hitObject=be,this._hitObject.type==="CropCylinder"||this._hitObject.type==="CropSphere"?this._hitFace=le[0].face:this._hitFace=null,this._hitObject.highlight(le[0].point,le[0].index,this._hitFace),this.updateRequested=!0}else this._hitFace!==null&&Object.prototype.hasOwnProperty.call(this._hitFace,"materialIndex")&&Object.prototype.hasOwnProperty.call(je,"materialIndex")&&this._hitFace.materialIndex!==je.materialIndex?(this._hitFace=je,this._hitObject.highlight(le[0].point,le[0].index,this._hitFace),this.updateRequested=!0):(this._hitObject.highlight(le[0].point,le[0].index,this._hitFace),this.isLineTraceableAnnotation(this._hitObject.type)&&(this.updateRequested=!0))}else this._cleanUpHitObject()}isClickOnFirstPoint(j,F,J,te){return this._objectBeingDrawn!==null&&(this._objectBeingDrawn.type==="Polygon"||this._objectBeingDrawn.type==="Polyline")&&this.clickCounter>1?(this._setRaycaster(j,F,J,te),this._objectBeingDrawn.hitFirstPoint(this._raycaster)):!1}_setRaycaster(j,F,J,te){j.x=j.x*2-1,j.y=-j.y*2+1;let _e=2;this._hitObject!==null&&(this.isLineHittableAnnotation(this._hitObject.type)||this._hitObject.type==="InteractivePlane")&&(_e=1.5*this._annotationUniforms.pointSizeHighlighted.value),F.type==="OrthographicCamera"?(this._raycaster.params.Points.threshold=1.5*this._annotationUniforms.pointSizeHighlighted.value*J/(Math.min(te.width,te.height)*F.zoom),this._raycaster.params.Line.threshold=1.5*_e*J/(Math.min(te.width,te.height)*F.zoom)):(this._raycaster.params.Points.threshold=1.5*Math.tan(F.fov*Math.PI/360)*this._annotationUniforms.pointSizeHighlighted.value/(te.height*F.zoom),this._raycaster.params.Line.threshold=1.5*Math.tan(F.fov*Math.PI/360)*_e/(te.height*F.zoom)),this._raycaster.setFromCamera(j,F)}_cleanUpHitObject(){this._hitObject&&(this._hitObject.show(),this.updateRequested=!0),this._hitObject=null,this._hitFace=null}_isCullingObject(j){return j.type==="InteractivePlane"||j.type==="CropSphere"||j.type==="CropCylinder"||j.type==="CropBox"}getInteractionEndedEventData(j,F){if(this._objectBeingDrawn!==null)return{type:"interactionEnded",name:"AnnotationAdded",redraw:j,message:{id:this._objectBeingDrawn.ID,position:this._objectBeingDrawn.getPosition(),type:this._objectBeingDrawn.type,label:this._defaultLabel,color:this._color,clickType:F}};{if(this._hitObject===null)return{type:"clickReleased",message:{clickType:F}};const J=this._hitObject.parent.type==="Scene"?this._hitObject:this._hitObject.parent;switch(J.type){case"InteractivePlane":return{type:"interactionEnded",name:this._planes.state===this._planes.STATE.CLIPPING?"ClippingPlanesChanged":"SlicePlanesChanged",message:J.ID};case"Crosshair":return{type:"interactionEnded",name:"CrosshairMoved",message:J.getPosition()};case"CropBox":return{type:"interactionEnded",name:"CropRegionChanged",message:J.ID};default:return{type:"interactionEnded",name:"AnnotationMoved",redraw:j,message:{id:J.ID,position:J.getPosition(),type:J.type,clickType:F}}}}}getPlaneChangeEventData(j){return this._hitObject===null?null:{type:"interactionUpdating",name:this._planes.state===this._planes.STATE.CLIPPING?"ClippingPlanesChanging":"SlicePlanesChanging",notifyUser:j,message:{plane:this._hitObject.plane,id:this._hitObject.ID}}}getCropChangeEventData(j){switch(this._cropType){case"box":{const F=new d.Vector3,J=new d.Vector3,te=this._crop.scale.clone();return te.divideScalar(2),te.x=Math.abs(te.x),te.y=Math.abs(te.y),te.z=Math.abs(te.z),F.subVectors(this._crop.position,te),J.addVectors(this._crop.position,te),{type:"interactionUpdating",name:"CropRegionChanging",notifyUser:j,message:{cropMin:F,cropMax:J}}}case"sphere":return{type:"interactionUpdating",name:"CropRegionChanging",notifyUser:j,message:{center:new d.Vector3(this._cropSphere.position.x,this._cropSphere.position.y,this._cropSphere.position.z),radius:this._cropSphere.scale.x}};case"cylinder":return{type:"interactionUpdating",name:"CropRegionChanging",notifyUser:j,message:{center:new d.Vector3(this._cropCylinder.position.x,this._cropCylinder.position.y,this._cropCylinder.position.z),radius:this._cropCylinder.scale.x,height:this._cropCylinder.scale.y}}}return null}getAnnotationMovingEventData(j){const F=this._hitObject!==null?this._hitObject.parent.type==="Scene"?this._hitObject:this._hitObject.parent:this._objectBeingDrawn;return F.type==="Crosshair"?{type:"interactionUpdating",name:"CrosshairMoving",notifyUser:j,message:F.getPosition()}:{type:"interactionUpdating",name:"AnnotationMoving",notifyUser:j,message:{id:F.ID,position:F.getPosition(),type:F.type,label:this._defaultLabel,color:this._color}}}getColorFillEventData(j,F){const J=j===!0?this._hitObject.scale.clone():this._sharedCuboid.scale.clone();J.divideScalar(2),J.x=Math.abs(J.x),J.y=Math.abs(J.y),J.z=Math.abs(J.z);const te=new d.Vector3,_e=new d.Vector3,ne=new d.Matrix4;return j===!0?(te.subVectors(this._hitObject.position,J),_e.addVectors(this._hitObject.position,J),ne.copy(this._hitObject.matrixWorld)):(te.subVectors(this._sharedCuboid.position,J),_e.addVectors(this._sharedCuboid.position,J),ne.copy(this._sharedCuboid.matrixWorld)),ne.invert(),{type:"colorBoxChanged",message:{boxMin:te,boxMax:_e,boxMatrix:ne,boxColor:j===!0?this._hitObject.color:this._sharedCuboid.color,notifyUser:F}}}updateAnnotationSettings(j){j.DataUpdateRequired&&!j.DataUseBinaryChannel&&this.clear(),this._annotationUniforms.selectedColor.value.fromArray(j.SelectedColor),j.LabelUpdateRequired&&(this._labelDictionary=j.LabelDictionary);const F=this._selectable;if(this._selectable=j.Selectable,F===!0&&this._selectable===!1&&this.deselectAll(),this._selectable)if(j.SelectAllRequired>0?this.selectAll():j.SelectAllRequired<0&&this.deselectAll(),Array.isArray(j.SelectIndex)&&j.SelectIndex.length>0){for(let J=0;J<j.SelectIndex.length;J++)j.SelectIndex[J]>0?this._annotations[j.SelectIndex[J]-1].select():this._annotations[Math.abs(j.SelectIndex[J])-1].deselect();this.updateRequested=!0}else Array.isArray(j.SelectIndex)||(j.SelectIndex>0?this._annotations[j.SelectIndex-1].select():this._annotations[Math.abs(j.SelectIndex)-1].deselect(),this.updateRequested=!0);this._annotationUniforms.depthTest.value!==j.DepthTest&&(this._annotationUniforms.depthTest.value=j.DepthTest,this._lines.setDepthTest(j.DepthTest),this._angles.setDepthTest(j.DepthTest),this._polygons.setDepthTest(j.DepthTest),this._elevation.setDepthTest(j.DepthTest)),this._annotationUniforms.pickable.value!==j.Pickable&&(this._annotationUniforms.pickable.value=j.Pickable,this._lines.setPickable(j.Pickable),this._angles.setPickable(j.Pickable),this._polygons.setPickable(j.Pickable),this._elevation.setPickable(j.Pickable),this._cuboids.setPickable(j.Pickable),this._rectangles.setPickable(j.Pickable),this._freehands.setPickable(j.Pickable),this._caliper.setPickable(j.Pickable),this._points.setPickable(j.Pickable),this._tSquare.setPickable(j.Pickable),this._circles.setPickable(j.Pickable),this._thumbnails.setPickable(j.Pickable)),this._annotationUniforms.labelVisible.value!==j.LabelVisible&&(this._annotationUniforms.labelVisible.value=j.LabelVisible,this._annotationUniforms.labelVisible.value==="select"?(this._lines.showLabelsIfSelected(),this._angles.showLabelsIfSelected(),this._polygons.showLabelsIfSelected(),this._elevation.showLabelsIfSelected(),this._cuboids.showLabelsIfSelected(),this._rectangles.showLabelsIfSelected(),this._freehands.showLabelsIfSelected(),this._points.showLabelsIfSelected(),this._circles.showLabelsIfSelected()):this._annotationUniforms.labelVisible.value!=="on"?(this._lines.hideLabels(),this._angles.hideLabels(),this._polygons.hideLabels(),this._elevation.hideLabels(),this._cuboids.hideLabels(),this._rectangles.hideLabels(),this._freehands.hideLabels(),this._points.hideLabels(),this._circles.hideLabels()):(this._lines.showLabels(),this._angles.showLabels(),this._polygons.showLabels(),this._elevation.showLabels(),this._cuboids.showLabels(),this._rectangles.showLabels(),this._freehands.showLabels(),this._points.showLabels(),this._circles.showLabels()))}dispose(){this._lines.dispose(),this._angles.dispose(),this._polygons.dispose(),this._elevation.dispose(),this._cuboids.dispose(),this._rectangles.dispose(),this._freehands.dispose(),this._caliper.dispose(),this._points.dispose(),this._circles.dispose(),this._tSquare.dispose(),this._thumbnails.dispose()}}},D,V),D.exports=B},9032:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class{constructor(_="location",l,n=!0,r=null){this.element=document.createElement("div"),this.element.className="iptLabel",this._formats=r,l.appendChild(this.element),this.position=new d.Vector3,this.extent={x:null,y:null,width:null,height:null},this.visible=!1,this.measurement=!1,this._offset=2,this.inPool=!1,this.style=_,this.highlightColor="rgba(0, 0, 0, 1)",this.color="rgba(0, 0, 0, 0.5)",this.orientation="lower-left",this.setTheme(n)}setColor(_){this.element.style.borderColor=_.getStyle()}setTheme(_){this.highlightColor=_?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.9)",this.color=_?"rgba(0, 0, 0, 0.5)":"rgba(255, 255, 255, 0.7)",this.element.style.backgroundColor=this.color,this.element.style.color=_?"#D9D9D9":"#212121"}setLabel(_,l,n=!0){let r;switch(typeof _){case"number":r=this._numToString(_,l),this.visible=!0;break;case"object":_.isVector2?r=this._numToString(_.x,l)+" x "+this._numToString(_.y,l):n?r="X "+this._numToString(_.x,l)+`
Y `+this._numToString(_.y,l)+`
Z `+this._numToString(_.z,l):r="X "+this._numToString(_.x,l)+`
Y `+this._numToString(_.y,l),this.visible=!0;break;case"string":r=_.replaceAll("\u21B5",` 
`),this.visible=_!=="";break}this.element.textContent=r,this.element.style.visibility=this.visible?"visible":"hidden"}highlight(){this.element.style.backgroundColor=this.highlightColor,this.element.style.zIndex="3"}show(_){this.element.style.backgroundColor=_===!0?this.highlightColor:this.color,this.element.style.zIndex=_===!0?"2":"1"}edit(_){this.element.style.cursor="text",this.element.style.userSelect="text",this.element.style.pointerEvents="auto",this.element.contentEditable="plaintext-only",this.priorText=this.element.textContent,this.setVisibility(!0);const l=document.createRange(),n=window.getSelection();n.removeAllRanges(),l.selectNodeContents(this.element),n.addRange(l),this.element.focus(),this.element.addEventListener("blur",_)}stopEditing(_){return this.element.removeEventListener("blur",_),this.element.style.cursor="none",this.element.style.userSelect="none",this.element.style.pointerEvents="none",this.element.contentEditable=!1,this.element.textContent===""&&this.setVisibility(!1),this.element.textContent!==this.priorText?(this.measurement=!1,!0):!1}clear(){this.inPool=!0,this.element.textContent="",this.extent={x:null,y:null,width:null,height:null},this.setVisibility(!1)}getLabel(){return this.element.textContent}setOpacity(_){this.element.style.opacity=_}setVisibility(_){if(this.visible!==_){if(_&&this.element.textContent==="")return;this.visible=_,this.element.style.visibility=this.visible?"visible":"hidden"}}_projectPosition(_){const l=new d.Vector3;return l.copy(this.position),l.project(_),l}project(_,l,n=!1){const r=this._projectPosition(l);if(r.z>1){this.setVisibility(!1);return}const h=Math.round((r.x+1)*_.x/2),u=Math.round((r.y+1)*_.y/2);switch(this.style){case"distance":case"angle":n&&this.extent.width!==null?(this.element.style.left=this.extent.x+"px",this.element.style.bottom=this.extent.y+"px",this.element.style.transform="none"):(this.element.style.left=h+"px",this.element.style.bottom=u+"px",this.element.style.transform="translate(0, 50%)");break;case"volume":case"centered":case"dimension":case"centeredArea":this.element.style.left=h+"px",this.element.style.bottom=u+"px",this.element.style.transform="translate(-50%, 50%)";break;case"radius":n&&this.extent.width!==null?(this.element.style.left=this.extent.x+"px",this.element.style.bottom=this.extent.y+"px",this.element.style.transform="none"):(this.element.style.left=h+"px",this.element.style.bottom=u+2*this._offset+"px",this.element.style.transform="translate(-50%, 0)");break;case"left":this.element.style.left=h+"px",this.element.style.bottom=u+"px",this.element.style.transform="translate(0, 50%)";break;case"right":this.element.style.left=h+"px",this.element.style.bottom=u+"px",this.element.style.transform="translate(-100%, 50%)";break;case"bottom-left":this.element.style.left=h+"px",this.element.style.bottom=u+"px",this.element.style.transform="translate(0, 0)";break;case"top-left":this.element.style.left=h+"px",this.element.style.bottom=u+"px",this.element.style.transform="translate(0, 100%)";break;case"top-right":this.element.style.left=h+"px",this.element.style.bottom=u+"px",this.element.style.transform="translate(-100%, 100%)";break;default:n&&this.extent.width!==null?(this.element.style.left=this.extent.x+"px",this.element.style.bottom=this.extent.y+"px"):(this.element.style.bottom=u+this._offset+"px",this.element.style.left=h+this._offset+"px")}this.setVisibility(!0)}checkExtent(){const _=this.element.getBoundingClientRect();this.extent.width=_.width,this.extent.height=_.height}getExtent(_,l,n){if(this.extent.width!==null){const r=this._projectPosition(l);if(r.z<1){const h=Math.round((r.x+1)*_.x/2),u=Math.round((r.y+1)*_.y/2);switch(this.style){case"distance":case"angle":this.extent.x=h,this.extent.y=u-this.extent.height/2;break;case"volume":case"centered":case"dimension":case"centeredArea":this.extent.x=h-this.extent.width/2,this.extent.y=u-this.extent.height/2;break;case"radius":this.extent.x=h-this.extent.width/2,this.extent.y=u+2*this._offset;break;case"left":this.extent.x=h,this.extent.y=u-this.extent.height/2;break;case"right":this.extent.x=h-this.extent.width,this.extent.y=u-this.extent.height/2;break;case"bottom-left":this.extent.x=h,this.extent.y=u;break;case"top-left":this.extent.x=h,this.extent.y=u-this.extent.height;break;case"top-right":this.extent.x=h-this.extent.width,this.extent.y=u-this.extent.height;break;default:this.extent.y=u+this._offset,this.extent.x=h+this._offset}}else this.extent.x=null,this.extent.y=null}n.push(this.extent)}shuffleExtent(_,l,n){this.extent.width!==null&&this.extent.x!==null&&this._checkForOverlap(_,l,n)&&(this.style==="distance"||this.style==="angle"?(this.extent.x=this.extent.x-this.extent.width,this._checkForOverlap(_,l,n)&&(this.extent.x=this.extent.x+this.extent.width)):this.style==="location"||this.style==="length"||this.style==="area"?(this.extent.x=this.extent.x-this.extent.width-2*this._offset,this.extent.y=this.extent.y-this.extent.height-2*this._offset,this._checkForOverlap(_,l,n)&&(this.extent.x=this.extent.x+this.extent.width+2*this._offset,this._checkForOverlap(_,l,n)&&(this.extent.x=this.extent.x-this.extent.width-2*this._offset,this.extent.y=this.extent.y+this.extent.height+2*this._offset,this._checkForOverlap(_,l,n)&&(this.extent.x=this.extent.x+this.extent.width+2*this._offset)))):this.style==="radius"&&(this.extent.y=this.extent.y-2*this._offset-this.extent.height,this._checkForOverlap(_,l,n)&&(this.extent.y=this.extent.y+2*this._offset+this.extent.height)))}_checkForOverlap(_,l,n){if(this.extent.y+this.extent.height>_.y||this.extent.x+this.extent.width>_.x)return!0;for(let r=0;r<l.length;r++)if(r!==n&&l[r].width!==null&&l[r].x!==null&&this._isOverlapping(this.extent,l[r]))return!0;return!1}_isOverlapping(_,l){return!(_.x+_.width<=l.x||l.x+l.width<=_.x||_.y+_.height<=l.y||l.y+l.height<=_.y)}unproject(_,l,n){const r=this.element.getBoundingClientRect(),h=3,u=(r.left+h)*2/_.x-1,g=(r.left+r.width-h)*2/_.x-1,p=1-(r.bottom-h)*2/_.y,y=1-(r.bottom-r.height+h)*2/_.y,x=new d.Vector3(u,p,0),w=new d.Vector3(g,p,0),M=new d.Vector3(u,y,0),T=new d.Vector3(g,y,0);x.unproject(l),w.unproject(l),M.unproject(l),T.unproject(l);const A=x.clone();let C=x.distanceToSquared(n);return w.distanceToSquared(n)<C&&(A.copy(w),C=w.distanceToSquared(n),this.orientation="lower-right"),M.distanceToSquared(n)<C&&(A.copy(M),C=M.distanceToSquared(n),this.orientation="upper-left"),T.distanceToSquared(n)<C&&(A.copy(T),this.orientation="upper-right"),A}projectCorner(_,l,n){l.project(n);const r=Math.round((l.x+1)*_.x/2),h=Math.round((l.y+1)*_.y/2),u=this.element.getBoundingClientRect();switch(this.orientation){case"lower-left":this.element.style.bottom=h-this._offset+"px",this.element.style.left=r-this._offset+"px";break;case"upper-left":this.element.style.bottom=h-u.height+this._offset+"px",this.element.style.left=r-this._offset+"px";break;case"lower-right":this.element.style.bottom=h-this._offset+"px",this.element.style.left=r-u.width+this._offset+"px";break;case"upper-right":this.element.style.bottom=h-u.height+this._offset+"px",this.element.style.left=r-u.width+this._offset+"px";break}}_numToString(_,l){let n,r=3;switch(this.style){case"angle":n="\xB0";break;case"volume":n=l===""?"":" "+l+"\xB3";break;case"area":case"centeredArea":n=l===""?"":" "+l+"\xB2";break;case"dimension":r=1,n=l;break;default:n=l===""?"":" "+l}const h=Math.floor(Math.log10(_));return _===0||this._formats===null?_+n:h>5||h<-2?_.toExponential(r)+n:this.style==="dimension"?this._formats.slimFormat.format(_)+n:this._formats.basicFormat.format(_)+n}}},D,V),D.exports=B},8405:(D,V,f)=>{var R,B;R=[f(3681),f(9721),f(9032)],B=f.dj.d(R,function(d,N,_){return class extends d.LineSegments{constructor(n=0,r,h=2){const u=new d.BufferGeometry;u.setAttribute("position",new d.Float32BufferAttribute(new Array(h*3).fill(0),3)),u.computeBoundingSphere();const g=new d.Color(16777215),p=new d.LineBasicMaterial({color:g,toneMapped:!1,transparent:!1,depthTest:r.depthTest.value,depthWrite:!1});super(u,p),this.type="Caliper",this._width=50,this._profileHeight=-1,this._distances=[],this._numDistance=0,this._profile=[],this._labelStyle=0,this.visible=!1,this.selected=!1,this.ID=n,this.color=g,this.pickable=r.pickable.value,this._globalUniforms=r,this._reshape=!0,this._translate=!0,this._formats={basicFormat:new Intl.NumberFormat(navigator.language,{trailingZeroDisplay:"stripIfInteger"}),slimFormat:new Intl.NumberFormat(navigator.language,{trailingZeroDisplay:"stripIfInteger",maximumFractionDigits:1})},this._createWidth();const y=new d.BufferGeometry;y.setAttribute("position",new d.Float32BufferAttribute(new Array(6).fill(0),3)),this._numPoints=2,this._points=new N(0,this._globalUniforms,"circle",y),this._points.material.uniforms.color.value=this.material.color,this._points.visible=!0,this.add(this._points),this._labels=[],this._numLabels=0}updateMatrixWorld(n){super.updateMatrixWorld(n),this._points.visible=this.visible&&this.pickable}highlight(n,r){(this._reshape||this._translate)&&(this.material.opacity=1,this._points.ID=r,this._points.highlight())}show(){this.material.opacity=1,this._points.show()}hide(){this.material.opacity=0,this._points.hide()}highlightLabel(){for(let n=0;n<this._labels.length;n++)this._labels[n].highlight()}unhighlightLabel(){this._setLabelColor()}select(n){this.selected===!0&&n===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this._setLabelColor()}setTheme(n){for(let r=0;r<this._labels.length;r++)this._labels[r].setTheme(n)}getPosition(){const n=new Array(this._numPoints*3),r=this._points.geometry.attributes.position.array;for(let h=0;h<n.length;h++)n[h]=r[h];return this._numDistance>0?n.concat(this._distances):n}removePoint(){}follow(n,r,h,u){}unfollow(){}close(){}clear(){this._numPoints=0;const n=new Array(0).fill(0);this.geometry.setAttribute("position",new d.Float32BufferAttribute(n,3)),this._points.visible=!1,this.visible=!1}remove(){this.visible=!1,this.selected=!1;for(let n=0;n<this._numLabels;n++)this._labels[n].setVisibility(!1)}setVisible(n){if(n>0)switch(this.visible=!0,n){case 1:this._reshape=!0,this._translate=!0;break;case 2:this._reshape=!1,this._translate=!1;break;case 3:this._reshape=!0,this._translate=!1;break;case 4:this._reshape=!1,this._translate=!0;break}else this.visible=!1,this.selected=!1,this._reshape=!1,this._translate=!1;for(let r=0;r<this._numLabels;r++)this._labels[r].setVisibility(n>0)}setLabel(n){}editLabel(n){}stopEditing(n){return!1}getLabel(){return null}showLabel(){}hideLabel(){}setWidth(n){this._width=n}setProfileHeight(n){this._profileHeight=n}setDistance(n){this._numDistance=n[0],this._numDistance>0?this._distances=Array.from(n.slice(1)):this._distances=[]}setProfile(n){this._profile=n}setLabelStyle(n){this._labelStyle=n[0]}setPosition(n){this._numPoints=2;const r=this._points.geometry.attributes.position.array;for(let h=0;h<n.length;h++)r[h]=n[h];this._points.geometry.attributes.position.needsUpdate=!0,this._updateCaliper()}setColor(n){this.color.fromArray(n),this.selected?(this.material.color.copy(this._globalUniforms.selectedColor.value),this._widthMesh.material.color.copy(this._globalUniforms.selectedColor.value)):(this.material.color.fromArray(n),this._widthMesh.material.color.fromArray(n))}_updateCaliper(){const n=this._points.geometry.attributes.position.array,r=new d.Vector3().fromArray(n,0),h=new d.Vector3().fromArray(n,3);if(this._numPoints===2){const u=new d.Vector3,g=new d.Vector3,p=new d.Vector3;u.subVectors(h,r).normalize();const y=r.distanceTo(h),x=.2,w=this._profileHeight>0?this._profileHeight:y*x,M=this._profileHeight>0?Math.max(w,this._width):Math.max(y*x,this._width);p.crossVectors(u,this._globalUniforms.eye.value).normalize().setLength(this._width/2);const T=p.clone().negate(),A=this._widthMesh.geometry.attributes.position.array;g.copy(r).add(p),g.toArray(A,0),g.toArray(A,9),g.copy(h).add(T),g.toArray(A,3),g.toArray(A,15),g.copy(r).add(T),g.toArray(A,6),g.copy(h).add(p),g.toArray(A,12);const C=this._profile.length>1?(this._profile.length-1)*6:0;let z=0;this._numDistance>0&&(this._labelStyle===0?z=(3+this._numDistance)*6:this._labelStyle===1&&(z=4*(this._numDistance-1)*6));const H=new Array((this._numDistance+1)*6+C+z).fill(0);r.toArray(H,0),h.toArray(H,3),p.setLength(M/2),T.setLength(M/2);for(let q=0;q<this._numDistance;q++)this._distances[q]>0?(u.setLength(this._distances[q]),g.copy(r).add(u).add(p),g.toArray(H,q*6+6),g.copy(r).add(u).add(T),g.toArray(H,q*6+9)):(g.copy(r).add(p),g.toArray(H,q*6+6),g.copy(r).add(T),g.toArray(H,q*6+9));if(this._numDistance>0){p.setLength(M/2+.1*w),T.setLength(M/2+.1*w);const q=u.clone().normalize();q.cross(this._globalUniforms.up.value).dot(this._globalUniforms.eye.value)>0?q.copy(p):q.copy(T);const P=q.clone().setLength(.1*w);if(this._labelStyle===0){g.copy(r).add(q),g.toArray(H,this._numDistance*6+6),g.copy(r).add(u).add(q),g.toArray(H,this._numDistance*6+9),u.setLength(.2*w),g.copy(r).add(q),g.toArray(H,this._numDistance*6+12),g.copy(r).add(q),g.toArray(H,this._numDistance*6+15),g.copy(r).add(q),g.toArray(H,this._numDistance*6+18),g.copy(r).add(q),g.toArray(H,this._numDistance*6+21);for(let Z=0;Z<this._numDistance;Z++)this._distances[Z]>0?(u.setLength(this._distances[Z]),g.copy(r).add(u).add(q).add(P),g.toArray(H,(this._numDistance+Z)*6+24),g.copy(r).add(u).add(q),g.toArray(H,(this._numDistance+Z)*6+27)):(g.copy(r).add(q).add(P),g.toArray(H,(this._numDistance+Z)*6+24),g.copy(r).add(q),g.toArray(H,(this._numDistance+Z)*6+27))}else if(this._labelStyle===1){const Z=new d.Vector3;let K=0;for(let Y=1;Y<this._numDistance;Y++)Z.copy(u),Z.setLength(this._distances[Y]),g.copy(r).add(Z).add(q).add(P),g.toArray(H,this._numDistance*6+(Y-1)*24+6),g.copy(r).add(Z).add(q),g.toArray(H,this._numDistance*6+(Y-1)*24+9),g.copy(r).add(Z).add(q).add(P),g.toArray(H,this._numDistance*6+(Y-1)*24+12),Z.copy(u),Z.setLength(this._distances[Y-1]),g.copy(r).add(Z).add(q).add(P),g.toArray(H,this._numDistance*6+(Y-1)*24+15),g.copy(r).add(Z).add(q).add(P),g.toArray(H,this._numDistance*6+(Y-1)*24+18),g.copy(r).add(Z).add(q),g.toArray(H,this._numDistance*6+(Y-1)*24+21),Z.copy(u),K=this._distances[Y]-this._distances[Y-1],Z.setLength(this._distances[Y-1]+K/2),g.copy(r).add(Z).add(q).add(P),g.toArray(H,this._numDistance*6+(Y-1)*24+24),Math.abs(K)>0?g.copy(r).add(Z).add(q).add(P).add(P):g.copy(r).add(Z).add(q).add(P),g.toArray(H,this._numDistance*6+(Y-1)*24+27)}}if(C>0){const q=u.clone().normalize();q.cross(this._globalUniforms.up.value).dot(this._globalUniforms.eye.value)>0?q.copy(T):q.copy(p);for(let P=0;P<this._profile.length-1;P++)q.setLength(M/2+this._profile[P]*w),P===0?g.copy(r).add(q):(u.setLength(y*(P/(this._profile.length-1))),g.copy(r).add(u).add(q)),g.toArray(H,(P+this._numDistance)*6+6+z),u.setLength(y*((P+1)/(this._profile.length-1))),q.setLength(M/2+this._profile[P+1]*w),g.copy(r).add(u).add(q),g.toArray(H,(P+this._numDistance)*6+9+z)}this.geometry.setAttribute("position",new d.Float32BufferAttribute(H,3)),this._widthMesh.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere()}}raycast(n,r){if(this.visible&&this.pickable&&(this._reshape||this._translate)){const h=[];if(this._points.raycastForced(n,h),h.length>0)h[0].object=this,r.push(h[0]);else if(this._widthMesh.raycast(n,h),h.length>0)h[0].object=this,h[0].index=-1,r.push(h[0]);else if(super.raycast(n,h),h.length>0){for(let u=0;u<h.length;u++)if(h[u].index===0){h[0].index=-1,r.push(h[u]);return}}}}applyQuaternion(){}applyTransformation(n,r,h,u,g,p,y){const x=this._points.ID;if(u||x<0||!this._reshape)this.applyUniformTranslation(n,r,y);else{this._clampPointToSceneLimits(n,r);const w=this._points.geometry.attributes.position.array,M=new d.Vector3().fromArray(w,0),T=new d.Vector3().fromArray(w,3);if(h){const A=new d.Vector3;x===0?A.copy(T):A.copy(M),this._snapToAngle(n,A)}if(this._numDistance>0){const A=M.distanceTo(T),C=x===0?n.distanceTo(T):n.distanceTo(M),z=this._distances;this._distances=[];let H;const q=x===0?C-A:0;for(let P=0;P<this._numDistance;P++)H=z[P]+q,H>0&&H<C&&this._distances.push(H);this._numDistance=this._distances.length}w[x*3]=n.x,w[x*3+1]=n.y,w[x*3+2]=n.z,this._points.geometry.attributes.position.needsUpdate=!0,this._updateCaliper()}}applyUniformTranslation(n,r,h){if(!this._translate)return;this._clampOffsetToSceneLimits(r,h);const u=this._points.geometry.attributes.position.array;for(let g=0;g<u.length/3;g++)u[g*3]-=h.x,u[g*3+1]-=h.y,u[g*3+2]-=h.z;this._points.geometry.attributes.position.needsUpdate=!0,this._updateCaliper()}getLastMarker(){return this._points.ID=this._numPoints-1,this}_clampPointToSceneLimits(n,r){this._globalUniforms.clampToSceneLimits.value&&n.clamp(r.min,r.max)}_clampOffsetToSceneLimits(n,r){if(this._globalUniforms.clampToSceneLimits.value){this._computeBoundingBox();const h=this._widthMesh.geometry.boundingBox.min.clone().sub(r),u=this._widthMesh.geometry.boundingBox.max.clone().sub(r);h.clamp(n.min,n.max).sub(this._widthMesh.geometry.boundingBox.min).add(r),u.clamp(n.min,n.max).sub(this._widthMesh.geometry.boundingBox.max).add(r),r.sub(h).sub(u)}}_snapToAngle(n,r){const h=n.distanceTo(r),u=new d.Vector3().subVectors(n,r).normalize(),g=12/Math.PI,p=new d.Spherical().setFromVector3(u);p.phi=Math.round(p.phi*g)/g,p.theta=Math.round(p.theta*g)/g,u.setFromSpherical(p).setLength(h),n.copy(r).add(u)}_computeBoundingBox(){this._widthMesh.geometry.computeBoundingBox()}_computeBoundingSphere(){this.geometry.computeBoundingSphere(),this._points.geometry.computeBoundingSphere(),this._widthMesh.geometry.computeBoundingSphere()}_createWidth(){const n=new d.BufferGeometry,r=new Array(18).fill(0);n.setAttribute("position",new d.Float32BufferAttribute(r,3)),n.computeBoundingSphere();const h=new d.MeshBasicMaterial({color:this.color,toneMapped:!1,transparent:!0,depthWrite:!1,side:d.FrontSide,opacity:.2});this._widthMesh=new d.Mesh(n,h),this.add(this._widthMesh)}renderLabel(n,r){if(this.visible&&this._labelStyle>-1){this._numLabels=0;const h=new d.Vector3,u=this.geometry.attributes.position.array,g=this._points.geometry.attributes.position.array;let p="left";const y=[],x=new d.Vector3().fromArray(g,0),w=new d.Vector3().fromArray(g,3).sub(x).normalize(),M=w.dot(this._globalUniforms.up.value),T=w.cross(this._globalUniforms.up.value).dot(this._globalUniforms.eye.value);if(M>.8?(p="left",T>0?p="left":p="right"):M<-.8?T>0?p="right":p="left":M>0?T>0?p="top-left":p="top-right":T>0?p="top-right":p="top-left",this._labelStyle===0)for(let A=0;A<this._numDistance;A++)h.fromArray(u,(this._numDistance+A)*6+24),h.project(r),this._isLabelLocationValid(h,n,y,p)&&(this._numLabels++,this._numLabels>this._labels.length&&this._constructLabel(),this._labels[this._numLabels-1].style=p,this._labels[this._numLabels-1].position.fromArray(u,(this._numDistance+A)*6+24),this._labels[this._numLabels-1].setLabel(this._distances[A],this._globalUniforms.units.value),this._labels[this._numLabels-1].project(n,r,!1),this._labels[this._numLabels-1].setVisibility(!0),this._labels[this._numLabels-1].checkExtent(),this._labels[this._numLabels-1].getExtent(n,r,y));else{const A=new d.Vector3;for(let C=0;C<this._numDistance-1;C++)A.fromArray(u,this._numDistance*6+C*24+27),h.copy(A),h.project(r),this._distances[C+1]-this._distances[C]>Number.EPSILON&&this._isLabelLocationValid(h,n,y,p)&&(this._numLabels++,this._numLabels>this._labels.length&&this._constructLabel(),this._labels[this._numLabels-1].style=p,this._labels[this._numLabels-1].position.copy(A),this._labels[this._numLabels-1].setLabel(this._distances[C+1]-this._distances[C],this._globalUniforms.units.value),this._labels[this._numLabels-1].project(n,r,!1),this._labels[this._numLabels-1].setVisibility(!0),this._labels[this._numLabels-1].checkExtent(),this._labels[this._numLabels-1].getExtent(n,r,y))}for(let A=this._numLabels;A<this._labels.length;A++)this._labels[A].setVisibility(!1)}else{for(let h=0;h<this._labels.length;h++)this._labels[h].setVisibility(!1);this._numLabels=0}}_isLabelLocationValid(n,r,h,u){if(Math.abs(n.x)<=1&&Math.abs(n.y)<=1&&Math.abs(n.z)<=1)if(h.length>0){const g=Math.round((n.x+1)*r.x/2),p=Math.round((n.y+1)*r.y/2),y=h[0].height;let x=h[0].width;if(h.length>1)for(let M=1;M<h.length;M++)x=Math.max(x,h[M].width);const w=this._createCandidateExtent(g,p,x,y,u);for(let M=0;M<h.length;M++)if(this._isExtentOverlapping(w,h[M]))return!1;return!0}else return!0;else return!1}_createCandidateExtent(n,r,h,u,g){const p={x:n,y:r,width:h,height:u};switch(g){case"left":p.x=n,p.y=r-p.height/2;break;case"right":p.x=n-p.width,p.y=r-p.height/2;break;case"bottom-left":p.x=n,p.y=r;break;case"top-left":p.x=n,p.y=r-p.height;break;case"top-right":p.x=n-p.width,p.y=r-p.height;break}return p}_isExtentOverlapping(n,r){return this._isPointInExtent(n.x,n.y,r)||this._isPointInExtent(n.x,n.y+n.height,r)||this._isPointInExtent(n.x+n.width,n.y,r)||this._isPointInExtent(n.x+n.width,n.y+n.height,r)||this._isPointInExtent(n.x+n.width/2,n.y+n.height/2,r)}_isPointInExtent(n,r,h){return n>=h.x&&n<=h.x+h.width&&r>=h.y&&r<=h.y+h.height}_setLabelColor(){for(let n=0;n<this._labels.length;n++)this._labels[n].setColor(this.material.color),this._labels[n].show(this.selected)}_constructLabel(){const n=new _("left",this._globalUniforms.container.value,this._globalUniforms.isDarkTheme.value,this._formats);n.setColor(this.material.color),n.measurement=!0,this._labels.push(n)}getExtent(n,r,h){h.push({x:null,y:null,width:null,height:null})}shuffleExtent(n,r,h){}dispose(){this.material.dispose(),this.geometry.dispose(),this._points.dispose()}}},D,V),D.exports=B},9127:(D,V,f)=>{var R,B;R=[f(6127),f(8405)],B=f.dj.d(R,function(d,N){return class extends d{add(l,n,r,h,u,g,p=[50,-1,0,0,0]){if(this._numObjects+=1,this._numObjects>this.objects.length){const y=this._newObject(u,this._annotationUniforms,g);this._scene.add(y),this.objects.push(y)}return this.objects[this._numObjects-1].setLabel(r),this.objects[this._numObjects-1].setWidth(p.slice(0,1)),this.objects[this._numObjects-1].setProfileHeight(p.slice(1,2)),this.objects[this._numObjects-1].setLabelStyle(p.slice(2,3)),this.objects[this._numObjects-1].setProfile(p.slice(5+p[4],6+p[3]+p[4])),this.objects[this._numObjects-1].setDistance(p.slice(4,5+p[4])),this.objects[this._numObjects-1].setColor(h),this.objects[this._numObjects-1].setPosition(l),this.objects[this._numObjects-1].ID=u,this.objects[this._numObjects-1].setVisible(n),this._getObject(this._numObjects-1)}_newObject(l,n,r){return new N(l,n)}}},D,V),D.exports=B},4039:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.Line{constructor(_=0,l,n=0){const r=new d.BufferGeometry,h=new Array(181*3).fill(0);for(let p=0;p<181;p++)h[p*3]=Math.cos(2*p*Math.PI/180),h[p*3+1]=Math.sin(2*p*Math.PI/180);r.setAttribute("position",new d.Float32BufferAttribute(h,3)),r.computeBoundingSphere();const u=new d.Color(16777215),g=new d.LineBasicMaterial({color:u,toneMapped:!1,transparent:!1,depthTest:l.depthTest.value,depthWrite:!1});super(r,g),this.type="Circle",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=_,this.color=u,this._drawing=!1,this.pickable=l.pickable.value,this._labelType="radius",this._globalUniforms=l,this._facePickable=!1,this._faceAlpha=0,this._face=null,this._faceHit=!1,this._reshape=!0,this._translate=!0,this._edgeA=new d.Vector3,this._edgeB=new d.Vector3,this._view=new d.Vector3,this._label=null,this._labelString=null,this.setFaceAlpha(n)}updateMatrixWorld(_){this._view.copy(this.position).add(this._globalUniforms.eye.value),this.lookAt(this._view),super.updateMatrixWorld(_)}highlight(_,l){(this._reshape||this._translate)&&(this.material.opacity=1,this._faceHit=l===-1,_.x=-_.x,_.multiply(this.scale).add(this.position),this._globalUniforms.sharedMarker.value.display(_,this.color.toArray()),this.highlightLabel())}show(){this.material.opacity=1,this._faceHit=!1,this._globalUniforms.sharedMarker.value.visible=!1,this.unhighlightLabel()}hide(){this.material.opacity=0,this._faceHit=!1}highlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select")&&this.showLabel(),this._label!==null&&this._label.highlight()}unhighlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select"&&!this.selected)&&this.hideLabel(),this._setLabelColor()}select(_){this.selected===!0&&_===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this._globalUniforms.labelVisible.value==="select"&&this.showLabel(),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this._globalUniforms.labelVisible.value==="select"&&this.hideLabel(),this._setLabelColor()}onPointerDown(){this._globalUniforms.sharedPlus.value.copyParameters(this.position,this.scale,this.material.color),this._globalUniforms.sharedPlus.value.visible=!0}onPointerUp(){this._globalUniforms.sharedPlus.value.visible=!1}setFaceAlpha(_){if(_===0)this._faceAlpha=0,this._facePickable=!1,this._face!==null&&(this._face.visible=!1);else{if(this._face===null){const l=new d.CircleGeometry(1,180),n=new d.MeshBasicMaterial({color:this.material.color,toneMapped:!1,transparent:!0,depthTest:!0,depthWrite:!1});this._face=new d.Mesh(l,n),this.add(this._face)}_>0?(this._faceAlpha=_,this._facePickable=!1,this._face.material.opacity=_,this._face.visible=!0):(this._facePickable=!0,_<-1?(this._faceAlpha=0,this._face.visible=!1):(this._faceAlpha=Math.abs(_),this._face.material.opacity=this._faceAlpha,this._face.visible=!0))}}getPosition(){const _=new Array(4);return this.position.toArray(_),_[3]=this.scale.x,_}setCenter(_){this.position.fromArray(_),this.refreshLabel()}setSize(_){this.scale.x=Math.abs(_),this.scale.y=Math.abs(_),this.scale.z=1}startDrawing(){this._drawing=!0,this._edgeA.copy(this.position),this._edgeB.copy(this._edgeA)}close(){this._drawing=!1,this.refreshLabel()}clear(){this.setSize(0),this.setCenter([0,0,0]),this.visible=!1}remove(){this.visible=!1,this.selected=!1,this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null)}setVisible(_){if(_>0)switch(this.visible=!0,_){case 1:this._reshape=!0,this._translate=!0;break;case 2:this._reshape=!1,this._translate=!1;break;case 3:this._reshape=!0,this._translate=!1;break;case 4:this._reshape=!1,this._translate=!0;break}else this.visible=!1,this.selected=!1,this._reshape=!1,this._translate=!1;this._label!==null&&this._label.setVisibility(_>0)}setLabel(_){switch(this._labelString=_,this._globalUniforms.labelVisible.value){case"on":this._constructLabel();break;case"off":case"hover":this._showLabel=!1,this.frustumCulled=!0;break;case"select":this.selected?this._constructLabel():(this._showLabel=!1,this.frustumCulled=!0)}}editLabel(_){this._label!==null&&this._label.edit(_)}stopEditing(_){return this._label!==null?this._label.stopEditing(_):!1}getLabel(){return this._label!==null?this._label.getLabel():null}showLabel(){this._constructLabel(),this.refreshLabel()}hideLabel(){this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null),this._showLabel=!1}setPosition(_){this.setSize(_[3]),this.setCenter(_),this._computeBoundingSphere(),this.refreshLabel()}setColor(_){this.color.fromArray(_),this.selected?this.material.color.copy(this._globalUniforms.selectedColor.value):this.material.color.fromArray(_),this._face!==null&&this._face.material.color.copy(this.material.color),this._setLabelColor()}raycast(_,l){if(this.visible&&this.pickable&&(this._reshape||this._translate)){const n=[];if(super.raycast(_,n),n.length>0){n[0].point.set(0,0,0);const r=new d.Vector3;for(let h=0;h<n.length;h++)r.set(Math.cos(2*(n[h].index+1)*Math.PI/180),Math.sin(2*(n[h].index+1)*Math.PI/180),0),n[0].point.add(r);n[0].point.divideScalar(n.length),l.push(n[0])}else this._face!==null&&this._facePickable&&(this._face.raycast(_,n),n.length>0&&(n[0].object=this,n[0].index=-1,l.push(n[0])))}}applyQuaternion(){}applyTransformation(_,l,n,r,h,u,g){if(this._clampPointToSceneLimits(_,l),r||!this._reshape||this._faceHit){if(!this._translate)return;this._clampOffsetToSceneLimits(l,g),this._drawing&&(this._edgeA.sub(g),this._edgeB.sub(g)),this.position.sub(g)}else this._drawing?(this._edgeB.copy(_),this.position.lerpVectors(this._edgeA,this._edgeB,.5),this.setSize(this._edgeA.distanceTo(this._edgeB)/2)):this.setSize(this.position.distanceTo(_));this.onPointerDown(),this._computeBoundingSphere(),this.refreshLabel()}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._label.measurement===!0&&this._label.setLabel(this.scale.x,this._globalUniforms.units.value),this._globalUniforms.checkExtent.value&&this._label.checkExtent())}getLastMarker(){return this}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_constructLabel(){this._labelString===null?(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.measurement=!0,this._showLabel=!0):this._labelString===""?this.hideLabel():(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.setLabel(this._labelString,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0),this._showLabel&&this._globalUniforms.checkExtent.value&&this._label.checkExtent(),this.frustumCulled=!this._showLabel}renderLabel(_,l){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.project(_,l,this._globalUniforms.checkExtent.value)}getExtent(_,l,n){this.visible===!0&&this._showLabel===!0&&this._label!==null?this._label.getExtent(_,l,n):n.push({x:null,y:null,width:null,height:null})}shuffleExtent(_,l,n){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.shuffleExtent(_,l,n)}_clampPointToSceneLimits(_,l){this._globalUniforms.clampToSceneLimits.value&&_.clamp(l.min,l.max)}_clampOffsetToSceneLimits(_,l){if(this._globalUniforms.clampToSceneLimits.value){this._computeBoundingBox();const n=this.geometry.boundingBox.min.clone().sub(l),r=this.geometry.boundingBox.max.clone().sub(l);n.clamp(_.min,_.max).sub(this.geometry.boundingBox.min).add(l),r.clamp(_.min,_.max).sub(this.geometry.boundingBox.max).add(l),l.sub(n).sub(r)}}_computeBoundingBox(){this.geometry.computeBoundingBox()}_computeBoundingSphere(){this.geometry.computeBoundingSphere()}dispose(){this.material.dispose(),this.geometry.dispose()}}},D,V),D.exports=B},2649:(D,V,f)=>{var R,B;R=[f(6127),f(4039)],B=f.dj.d(R,function(d,N){return class extends d{add(l,n,r,h,u,g,p){if(this._numObjects+=1,this._numObjects>this.objects.length){const y=this._newObject(u,this._annotationUniforms,g,p);this._scene.add(y),this.objects.push(y)}return this.objects[this._numObjects-1].setLabel(r),this.objects[this._numObjects-1].setPosition(l),this.objects[this._numObjects-1].setColor(h),this.objects[this._numObjects-1].setFaceAlpha(p),this.objects[this._numObjects-1].ID=u,this.objects[this._numObjects-1].setVisible(n),this._getObject(this._numObjects-1)}_newObject(l,n,r,h){return new N(l,n,h)}}},D,V),D.exports=B},4775:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.LineSegments{constructor(_){const l=new d.BufferGeometry,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=[1,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,1];l.setAttribute("position",new d.Float32BufferAttribute(n,3)),l.setAttribute("color",new d.Float32BufferAttribute(r,3));const h=new d.LineBasicMaterial({toneMapped:!1,transparent:!0,depthWrite:!1,depthTest:!1,opacity:.6,vertexColors:!0});super(l,h),this.type="Crosshair",this.visible=!1,this.pickable=!1,this._rawPosition=new d.Vector3,this._cleanPosition=new d.Vector3,this._color=new d.Color,this._boundingBox=_,this.setTheme(!0)}highlight(){this.material.opacity=1}show(){this.material.opacity=.6}hide(){this.material.opacity=.6}setTheme(_){const l=this.geometry.attributes.color.array;this._color.set(_===!1?12005676:16743028),this._color.toArray(l,0),this._color.toArray(l,3),this._color.set(_===!1?32787:9760644),this._color.toArray(l,6),this._color.toArray(l,9),this._color.set(_===!1?1463975:5551871),this._color.toArray(l,12),this._color.toArray(l,15),this.geometry.attributes.color.needsUpdate=!0}getPosition(){return this._cleanPosition.toArray()}setPosition(_){_.length>0?(this._rawPosition.fromArray(_,0),this.clamp(),this.visible=!0,this.pickable=!0):this.visible=!1}clamp(){this._boundingBox.clampPoint(this._rawPosition,this._cleanPosition);const _=this.geometry.attributes.position.array;_[0]=this._boundingBox.min.x,_[1]=this._cleanPosition.y,_[2]=this._cleanPosition.z,_[3]=this._boundingBox.max.x,_[4]=this._cleanPosition.y,_[5]=this._cleanPosition.z,_[6]=this._cleanPosition.x,_[7]=this._boundingBox.min.y,_[8]=this._cleanPosition.z,_[9]=this._cleanPosition.x,_[10]=this._boundingBox.max.y,_[11]=this._cleanPosition.z,_[12]=this._cleanPosition.x,_[13]=this._cleanPosition.y,_[14]=this._boundingBox.min.z,_[15]=this._cleanPosition.x,_[16]=this._cleanPosition.y,_[17]=this._boundingBox.max.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere()}raycast(_,l){if(this.visible&&this.pickable){const n=_.params.Line.threshold;_.params.Line.threshold=n*3,super.raycast(_,l),_.params.Line.threshold=n}}close(){}clear(){}remove(){this.visible=!1}applyQuaternion(){}applyTransformation(_,l,n,r,h,u,g){this._rawPosition.sub(g),this.clamp()}getLastMarker(){return this}}},D,V),D.exports=B},2297:(D,V,f)=>{var R,B;R=[f(3681),f(8486)],B=f.dj.d(R,function(d,N){return class extends d.LineSegments{constructor(l=0,n){const r=new d.BufferGeometry,h=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),u=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5];r.setIndex(new d.BufferAttribute(h,1)),r.setAttribute("position",new d.Float32BufferAttribute(u,3)),r.computeBoundingSphere();const g=new d.Color(16777215),p=new d.LineBasicMaterial({color:g,toneMapped:!1,transparent:!0,depthWrite:!1});super(r,p),this.type="Cuboid",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=l,this.color=g,this.pickable=n.pickable.value,this._reshape=!0,this._translate=!0,this._labelType="volume",this._globalUniforms=n,this._quaternion=new d.Quaternion,this._constructFace(),this._label=null,this._labelString=null}set movable(l){this._reshape=l,this._translate=l}get movable(){return this._reshape||this._translate}updateMatrixWorld(l){super.updateMatrixWorld(l),this._face.visible=this.visible}highlight(l,n){(this._reshape||this._translate)&&(this._face.ID=n,this.material.opacity=1,this._face.highlight())}show(){this.material.opacity=1,this._face.show()}hide(){this.material.opacity=0,this._face.hide()}highlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select")&&this.showLabel(),this._label!==null&&this._label.highlight()}unhighlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select"&&!this.selected)&&this.hideLabel(),this._setLabelColor()}select(l){this.selected===!0&&l===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this._globalUniforms.labelVisible.value==="select"&&this.showLabel(),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this._globalUniforms.labelVisible.value==="select"&&this.hideLabel(),this._setLabelColor()}getPosition(){const l=new Array(9);return this.position.toArray(l,0),this.scale.toArray(l,3),l[6]=this.rotation.x,l[7]=this.rotation.y,l[8]=this.rotation.z,l}setPosition(l){this.setSize(l.slice(3,6)),this.setRotation(l.slice(6,9)),this.setCenter(l.slice(0,3))}setLabel(l){switch(this._labelString=l,this._globalUniforms.labelVisible.value){case"on":this._constructLabel();break;case"off":case"hover":this._showLabel=!1,this.frustumCulled=!0;break;case"select":this.selected?this._constructLabel():(this._showLabel=!1,this.frustumCulled=!0)}}editLabel(l){this._label!==null&&this._label.edit(l)}stopEditing(l){return this._label!==null?this._label.stopEditing(l):!1}getLabel(){return this._label!==null?this._label.getLabel():null}showLabel(){this._constructLabel(),this.refreshLabel()}hideLabel(){this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null),this._showLabel=!1}setCenter(l){this.position.fromArray(l),this.refreshLabel()}setSize(l){this.scale.fromArray(l)}setRotation(l){this.rotation.fromArray(l)}setColor(l){this.color.fromArray(l),this.selected?this.material.color.copy(this._globalUniforms.selectedColor.value):this.material.color.fromArray(l),this._face.material.color=this.material.color,this._setLabelColor()}raycast(l,n){if(this.visible&&this.pickable&&(this._reshape||this._translate)){const r=[];this._face.raycast(l,r),r.length>0&&(r[0].index=Math.floor(r[0].faceIndex/2),r[0].object=this,n.push(r[0]))}}close(){}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null)}setVisible(l){if(l>0)switch(this.visible=!0,l){case 1:this._reshape=!0,this._translate=!0;break;case 2:this._reshape=!1,this._translate=!1;break;case 3:this._reshape=!0,this._translate=!1;break;case 4:this._reshape=!1,this._translate=!0;break}else this.visible=!1,this.selected=!1,this._reshape=!1,this._translate=!1;this._label!==null&&this._label.setVisibility(l>0)}applyQuaternion(l,n,r){this._face.applyQuaternion(l,n,r)}applyTransformation(l,n,r,h,u,g,p){this._face.applyTransformation(l,n,r,h,u,g,p)}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._label.measurement===!0&&this._label.setLabel(this.scale.x*this.scale.y*this.scale.z,this._globalUniforms.units.value),this._globalUniforms.checkExtent.value&&this._label.checkExtent())}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_constructLabel(){this._labelString===null?(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.measurement=!0,this._showLabel=!0):this._labelString===""?this.hideLabel():(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.setLabel(this._labelString,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0),this._showLabel&&this._globalUniforms.checkExtent.value&&this._label.checkExtent(),this.frustumCulled=!this._showLabel}_constructFace(){const l=[.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5];this._face=new N(0,this.material.color,l),this._face.matrixAutoUpdate=!1,this.add(this._face)}renderLabel(l,n){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.project(l,n)}getExtent(l,n,r){this.visible===!0&&this._showLabel===!0&&this._label!==null?this._label.getExtent(l,n,r):r.push({x:null,y:null,width:null,height:null})}shuffleExtent(l,n,r){}}},D,V),D.exports=B},4563:(D,V,f)=>{var R,B;R=[f(6127),f(2297)],B=f.dj.d(R,function(d,N){return class extends d{_newObject(l,n){return new N(l,n)}}},D,V),D.exports=B},7045:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.Mesh{constructor(_=0,l){const n=new d.CylinderGeometry(1,1,1,32),r=new d.Color(16777215),h=new d.MeshBasicMaterial({color:r,toneMapped:!1,transparent:!0,depthWrite:!1,side:d.FrontSide,opacity:.1}),u=new d.MeshBasicMaterial({color:r,toneMapped:!1,transparent:!0,depthWrite:!1,side:d.FrontSide,opacity:.1}),g=[h,u,u],p=new d.EdgesGeometry(n,30),y=new d.LineBasicMaterial({color:r,toneMapped:!1,transparent:!0,depthWrite:!1,opacity:1}),x=new d.LineSegments(p,y);super(n,g),this.add(x),this.rotation.x+=1.57,this.type="CropCylinder",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=_,this.color=r,this.pickable=l.pickable.value,this.movable=!0,this._labelType="volume",this._globalUniforms=l,this._quaternion=new d.Quaternion,this._interactionStarted=!0,this._initialDistance=0,this._initialDirection=new d.Vector2,this._previousEndPoint=new d.Vector2,this._scaleFactor=.03,this._label=null,this._labelString=null}updateMatrixWorld(_){super.updateMatrixWorld(_)}highlight(_,l,n){const r=n.normal.dot(new d.Vector3(0,1,0));Math.abs(r)/n.normal.length()>=.95?(this.material[0].opacity=.1,this.material[1].opacity=.2,this.material[2].opacity=.2):(this.material[0].opacity=.2,this.material[1].opacity=.1,this.material[2].opacity=.1),this.children[0].material.opacity=1}show(){this.material[0].opacity=.1,this.material[1].opacity=.1,this.material[2].opacity=.1,this.children[0].material.opacity=1,this._setLabelColor()}hide(){this.material[0].opacity=0,this.material[1].opacity=0,this.material[2].opacity=0,this.children[0].material.opacity=0}highlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select")&&this.showLabel(),this._label!==null&&this._label.highlight()}unhighlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select"&&!this.selected)&&this.hideLabel(),this._setLabelColor()}select(_){this.selected===!0&&_===!0?this.deselect():(this.selected=!0,this.material[0].color.copy(this._globalUniforms.selectedColor.value),this.material[1].color.copy(this._globalUniforms.selectedColor.value),this.material[2].color.copy(this._globalUniforms.selectedColor.value),this.children[0].material.color.copy(this._globalUniforms.selectedColor.value),this._globalUniforms.labelVisible.value==="select"&&this.showLabel(),this._setLabelColor())}deselect(){this.selected=!1,this.material[0].color.copy(this.color),this.material[1].color.copy(this.color),this.material[1].color.copy(this.color),this.children[0].material.color.copy(this.color),this._globalUniforms.labelVisible.value==="select"&&this.hideLabel(),this._setLabelColor()}getPosition(){return[this.position.x,this.position.y,this.position.z,this.scale.x,this.scale.y,this.scale.z,this.rotation.x,this.rotation.y,this.rotation.z]}setPosition(_){this.setSize(_.slice(3,6)),this.setRotation(_.slice(6,9)),this.setCenter(_.slice(0,3))}setLabel(_){switch(this._labelString=_,this._globalUniforms.labelVisible.value){case"on":this._constructLabel();break;case"off":case"hover":this._showLabel=!1,this.frustumCulled=!0;break;case"select":this.selected?this._constructLabel():(this._showLabel=!1,this.frustumCulled=!0)}}editLabel(_){this._label!==null&&this._label.edit(_)}stopEditing(_){return this._label!==null?this._label.stopEditing(_):!1}getLabel(){return this._label!==null?this._label.getLabel():null}showLabel(){this._constructLabel(),this.refreshLabel()}hideLabel(){this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null),this._showLabel=!1}setCenter(_){this.position.fromArray(_),this.refreshLabel()}setSize(_){this.scale.fromArray(_)}setRotation(_){this.rotation.fromArray(_)}setColor(_){this.color.fromArray(_),this.selected?(this.material[0].color.copy(this._globalUniforms.selectedColor.value),this.material[1].color.copy(this._globalUniforms.selectedColor.value),this.material[2].color.copy(this._globalUniforms.selectedColor.value),this.children[0].material.color.copy(this._globalUniforms.selectedColor.value)):(this.material[0].color.fromArray(_),this.material[1].color.fromArray(_),this.material[2].color.fromArray(_),this.children[0].material.color.fromArray(_)),this._setLabelColor()}raycast(_,l){this.visible&&this.pickable&&super.raycast(_,l)}close(){}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null)}applyQuaternion(){}onPointerDown(){this._interactionStarted=!0}onPointerUp(){this._interactionStarted=!1,this._initialDirection.set(0,0),this._previousEndPoint.set(0,0)}applyTransformation(_,l,n,r,h,u,g){if(l)this.position.sub(r);else{const p=u.normal.dot(new d.Vector3(0,1,0));if(Math.abs(p)/u.normal.length()>=.98){const x=this.position.clone(),w=x.clone().add(u.normal),M=new d.Matrix4;M.extractRotation(this.matrixWorld),w.applyMatrix4(M),x.applyMatrix4(M),w.project(n),x.project(n);const T=new d.Vector3;T.subVectors(w,x),T.setComponent(2,0).normalize(),_.y=-_.y;const A=_.dot(T),C=u.normal.clone();C.applyMatrix4(M).multiplyScalar(-A),C.divideScalar(2),this.position.sub(C),u.normal.dot(new d.Vector3(0,1,0))>0?C.copy(u.normal).multiplyScalar(-A):C.copy(u.normal).multiplyScalar(A),this.scale.sub(C)}else{const x=this.position.clone().project(n),w=new d.Vector2;w.x=(x.x+1)/2,w.y=1-(x.y+1)/2,this._interactionStarted&&(this._initialDistance=w.clone().sub(h.clone()),this._initialDirection=this._initialDistance.normalize(),this._interactionStarted=!1);const M=g.clone(),A=this._previousEndPoint.clone().sub(g.clone()).normalize();this._previousEndPoint.set(M.x,M.y),this._initialDirection.dot(A)<0?this.scale.set(this.scale.x*(1-this._scaleFactor),this.scale.y,this.scale.z*(1-this._scaleFactor)):this.scale.set(this.scale.x*(1+this._scaleFactor),this.scale.y,this.scale.z*(1+this._scaleFactor))}this.scale.x<0&&(this.scale.x=Number.EPSILON),this.scale.y<0&&(this.scale.y=Number.EPSILON),this.scale.z<0&&(this.scale.z=Number.EPSILON)}}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._label.measurement===!0&&this._label.setLabel(this.scale.x*this.scale.y*this.scale.z,this._globalUniforms.units.value),this._globalUniforms.checkExtent.value&&this._label.checkExtent())}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_constructLabel(){this._labelString===null?(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.measurement=!0,this._showLabel=!0):this._labelString===""?this.hideLabel():(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.setLabel(this._labelString,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0),this._showLabel&&this._globalUniforms.checkExtent.value&&this._label.checkExtent(),this.frustumCulled=!this._showLabel}renderLabel(_,l){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.project(_,l,this._globalUniforms.checkExtent.value)}getExtent(_,l,n){this.visible===!0&&this._showLabel===!0&&this._label!==null?this._label.getExtent(_,l,n):n.push({x:null,y:null,width:null,height:null})}shuffleExtent(_,l,n){}}},D,V),D.exports=B},2560:(D,V,f)=>{var R,B;R=[f(3681),f(3497)],B=f.dj.d(R,function(d,N){return class extends N{constructor(l=0,n){super(l,n,4),this._numPoints=2,this.type="Elevation";const r=new d.BufferGeometry;r.setAttribute("position",new d.Float32BufferAttribute(new Array(6).fill(0),3)),this._points.geometry=r}setPosition(l){const n=this._points.geometry.attributes.position.array,r=this.geometry.attributes.position.array,h=l[2]>l[5]?[l[0],l[1],l[5],l[0],l[1],l[2]]:[l[3],l[4],l[2],l[0],l[1],l[2]];for(let u=0;u<l.length;u++)n[u]=l[u],r[u]=l[u],r[u+l.length]=h[u];this._computeBoundingSphere(),this.geometry.attributes.position.needsUpdate=!0,this._points.geometry.attributes.position.needsUpdate=!0,this.refreshLabel()}applyTransformation(l,n,r,h,u,g,p){const y=this._points.ID;if(h||y<0)this.applyUniformTranslation(l,n,p);else{const x=this.geometry.attributes.position.array,w=this._points.geometry.attributes.position.array;x[y*3]=l.x,x[y*3+1]=l.y,x[y*3+2]=l.z,w[y*3]=l.x,w[y*3+1]=l.y,w[y*3+2]=l.z,x[2]>x[5]?(x[6]=x[0],x[7]=x[1],x[8]=x[5]):(x[6]=x[3],x[7]=x[4],x[8]=x[2]),x[9]=x[0],x[10]=x[1],x[11]=x[2],this.geometry.attributes.position.needsUpdate=!0,this._points.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}}applyUniformTranslation(l,n,r){const h=this.geometry.attributes.position.array,u=this._points.geometry.attributes.position.array;for(let g=0;g<h.length/3;g++)h[g*3]-=r.x,h[g*3+1]-=r.y,h[g*3+2]-=r.z;for(let g=0;g<u.length/3;g++)u[g*3]-=r.x,u[g*3+1]-=r.y,u[g*3+2]-=r.z;this.geometry.attributes.position.needsUpdate=!0,this._points.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}refreshLabel(){if(this._label!==null){let l;const n=this._points.geometry.attributes.position.array;n[2]>n[5]?(l=n[5]+(n[2]-n[5])/2,this._label.position.set(n[0],n[1],l)):(l=n[2]+(n[5]-n[2])/2,this._label.position.set(n[3],n[4],l)),this._label.measurement===!0&&this._label.setLabel(Math.abs(n[2]-n[5]),this._globalUniforms.units.value),this._globalUniforms.checkExtent.value&&this._label.checkExtent()}}_computeBoundingSphere(){this.geometry.computeBoundingSphere(),this._points.geometry.computeBoundingSphere()}}},D,V),D.exports=B},2218:(D,V,f)=>{var R,B;R=[f(6127),f(2560)],B=f.dj.d(R,function(d,N){return class extends d{_newObject(l,n){return new N(l,n)}}},D,V),D.exports=B},8486:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.Mesh{constructor(_,l,n){const r=new d.BufferGeometry;r.setAttribute("position",new d.Float32BufferAttribute(n,3)),r.computeBoundingSphere();const h=new d.MeshBasicMaterial({color:l,opacity:.05,transparent:!0,depthWrite:!1,side:d.FrontSide,toneMapped:!1});switch(super(r,h),this.type="Face",this.ID=_,this.normal=new d.Vector3,_){case 0:this.normal=new d.Vector3(1,0,0);break;case 1:this.normal=new d.Vector3(-1,0,0);break;case 2:this.normal=new d.Vector3(0,1,0);break;case 3:this.normal=new d.Vector3(0,-1,0);break;case 4:this.normal=new d.Vector3(0,0,1);break;case 5:this.normal=new d.Vector3(0,0,-1);break}}highlight(){this.material.opacity=.2,this.parent.highlightLabel()}show(){this.material.opacity=.05,this.parent.unhighlightLabel()}hide(){this.material.opacity=0}applyQuaternion(_,l,n){if(n==="none")return;this._updateFaceNormal();const r=new d.Euler;n!=="all"&&(r.setFromQuaternion(_),n==="x"?(r.y=0,r.z=0):n==="y"?(r.x=0,r.z=0):(r.x=0,r.y=0),_.setFromEuler(r));const h=new d.Quaternion,u=new d.Matrix4;if(u.extractRotation(this.parent.matrixWorld),h.setFromRotationMatrix(u),h.premultiply(_),l){switch(this.parent._quaternion.premultiply(_),r.setFromQuaternion(this.parent._quaternion),n){case"all":r.x=Math.round(r.x*(12/Math.PI))*(Math.PI/12),r.y=Math.round(r.y*(12/Math.PI))*(Math.PI/12),r.z=Math.round(r.z*(12/Math.PI))*(Math.PI/12);break;case"x":r.x=Math.round(r.x*(12/Math.PI))*(Math.PI/12);break;case"y":r.y=Math.round(r.y*(12/Math.PI))*(Math.PI/12);break;case"z":r.z=Math.round(r.z*(12/Math.PI))*(Math.PI/12);break}h.setFromEuler(r)}else this.parent._quaternion.copy(h);this.parent.setRotationFromQuaternion(h),this.parent.refreshLabel()}applyTransformation(_,l,n,r,h,u,g){if(this.parent.movable!==!1){if(this._updateFaceNormal(),this.normal.dot(u)>.98)this.parent.position.sub(g);else{const p=this.parent.position.clone(),y=p.clone().add(this.normal),x=new d.Matrix4;x.extractRotation(this.parent.matrixWorld),y.applyMatrix4(x),p.applyMatrix4(x),y.project(h),p.project(h);const w=new d.Vector3;w.subVectors(y,p),w.setComponent(2,0).normalize(),_.y=-_.y;const M=_.dot(w),T=this.normal.clone();T.applyMatrix4(x).multiplyScalar(-M),r||!this.parent._reshape?this.parent.position.sub(T):(T.divideScalar(2),this.parent.position.sub(T),this.ID===1||this.ID===3||this.ID===5?T.copy(this.normal).multiplyScalar(M):T.copy(this.normal).multiplyScalar(-M),this.parent.scale.sub(T),this.parent.scale.x<0&&(this.parent.scale.x=Number.EPSILON),this.parent.scale.y<0&&(this.parent.scale.y=Number.EPSILON),this.parent.scale.z<0&&(this.parent.scale.z=Number.EPSILON))}this.parent.refreshLabel()}}_updateFaceNormal(){switch(this.ID){case 0:this.normal.set(1,0,0);break;case 1:this.normal.set(-1,0,0);break;case 2:this.normal.set(0,1,0);break;case 3:this.normal.set(0,-1,0);break;case 4:this.normal.set(0,0,1);break;case 5:this.normal.set(0,0,-1);break}}}},D,V),D.exports=B},2980:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.Line{constructor(_=0,l,n=!0){const r=new d.BufferGeometry;r.setAttribute("position",new d.Float32BufferAttribute([],3)),r.computeBoundingSphere();const h=new d.Color(16777215),u=new d.LineBasicMaterial({color:h,toneMapped:!1,transparent:!1,depthTest:l.depthTest.value,depthWrite:!1});super(r,u),this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=_,this.color=h,this.pickable=l.pickable.value,this._globalUniforms=l,this._reshape=!0,this._translate=!0,this._label=null,this._labelString=null,this.type="Freehand",this._labelType="centeredArea",this.closed=n,this.hit=!1,this._hitIndex=-1,this._hitPoint=new d.Vector3,this._raycastLine=!0,this._length=0,this._bufferStep=200,this._reshapeLimits=new d.Vector2(-1,-1),this._updateReshapeLimits=!0}refreshLabel(){if(this._showLabel!==!1&&this._length>0&&this._label!==null){const _=this.geometry.getAttribute("position"),l=this._length;if(this._label.measurement===!0){let n=0;if(this.closed===!0){this._labelType="centeredArea",this._label.style="centeredArea";let r=0;if(l>2){for(let h=0;h<l;h++)r=(h+1)%l,n+=_.array[h*3]*_.array[r*3+1],n-=_.array[r*3]*_.array[h*3+1];n=Math.abs(n/2)}}else if(this._labelType="length",this._label.style="length",l>2)for(let r=1;r<l;r++)n+=Math.sqrt(_.array[r*3]*_.array[(r-1)*3]+_.array[r*3+1]*_.array[(r-1)*3+1]+_.array[r*3+2]*_.array[(r-1)*3+2]);this._label.setLabel(n,this._globalUniforms.units.value)}this.closed?this._label.position.copy(this.geometry.boundingSphere.center):this._label.position.fromArray(_.array)}}close(){if(this.closed){const _=this.geometry.attributes.position.array;_[this._length*3-3]=_[0],_[this._length*3-2]=_[1],_[this._length*3-1]=_[2],this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere()}this.refreshLabel()}addPoint(_,l,n){this._expandBuffer(),this._clampPointToSceneLimits(_,l);const r=this.geometry.attributes.position.array;if(this._length===0)this._length+=2;else if(this._length+=1,n){const h=new d.Vector3;h.fromArray(r,this._length*3-9),this._snapToAngle(_,h)}r[this._length*3-6]=_.x,r[this._length*3-5]=_.y,r[this._length*3-4]=_.z,r[this._length*3-3]=_.x,r[this._length*3-2]=_.y,r[this._length*3-1]=_.z,this.geometry.setDrawRange(0,this._length),this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}removePoint(){}follow(_,l,n,r){this._clampPointToSceneLimits(_,n);const h=this.geometry.attributes.position.array;if(r){const u=new d.Vector3;u.fromArray(h,this._length*3-6),this._snapToAngle(_,u)}h[this._length*3-3]=_.x,h[this._length*3-2]=_.y,h[this._length*3-1]=_.z,this.geometry.attributes.position.needsUpdate=!0,this.refreshLabel()}unfollow(){const _=this.geometry.attributes.position.array;_[this._length*3-3]=_[this._length*3-6],_[this._length*3-2]=_[this._length*3-5],_[this._length*3-1]=_[this._length*3-4],this.geometry.attributes.position.needsUpdate=!0,this.refreshLabel()}isLengthValid(){return this.closed===!0?this._length>3:this._length>2}highlight(_,l){(this._reshape||this._translate)&&(this.material.opacity=1,this.hit=!0,this._hitIndex!==l&&(this._updateReshapeLimits=!0),this._hitIndex=l,this._hitPoint.copy(_),this._globalUniforms.sharedMarker.value.display(this._hitPoint,this.color.toArray()),this.highlightLabel())}show(){this.material.opacity=1,this.hit=!1,this._hitIndex=-1,this._updateReshapeLimits=!0,this.unhighlightLabel()}hide(){this.material.opacity=0,this.hit=!1,this._hitIndex=-1,this._updateReshapeLimits=!0}highlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select")&&this.showLabel(),this._label!==null&&this._label.highlight()}unhighlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select"&&!this.selected)&&this.hideLabel(),this._setLabelColor()}select(_){this.selected===!0&&_===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this._globalUniforms.labelVisible.value==="select"&&this.showLabel(),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this._globalUniforms.labelVisible.value==="select"&&this.hideLabel(),this._setLabelColor()}setColor(_){this.color.fromArray(_),this.selected?this.material.color.copy(this._globalUniforms.selectedColor.value):this.material.color.fromArray(_),this._setLabelColor()}clear(){this._length=0,this._points.visible=!1,this.visible=!1}remove(){this.visible=!1,this.selected=!1,this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null)}setVisible(_){if(_>0)switch(this.visible=!0,_){case 1:this._reshape=!0,this._translate=!0;break;case 2:this._reshape=!1,this._translate=!1;break;case 3:this._reshape=!0,this._translate=!1;break;case 4:this._reshape=!1,this._translate=!0;break}else this.visible=!1,this.selected=!1,this._reshape=!1,this._translate=!1;this._label!==null&&this._label.setVisibility(_>0)}setLabel(_){switch(this._labelString=_,this._globalUniforms.labelVisible.value){case"on":this._constructLabel();break;case"off":case"hover":this._showLabel=!1,this.frustumCulled=!0;break;case"select":this.selected?this._constructLabel():(this._showLabel=!1,this.frustumCulled=!0)}}editLabel(_){this._label!==null&&this._label.edit(_)}stopEditing(_){return this._label!==null?this._label.stopEditing(_):!1}getLabel(){return this._label!==null?this._label.getLabel():null}showLabel(){this._constructLabel(),this.refreshLabel()}hideLabel(){this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null),this._showLabel=!1}raycast(_,l){if(this.visible&&this.pickable&&(this._reshape||this._translate)){const n=[];if(super.raycast(_,n),n.length>0){for(let r=0;r<n.length;r++)if(n[r].index+1<this._length){l.push(n[r]);return}}}}applyQuaternion(){}applyTransformation(_,l,n,r,h,u,g){const p=this.geometry.attributes.position.array;if(r||!this._reshape){if(!this._translate)return;this._clampOffsetToSceneLimits(l,g);for(let y=0;y<this._length;y++)p[y*3]-=g.x,p[y*3+1]-=g.y,p[y*3+2]-=g.z}else if(this._hitIndex>-1){this._updateReshapeLimits&&(this._updateReshapeLimits=!1,this._setReshapeLimits()),p[this._hitIndex*3]-=g.x,p[this._hitIndex*3+1]-=g.y,p[this._hitIndex*3+2]-=g.z,this._hitIndex===this._length-1?(p[0]-=g.x,p[1]-=g.y,p[2]-=g.z):(p[(this._hitIndex+1)*3]-=g.x,p[(this._hitIndex+1)*3+1]-=g.y,p[(this._hitIndex+1)*3+2]-=g.z);let y=this._hitIndex,x=0;const w=new d.Vector3,M=g.clone();for(;x<this._reshapeLimits.x;)y===0?y=this._length-1:y--,M.copy(g).multiplyScalar((this._reshapeLimits.x-1-x)/this._reshapeLimits.x),w.fromArray(p,y*3).sub(M),w.toArray(p,y*3),x++;for(x=0,y=this._hitIndex+1,this._hitIndex===this._length-1?y=0:y=this._hitIndex+1;x<this._reshapeLimits.y;)y===this._length-1?y=0:y++,M.copy(g).multiplyScalar((this._reshapeLimits.y-1-x)/this._reshapeLimits.y),w.fromArray(p,y*3).sub(M),w.toArray(p,y*3),x++;this.closed&&(p[this._length*3-3]=p[0],p[this._length*3-2]=p[1],p[this._length*3-1]=p[2]),this._clampGeometryToSceneLimits(l)}this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}_setReshapeLimits(){const _=this.geometry.attributes.position.array,l=this.geometry.boundingSphere.radius/2;let n=0,r=this._hitIndex-1,h=1;const u=this._length-1,g=new d.Vector3;for(this._reshapeLimits.set(Math.floor(u/2)-1,Math.ceil(u/2)),this._hitIndex===0?r=this._length-1:r=this._hitIndex-1;h<u;){if(r===0?r=this._length-1:r--,g.fromArray(_,r*3),n=g.distanceTo(this._hitPoint),n>l){this._reshapeLimits.x=h;break}h++}for(h=1,this._hitIndex===this._length-1?r=0:r=this._hitIndex+1;h<u;){if(r===this._length-1?r=0:r++,g.fromArray(_,r*3),n=g.distanceTo(this._hitPoint),n>l){this._reshapeLimits.y=h;break}h++}}getLastMarker(){return this}setPosition(_){this.closed?this._length=_.length/3+1:this._length=_.length/3;const l=new Array(this._length*3);for(let n=0;n<_.length;n++)l[n]=_[n];this.closed&&(l[this._length*3-3]=l[0],l[this._length*3-2]=l[1],l[this._length*3-1]=l[2]),this.geometry.setAttribute("position",new d.Float32BufferAttribute(l,3)),this._computeBoundingSphere(),this.refreshLabel()}getPosition(){const _=this.geometry.getAttribute("position"),l=new Array(this.closed?(this._length-1)*3:this._length*3);for(let n=0;n<l.length;n++)l[n]=_.array[n];return l}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_constructLabel(){this._labelString===null?(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.measurement=!0,this._showLabel=!0):this._labelString===""?this.hideLabel():(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.setLabel(this._labelString,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0),this._showLabel&&this._globalUniforms.checkExtent.value&&this._label.checkExtent(),this.frustumCulled=!this._showLabel}_expandBuffer(){if(this._length===0)this.geometry.setAttribute("position",new d.Float32BufferAttribute(new Float32Array(this._bufferStep*3),3));else if((this._length+1)*3>this.geometry.attributes.position.count){const _=new Float32Array((this._length+this._bufferStep)*3),l=this.geometry.attributes.position.array;_.set(l,0),this.geometry.setAttribute("position",new d.Float32BufferAttribute(_,3))}}renderLabel(_,l){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.project(_,l,this._globalUniforms.checkExtent.value)}getExtent(_,l,n){this.visible===!0&&this._showLabel===!0&&this._label!==null?this._label.getExtent(_,l,n):n.push({x:null,y:null,width:null,height:null})}shuffleExtent(_,l,n){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.shuffleExtent(_,l,n)}_clampPointToSceneLimits(_,l){this._globalUniforms.clampToSceneLimits.value&&_.clamp(l.min,l.max)}_clampOffsetToSceneLimits(_,l){if(this._globalUniforms.clampToSceneLimits.value){this._computeBoundingBox();const n=this.geometry.boundingBox.min.clone().sub(l),r=this.geometry.boundingBox.max.clone().sub(l);n.clamp(_.min,_.max).sub(this.geometry.boundingBox.min).add(l),r.clamp(_.min,_.max).sub(this.geometry.boundingBox.max).add(l),l.sub(n).sub(r)}}_snapToAngle(_,l){const n=_.distanceTo(l),r=new d.Vector3().subVectors(_,l).normalize(),h=12/Math.PI,u=new d.Spherical().setFromVector3(r);u.phi=Math.round(u.phi*h)/h,u.theta=Math.round(u.theta*h)/h,r.setFromSpherical(u).setLength(n),_.copy(l).add(r)}_clampGeometryToSceneLimits(_){if(this._globalUniforms.clampToSceneLimits.value){const l=this.geometry.attributes.position.array,n=new d.Vector3;for(let r=0;r<this._length;r++)n.fromArray(l,r*3),n.clamp(_.min,_.max),n.toArray(l,r*3)}}_computeBoundingSphere(){this.geometry.boundingSphere===null&&this.geometry.computeBoundingSphere();const _=this.geometry.attributes.position.array,l=new d.Box3,n=new d.Vector3;l.setFromArray(_.slice(0,this._length*3)),l.getCenter(this.geometry.boundingSphere.center);let r=0;for(let h=0;h<this._length;h++)n.fromArray(_,h*3),r=Math.max(r,this.geometry.boundingSphere.center.distanceToSquared(n));this.geometry.boundingSphere.radius=Math.sqrt(r)}_computeBoundingBox(){this.geometry.boundingBox===null&&(this.geometry.boundingBox=new d.Box3),this.geometry.boundingBox.makeEmpty();const _=this.geometry.attributes.position.array;this.geometry.boundingBox.setFromArray(_.slice(0,this._length*3))}dispose(){this.material.dispose(),this.geometry.dispose()}}},D,V),D.exports=B},614:(D,V,f)=>{var R,B;R=[f(6127),f(2980)],B=f.dj.d(R,function(d,N){return class extends d{_newObject(l,n,r){return new N(l,n,!0)}}},D,V),D.exports=B},8997:(D,V,f)=>{var R,B;R=[f(3681),f(6164)],B=f.dj.d(R,function(d,N){return class extends d.Line{constructor(l,n=0,r=16777215,h=16777215,u=0,g=0,p=1){l.normalize();const y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0,1,1,0,1,1,0],x=new d.BufferGeometry;x.setAttribute("position",new d.Float32BufferAttribute(y,3)),x.computeBoundingSphere();const w=new d.LineBasicMaterial({color:r,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1,opacity:g===1?.5:0});super(x,w),this.MODE={NONE:0,CLIPPING:1,SLICE:2},this.mode=g,this._lineGeometry=x,this._lineMaterial=w,this.type="InteractivePlane",this.plane=l,this.size=p,this.ID=n,this.sceneCenter=new d.Vector3,this._color=r,this._alternateColor=h,this._xColor=new d.Color(12005676),this._yColor=new d.Color(32787),this._zColor=new d.Color(1463975),this._xNormal=new d.Vector3(1,0,0),this._yNormal=new d.Vector3(0,1,0),this._zNormal=new d.Vector3(0,0,1),this._matrix=new d.Matrix4,this.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this._objectBoundingBox=new d.Box3,this._objectCenter=new d.Vector3,this._objectSize=1,this._boxEdges=[new d.Line3,new d.Line3,new d.Line3,new d.Line3,new d.Line3,new d.Line3,new d.Line3,new d.Line3,new d.Line3,new d.Line3,new d.Line3,new d.Line3],this._numVertices=4,this._vertices=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0,1,1,0],this._tempPlane=this.plane.clone(),this.pushPinVisible=!0;const M=new d.BufferGeometry;M.setAttribute("position",new d.Float32BufferAttribute(this._getDefaultFacePosition(),3)),M.computeBoundingSphere(),this._faceMaterial=new d.MeshBasicMaterial({color:this._color,opacity:this.mode===this.MODE.CLIPPING?.05:0,transparent:!0,depthTest:!1,depthWrite:!1,side:d.DoubleSide,toneMapped:!1}),this._faceGeometry=M,this._mesh=new d.Mesh(this._faceGeometry,this._faceMaterial),this._mesh.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this.add(this._mesh);const T=new d.BufferGeometry;T.setAttribute("position",new d.Float32BufferAttribute([0,0,0,0,0,-.5],3)),T.computeBoundingSphere(),this._normalGeometry=T,this._normalMaterial=new d.LineBasicMaterial({visible:!1,color:this._color,toneMapped:!1,transparent:!1,depthTest:!1,depthWrite:!1}),this._normalLine=new d.Line(T,this._normalMaterial),this._normalLine.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this.add(this._normalLine),this._addSphereGeometry(this._color),this.setColor(this._color,this._alternateColor,u)}updateMatrixWorld(l){if(this.visible){if(this.mode===this.MODE.CLIPPING){this.scale.set(.5*this.size,.5*this.size,.5*this.size);const n=this.plane.distanceToPoint(this.sceneCenter),r=this.plane.normal.clone();r.multiplyScalar(n),r.subVectors(this.sceneCenter,r),this.position.copy(r),this._sphere.position.set(0,0,-.5),this.lookAt(r.add(this.plane.normal))}else if(this.mode===this.MODE.SLICE)if(this.plane.intersectsBox(this._objectBoundingBox)){if(this._findIntersectionVertices(),this._setVertices(this._lineGeometry.attributes.position.array),this._lineGeometry.attributes.position.needsUpdate=!0,this._lineGeometry.applyMatrix4(this._matrix),this._lineGeometry.computeBoundingSphere(),this._faceGeometry.setAttribute("position",new d.Float32BufferAttribute(this._getFaceVertices(),3)),this._faceGeometry.applyMatrix4(this._matrix),this._faceGeometry.computeBoundingSphere(),this.pushPinVisible===!0){const n=this.plane.distanceToPoint(this._objectCenter),r=this.plane.normal.clone(),h=this.plane.normal.clone(),u=this.plane.normal.clone();r.multiplyScalar(n),r.subVectors(this._objectCenter,r);const g=this._matrix.clone();g.setPosition(0,0,0),u.applyMatrix4(g),h.multiplyScalar(.25*this._objectSize).divideScalar(u.length()),h.subVectors(r,h),this._objectBoundingBox.containsPoint(r)?(r.applyMatrix4(this._matrix),h.applyMatrix4(this._matrix),this._normalGeometry.attributes.position.array.set([r.x,r.y,r.z,h.x,h.y,h.z],0),this._normalGeometry.attributes.position.needsUpdate=!0,this._normalGeometry.computeBoundingSphere(),this._sphere.position.copy(h),this._sphere.visible=!0,this._normalLine.visible=!0):(this._sphere.visible=!1,this._normalLine.visible=!1)}}else this.hide();else return;super.updateMatrixWorld(l)}}raycast(l,n){if(this.visible){const r=[];this._mesh.raycast(l,r),this.pushPinVisible&&(this._sphere.raycast(l,r),this._normalLine.raycast(l,r)),Math.abs(l.ray.direction.dot(this.plane.normal))<.05&&super.raycast(l,r),r.length>0&&(r[0].object=this,n.push(r[0]))}}setColor(l,n,r){this._color=l,this._alternateColor=n,this._xColor.set(r<.7||r>2?12005676:16743028),this._yColor.set(r<.7||r>2?32787:9760644),this._zColor.set(r<.7||r>2?1463975:5551871),this._setColor()}setPlane(l){l.normalize(),!(this.mode===this.MODE.SLICE&&!l.intersectsBox(this._objectBoundingBox))&&(this._tempPlane.copy(l),this.plane=l,this._setColor())}setMode(l){this.mode=l,this.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this._mesh.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this._normalLine.matrixAutoUpdate=this.mode!==this.MODE.SLICE,this.mode===this.MODE.CLIPPING?(this._setDefaultLinePosition(this._lineGeometry.attributes.position.array),this._lineGeometry.attributes.position.needsUpdate=!0,this._lineGeometry.computeBoundingSphere(),this._faceGeometry.setAttribute("position",new d.Float32BufferAttribute(this._getDefaultFacePosition(),3)),this._faceGeometry.computeBoundingSphere(),this._normalGeometry.attributes.position.array.set([0,0,0,0,0,-.5],0),this._normalGeometry.attributes.position.needsUpdate=!0,this._normalGeometry.computeBoundingSphere()):this.mode===this.MODE.SLICE?(this.matrix.identity(),this._setVertices(this._lineGeometry.attributes.position.array),this._lineGeometry.attributes.position.needsUpdate=!0,this._lineGeometry.computeBoundingSphere(),this._faceGeometry.setAttribute("position",new d.Float32BufferAttribute(this._getFaceVertices(),3)),this._faceGeometry.computeBoundingSphere(),this.scale.set(1,1,1),this.position.set(0,0,0),this.lookAt(0,1,0),this.matrix.identity(),this.matrixWorldNeedsUpdate=!0):this.visible=!1}setBoundingBox(l){l.getCenter(this._objectCenter),l.min.subScalar(1e-10),l.max.addScalar(1e-10),this._objectBoundingBox.copy(l),this._setBoundingBoxEdges()}applyMatrix(l){if(this.mode===this.MODE.SLICE){this._matrix.copy(l);const n=this._objectBoundingBox.clone(),r=new d.Vector3;n.applyMatrix4(this._matrix).getSize(r),this._objectSize=r.length()}}show(){this.mode===this.MODE.CLIPPING?this._setOpacity(.05,.5,0,!1):this._setOpacity(0,0,0,!1)}hide(){this._setOpacity(0,0,0,!1)}highlight(){this.mode===this.MODE.CLIPPING?this._setOpacity(.1,1,.5,this.pushPinVisible):this._setOpacity(.05,1,.5,this.pushPinVisible)}select(){}applyTransformation(l,n,r,h,u){const g=this.position.clone(),p=g.clone().add(this.plane.normal);this.mode===this.MODE.SLICE&&(p.applyMatrix4(this._matrix),g.applyMatrix4(this._matrix)),p.project(u),g.project(u);const y=new d.Vector3;y.subVectors(p,g),y.setComponent(2,0).normalize(),l.y=-l.y;let x=-l.dot(y);if(this.mode===this.MODE.SLICE){this._tempPlane.copy(this.plane);const w=new d.Vector4(this._tempPlane.normal.x,this._tempPlane.normal.y,this._tempPlane.normal.z,0);w.applyMatrix4(this._matrix);const M=new d.Vector3(w.x,w.y,w.z),T=M.dot(M);x=x/T,T>1.01&&(x*=1.5),this._tempPlane.constant=this._tempPlane.constant+x,this._tempPlane.intersectsBox(this._objectBoundingBox)?this.plane.copy(this._tempPlane):this._tempPlane.copy(this.plane)}else this.plane.constant=this.plane.constant+x}applyQuaternion(l,n){const r=this._tempPlane.normal.clone(),h=this.plane.clone();r.applyQuaternion(l),r.normalize();const u=this.plane.normal.clone();if(this.mode===this.MODE.SLICE){const g=this.plane.distanceToPoint(this._objectCenter);u.multiplyScalar(g),u.subVectors(this._objectCenter,u),this._tempPlane.setFromNormalAndCoplanarPoint(r,u)}else this._tempPlane.setFromNormalAndCoplanarPoint(r,this.position);this._tempPlane.normalize(),this.plane.copy(this._tempPlane),n&&(this._snapToAngle(r),this.mode===this.MODE.SLICE?this.plane.setFromNormalAndCoplanarPoint(r,u):this.plane.setFromNormalAndCoplanarPoint(r,this.position),this.plane.normalize()),this.mode===this.MODE.SLICE&&(this.plane.intersectsBox(this._objectBoundingBox)||(this.plane.copy(h),this._tempPlane.copy(h))),this._setColor()}_setOpacity(l,n,r,h){this._faceMaterial.opacity=l,this._lineMaterial.opacity=n,this._sphereMaterial.uniforms.alpha.value=r,this._sphereMaterial.visible=h,this._normalMaterial.visible=h}_setColor(){let l=this.mode===this.MODE.SLICE?this._alternateColor:this._color;Math.abs(this.plane.normal.dot(this._xNormal))===1?l=this._xColor:Math.abs(this.plane.normal.dot(this._yNormal))===1?l=this._yColor:Math.abs(this.plane.normal.dot(this._zNormal))===1&&(l=this._zColor),this._lineMaterial.color=l,this._faceMaterial.color=l,this._normalMaterial.color=l,this._sphereMaterial.uniforms.color.value=l,this._sphereMaterial.uniforms.edgeColor.value=l}_getVertices(){const l=new Float32Array(21);return this._setVertices(l)}_setVertices(l){for(let n=0;n<this._numVertices*3;n++)l[n]=this._vertices[n];for(let n=0;n<7-this._numVertices;n++)l[n*3+this._numVertices*3]=this._vertices[0],l[n*3+this._numVertices*3+1]=this._vertices[1],l[n*3+this._numVertices*3+2]=this._vertices[2];return l}_getFaceVertices(){const l=this._getVertices();return[l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[6],l[7],l[8],l[9],l[10],l[11],l[12],l[13],l[14],l[12],l[13],l[14],l[15],l[16],l[17],l[18],l[19],l[20],l[0],l[1],l[2],l[6],l[7],l[8],l[12],l[13],l[14]]}_findIntersectionVertices(){this._numVertices=0;const l=new d.Vector3,n=new Float32Array(18);for(let r=0;r<12;r++)this.plane.intersectsLine(this._boxEdges[r])&&(this.plane.intersectLine(this._boxEdges[r],l),n[this._numVertices*3]=l.x,n[this._numVertices*3+1]=l.y,n[this._numVertices*3+2]=l.z,this._numVertices=this._numVertices+1);this._vertices=this._sortVertices(n)}_sortVertices(l){const n=this.plane.distanceToPoint(this._objectCenter),r=this.plane.normal.clone();r.multiplyScalar(n),r.subVectors(this._objectCenter,r);const h=new d.Vector3(1,0,0),u=new d.Vector3(0,1,0),g=new d.Vector3(0,0,1),p=new d.Vector3,y=new d.Vector3,x=new d.Vector3,w=new d.Vector3,M=new d.Vector3,T=new d.Vector3,A=new d.Vector3,C=h.cross(this.plane.normal).lengthSq(),z=u.cross(this.plane.normal).lengthSq(),H=g.cross(this.plane.normal).lengthSq();C>z?C>H?p.copy(h):p.copy(g):z>H?p.copy(u):p.copy(g),y.crossVectors(this.plane.normal,p);const q=new Float32Array(this._numVertices),P=new Float32Array(this._numVertices*3);for(let K=0;K<this._numVertices;K++)M.set(l[K*3],l[K*3+1],l[K*3+2]),q[K]=Math.atan2(this.plane.normal.dot(w.crossVectors(T.subVectors(M,r),y)),this.plane.normal.dot(x.crossVectors(A.subVectors(M,r),p)))*180/Math.PI;const Z=Array.from(Array(q.length).keys()).sort((K,Y)=>q[K]<q[Y]?-1:q[Y]<q[K]|0);for(let K=0;K<this._numVertices;K++)P[K*3]=l[Z[K]*3],P[K*3+1]=l[Z[K]*3+1],P[K*3+2]=l[Z[K]*3+2];return P}_addSphereGeometry(l){const n=new d.BufferGeometry,r=[0,0,0];n.setAttribute("position",new d.Float32BufferAttribute(r,3)),n.computeBoundingSphere();const h=N,u=d.UniformsUtils.clone(h.uniforms);u.edgeColor.value=l,u.color.value=l,u.pointSize.value=10,this._sphereMaterial=new d.ShaderMaterial({visible:!1,transparent:!0,fog:!1,depthTest:!1,depthWrite:!1,uniforms:u,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}),this._sphere=new d.Points(n,this._sphereMaterial),this.add(this._sphere)}_snapToAngle(l){const n=[0,0,1,0,0,-1,1,0,0,-1,0,0,0,1,0,0,-1,0,.5774,.5774,.5774,-.5774,-.5774,-.5774,.5774,-.5774,.5774,-.5774,.5774,-.5774,.5774,.5774,-.5774,-.5774,-.5774,.5774,-.5774,.5774,.5774,.5774,-.5774,-.5774,.7071,-.7071,0,-.7071,.7071,0,0,.7071,-.7071,0,-.7071,.7071,-.7071,0,.7071,.7071,0,-.7071,.7071,.7071,0,-.7071,-.7071,0,.7071,0,.7071,-.7071,0,-.7071,0,.7071,.7071,0,-.7071,-.7071],r=l.x,h=l.y,u=l.z;let g=0,p=0,y=0;for(let x=0;x<26;x++)y=r*n[x*3]+h*n[x*3+1]+u*n[x*3+2],y>g&&(g=y,p=x);l.set(n[p*3],n[p*3+1],n[p*3+2]).normalize()}_setBoundingBoxEdges(){this._boxEdges[0].start=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[0].end=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[1].start=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[1].end=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[2].start=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[2].end=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[3].start=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z),this._boxEdges[3].end=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z),this._boxEdges[4].start=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[4].end=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[5].start=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[5].end=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[6].start=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[6].end=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z),this._boxEdges[7].start=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[7].end=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z),this._boxEdges[8].start=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[8].end=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[9].start=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.min.z),this._boxEdges[9].end=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.min.y,this._objectBoundingBox.max.z),this._boxEdges[10].start=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[10].end=new d.Vector3(this._objectBoundingBox.min.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z),this._boxEdges[11].start=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.min.z),this._boxEdges[11].end=new d.Vector3(this._objectBoundingBox.max.x,this._objectBoundingBox.max.y,this._objectBoundingBox.max.z)}_getDefaultFacePosition(){return[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0]}_setDefaultLinePosition(l){return l.set([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0,1,1,0,1,1,0],0)}}},D,V),D.exports=B},9271:(D,V,f)=>{var R,B;R=[f(3681),f(9032)],B=f.dj.d(R,function(d,N){return class extends d.EventDispatcher{constructor(l){super(),this._labels=[],this._numLabelsInUse=0,this._annotationUniforms=l,this._numberFormats={basicFormat:new Intl.NumberFormat(navigator.language,{trailingZeroDisplay:"stripIfInteger"}),slimFormat:new Intl.NumberFormat(navigator.language,{trailingZeroDisplay:"stripIfInteger",maximumFractionDigits:1})}}clear(){this._numLabelsInUse=0;for(let l=0;l<this._labels.length;l++)this._labels[l].clear()}getLabel(l){if(this._numLabelsInUse+=1,this._numLabelsInUse>this._labels.length)return this._newLabel(l);for(let n=0;n<this._labels.length;n++)if(this._labels[n].inPool){const r=this._labels[n];return r.inPool=!1,r.style=l,r}}returnLabel(l){this._numLabelsInUse-=1,l.clear()}_newLabel(l){const n=new N(l,this._annotationUniforms.container.value,this._annotationUniforms.isDarkTheme.value,this._numberFormats);return n.inPool=!1,this._labels.push(n),n}setTheme(l){for(let n=0;n<this._labels.length;n++)this._labels[n].setTheme(l)}}},D,V),D.exports=B},3497:(D,V,f)=>{var R,B;R=[f(3681),f(9721)],B=f.dj.d(R,function(d,N){return class extends d.Line{constructor(l=0,n,r=2){const h=new d.BufferGeometry,u=new Array(r*3).fill(0);h.setAttribute("position",new d.Float32BufferAttribute(u,3)),h.computeBoundingSphere();const g=new d.Color(16777215),p=new d.LineBasicMaterial({color:g,toneMapped:!1,transparent:!1,depthTest:n.depthTest.value,depthWrite:!1});super(h,p),this.type="Line",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=l,this.color=g,this.pickable=n.pickable.value,this._labelType="distance",this._globalUniforms=n,this._raycastLine=!1,this._reshape=!0,this._translate=!0,this._numPoints=0,this._points=new N(0,this._globalUniforms,"circle",h),this._points.material.uniforms.color.value=this.material.color,this._points.visible=!0,this.add(this._points),this._label=null,this._labelString=null}updateMatrixWorld(l){super.updateMatrixWorld(l),this._points.visible=this.visible&&this.pickable}highlight(l,n){(this._reshape||this._translate)&&(this.material.opacity=1,this._points.ID=n,this._points.highlight())}show(){this.material.opacity=1,this._points.show()}hide(){this.material.opacity=0,this._points.hide()}highlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select")&&this.showLabel(),this._label!==null&&this._label.highlight()}unhighlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select"&&!this.selected)&&this.hideLabel(),this._setLabelColor()}select(l){this.selected===!0&&l===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this._globalUniforms.labelVisible.value==="select"&&this.showLabel(),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this._globalUniforms.labelVisible.value==="select"&&this.hideLabel(),this._setLabelColor()}getPosition(){const l=new Array(this._numPoints*3),n=this._points.geometry.attributes.position.array;for(let r=0;r<l.length;r++)l[r]=n[r];return l}close(){if(this._numPoints<=1)return;const l=this._points.geometry.attributes.position.array;this._numPoints!==l.length/3&&(this._numPoints===2?(l[l.length-3]=l[0],l[l.length-2]=l[1],l[l.length-1]=l[2]):(l[l.length-3]=l[l.length-6],l[l.length-2]=l[l.length-5],l[l.length-1]=l[l.length-4]),this._points.geometry.attributes.position.needsUpdate=!0,this.refreshLabel())}clear(){this._numPoints=0,this._points.visible=!1,this.visible=!1}remove(){this.visible=!1,this.selected=!1,this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null)}setVisible(l){if(l>0)switch(this.visible=!0,l){case 1:this._reshape=!0,this._translate=!0;break;case 2:this._reshape=!1,this._translate=!1;break;case 3:this._reshape=!0,this._translate=!1;break;case 4:this._reshape=!1,this._translate=!0;break}else this.visible=!1,this.selected=!1,this._reshape=!1,this._translate=!1;this._label!==null&&this._label.setVisibility(l>0)}setLabel(l){switch(this._labelString=l,this._globalUniforms.labelVisible.value){case"on":this._constructLabel();break;case"off":case"hover":this._showLabel=!1,this.frustumCulled=!0;break;case"select":this.selected?this._constructLabel():(this._showLabel=!1,this.frustumCulled=!0)}}editLabel(l){this._label!==null&&this._label.edit(l)}stopEditing(l){return this._label!==null?this._label.stopEditing(l):!1}getLabel(){return this._label!==null?this._label.getLabel():null}showLabel(){this._constructLabel(),this.refreshLabel()}hideLabel(){this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null),this._showLabel=!1}setPosition(l){this._numPoints=l.length/3;const n=this._points.geometry.attributes.position.array;for(let r=0;r<l.length;r++)n[r]=l[r];this._points.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}setColor(l){this.color.fromArray(l),this.selected?this.material.color.copy(this._globalUniforms.selectedColor.value):this.material.color.fromArray(l),this._setLabelColor()}raycast(l,n){if(this.visible&&this.pickable&&(this._reshape||this._translate)){const r=[];if(this._points.raycastForced(l,r),r.length>0)r[0].object=this,n.push(r[0]);else if(super.raycast(l,r),r.length>0)for(let h=0;h<r.length;h++)r[h].index<this._numPoints-1&&(r[0].index=-1,n.push(r[0]))}}applyQuaternion(){}applyTransformation(l,n,r,h,u,g,p){const y=this._points.ID;if(h||y<0||!this._reshape)this.applyUniformTranslation(l,n,p);else{this._clampPointToSceneLimits(l,n);const x=this._points.geometry.attributes.position.array;if(y===this._numPoints-1){if(r){const w=new d.Vector3;w.fromArray(x,(y-1)*3),this._snapToAngle(l,w)}x[(y+1)*3]=l.x,x[(y+1)*3+1]=l.y,x[(y+1)*3+2]=l.z}else if(y===0&&r){const w=new d.Vector3;w.fromArray(x,3),this._snapToAngle(l,w)}x[y*3]=l.x,x[y*3+1]=l.y,x[y*3+2]=l.z,this._points.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}}applyUniformTranslation(l,n,r){if(!this._translate)return;this._clampOffsetToSceneLimits(n,r);const h=this._points.geometry.attributes.position.array;for(let u=0;u<h.length/3;u++)h[u*3]-=r.x,h[u*3+1]-=r.y,h[u*3+2]-=r.z;this._points.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}refreshLabel(){if(this._showLabel!==!1&&this._label!==null){const l=this.geometry.attributes.position.array;if(this._numPoints>1){const n=new d.Vector3().fromArray(l,3);if(this._label.position.fromArray(l,0).add(n).divideScalar(2),this._label.measurement===!0){let r=0;for(let h=3;h<l.length;h+=3){const u=l[h]-l[h-3],g=l[h+1]-l[h-2],p=l[h+2]-l[h-1];r+=Math.sqrt(u*u+g*g+p*p)}this._label.setLabel(r,this._globalUniforms.units.value)}}else this._label.position.fromArray(l,0),this._label.measurement===!0&&this._label.setLabel(0,this._globalUniforms.units.value);this._globalUniforms.checkExtent.value&&this._label.checkExtent()}}getLastMarker(){return this._points.ID=this._numPoints-1,this}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_constructLabel(){this._labelString===null?(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.measurement=!0,this._showLabel=!0):this._labelString===""?this.hideLabel():(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.setLabel(this._labelString,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0),this._showLabel&&this._globalUniforms.checkExtent.value&&this._label.checkExtent(),this.frustumCulled=!this._showLabel}renderLabel(l,n){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.project(l,n,this._globalUniforms.checkExtent.value)}getExtent(l,n,r){this.visible===!0&&this._showLabel===!0&&this._label!==null?this._label.getExtent(l,n,r):r.push({x:null,y:null,width:null,height:null})}shuffleExtent(l,n,r){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.shuffleExtent(l,n,r)}_clampPointToSceneLimits(l,n){this._globalUniforms.clampToSceneLimits.value&&l.clamp(n.min,n.max)}_clampOffsetToSceneLimits(l,n){if(this._globalUniforms.clampToSceneLimits.value){this._computeBoundingBox();const r=this.geometry.boundingBox.min.clone().sub(n),h=this.geometry.boundingBox.max.clone().sub(n);r.clamp(l.min,l.max).sub(this.geometry.boundingBox.min).add(n),h.clamp(l.min,l.max).sub(this.geometry.boundingBox.max).add(n),n.sub(r).sub(h)}}_snapToAngle(l,n){const r=l.distanceTo(n),h=new d.Vector3().subVectors(l,n).normalize(),u=12/Math.PI,g=new d.Spherical().setFromVector3(h);g.phi=Math.round(g.phi*u)/u,g.theta=Math.round(g.theta*u)/u,h.setFromSpherical(g).setLength(r),l.copy(n).add(h)}_computeBoundingBox(){this.geometry.computeBoundingBox()}_computeBoundingSphere(){this.geometry.computeBoundingSphere()}dispose(){this.material.dispose(),this.geometry.dispose(),this._points.dispose()}}},D,V),D.exports=B},1571:(D,V,f)=>{var R,B;R=[f(6127),f(3497)],B=f.dj.d(R,function(d,N){return class extends d{_newObject(l,n){return new N(l,n,2)}}},D,V),D.exports=B},9721:(D,V,f)=>{var R,B;R=[f(3681),f(6164)],B=f.dj.d(R,function(d,N){return class extends d.Points{constructor(l=0,n,r="circle",h=null){h===null&&(h=new d.BufferGeometry,h.setAttribute("position",new d.Float32BufferAttribute([0,0,0],3))),h.computeBoundingSphere();const u=N,g=d.UniformsUtils.clone(u.uniforms);g.edgeColor.value=n.edgeColor.value,g.pointSize.value=n.pointSize.value;const p=new d.ShaderMaterial({transparent:!0,fog:!1,depthTest:!1,depthWrite:!1,defines:r==="circle"?{}:{SQUARE_MARKER:1},uniforms:g,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader});super(h,p),this.type="Marker",this.visible=!1,this._showLabel=!1,this.selected=!1,this.color=new d.Color(16777215),this.ID=l,this._globalUniforms=n,this.pickable=!0,this._translate=!0,this._label=null,this._labelString=null}raycast(l,n){this.visible&&this.pickable&&this._translate&&this.raycastForced(l,n)}raycastForced(l,n){if(l.camera.type==="PerspectiveCamera"){const r=l.params.Points.threshold;l.params.Points.threshold=r*l.camera.position.distanceTo(this.position),super.raycast(l,n),l.params.Points.threshold=r}else super.raycast(l,n)}highlight(){this.material.opacity=1,this.material.uniforms.pointSize.value=this._globalUniforms.pointSizeHighlighted.value,this.highlightLabel()}show(){this.material.opacity=1,this.material.uniforms.pointSize.value=this._globalUniforms.pointSize.value,this.unhighlightLabel()}hide(){this.material.opacity=0}highlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select")&&this.showLabel(),this._label!==null&&this._label.highlight()}unhighlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select"&&!this.selected)&&this.hideLabel(),this._setLabelColor()}display(l,n){this.position.copy(l),this.setColor(n),this.material.uniforms.interactive.value=0,this.visible=!0}select(l){this.selected===!0&&l===!0?this.deselect():(this.selected=!0,this.material.uniforms.color.value.copy(this._globalUniforms.selectedColor.value),this._globalUniforms.labelVisible.value==="select"&&this.showLabel(),this._setLabelColor(),this._label!==null&&this._label.highlight())}deselect(){this.selected=!1,this.material.uniforms.color.value.copy(this.color),this._globalUniforms.labelVisible.value==="select"&&this.hideLabel(),this._setLabelColor()}getPosition(){return this.position.toArray()}onPointerDown(){this.material.uniforms.interactive.value=1}onPointerUp(){this.material.uniforms.interactive.value=0}setPosition(l){this.position.fromArray(l),this.refreshLabel()}setColor(l){this.color.fromArray(l),this.selected?this.material.uniforms.color.value.copy(this._globalUniforms.selectedColor.value):this.material.uniforms.color.value.fromArray(l),this._setLabelColor()}setLabel(l){switch(this._labelString=l,this._globalUniforms.labelVisible.value){case"on":this._constructLabel();break;case"off":case"hover":this._showLabel=!1,this.frustumCulled=!0;break;case"select":this.selected?this._constructLabel():(this._showLabel=!1,this.frustumCulled=!0)}}editLabel(l){this._label!==null&&this._label.edit(l)}stopEditing(l){return this._label!==null?this._label.stopEditing(l):!1}getLabel(){return this._label!==null?this._label.getLabel():null}showLabel(){this._constructLabel(),this.refreshLabel()}hideLabel(){this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null),this._showLabel=!1}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null)}setVisible(l){l>0?(this.visible=!0,l===1||l===4?this._translate=!0:this._translate=!1):(this.visible=!1,this.selected=!1,this._translate=!1),this._label!==null&&this._label.setVisibility(l>0)}applyQuaternion(){}applyTransformation(l,n,r,h,u,g,p){this._translate&&(h?this.position.sub(p):this.position.copy(l),this._clampPointToSceneLimits(this.position,n),this.refreshLabel())}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._label.measurement===!0&&this._label.setLabel(this.position,this._globalUniforms.units.value,this._globalUniforms.is3D.value),this._globalUniforms.checkExtent.value&&this._label.checkExtent())}getLastMarker(){return this}close(){}_clampPointToSceneLimits(l,n){this._globalUniforms.clampToSceneLimits.value&&l.clamp(n.min,n.max)}_constructLabel(){this._labelString===null?(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel("location"),this._label.setColor(this.material.uniforms.color.value)),this._label.measurement=!0,this._showLabel=!0):this._labelString===""?this.hideLabel():(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel("location"),this._label.setColor(this.material.uniforms.color.value)),this._label.setLabel(this._labelString,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0),this._showLabel&&this._globalUniforms.checkExtent.value&&this._label.checkExtent(),this.frustumCulled=!this._showLabel}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.uniforms.color.value),this._label.show(this.selected))}renderLabel(l,n){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.project(l,n,this._globalUniforms.checkExtent.value)}getExtent(l,n,r){this.visible===!0&&this._showLabel===!0&&this._label!==null?this._label.getExtent(l,n,r):r.push({x:null,y:null,width:null,height:null})}shuffleExtent(l,n,r){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.shuffleExtent(l,n,r)}dispose(){this.material.dispose(),this.geometry.dispose()}}},D,V),D.exports=B},6164:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return{uniforms:{pointSize:{value:8},edgeWidth:{value:4},color:{value:new d.Color},alpha:{value:1},edgeColor:{value:new d.Color},edgeAlpha:{value:.8},interactive:{value:0}},vertexShader:`
        uniform float edgeWidth;
        uniform float pointSize;

        void main() {
            vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
            gl_PointSize = (pointSize + edgeWidth);
            gl_Position = projectionMatrix * mvPosition;
        }`,fragmentShader:`
        uniform vec3 color;
        uniform vec3 edgeColor;
        uniform float edgeWidth;
        uniform float pointSize;
        uniform float alpha;
        uniform float edgeAlpha;
        uniform float interactive;

        void main() {
            #ifdef SQUARE_MARKER
                vec2 coord = 2.0 * gl_PointCoord - 1.0;
                float dist = max(abs(coord.x),abs(coord.y));
            #else
                float dist = length(2.0 * gl_PointCoord - 1.0);
            #endif
            float totalWidth = pointSize + edgeWidth;
            float edgeStart = pointSize;
            float edgeMid = pointSize + (edgeWidth / 2.0);
            float edgeEnd = pointSize + edgeWidth;

            // Interpolate transitions from color to edgeColor and to transparency at edge
            float sEdge = smoothstep(edgeStart, edgeMid, dist * totalWidth);
            float sAlpha = smoothstep(edgeMid, edgeEnd, dist * totalWidth);

            // Transition from edgeColor to color along the edge
            float insideAlpha =  (1.0 - interactive) * alpha * (1.0 - sEdge);
            float outsideAlpha = ((1.0 - interactive) * (1.0 - sAlpha) * edgeAlpha) + (interactive * (1.0 - sAlpha) * edgeAlpha * sEdge);

            // Premultiply before blending
            vec3 outsideColor = mix(edgeColor,color,interactive) * outsideAlpha;
            vec3 insideColor = color * insideAlpha;

            // Blend colors
            gl_FragColor.a = insideAlpha + outsideAlpha * (1.0 - insideAlpha);
            gl_FragColor.rgb = insideColor + outsideColor * (1.0 - insideAlpha);

            // Correct premultiplied alpha
            gl_FragColor.rgb = gl_FragColor.rgb / gl_FragColor.a;
        }`}},D,V),D.exports=B},5039:(D,V,f)=>{var R,B;R=[f(3681),f(8997)],B=f.dj.d(R,function(d,N){return class{constructor(l,n){this.enabled=!0,this.STATE={NONE:0,CLIPPING:1,SLICE:2},this.state=this.STATE.NONE,this._visible=!1,this._matrix=new d.Matrix4,this._clippingEnabled={add:!1,remove:!1,rotate:!1,translate:!1},this._sliceEnabled={add:!1,remove:!1,rotate:!1,translate:!1},this._sliceAllowed=!1,this._scene=l,this._planes=[],this._planeData=[],this._sliceData=[],this.numPlanes=0,this._color=new d.Color(1,1,1),this._alternateColor=new d.Color(.8,.8,.8),this._colorSum=0,this._size=1,this._sceneCenter=new d.Vector3,this.enableAdd=!1,this.enableRemove=!1,this.enableRotate=!1,this.enableTranslate=!1,this._objectBoundingBox=new d.Box3,this._scene.matrixAutoUpdate=!1,this.updateInteractions(n.Clipping,n.Slice,!1)}updateInteractions(l,n,r){this._clippingEnabled.add=l.Add,this._clippingEnabled.remove=l.Remove,this._clippingEnabled.rotate=l.Rotate,this._clippingEnabled.translate=l.Translate,this._sliceEnabled.add=n.Add,this._sliceEnabled.remove=n.Remove,this._sliceEnabled.rotate=n.Rotate,this._sliceEnabled.translate=n.Translate,r&&this._updateState()}enable(){if(this._visible&&(this.enableAdd||this.enableRemove||this.enableRotate||this.enableTranslate)){this.enabled=this.numPlanes>0;for(let l=0;l<this.numPlanes;l++)this._planes[l].visible=!0}else this.disable()}disable(){if(this.enabled){this.enabled=!1;for(let l=0;l<this._planes.length;l++)this._planes[l].visible=!1}}update(l,n,r,h,u){const g=new d.Vector3(u[0][0],u[0][1],u[0][2]),p=new d.Vector3(u[1][0],u[1][1],u[1][2]);this._objectBoundingBox.set(g,p),this._matrix.copy(h),this._sliceAllowed=r,this._sliceData=n,this._planeData=l,this._updateState()}setPosition(l,n){this._sceneCenter=l,this._size=n;for(let r=0;r<this._planes.length;r++)this._planes[r].sceneCenter=this._sceneCenter,this._planes[r].size=this._size;this._scene.updateMatrixWorld(!0)}setColor(l){this._colorSum=l[0]+l[1]+l[2],this._colorSum>2?(this._color.setRGB(0,0,0),this._alternateColor.setRGB(this._colorSum/3-.2,this._colorSum/3-.2,this._colorSum/3-.2)):(this._color.setRGB(1,1,1),this._alternateColor.setRGB(1,1,1));for(let n=0;n<this._planes.length;n++)this._planes[n].setColor(this._color,this._alternateColor,this._colorSum)}isMouseOnSphere(l,n,r,h){const u=l.clone();u.x=u.x*2-1,u.y=-u.y*2+1,r.setFromCamera(u,n);const g=[];return h._sphere.raycast(r,g),g.length>0}isContextMenuAvailable(){return this.enableRotate||this.enableRemove}_updateState(){this._sliceAllowed&&(this._sliceEnabled.add||this._sliceEnabled.remove||this._sliceEnabled.rotate||this._sliceEnabled.translate)?(this.state=this.STATE.SLICE,this.enableAdd=this._sliceEnabled.add,this.enableRemove=this._sliceEnabled.remove,this.enableRotate=this._sliceEnabled.rotate,this.enableTranslate=this._sliceEnabled.translate):this._clippingEnabled.add||this._clippingEnabled.remove||this._clippingEnabled.rotate||this._clippingEnabled.translate?(this.state=this.STATE.CLIPPING,this.enableAdd=this._clippingEnabled.add,this.enableRemove=this._clippingEnabled.remove,this.enableRotate=this._clippingEnabled.rotate,this.enableTranslate=this._clippingEnabled.translate):(this.state=this.STATE.NONE,this.enableAdd=!1,this.enableRemove=!1,this.enableRotate=!1,this.enableTranslate=!1),this.state===this.STATE.CLIPPING?this._setPlanes(this._planeData):this.state===this.STATE.SLICE?this._setPlanes(this._sliceData):this.disable()}_setPlanes(l){if(l.length>this._planes.length){for(let n=0;n<this._planes.length;n++)this._planes[n].setMode(this.state),this._planes[n].pushPinVisible=this.enableRotate,this._planes[n].setBoundingBox(this._objectBoundingBox),this._planes[n].applyMatrix(this._matrix),this._planes[n].setPlane(l[n]),this._planes[n].show(),this._planes[n].visible=this._visible;for(let n=this._planes.length;n<l.length;n++)this._add(l[n],n)}else{for(let n=0;n<l.length;n++)this._planes[n].setMode(this.state),this._planes[n].pushPinVisible=this.enableRotate,this._planes[n].setBoundingBox(this._objectBoundingBox),this._planes[n].applyMatrix(this._matrix),this._planes[n].setPlane(l[n]),this._planes[n].show(),this._planes[n].visible=this._visible;if(l.length<this._planes.length)for(let n=l.length;n<this._planes.length;n++)this._planes[n].visible=!1}this.numPlanes=l.length,this.enable()}_add(l,n){const r=new N(l,n,this._color,this._alternateColor,this._colorSum,this.state);r.size=this._size,r.sceneCenter=this._sceneCenter,r.setBoundingBox(this._objectBoundingBox),r.applyMatrix(this._matrix),r.pushPinVisible=this.enableRotate,r.visible=this._visible,this._scene.add(r),this._planes.push(r)}onPointerDown(l){for(let n=0;n<this._planes.length;n++)this._planes[n]!==l&&this._planes[n].hide()}onPointerUp(l){for(let n=0;n<this.numPlanes;n++)this._planes[n]!==l&&this._planes[n].show()}onPointerLeave(){return this._visible===!0?(this._visible=!1,this.disable(),!0):!1}onPointerEnter(){return this._visible===!1?(this._visible=!0,this.enable(),!0):!1}}},D,V),D.exports=B},4207:(D,V,f)=>{var R,B;R=[f(6127),f(9721)],B=f.dj.d(R,function(d,N){return class extends d{_newObject(l,n){const r=new N(l,n);return r.pickable=n.pickable.value,r}}},D,V),D.exports=B},6751:(D,V,f)=>{var R,B;R=[f(6127),f(8311)],B=f.dj.d(R,function(d,N){return class extends d{_newObject(l,n,r,h=!1){return new N(l,n,r,h)}}},D,V),D.exports=B},8311:(D,V,f)=>{var R,B;R=[f(3681),f(9721)],B=f.dj.d(R,function(d,N){return class extends d.Line{constructor(l=0,n,r,h=!0){const u=new d.BufferGeometry,g=new Array(r*3).fill(0);u.setAttribute("position",new d.Float32BufferAttribute(g,3));const p=new d.Color(16777215),y=new d.LineBasicMaterial({color:p,toneMapped:!1,transparent:!1,depthTest:n.depthTest.value,depthWrite:!1});super(u,y),this.type="Polygon",this.visible=!1,this._showLabel=!1,this.showVertices=!0,this.selected=!1,this.ID=l,this.color=p,this.pickable=n.pickable.value,this.closed=h,this._labelType="length",this._globalUniforms=n,this._drawing=!1,this._numPoints=0,this._reshape=!0,this._translate=!0,this._hitLocation=new d.Vector3,this._hitIndex=0,this._points=new N(0,this._globalUniforms,"circle",this.geometry),this._points.material.uniforms.color.value=this.material.color,this._points.visible=!0,this.add(this._points),this._label=null,this._labelString=null,this.onBeforeRender=this._updateVertexDisplay.bind(this)}set closed(l){this._closed=l,this.type=l?"Polygon":"Polyline"}get closed(){return this._closed}updateMatrixWorld(l){super.updateMatrixWorld(l),this._points.visible=this.visible&&this.pickable&&this.showVertices}highlight(l,n){(this._reshape||this._translate)&&(this._hitLocation.copy(l),this.material.opacity=1,this._points.ID=n,this._points.highlight(),this.showVertices||this._globalUniforms.sharedMarker.value.display(l,this.color.toArray()))}show(){this.material.opacity=1,this._points.show()}hide(){this.material.opacity=0,this._points.hide()}highlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select")&&this.showLabel(),this._label!==null&&this._label.highlight()}unhighlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select"&&!this.selected)&&this.hideLabel(),this._setLabelColor()}select(l){this.selected===!0&&l===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this._globalUniforms.labelVisible.value==="select"&&this.showLabel(),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this._globalUniforms.labelVisible.value==="select"&&this.hideLabel(),this._setLabelColor()}getPosition(){const l=this.geometry.attributes.position.array,n=new Array(this._drawing?(this._numPoints+1)*3:this._numPoints*3);for(let r=0;r<n.length;r++)n[r]=l[r];return n}addPoint(l,n,r){this._clampPointToSceneLimits(l,n),this._numPoints+=1;const h=this.geometry.getAttribute("position"),u=[...h.array];if(u.push(l.x,l.y,l.z),this._numPoints===1)this._drawing=!0,u.push(l.x,l.y,l.z),this._closed&&u.push(l.x,l.y,l.z);else{if(r){const g=new d.Vector3;g.fromArray(h,h.length-6),this._snapToAngle(l,g)}this._closed?(u[u.length-6]=l.x,u[u.length-5]=l.y,u[u.length-4]=l.z,u[u.length-3]=u[0],u[u.length-2]=u[1],u[u.length-1]=u[2]):(u[u.length-3]=l.x,u[u.length-2]=l.y,u[u.length-1]=l.z)}this.geometry.setAttribute("position",new d.Float32BufferAttribute(u,3)),this._computeBoundingSphere(),this._points.ID=this._numPoints-1,this.refreshLabel()}removePoint(){if(this._numPoints>1){this._numPoints-=1;const n=[...this.geometry.getAttribute("position").array];n.splice(this._closed?n.length-9:n.length-6,3),this.geometry.setAttribute("position",new d.Float32BufferAttribute(n,3)),this._computeBoundingSphere(),this.refreshLabel(),this._points.ID=this._numPoints-1}}insertVertex(){if(this._points.ID<0&&this._reshape){this._numPoints+=1;const l=this._hitLocation.toArray(),r=[...this.geometry.getAttribute("position").array];r.splice((this._hitIndex+1)*3,0,...l),console.log(r),this.geometry.setAttribute("position",new d.Float32BufferAttribute(r,3)),this._computeBoundingSphere(),this.refreshLabel(),this._points.ID=this._hitIndex+1}}follow(l,n,r,h){this._clampPointToSceneLimits(l,r);const u=this.geometry.attributes.position.array;if(h){const g=new d.Vector3;g.fromArray(u,this._closed?u.length-9:u.length-6),this._snapToAngle(l,g)}this._closed?(u[u.length-6]=l.x,u[u.length-5]=l.y,u[u.length-4]=l.z):(u[u.length-3]=l.x,u[u.length-2]=l.y,u[u.length-1]=l.z),this.geometry.attributes.position.needsUpdate=!0,this.refreshLabel()}unfollow(){const l=this.geometry.attributes.position.array;this._closed?(l[l.length-6]=l[l.length-3],l[l.length-5]=l[l.length-2],l[l.length-4]=l[l.length-1]):(l[l.length-3]=l[l.length-6],l[l.length-2]=l[l.length-5],l[l.length-1]=l[l.length-4]),this.geometry.attributes.position.needsUpdate=!0,this.refreshLabel()}close(){this._drawing=!1;const l=this.geometry.attributes.position.array;if(this._closed){if(this._numPoints<=2||l.length/3===this._numPoints+1)return}else{if(this._numPoints<=1||l.length/3===this._numPoints)return;l[l.length-3]=l[l.length-6],l[l.length-2]=l[l.length-5],l[l.length-1]=l[l.length-4]}const n=[...l];n.splice(n.length-6,3),this.geometry.setAttribute("position",new d.Float32BufferAttribute(n,3)),this._computeBoundingSphere(),this.refreshLabel()}clear(){const l=new Array(0).fill(0);this.geometry.setAttribute("position",new d.Float32BufferAttribute(l,3)),this._numPoints=0,this.visible=!1}remove(){this.visible=!1,this.selected=!1,this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null)}setVisible(l){if(l>0)switch(this.visible=!0,l){case 1:this._reshape=!0,this._translate=!0;break;case 2:this._reshape=!1,this._translate=!1;break;case 3:this._reshape=!0,this._translate=!1;break;case 4:this._reshape=!1,this._translate=!0;break}else this.visible=!1,this.selected=!1,this._reshape=!1,this._translate=!1;this._label!==null&&this._label.setVisibility(l>0)}setLabel(l){switch(this._labelString=l,this._globalUniforms.labelVisible.value){case"on":this._constructLabel();break;case"off":case"hover":this._showLabel=!1,this.frustumCulled=!0;break;case"select":this.selected?this._constructLabel():(this._showLabel=!1,this.frustumCulled=!0)}}editLabel(l){this._label!==null&&this._label.edit(l)}stopEditing(l){return this._label!==null?this._label.stopEditing(l):!1}getLabel(){return this._label!==null?this._label.getLabel():null}showLabel(){this._constructLabel(),this.refreshLabel()}hideLabel(){this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null),this._showLabel=!1}setPosition(l){if(this._numPoints=l.length/3-(this._drawing?1:0),this._closed){const n=new Float32Array(l.length+3);n.set(l),n.set(l.slice(0,3),l.length),this.geometry.setAttribute("position",new d.Float32BufferAttribute(n,3))}else this.geometry.setAttribute("position",new d.Float32BufferAttribute(l,3));this._computeBoundingSphere(),this.refreshLabel()}setColor(l){this.color.fromArray(l),this.selected?this.material.color.copy(this._globalUniforms.selectedColor.value):this.material.color.fromArray(l),this._setLabelColor()}raycast(l,n){if(this.visible&&this.pickable&&(this._reshape||this._translate)){const r=[];this._points.raycastForced(l,r),r.length>0?(r[0].object=this,n.push(r[0])):(super.raycast(l,r),r.length>0&&(this._hitIndex=r[0].index,r[0].index=-1,n.push(r[0])))}}hitFirstPoint(l){if(this.isLengthValid()){const n=[];if(this._points.raycastForced(l,n),n.length>0){for(let r=0;r<n.length;r++)if(n[r].index===0)return!0;return!1}else return!1}else return!1}applyQuaternion(){}applyTransformation(l,n,r,h,u,g,p){const y=this._points.ID;if(h||y<0||!this._reshape)this.applyUniformTranslation(l,n,p);else{const x=this._points.ID;this._clampPointToSceneLimits(l,n);const w=this.geometry.attributes.position.array;if(x===this._numPoints-1){if(r&&(this._drawing||!this._closed)){const M=new d.Vector3;M.fromArray(w,(x-1)*3),this._snapToAngle(l,M)}this._closed?(w[(x+1)*3]=w[0],w[(x+1)*3+1]=w[1],w[(x+1)*3+2]=w[2]):(w[(x+1)*3]=l.x,w[(x+1)*3+1]=l.y,w[(x+1)*3+2]=l.z)}else if(x===0){if(this._closed)w[this._numPoints*3]=l.x,w[this._numPoints*3+1]=l.y,w[this._numPoints*3+2]=l.z;else if(r){const M=new d.Vector3;M.fromArray(w,3),this._snapToAngle(l,M)}}w[x*3]=l.x,w[x*3+1]=l.y,w[x*3+2]=l.z,this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}}applyUniformTranslation(l,n,r){if(!this._translate)return;this._clampOffsetToSceneLimits(n,r);const h=this.geometry.attributes.position.array;for(let u=0;u<h.length/3;u++)h[u*3]-=r.x,h[u*3+1]-=r.y,h[u*3+2]-=r.z;this.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}getLastMarker(){return this._points.ID=this._numPoints-1,this}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_constructLabel(){this._labelString===null?(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.measurement=!0,this._showLabel=!0):this._labelString===""?this.hideLabel():(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.setLabel(this._labelString,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0),this._showLabel&&this._globalUniforms.checkExtent.value&&this._label.checkExtent(),this.frustumCulled=!this._showLabel}_updateVertexDisplay(l,n,r,h,u,g){if(this.visible&&this.pickable)if(this._numPoints>2&&!this._drawing){const p=window.innerWidth,y=window.innerHeight,x=this.geometry.boundingSphere.center.clone().project(r),w=(x.x*.5+.5)*p,M=(1-(x.y*.5+.5))*y,T=this.geometry.boundingSphere.center.clone().add(new d.Vector3(this.geometry.boundingSphere.radius,0,0)).project(r),A=(T.x*.5+.5)*p,C=(1-(T.y*.5+.5))*y;2*Math.sqrt(Math.pow(A-w,2)+Math.pow(C-M,2))/this._numPoints>5?this.showVertices=!0:this.showVertices=!1}else this.showVertices=!0}renderLabel(l,n){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.project(l,n,this._globalUniforms.checkExtent.value)}getExtent(l,n,r){this.visible===!0&&this._showLabel===!0&&this._label!==null?this._label.getExtent(l,n,r):r.push({x:null,y:null,width:null,height:null})}shuffleExtent(l,n,r){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.shuffleExtent(l,n,r)}_clampPointToSceneLimits(l,n){this._globalUniforms.clampToSceneLimits.value&&l.clamp(n.min,n.max)}_clampOffsetToSceneLimits(l,n){if(this._globalUniforms.clampToSceneLimits.value){this._computeBoundingBox();const r=this.geometry.boundingBox.min.clone().sub(n),h=this.geometry.boundingBox.max.clone().sub(n);r.clamp(l.min,l.max).sub(this.geometry.boundingBox.min).add(n),h.clamp(l.min,l.max).sub(this.geometry.boundingBox.max).add(n),n.sub(r).sub(h)}}_snapToAngle(l,n){const r=l.distanceTo(n),h=new d.Vector3().subVectors(l,n).normalize(),u=12/Math.PI,g=new d.Spherical().setFromVector3(h);g.phi=Math.round(g.phi*u)/u,g.theta=Math.round(g.theta*u)/u,h.setFromSpherical(g).setLength(r),l.copy(n).add(h)}_computeBoundingBox(){this.geometry.computeBoundingBox()}_computeBoundingSphere(){this.geometry.computeBoundingSphere()}dispose(){this.material.dispose(),this.geometry.dispose(),this._points.dispose()}refreshLabel(){if(this._showLabel!==!1&&this._numPoints>0&&this._label!==null){const l=this.geometry.attributes.position.array;if(this._label.measurement===!0){let n=0;const r=l.length/3;if(this._closed){this._labelType="area",this._label.style="area";let h=0;if(r>2){for(let u=0;u<r;u++)h=(u+1)%r,n+=l[u*3]*l[h*3+1],n-=l[h*3]*l[u*3+1];n=Math.abs(n/2)}}else{this._labelType="length",this._label.style="length";for(let h=3;h<l.length;h+=3){const u=l[h]-l[h-3],g=l[h+1]-l[h-2],p=l[h+2]-l[h-1];n+=Math.sqrt(u*u+g*g+p*p)}}this._label.setLabel(n,this._globalUniforms.units.value),this._globalUniforms.checkExtent.value&&this._label.checkExtent()}this._label.position.fromArray(l,0)}}isLengthValid(){return this._closed?this._numPoints>2:this._numPoints>1}}},D,V),D.exports=B},7234:(D,V,f)=>{var R,B;R=[f(3681),f(8486),f(9721)],B=f.dj.d(R,function(d,N,_){return class extends d.Line{constructor(n=0,r,h=0){const u=new d.BufferGeometry,g=[.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,-.5,0,.5,.5,0];u.setAttribute("position",new d.Float32BufferAttribute(g,3)),u.computeBoundingSphere();const p=new d.Color(16777215),y=new d.LineBasicMaterial({color:p,toneMapped:!1,transparent:!0,depthWrite:!1,depthTest:!1});super(u,y),this.type="Rectangle",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=n,this.color=p,this.pickable=r.pickable.value,this.showVertices=!0,this._drawing=!1,this._reshape=!0,this._translate=!0,this._facePickable=!1,this._faceAlpha=0,this._labelType="dimension",this._globalUniforms=r,this._cornerA=new d.Vector3,this._cornerB=new d.Vector3,this._cornerScreenA=new d.Vector2,this._cornerScreenB=new d.Vector2,this._view=new d.Vector3,this._rotationAngle=0,this._label=null,this._labelString=null,this._face=null,this._points=null,h>0&&(this._constructFace(),this._constructMarkers(),this._face.material.opacity=.5)}set movable(n){this._reshape=n,this._translate=n}get movable(){return this._reshape||this._translate}updateMatrixWorld(n){super.updateMatrixWorld(n),this._points!==null&&(this._points.visible=this.visible&&this.showVertices&&!this._drawing)}highlight(n,r){(this._reshape||this._translate)&&(this._points!==null&&(this._points.ID=r),this.material.opacity=1,this._points!==null&&this.showVertices&&this._points.highlight())}show(){this.material.opacity=1,this._points!==null&&this._points.show()}hide(){this.material.opacity=0,this._points!==null&&this._points.hide()}highlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select")&&this.showLabel(),this._label!==null&&this._label.highlight()}unhighlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select"&&!this.selected)&&this.hideLabel(),this._setLabelColor()}select(n){this.selected===!0&&n===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this._face!==null&&this._face.material.color.copy(this._globalUniforms.selectedColor.value),this._globalUniforms.labelVisible.value==="select"&&this.showLabel(),this._setLabelColor()),this._points!==null&&this._points.select(n)}deselect(){this.selected=!1,this.material.color.copy(this.color),this._face!==null&&this._face.material.color.copy(this.color),this._globalUniforms.labelVisible.value==="select"&&this.hideLabel(),this._points!==null&&this._points.deselect(),this._setLabelColor()}getPosition(){const n=new Array(5);return n[0]=this.position.x,n[1]=this.position.y,n[2]=Math.abs(this.scale.x),n[3]=Math.abs(this.scale.y),n[4]=this._rotationAngle,n}setPosition(n){this.position.x=n[0],this.position.y=n[1],this.position.z=.5,this.scale.x=n[2],this.scale.y=n[3],this.scale.z=1,this._rotationAngle=n[4],this.refreshLabel()}startDrawing(){this._drawing=!0}setLabel(n){switch(this._labelString=n,this._globalUniforms.labelVisible.value){case"on":this._constructLabel();break;case"off":case"hover":this._showLabel=!1,this.frustumCulled=!0;break;case"select":this.selected?this._constructLabel():(this._showLabel=!1,this.frustumCulled=!0)}}editLabel(n){this._label!==null&&this._label.edit(n)}stopEditing(n){return this._label!==null?this._label.stopEditing(n):!1}getLabel(){return this._label!==null?this._label.getLabel():null}showLabel(){this._constructLabel(),this.refreshLabel()}hideLabel(){this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null),this._showLabel=!1}setColor(n){this.color.fromArray(n),this.selected?this.material.color.copy(this._globalUniforms.selectedColor.value):this.material.color.fromArray(n),this._setLabelColor(),this._setChildColor(n)}raycast(n,r){if(this.visible&&this.pickable&&(this._reshape||this._translate)){const h=[];h.length===0&&this._face!==null&&this._facePickable&&(this._face.raycast(n,h),h.length>0&&(h[0].index=-1,h[0].object=this,r.push(h[0])))}}setEye(n){this.up.copy(n).normalize()}start(n,r){this._cornerA.copy(n),this._cornerB.copy(n),this._cornerScreenA.copy(r),this._cornerScreenB.copy(r)}follow(n,r){this._cornerB.copy(n),this._cornerScreenB.copy(r);const h=this._cornerB.clone().sub(this._cornerA),u=this.up.clone();this.scale.y=Math.abs(h.dot(u)),u.cross(this._globalUniforms.eye.value).normalize(),this.scale.x=Math.abs(h.dot(u)),this.position.lerpVectors(this._cornerA,this._cornerB,.5),this._view.copy(this.position).add(this._globalUniforms.eye.value),this.lookAt(this._view),this.visible=!0,this.refreshLabel()}unfollow(){}getScreenDimensions(){const n=new d.Vector4,r=new d.Vector2;return r.lerpVectors(this._cornerScreenA,this._cornerScreenB,.5),n.x=Math.abs(r.x),n.y=Math.abs(r.y),n.width=Math.abs(this._cornerScreenA.x-this._cornerScreenB.x),n.height=Math.abs(this._cornerScreenA.y-this._cornerScreenB.y),n}close(){this._drawing=!1}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null)}setFaceAlpha(n){n===0?(this._faceAlpha=0,this._facePickable=!1,this._face!==null&&(this._face.visible=!1)):(this._face===null&&this._constructFace(),n>0?(this._faceAlpha=n,this._facePickable=!1,this._face.material.opacity=n,this._face.visible=!0):(this._facePickable=!0,n<-1?(this._faceAlpha=0,this._face.visible=!1):(this._faceAlpha=Math.abs(n),this._face.material.opacity=this._faceAlpha,this._face.visible=!0)))}setVisible(n){if(n>0)switch(this.visible=!0,n){case 1:this._reshape=!0,this._translate=!0;break;case 2:this._reshape=!1,this._translate=!1;break;case 3:this._reshape=!0,this._translate=!1;break;case 4:this._reshape=!1,this._translate=!0;break}else this.visible=!1,this.selected=!1,this._reshape=!1,this._translate=!1;this._label!==null&&this._label.setVisibility(n>0)}applyQuaternion(n,r,h){}applyTransformation(n,r,h,u,g,p,y){const x=this._points.ID;(u||x<0)&&this._face!==null&&this._face.applyTransformation(n,r,h,u,g,p,y)}getLastMarker(){return this}refreshLabel(){if(this._showLabel!==!1&&this._label!==null){if(this._label.position.copy(this.position),this._label.measurement===!0){const n=new d.Vector2(Math.abs(this.scale.x),Math.abs(this.scale.y));this._label.setLabel(n,this._globalUniforms.units.value)}this._globalUniforms.checkExtent.value&&this._label.checkExtent()}}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_setChildColor(n){this._face!==null&&(this._face.material.color=this.material.color),this._points!==null&&this._points.setColor(n)}_constructLabel(){this._labelString===null?(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.measurement=!0,this._showLabel=!0):this._labelString===""?this.hideLabel():(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.setLabel(this._labelString,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0),this._showLabel&&this._globalUniforms.checkExtent.value&&this._label.checkExtent(),this.frustumCulled=!this._showLabel}_constructFace(){const n=[-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,.5,0,.5,-.5,0,-.5,-.5,0];this._face=new N(5,this.material.color,n),this._face.material.side=d.BackSide,this.add(this._face)}_constructMarkers(){const n=[-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,0,0,.5,0,0,0,-.5,0,0,.5,0],r=new d.BufferGeometry;r.setAttribute("position",new d.Float32BufferAttribute(n,3)),this._points=new _(0,this._globalUniforms,"square",r),this._points.matrixAutoUpdate=!1,this.add(this._points)}renderLabel(n,r){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.project(n,r,this._globalUniforms.checkExtent.value)}getExtent(n,r,h){this.visible===!0&&this._showLabel===!0&&this._label!==null?this._label.getExtent(n,r,h):h.push({x:null,y:null,width:null,height:null})}shuffleExtent(n,r,h){}}},D,V),D.exports=B},4036:(D,V,f)=>{var R,B;R=[f(6127),f(7234)],B=f.dj.d(R,function(d,N){return class extends d{add(l,n,r,h,u,g,p){if(this._numObjects+=1,this._numObjects>this.objects.length){const y=this._newObject(u,this._annotationUniforms,g,p);this._scene.add(y),this.objects.push(y)}return this.objects[this._numObjects-1].setLabel(r),this.objects[this._numObjects-1].setPosition(l),this.objects[this._numObjects-1].setColor(h),this.objects[this._numObjects-1].setFaceAlpha(p),this.objects[this._numObjects-1].ID=u,this.objects[this._numObjects-1].setVisible(n),this._getObject(this._numObjects-1)}_newObject(l,n,r){return new N(l,n,1)}}},D,V),D.exports=B},6658:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.Mesh{constructor(_=0,l){const n=new d.SphereGeometry(1,32,16),r=new d.Color(16777215),h=new d.MeshBasicMaterial({color:r,toneMapped:!1,transparent:!0,depthWrite:!1,side:d.FrontSide,opacity:.1}),u=new d.RingGeometry(1,1,32),g=new d.LineBasicMaterial({color:16711680,transparent:!0,opacity:1}),p=new d.LineSegments(u,g),y=new d.RingGeometry(1,1,32),x=new d.LineBasicMaterial({color:65535,transparent:!0,opacity:1}),w=new d.LineSegments(y,x);w.rotation.y+=1.57;const M=new d.RingGeometry(1,1,32),T=new d.LineBasicMaterial({color:16777215,transparent:!0,opacity:1}),A=new d.LineSegments(M,T);A.rotation.x+=1.57,super(n,h),this.add(p),this.add(w),this.add(A),this.type="CropSphere",this.visible=!1,this._showLabel=!1,this.selected=!1,this.ID=_,this.color=r,this.pickable=l.pickable.value,this.movable=!0,this._labelType="volume",this._globalUniforms=l,this._quaternion=new d.Quaternion,this._label=null,this._labelString=null,this._interactionStarted=!1,this._initialDistance=new d.Vector2,this._previousEndPoint=new d.Vector2,this._initialDirection=new d.Vector2,this._scaleFactor=.03}updateMatrixWorld(_){super.updateMatrixWorld(_)}highlight(){this.material.opacity=.2,this.children[0].material.opacity=1,this.children[1].material.opacity=1,this.children[2].material.opacity=1}show(){this.material.opacity=.1,this.children[0].material.opacity=1,this.children[1].material.opacity=1,this.children[2].material.opacity=1,this._setLabelColor()}hide(){this.material.opacity=0,this.children[0].material.opacity=0,this.children[1].material.opacity=0,this.children[2].material.opacity=0}highlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select")&&this.showLabel(),this._label!==null&&this._label.highlight()}unhighlightLabel(){(this._globalUniforms.labelVisible.value==="hover"||this._globalUniforms.labelVisible.value==="select"&&!this.selected)&&this.hideLabel(),this._setLabelColor()}select(_){this.selected===!0&&_===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value),this.children[0].material.color.copy(this._globalUniforms.selectedColor.value),this.children[1].material.color.copy(this._globalUniforms.selectedColor.value),this.children[2].material.color.copy(this._globalUniforms.selectedColor.value),this._globalUniforms.labelVisible.value==="select"&&this.showLabel(),this._setLabelColor())}deselect(){this.selected=!1,this.material.color.copy(this.color),this.children[0].material.color.copy(this.color),this.children[1].material.color.copy(this.color),this.children[2].material.color.copy(this.color),this._globalUniforms.labelVisible.value==="select"&&this.hideLabel(),this._setLabelColor()}getPosition(){return[this.position.x,this.position.y,this.position.z,this.scale.x,this.scale.y,this.scale.z,this.rotation.x,this.rotation.y,this.rotation.z]}setPosition(_){this.setSize(_.slice(3,6)),this.setRotation(_.slice(6,9)),this.setCenter(_.slice(0,3))}setLabel(_){switch(this._labelString=_,this._globalUniforms.labelVisible.value){case"on":this._constructLabel();break;case"off":case"hover":this._showLabel=!1,this.frustumCulled=!0;break;case"select":this.selected?this._constructLabel():(this._showLabel=!1,this.frustumCulled=!0)}}editLabel(_){this._label!==null&&this._label.edit(_)}stopEditing(_){return this._label!==null?this._label.stopEditing(_):!1}getLabel(){return this._label!==null?this._label.getLabel():null}showLabel(){this._constructLabel(),this.refreshLabel()}hideLabel(){this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null),this._showLabel=!1}setCenter(_){this.position.fromArray(_),this.refreshLabel()}setSize(_){this.scale.fromArray(_)}setRotation(_){this.rotation.fromArray(_)}setColor(_){this.color.fromArray(_),this.selected?(this.material.color.copy(this._globalUniforms.selectedColor.value),this.children[0].material.color.copy(this._globalUniforms.selectedColor.value),this.children[1].material.color.copy(this._globalUniforms.selectedColor.value),this.children[2].material.color.copy(this._globalUniforms.selectedColor.value)):(this.material.color.fromArray(_),this.children[0].material.color.fromArray(_),this.children[1].material.color.fromArray(_),this.children[2].material.color.fromArray(_)),this._setLabelColor()}raycast(_,l){this.visible&&this.pickable&&super.raycast(_,l)}close(){}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&(this._globalUniforms.labelPool.value.returnLabel(this._label),this._label=null)}applyQuaternion(){}onPointerDown(){this._interactionStarted=!0}onPointerUp(){this._interactionStarted=!1,this._initialDirection.set(0,0),this._previousEndPoint.set(0,0)}applyTransformation(_,l,n,r,h){if(_)this.position.sub(n);else{if(this._interactionStarted){const y=this.position.clone().project(l),x=new d.Vector2;x.x=(y.x+1)/2,x.y=1-(y.y+1)/2,this._initialDistance=x.clone().sub(r.clone()),this._initialDirection=this._initialDistance.normalize(),this._interactionStarted=!1}const u=h.clone(),p=this._previousEndPoint.clone().sub(h.clone()).normalize();this._previousEndPoint.set(u.x,u.y),this._initialDirection.dot(p)<0?this.scale.multiplyScalar(1-this._scaleFactor):this.scale.multiplyScalar(1+this._scaleFactor),this.scale.x<0&&(this.scale.x=Number.EPSILON),this.scale.y<0&&(this.scale.y=Number.EPSILON),this.scale.z<0&&(this.scale.z=Number.EPSILON)}}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._label.measurement===!0&&this._label.setLabel(this.scale.x*this.scale.y*this.scale.z,this._globalUniforms.units.value),this._globalUniforms.checkExtent.value&&this._label.checkExtent())}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.color),this._label.show(this.selected))}_constructLabel(){this._labelString===null?(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.measurement=!0,this._showLabel=!0):this._labelString===""?this.hideLabel():(this._label===null&&(this._label=this._globalUniforms.labelPool.value.getLabel(this._labelType),this._label.setColor(this.material.color)),this._label.setLabel(this._labelString,this._globalUniforms.units.value),this._label.measurement=!1,this._showLabel=!0),this._showLabel&&this._globalUniforms.checkExtent.value&&this._label.checkExtent(),this.frustumCulled=!this._showLabel}renderLabel(_,l){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.project(_,l,this._globalUniforms.checkExtent.value)}getExtent(_,l,n){this.visible===!0&&this._showLabel===!0&&this._label!==null?this._label.getExtent(_,l,n):n.push({x:null,y:null,width:null,height:null})}shuffleExtent(_,l,n){}}},D,V),D.exports=B},2700:(D,V,f)=>{var R,B;R=[f(3681),f(9721),f(9032)],B=f.dj.d(R,function(d,N,_){return class extends d.LineSegments{constructor(n=0,r){const h=new d.BufferGeometry;h.setAttribute("position",new d.Float32BufferAttribute(new Array(0).fill(0),3));const u=new d.Color(16777215),g=new d.LineBasicMaterial({color:u,toneMapped:!1,transparent:!1,depthTest:r.depthTest.value,depthWrite:!1});super(h,g),this.type="TSquare",this.visible=!1,this.selected=!1,this.ID=n,this.color=u,this.pickable=r.pickable.value,this._globalUniforms=r,this._drawing=!1,this._numPoints=0,this._labelsVisible=!0,this._reshape=!0,this._translate=!0,this._formats={basicFormat:new Intl.NumberFormat(navigator.language,{trailingZeroDisplay:"stripIfInteger"}),slimFormat:new Intl.NumberFormat(navigator.language,{trailingZeroDisplay:"stripIfInteger",maximumFractionDigits:1})};const p=new d.BufferGeometry;p.setAttribute("position",new d.Float32BufferAttribute([],3)),this._points=new N(0,this._globalUniforms,"circle",p),this._points.material.uniforms.color.value=this.material.color,this._points.visible=!0,this.add(this._points),this._computeBoundingSphere(),this._labels=[],this._numLabels=0}updateMatrixWorld(n){super.updateMatrixWorld(n),this._points.visible=this.visible}highlight(n,r){(this._reshape||this._translate)&&(this.material.opacity=1,this._points.ID=r,this._points.highlight())}show(){this.material.opacity=1,this._points.show()}hide(){this.material.opacity=0,this._points.hide()}highlightLabel(){for(let n=0;n<this._labels.length;n++)this._labels[n].highlight()}unhighlightLabel(){this._setLabelColor()}select(n){this.selected===!0&&n===!0?this.deselect():(this.selected=!0,this.material.color.copy(this._globalUniforms.selectedColor.value))}deselect(){this.selected=!1,this.material.color.copy(this.color)}setTheme(n){for(let r=0;r<this._labels.length;r++)this._labels[r].setTheme(n)}getPosition(){const n=this._points.geometry.attributes.position.array,r=new Array(this._drawing?n.length:this._numPoints*3);for(let h=0;h<r.length;h++)r[h]=n[h];return r}addPoint(n,r,h){this._clampPointToSceneLimits(n,r),this._numPoints+=1,this._following=!1;const g=[...this.geometry.getAttribute("position").array],p=this._points.geometry.getAttribute("position"),y=[...p.array];if(this._numPoints===1)this._drawing=!0,g.push(n.x,n.y,n.z,n.x,n.y,n.z),y.push(n.x,n.y,n.z,n.x,n.y,n.z);else if(this._numPoints===2)y.push(n.x,n.y,n.z),g.push(y[0],y[1],y[2],y[0],y[1],y[2],y[0],y[1],y[2],y[0],y[1],y[2]);else{const x=new d.Vector3().fromArray(g,0),w=new d.Vector3().fromArray(g,3);this._updateDataArray(g,n,this._numPoints-1,x,w),g.push(n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z),p[(this._numPoints-1)*3]=n.x,p[(this._numPoints-1)*3+1]=n.y,p[(this._numPoints-1)*3+2]=n.z,y.push(n.x,n.y,n.z)}this.geometry.setAttribute("position",new d.Float32BufferAttribute(g,3)),this._points.geometry.setAttribute("position",new d.Float32BufferAttribute(y,3)),this._computeBoundingSphere(),this.refreshLabel()}removePoint(){if(this._numPoints>2){this._numPoints-=1;const r=[...this.geometry.getAttribute("position").array],u=[...this._points.geometry.getAttribute("position").array],g=r.slice(0,this._requiredBufferLength(this._numPoints+1)),p=u.slice(0,(this._numPoints+1)*3),y=new d.Vector3().fromArray(r,0),x=new d.Vector3().fromArray(r,3),w=new d.Vector3().fromArray(u,this._numPoints*3);this._updateDataArray(g,w,this._numPoints,y,x),this.geometry.setAttribute("position",new d.Float32BufferAttribute(g,3)),this._points.geometry.setAttribute("position",new d.Float32BufferAttribute(p,3)),this._computeBoundingSphere(),this.refreshLabel()}}follow(n,r,h,u){this._clampPointToSceneLimits(n,h);const g=this.geometry.attributes.position.array,p=this._points.geometry.attributes.position.array;if(this._numPoints===1){if(this._following=!1,u){const y=new d.Vector3;y.fromArray(g,0),this._snapToAngle(n,y)}g[3]=n.x,g[4]=n.y,g[5]=n.z,p[3]=n.x,p[4]=n.y,p[5]=n.z}else{this._following=!0,p[this._numPoints*3]=n.x,p[this._numPoints*3+1]=n.y,p[this._numPoints*3+2]=n.z;const y=new d.Vector3().fromArray(g,0),x=new d.Vector3().fromArray(g,3);this._updateDataArray(g,n,this._numPoints,y,x)}this.geometry.attributes.position.needsUpdate=!0,this._points.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}unfollow(){const n=this.geometry.attributes.position.array,r=this._points.geometry.attributes.position.array;if(this._numPoints===1)n[3]=n[0],n[4]=n[1],n[5]=n[2],r[3]=n[0],r[4]=n[1],r[5]=n[2];else{const h=new d.Vector3().fromArray(n),u=new d.Vector3().fromArray(n,0),g=new d.Vector3().fromArray(n,3);this._updateDataArray(n,h,this._numPoints,u,g)}this.geometry.attributes.position.needsUpdate=!0,this._points.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}close(){this._drawing=!1,this._following=!1;const n=this.geometry.attributes.position.array;this.geometry.setAttribute("position",new d.Float32BufferAttribute(n.slice(0,this._requiredBufferLength(this._numPoints)),3));const r=this._points.geometry.attributes.position.array;this._points.geometry.setAttribute("position",new d.Float32BufferAttribute(r.slice(0,this._numPoints*3),3))}clear(){this._numPoints=0;const n=new Array(0).fill(0);this.geometry.setAttribute("position",new d.Float32BufferAttribute(n,3)),this._points.geometry.setAttribute("position",new d.Float32BufferAttribute(n,3)),this._points.visible=!1,this.visible=!1}isLengthValid(){return this._numPoints>2}remove(){this.visible=!1,this.selected=!1;for(let n=0;n<this._numLabels;n++)this._labels[n].setVisibility(!1)}setVisible(n){if(n>0)switch(this.visible=!0,n){case 1:this._reshape=!0,this._translate=!0;break;case 2:this._reshape=!1,this._translate=!1;break;case 3:this._reshape=!0,this._translate=!1;break;case 4:this._reshape=!1,this._translate=!0;break}else this.visible=!1,this.selected=!1,this._reshape=!1,this._translate=!1}setLabel(n){this._labelsVisible=n}editLabel(n){}stopEditing(n){return!1}getLabel(){return null}showLabel(){}hideLabel(){}setPosition(n){if(this._numPoints=n.length/3-(this._drawing?1:0),this._numPoints>1){const r=new Array(this._numPoints*3+(this._drawing?3:0)).fill(0),h=new Array(this._requiredBufferLength(this._numPoints+(this._drawing&&this._numPoints>1?1:0))).fill(0);for(let y=0;y<n.length;y++)r[y]=n[y];h[0]=n[0],h[1]=n[1],h[2]=n[2],h[3]=n[3],h[4]=n[4],h[5]=n[5];const u=new d.Vector3().fromArray(r,0),g=new d.Vector3().fromArray(r,3),p=new d.Vector3;for(let y=2;y<this._numPoints;y++)p.fromArray(r,y*3),this._updateDataArray(h,p,y,u,g);this._drawing&&(p.fromArray(r,this._numPoints*3),this._updateDataArray(h,p,this._numPoints,u,g)),this.geometry.setAttribute("position",new d.Float32BufferAttribute(h,3)),this._points.geometry.setAttribute("position",new d.Float32BufferAttribute(r,3))}else{const r=new Array(this._numPoints*6).fill(0),h=new Array(this._numPoints*6).fill(0);if(this._numPoints===1)for(let u=0;u<n.length;u++)h[u]=n[u],r[u]=n[u];this.geometry.setAttribute("position",new d.Float32BufferAttribute(h,3)),this._points.geometry.setAttribute("position",new d.Float32BufferAttribute(r,3))}this._computeBoundingSphere(),this.refreshLabel()}setColor(n){this.color.fromArray(n),this.selected?this.material.color.copy(this._globalUniforms.selectedColor.value):this.material.color.fromArray(n),this._setLabelColor()}raycast(n,r){if(this.visible&&this.pickable&&(this._reshape||this._translate)){const h=[];if(this._points.raycastForced(n,h),h.length>0)h[0].object=this,r.push(h[0]);else if(super.raycast(n,h),h.length>0){for(let u=0;u<h.length;u++)if(h[u].index===0){h[0].index=-1,r.push(h[u]);return}}}}applyQuaternion(){}applyTransformation(n,r,h,u,g,p,y){const x=this._points.ID;if(u||x<0||!this._reshape)this.applyUniformTranslation(n,r,y);else{this._clampPointToSceneLimits(n,r);const w=this.geometry.attributes.position.array,M=this._points.geometry.attributes.position.array,T=new d.Vector3().fromArray(w,0),A=new d.Vector3().fromArray(w,3);if(x<2){if(x===1&&this._numPoints===2&&h){const z=new d.Vector3;z.fromArray(w,0),this._snapToAngle(n,z)}w[x*3]=n.x,w[x*3+1]=n.y,w[x*3+2]=n.z,M[x*3]=n.x,M[x*3+1]=n.y,M[x*3+2]=n.z,x===0&&this._numPoints===1&&(w[3]=n.x,w[4]=n.y,w[5]=n.z,M[3]=n.x,M[4]=n.y,M[5]=n.z);const C=new d.Vector3;for(let z=2;z<this._numPoints;z++)C.fromArray(M,z*3),this._updateDataArray(w,C,z,T,A)}else M[x*3]=n.x,M[x*3+1]=n.y,M[x*3+2]=n.z,this._updateDataArray(w,n,x,T,A);this._drawing&&(M[(x+1)*3]=n.x,M[(x+1)*3+1]=n.y,M[(x+1)*3+2]=n.z),this.geometry.attributes.position.needsUpdate=!0,this._points.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}}applyUniformTranslation(n,r,h){if(!this._translate)return;this._clampOffsetToSceneLimits(r,h);const u=this.geometry.attributes.position.array,g=this._points.geometry.attributes.position.array;for(let p=0;p<u.length/3;p++)u[p*3]-=h.x,u[p*3+1]-=h.y,u[p*3+2]-=h.z;for(let p=0;p<g.length/3;p++)g[p*3]-=h.x,g[p*3+1]-=h.y,g[p*3+2]-=h.z;this.geometry.attributes.position.needsUpdate=!0,this._points.geometry.attributes.position.needsUpdate=!0,this._computeBoundingSphere(),this.refreshLabel()}refreshLabel(){}getLastMarker(){return this._points.ID=this._numPoints-1,this}_setLabelColor(){for(let n=0;n<this._labels.length;n++)this._labels[n].setColor(this.material.color),this._labels[n].show(this.selected)}_constructLabel(){const n=new _("left",this._globalUniforms.container.value,this._globalUniforms.isDarkTheme.value,this._formats);n.setColor(this.material.color),n.measurement=!0,this._labels.push(n)}_clampPointToSceneLimits(n,r){this._globalUniforms.clampToSceneLimits.value&&n.clamp(r.min,r.max)}_clampOffsetToSceneLimits(n,r){if(this._globalUniforms.clampToSceneLimits.value){this._computeBoundingBox();const h=this.geometry.boundingBox.min.clone().sub(r),u=this.geometry.boundingBox.max.clone().sub(r);h.clamp(n.min,n.max).sub(this.geometry.boundingBox.min).add(r),u.clamp(n.min,n.max).sub(this.geometry.boundingBox.max).add(r),r.sub(h).sub(u)}}_snapToAngle(n,r){const h=n.distanceTo(r),u=new d.Vector3().subVectors(n,r).normalize(),g=12/Math.PI,p=new d.Spherical().setFromVector3(u);p.phi=Math.round(p.phi*g)/g,p.theta=Math.round(p.theta*g)/g,u.setFromSpherical(p).setLength(h),n.copy(r).add(u)}_updateDataArray(n,r,h,u,g){const p=this._findNearestPointOnLine(u,g,r);n[(h-2)*12+6]=u.x,n[(h-2)*12+7]=u.y,n[(h-2)*12+8]=u.z,n[(h-2)*12+9]=p.x,n[(h-2)*12+10]=p.y,n[(h-2)*12+11]=p.z,n[(h-2)*12+12]=p.x,n[(h-2)*12+13]=p.y,n[(h-2)*12+14]=p.z,n[(h-2)*12+15]=r.x,n[(h-2)*12+16]=r.y,n[(h-2)*12+17]=r.z}_findNearestPointOnLine(n,r,h){const u=new d.Vector3().subVectors(r,n),g=new d.Vector3().subVectors(h,n),p=u.lengthSq(),y=g.dot(u)/p;return new d.Vector3().addVectors(n,u.multiplyScalar(y))}_computeBoundingBox(){this.geometry.computeBoundingBox()}_requiredBufferLength(n){return n<2?0:n===2?6:6+(n-2)*12}getExtent(n,r,h){h.push({x:null,y:null,width:null,height:null})}shuffleExtent(n,r,h){}renderLabel(n,r){if(this.visible&&this._labelsVisible&&(this._numPoints>2||this._drawing&&this._following)){this._numLabels=0;const h=new d.Vector3,u=new d.Vector3,g=new d.Vector3,p=this.geometry.attributes.position.array;let y=0;const x=this._following?this._numPoints-1:this._numPoints-2;for(let w=0;w<x;w++)u.fromArray(p,w*12+12),g.fromArray(p,w*12+15),y=u.distanceTo(g),h.lerpVectors(u,g,.5),this._numLabels++,this._numLabels>this._labels.length&&this._constructLabel(),this._labels[this._numLabels-1].style="left",this._labels[this._numLabels-1].position.copy(h),this._labels[this._numLabels-1].setLabel(y,this._globalUniforms.units.value),this._labels[this._numLabels-1].project(n,r,!1),this._labels[this._numLabels-1].setVisibility(!0);for(let w=this._numLabels;w<this._labels.length;w++)this._labels[w].setVisibility(!1)}else{for(let h=0;h<this._labels.length;h++)this._labels[h].setVisibility(!1);this._numLabels=0}}_computeBoundingSphere(){this.geometry.computeBoundingSphere(),this._points.geometry.computeBoundingSphere()}dispose(){this.material.dispose(),this.geometry.dispose(),this._points.dispose()}}},D,V),D.exports=B},5310:(D,V,f)=>{var R,B;R=[f(6127),f(2700)],B=f.dj.d(R,function(d,N){return class extends d{_newObject(l,n,r){return new N(l,n)}}},D,V),D.exports=B},3600:(D,V,f)=>{var R,B;R=[f(3681),f(9032)],B=f.dj.d(R,function(d,N){return class extends N{constructor(l=0,n){super("text",n.container.value,n.isDarkTheme.value),this.ID=l,this._fixToViewport=!1,this.element.style.borderStyle="none"}render(l,n){let r="50%",h="0";if(this.verticalAlignment===2?r="0":this.verticalAlignment===1&&(r="100%"),this.horizontalAlignment===2?h="-50%":this.horizontalAlignment===1&&(h="-100%"),this._fixToViewport)this.element.style.left=this.position.x*n.width+"px",this.element.style.bottom=this.position.y*n.height+"px";else{const u=this._projectPosition(l);if(u.z>1){this.element.style.visibility="hidden";return}this.element.style.left=Math.round((u.x+1)*n.width/2)+"px",this.element.style.bottom=Math.round((u.y+1)*n.height/2)+"px"}this.element.style.transform="translate("+h+", "+r+")",this.element.style.visibility=this.visible?"visible":"hidden"}getExtent(l,n,r){if(this.extent.width!==null){const h=new d.Vector2;if(this._fixToViewport)h.set(this.position.x*l.x,this.position.y*l.y);else{const u=this._projectPosition(n);if(u.z<1)h.set(Math.round((u.x+1)*l.x/2),Math.round((u.y+1)*l.y/2));else{this.extent.x=null,this.extent.y=null;return}}this.verticalAlignment===0?h.y=h.y-this.extent.height/2:this.verticalAlignment===1&&(h.y=h.y-this.extent.height),this.horizontalAlignment===2?h.x=h.x-this.extent.width/2:this.horizontalAlignment===1&&(h.x=h.x-this.extent.width),this.extent.x=h.x,this.extent.y=h.y}r.push(this.extent)}setColor(l){const n=new d.Color;n.fromArray(l),super.setColor(n)}setPosition(l){l.length===2?(this.position.set(l[0],l[1],0),this._fixToViewport=!0):(this.position.fromArray(l),this._fixToViewport=!1)}setLabel(l){super.setLabel(l===null?"":l,"")}remove(){this.setVisibility(!1)}}},D,V),D.exports=B},5178:(D,V,f)=>{var R,B;R=[f(6127),f(3600)],B=f.dj.d(R,function(d,N){return class extends d{render(l,n){for(let r=0;r<this._numObjects;r++)this.objects[r].render(l,n)}clear(){for(let l=0;l<this._numObjects;l++)this.objects[l].remove();this._numObjects=0}getLength(){return this._numObjects}getExtent(l,n,r){for(let h=0;h<this._numObjects;h++)this.objects[h].getExtent(l,n,r)}add(l,n,r,h,u,g,p){if(this._numObjects+=1,this._numObjects>this.objects.length){const y=this._newObject(u,this._annotationUniforms,g);this.objects.push(y)}return this.objects[this._numObjects-1].horizontalAlignment=p[0],this.objects[this._numObjects-1].verticalAlignment=p[1],this.objects[this._numObjects-1].setLabel(r),this.objects[this._numObjects-1].setPosition(l),this.objects[this._numObjects-1].setColor(h),this.objects[this._numObjects-1].ID=u,this.objects[this._numObjects-1].setVisibility(n),this._annotationUniforms.checkExtent.value&&this.objects[this._numObjects-1].checkExtent(),this._getObject(this._numObjects-1)}_newObject(l,n,r){return new N(l,n)}}},D,V),D.exports=B},4639:(D,V,f)=>{var R,B;R=[f(3681),f(6164),f(9032)],B=f.dj.d(R,function(d,N,_){return class extends d.Points{constructor(n=0,r,h=0){const u=new d.BufferGeometry,g=[0,0,0];u.setAttribute("position",new d.Float32BufferAttribute(g,3)),u.computeBoundingSphere();const p=N,y=d.UniformsUtils.clone(p.uniforms);y.edgeColor.value=r.edgeColor.value,y.pointSize.value=r.pointSize.value;const x=new d.ShaderMaterial({transparent:!0,fog:!1,depthTest:!1,depthWrite:!1,uniforms:y,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader});super(u,x),this.type="Thumbnail",this.visible=!1,this._showLabel=!1,this.selected=!1,this.color=new d.Color(16777215),this.ID=n,this._globalUniforms=r,this.pickable=!0,this._translate=!0,this._label=null}raycast(n,r){if(this.visible&&this.pickable&&this._translate)if(n.camera.type==="PerspectiveCamera"){const h=n.params.Points.threshold;n.params.Points.threshold=h*n.camera.position.distanceTo(this.position),super.raycast(n,r),n.params.Points.threshold=h}else super.raycast(n,r)}highlight(){this._translate&&(this.material.opacity=1,this.material.uniforms.pointSize.value=this._globalUniforms.pointSizeHighlighted.value,this._label!==null&&this._label.highlight())}show(){this.material.opacity=1,this.material.uniforms.pointSize.value=this._globalUniforms.pointSize.value,this._label!==null&&this._label.show(this.selected)}hide(){this.material.opacity=0}select(n){this.selected===!0&&n===!0?this.deselect():(this.selected=!0,this.material.uniforms.color.value.copy(this._globalUniforms.selectedColor.value),this._setLabelColor(),this._label!==null&&this._label.highlight())}deselect(){this.selected=!1,this.material.uniforms.color.value.copy(this.color),this._setLabelColor()}setTheme(n){this._label!==null&&this._label.setTheme(n)}getPosition(){return this.position.toArray()}onPointerDown(){this.material.uniforms.interactive.value=1}onPointerUp(){this.material.uniforms.interactive.value=0}setPosition(n){this.position.fromArray(n),this.refreshLabel()}setColor(n){this.color.fromArray(n),this.selected?this.material.uniforms.color.value.copy(this._globalUniforms.selectedColor.value):this.material.uniforms.color.value.fromArray(n),this._setLabelColor()}setLabel(){}editLabel(n){}stopEditing(n){return!1}getLabel(){return this._label!==null?this._label.getLabel():null}showLabel(){this._label!==null&&(this._label.setVisibility(!0),this._showLabel=!0)}hideLabel(){this._label!==null&&this._label.setVisibility(!1),this._showLabel=!1}clear(){}remove(){this.visible=!1,this.selected=!1,this._label!==null&&this._label.setVisibility(!1)}setVisible(n){n>0?(this.visible=!0,n===1||n===4?this._translate=!0:this._translate=!1):(this.visible=!1,this.selected=!1,this._translate=!1),this._label!==null&&this._label.setVisibility(n>0)}applyQuaternion(){}applyTransformation(n,r,h,u,g,p,y){this._translate&&(u?this.position.sub(y):this.position.copy(n),this._clampPointToSceneLimits(this.position,r),this.refreshLabel())}setImage(n){if(this._globalUniforms.labelVisible.value===!1){this._showLabel=!1,this.frustumCulled=!0;return}if(n[0]>0&&n[1]>0){this._label===null&&(this._constructLabels(),this._canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this._label.element.appendChild(this._canvas),this._label.element.style.padding="3px 3px 0px 2px",this._context=this._canvas.getContext("2d"),this._showLabel=!0),this._canvas.width=n[0],this._canvas.height=n[1];const r=this._context.createImageData(n[0],n[1]);for(let h=0;h<n[0]*n[1];h++)r.data[h*4]=n[h*3+2],r.data[h*4+1]=n[h*3+3],r.data[h*4+2]=n[h*3+4],r.data[h*4+3]=255;this._context.putImageData(r,0,0)}else this._showLabel=!1,this._label!==null&&this._label.setVisibility(!1);this._showLabel&&this._globalUniforms.checkExtent.value&&this._label.checkExtent(),this.frustumCulled=!this._showLabel}refreshLabel(){this._showLabel!==!1&&this._label!==null&&(this._label.position.copy(this.position),this._globalUniforms.checkExtent.value&&this._label.checkExtent())}getLastMarker(){return this}close(){}_clampPointToSceneLimits(n,r){this._globalUniforms.clampToSceneLimits.value&&n.clamp(r.min,r.max)}_constructLabels(){this._label=new _("location",this._globalUniforms.container.value,this._globalUniforms.isDarkTheme.value),this.frustumCulled=!1}_setLabelColor(){this._label!==null&&(this._label.setColor(this.material.uniforms.color.value),this._label.show(this.selected))}renderLabel(n,r){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.project(n,r,this._globalUniforms.checkExtent.value)}getExtent(n,r,h){this.visible===!0&&this._showLabel===!0&&this._label!==null?this._label.getExtent(n,r,h):h.push({x:null,y:null,width:null,height:null})}shuffleExtent(n,r,h){this.visible===!0&&this._showLabel===!0&&this._label!==null&&this._label.shuffleExtent(n,r,h)}dispose(){this.material.dispose(),this.geometry.dispose()}}},D,V),D.exports=B},193:(D,V,f)=>{var R,B;R=[f(6127),f(4639)],B=f.dj.d(R,function(d,N){return class extends d{add(l,n,r,h,u,g,p=[0,0]){if(this._numObjects+=1,this._numObjects>this.objects.length){const y=this._newObject(u,this._annotationUniforms,g);this._scene.add(y),this.objects.push(y)}return this.objects[this._numObjects-1].setLabel(r),this.objects[this._numObjects-1].setImage(p.slice(0,2+p[0]*p[1]*3)),this.objects[this._numObjects-1].setColor(h),this.objects[this._numObjects-1].setPosition(l),this.objects[this._numObjects-1].ID=u,this.objects[this._numObjects-1].setVisible(n),this._getObject(this._numObjects-1)}_newObject(l,n){const r=new N(l,n,1);return r.pickable=n.pickable.value,r}}},D,V),D.exports=B},5872:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.LineSegments{constructor(_){const l=new d.BufferGeometry,n=new d.LineBasicMaterial({toneMapped:!1,transparent:!0,depthTest:!0,depthWrite:!1});super(l,n),this.type="Grid",this._empty=!0,this._color=new d.Color(1,1,1),this._boundingSphere=new d.Sphere,this._gridCenter=new d.Vector3,this._positionMode="auto",this._sizeMode="auto",this._positionNeedsUpdate=!1,this._update(_)}update(_){this._update(_)}setVisible(_){this._empty=_,this._visible&&!this._empty?this.visible=!0:this.visible=!1}setColor(_){_[0]+_[1]+_[2]>2?this.material.color.setRGB(0,0,0):this.material.color.setRGB(1,1,1)}setPosition(_){_.getCenter(this._gridCenter),_.getBoundingSphere(this._boundingSphere),this._gridCenter.z=_.min.z,this._sizeMode==="auto"&&(this._positionNeedsUpdate=!0)}_update(_){if(this.material.opacity=_.Alpha,this._visible=_.Visible,this._positionMode!==_.PositionMode&&(this._positionMode=_.PositionMode,this._positionNeedsUpdate=!0),this._sizeMode!==_.SizeMode&&(this._sizeMode=_.SizeMode,this._positionNeedsUpdate=!0),this._size!==_.Size&&(this._size=_.Size,this._sizeMode!=="auto"&&(this._positionNeedsUpdate=!0)),this._positionMode!=="auto"){const l=Array.from(_.Position);(l[0]!==this.position.x||l[1]!==this.position.y||l[2]!==this.position.z)&&(this._positionNeedsUpdate=!0),this.position.set(l[0],l[1],l[2])}this._numRadialDivisions!==_.NumRadialDivisions&&(this._numRadialDivisions=_.NumRadialDivisions,this._positionNeedsUpdate=!0),this._numDivisions!==_.NumDivisions&&(this._numDivisions=_.NumDivisions,this._positionNeedsUpdate=!0),this._style!==_.Style&&(this._style=_.Style,this._positionNeedsUpdate=!0)}updateMatrixWorld(_){if(this._positionNeedsUpdate){this._positionNeedsUpdate=!1,this._positionMode==="auto"&&this.position.copy(this._gridCenter);const l=[],n=this._sizeMode==="auto"?this._boundingSphere.radius:this._size;if(this._style==="cartesian"){if(this._numDivisions>0){const r=2*n/this._numDivisions,h=n;for(let u=0,g=-h;u<=this._numDivisions;u++,g+=r)l.push(-h,g,0,h,g,0),l.push(g,-h,0,g,h,0)}}else{if(this._numRadialDivisions>0)for(let r=0;r<this._numRadialDivisions;r++){const h=r/this._numRadialDivisions*(Math.PI*2),u=Math.sin(h)*n,g=Math.cos(h)*n;l.push(0,0,0),l.push(u,g,0)}if(this._numDivisions>0)for(let h=0;h<=this._numDivisions;h++){const u=n-n/this._numDivisions*h;for(let g=0;g<64;g++){let p=g/64*(Math.PI*2),y=Math.sin(p)*u,x=Math.cos(p)*u;l.push(y,x,0),p=(g+1)/64*(Math.PI*2),y=Math.sin(p)*u,x=Math.cos(p)*u,l.push(y,x,0)}}}this.geometry.setAttribute("position",new d.Float32BufferAttribute(l,3)),this.geometry.computeBoundingSphere()}super.updateMatrixWorld(_)}}},D,V),D.exports=B},5753:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.EventDispatcher{constructor(_){super(),this.enabled=!1,this.visible=!1,this.icon="warning",this._showFix=!1,this._colorSum=1,this._init(_)}show(){this.visible=!0,this._element.style.visibility="visible",this._closeElement.style.visibility="visible",this._showFix?(this._buttonElement.style.display="inline",this._buttonElement.style.visibility="visible"):(this._buttonElement.style.display="none",this._buttonElement.style.visibility="hidden")}hide(){this.visible&&(this.visible=!1,this._element.style.visibility="hidden",this._closeElement.style.visibility="hidden",this._buttonElement.style.visibility="hidden")}resize(_){this._element.style.width=_.width-26+"px"}update(_){if(this.enabled=_.Enabled,this.enabled){if(Object.prototype.hasOwnProperty.call(_,"Text"))switch(this._showFix=_.ShowFix,this.icon=_.Icon,this._textElement.innerHTML=_.Text+(this._showFix?" ":""),this._buttonElement.innerHTML=_.FixText,_.DisplayStyle){case"optional":this.hide();break;case"static":this.show();break}}else this.clear()}clear(){this._element.style.visibility="hidden",this._closeElement.style.visibility="hidden",this._buttonElement.style.visibility="hidden",this.visible=!1,this._textElement.innerHTML="",this._buttonElement.innerHTML=""}setColor(_){this._colorSum=_,_>2?(this._element.style.color="#212121",this._element.style.backgroundColor="white",this._closeElement.style.filter="invert(0%)"):(this._element.style.color="#D9D9D9",this._element.style.backgroundColor="#121212",this._closeElement.style.filter="invert(100%)")}dispose(){this._closeElement.removeEventListener("click",this._closeClicked.bind(this)),this._closeElement.removeEventListener("pointerenter",this._closeHovered.bind(this)),this._closeElement.removeEventListener("pointerleave",this._closeHovered.bind(this)),this._buttonElement.removeEventListener("click",this._applyFix.bind(this))}_closeClicked(){this.enabled=!1,this.clear(),this.dispatchEvent({type:"messageClosed",message:!1})}_applyFix(){this.enabled=!1,this.clear(),this.dispatchEvent({type:"messageClosed",message:!0})}_closeHovered(_){_.type==="pointerenter"?this._colorSum>2?this._closeElement.style.filter="invert(20%)":this._closeElement.style.filter="invert(75%)":this._colorSum>2?this._closeElement.style.filter="invert(0%)":this._closeElement.style.filter="invert(100%)"}_init(_){this._element=document.createElement("div"),this._element.className="iptInfo",_.appendChild(this._element),this._closeElement=document.createElement("div"),this._closeElement.className="iptInfoClose",_.appendChild(this._closeElement),this._textElement=document.createElement("div"),this._textElement.style.display="inline",this._element.appendChild(this._textElement),this._buttonElement=document.createElement("button"),this._buttonElement.style.display="inline",this._element.appendChild(this._buttonElement),this._closeElement.addEventListener("click",this._closeClicked.bind(this)),this._closeElement.addEventListener("pointerenter",this._closeHovered.bind(this)),this._closeElement.addEventListener("pointerleave",this._closeHovered.bind(this)),this._buttonElement.addEventListener("click",this._applyFix.bind(this))}}},D,V),D.exports=B},9015:(D,V,f)=>{var R,B;R=[f(3681),f(9032)],B=f.dj.d(R,function(d,N){return class extends N{constructor(l=0,n,r){super("text",n.container.value,n.isDarkTheme.value),this.ID=l,this._fixToViewport=!0,this.element.style.borderStyle="none",this.element.style.visibility="hidden",this.element.style.display="flex",this.element.style.alignItems="center",this.element.style.padding="2px",this.element.style.margin="7px",this.element.style.transitionProperty="visibility",this.element.style.transitionDelay="0.2s",this.setPosition([0,0]),this.verticalAlignment=2,this.horizontalAlignment=0,this._zoomCanvasSize=42,this._magToolVisible=!0,this._colorElement=r,this._colorElement.style.display="inline-block",this._colorElement.style.visibility="inherit",this._colorElement.style.margin="2px",this._colorElement.style.transitionProperty="visibility",this._colorElement.style.transitionDelay="0.2s",this._updateZoomCanvasSize(),this.element.appendChild(this._colorElement),this._textElement=document.createElement("div"),this._textElement.style.display="inline",this.element.appendChild(this._textElement)}render(l,n){let r="50%",h="0";if(this.verticalAlignment===2?r="0":this.verticalAlignment===1&&(r="100%"),this.horizontalAlignment===2?h="-50%":this.horizontalAlignment===1&&(h="-100%"),this._fixToViewport)this.element.style.left=this.position.x*n.width+"px",this.element.style.bottom=this.position.y*n.height+"px";else{const u=new d.Vector3;u.copy(this.position),u.project(l),this.element.style.left=Math.round((u.x+1)*n.width/2)+"px",this.element.style.bottom=Math.round((u.y+1)*n.height/2)+"px"}this.element.style.transform="translate("+h+", "+r+")"}setColor(l){const n=new d.Color;n.fromArray(l),super.setColor(n)}setPosition(l){l.length===2?(this.position.set(l[0],l[1],0),this._fixToViewport=!0):(this.position.fromArray(l),this._fixToViewport=!1)}setVisibility(l,n){this.visible!==l&&(this.visible=l,n?(this.element.style.transitionDelay="0.2s",this._colorElement.style.transitionDelay="0.2s"):(this.element.style.transitionDelay="0s",this._colorElement.style.transitionDelay="0s"),this.visible?(this._textElement.style.margin="0px",this._textElement.innerHTML=""):(this.element.style.visibility="hidden",this._colorElement.style.visibility="hidden"))}updateZoomCanvasSize(l){const n=this._zoomCanvasSize;l.width>=800&&l.height>=800?n!==56&&(this._zoomCanvasSize=56,this._updateZoomCanvasSize()):n!==42&&(this._zoomCanvasSize=42,this._updateZoomCanvasSize())}setLabel(l){const n=l.replaceAll("\u21B5",` 
`);this._textElement.style.margin=n===""?"0px":"0px 2px 0px 2px",this.visible&&(this._textElement.innerHTML=n),this.element.style.visibility=this.visible?"visible":"hidden",this._colorElement.style.visibility=this.visible&&this._magToolVisible?"visible":"hidden"}_updateZoomCanvasSize(){this._colorElement.style.width=this._zoomCanvasSize+"px",this._colorElement.style.height=this._zoomCanvasSize+"px",this._colorElement.width=this._zoomCanvasSize,this._colorElement.height=this._zoomCanvasSize;const l=this._colorElement.getContext("2d",{willReadFrequently:!0});l.imageSmoothingEnabled=!1}remove(){this.setVisibility(!1,!1)}}},D,V),D.exports=B},7533:(D,V,f)=>{var R,B;R=[f(3681),f(5833)],B=f.dj.d(R,function(d,N){return class extends N{constructor(l){super(),this._xLabel=l.getElementsByClassName("iptOrientationAxesX")[0],this._yLabel=l.getElementsByClassName("iptOrientationAxesY")[0],this._zLabel=l.getElementsByClassName("iptOrientationAxesZ")[0],this._size=50,this._visible=!0,this._empty=!0,this._viewportSize=new d.Vector4(0,0,100,100),this._viewportPlaceholder=new d.Vector4,this._eye=new d.Vector3,this._line=null,this._xLocation=new d.Vector3,this._yLocation=new d.Vector3,this._zLocation=new d.Vector3,this.enabled=!1,this._scene=new d.Scene,this._camera=new d.OrthographicCamera(-this._size,this._size,this._size,-this._size,1,1e3),this.reset()}render(l,n,r,h){this._eye.subVectors(n.position,h.u_cameraTarget.value),this._eye.multiplyScalar(100/this._eye.length()),this._camera.position.copy(this._eye),this._camera.up.copy(n.up),this._camera.lookAt(this._scene.position),l.getViewport(this._viewportPlaceholder),l.setViewport(this._viewportSize),l.render(this._scene,this._camera);const u=new d.Vector3(this._size,0,0),g=new d.Vector3(0,this._size,0),p=new d.Vector3(0,0,this._size);u.project(this._camera).addScalar(1).multiplyScalar(this._size).round(),g.project(this._camera).addScalar(1).multiplyScalar(this._size).round(),p.project(this._camera).addScalar(1).multiplyScalar(this._size).round(),this._xLocation.copy(u),this._yLocation.copy(g),this._zLocation.copy(p),this.enabled&&(this._xLabel.style.visibility==="hidden"&&this._setLabelVisibility(!0),this._updateLabelLocation()),l.setViewport(this._viewportPlaceholder)}dispose(){this._line.material.dispose(),this._line.geometry.dispose(),this._scene.clear()}setLabels(l){this._xLabel.innerHTML=l[0],this._yLabel.innerHTML=l[1],this._zLabel.innerHTML=l[2]}setVisible(l,n,r,h){this._visible=l,this._empty=n,this._visible&&!this._empty?r>=2*this._size&&h>=2*this._size?this.enabled=!0:(this.enabled=!1,this._setLabelVisibility(!1)):(this.enabled=!1,this._setLabelVisibility(!1))}get visible(){return this._visible}reset(){const l=[0,0,0,this._size,0,0,0,0,0,0,this._size,0,0,0,0,0,0,this._size],n=[.72,.19,.17,1,.48,.45,0,.5,.07,.58,.94,.52,.09,.34,.65,.33,.71,1],r=new d.BufferGeometry;r.setAttribute("position",new d.Float32BufferAttribute(l,3)),r.setAttribute("color",new d.Float32BufferAttribute(n,3));const h=new d.LineBasicMaterial({vertexColors:!0,toneMapped:!1,depthTest:!1,depthWrite:!1});this._line=new d.LineSegments(r,h),this._scene.add(this._line)}_setLabelVisibility(l){l&&this.enabled?(this._updateLabelLocation(),this._xLabel.style.visibility="visible",this._yLabel.style.visibility="visible",this._zLabel.style.visibility="visible"):(this._xLabel.style.visibility="hidden",this._yLabel.style.visibility="hidden",this._zLabel.style.visibility="hidden")}_updateLabelLocation(){this._xLabel.style.left=Math.max(this._xLocation.x-10,0)+"px",this._yLabel.style.left=Math.max(this._yLocation.x-10,0)+"px",this._zLabel.style.left=Math.max(this._zLocation.x-10,0)+"px",this._xLabel.style.bottom=this._xLocation.y+"px",this._yLabel.style.bottom=this._yLocation.y+"px",this._zLabel.style.bottom=this._zLocation.y+"px"}}},D,V),D.exports=B},1584:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.LineSegments{constructor(_){const l=new d.BufferGeometry,n=[1,0,0,-1,0,0,0,1,0,0,-1,0];l.setAttribute("position",new d.Float32BufferAttribute(n,3));const r=new d.LineBasicMaterial({toneMapped:!1,transparent:!1,depthWrite:!1,depthTest:!1});super(l,r),this.type="Plus",this.visible=!1,this.pickable=!1,this._view=new d.Vector3,this._globalUniforms=_}updateMatrixWorld(_){this.visible&&(this._view.copy(this.position).add(this._globalUniforms.eye.value),this.lookAt(this._view),super.updateMatrixWorld(_))}raycast(_,l){if(this.visible&&this.pickable){const n=_.params.Line.threshold;_.params.Line.threshold=n*3,super.raycast(_,l),_.params.Line.threshold=n}}copyParameters(_,l,n){this.position.copy(_),this.scale.copy(l).multiplyScalar(.309),this.material.color.copy(n)}}},D,V),D.exports=B},9782:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){return class{constructor(N,_=!1){this.enabled=!_,this.visible=!1,this.value=100,this._indeterminantSpinner=document.createElement("div"),this._indeterminantSpinner.className="iptIndeterminantSpinner",N.appendChild(this._indeterminantSpinner),this._indeterminantSpinner.appendChild(document.createElement("div")),this._indeterminantSpinner.appendChild(document.createElement("div")),this._indeterminantSpinner.appendChild(document.createElement("div")),this._indeterminantSpinner.appendChild(document.createElement("div")),this._indeterminantSpinner.appendChild(document.createElement("div")),this._determinantSpinner=document.createElement("div"),this._determinantSpinner.className="iptDeterminantSpinner",N.appendChild(this._determinantSpinner),this._leftSide=document.createElement("div"),this._leftSide.className="iptDeterminantSpinnerLeft",this._determinantSpinner.appendChild(this._leftSide),this._rotateSide=document.createElement("div"),this._rotateSide.className="iptDeterminantSpinnerRotate",this._leftSide.appendChild(this._rotateSide),this._rightSide=document.createElement("div"),this._rightSide.className="iptDeterminantSpinnerRight",this._leftSide.appendChild(this._rightSide);const l=document.createElement("div");l.className="iptDeterminantSpinnerBackground",this._determinantSpinner.appendChild(l)}setDeterminant(N){this.enabled&&(N===0?(this.value=0,this.setIndeterminant(!0)):N>=100?(this.value=100,this.setIndeterminant(!1)):(this._rotateSide.style.transform="rotate("+N*3.6+"deg)",this._rightSide.style.visibility=N>50?"visible":"hidden",this._leftSide.style.clipPath=N>50?"none":"inset(0px 0px 0px 11px)",this._determinantSpinner.style.visibility="visible",this._showIndeterminant(!1),this.visible=!0))}setIndeterminant(N){this.enabled&&(this._showDeterminant(!1),this._showIndeterminant(N),this.visible=N)}_showIndeterminant(N){this._indeterminantSpinner.style.opacity=N===!0?1:0}_showDeterminant(N){this._determinantSpinner.style.visibility=N===!0?"visible":"hidden",this._rightSide.style.visibility=N===!0?"visible":"hidden"}}},D,V),D.exports=B},2487:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class extends d.EventDispatcher{constructor(_){super(),this._visible=!0,this._empty=!0,this.units="voxels",this._bar=null,this._label=null,this._updateRequired=!1,this._minWidth=170,this._minHeight=52,this._style="measure",this._valueEdited=!1,this._zoomValue="0",this._colorSum=1,this._init(_)}setStyle(_){this._style!==_&&(this._style=_,this._style==="measure"?(this._element.style.height="22px",this.disable()):(this._element.style.height="16px",this.enable()))}disable(){this._label.style.pointerEvents="none",this._label.style.cursor="default",this._label.style.userSelect="none",this._label.contentEditable=!1,this._label.blur()}enable(){this._label.style.pointerEvents="auto",this._label.style.cursor="text",this._label.style.userSelect="text",this._label.contentEditable=!0}setColor(_){this._colorSum=_[0]+_[1]+_[2],this._bar.style["background-color"]=this._colorSum>2?"rgb(0,0,0)":"rgb(255,255,255)",this._label.style.color=this._colorSum>2?"rgb(0,0,0)":"rgb(255,255,255)",this._background.style.backgroundColor=this._colorSum>2?"rgb(255,255,255)":"rgb(0,0,0)",this._bar.style.opacity=this._colorSum>2?"1.0":"0.8",this._label.style.opacity=this._colorSum>2?"1.0":"0.8"}setVisible(_,l,n){this._visible=_,this._empty=l,this._minWidth=n===!0?270:170,this._updateRequired=!0}get visible(){return this._visible}render(_,l,n){const r=this._empty===!1&&this._visible===!0;this._updateRequired===!0&&(this._updateRequired=!1,l>=this._minWidth&&n>=this._minHeight?(this._bar.style.visibility=r===!0&&this._style==="measure"?"visible":"hidden",this._label.style.visibility=r===!0?"visible":"hidden",this._background.style.visibility=r===!0?"visible":"hidden"):(this._bar.style.visibility="hidden",this._label.style.visibility="hidden",this._background.style.visibility="hidden")),r&&(this._style==="measure"?this._renderMeasure(_,l):this._renderZoom(_,l))}_renderMeasure(_,l){const n=(_.right-_.left)/_.zoom*(160/l),r=Math.floor(Math.log10(n));let h=Math.pow(10,r);h<n*.2&&(h=h*5);const u=h/n*160;if(this.units==="m"||this.units==="mm")this._customMetricSystemUnits(h,r);else if(Math.abs(r)>3)this._label.innerHTML=h.toExponential(1)+" "+this.units;else{let g=0;r===-3?g=3:r===-2?g=2:r===-1&&(g=1),h===1?this.units==="voxels"?this._label.innerHTML=h.toFixed(g)+" voxel":this.units==="pixels"?this._label.innerHTML=h.toFixed(g)+" pixel":this._label.innerHTML=h.toFixed(g)+" "+this.units:this._label.innerHTML=h.toFixed(g)+" "+this.units}this._bar.style.width=u+"px",u>100?(this._element.style.width=u+4+"px",this._label.style.right=2+u/2-50+"px",this._bar.style.right="2px"):(this._element.style.width="104px",this._label.style.right="2px",this._bar.style.right=2+(100-u)/2+"px")}_renderZoom(_,l){let n=100*(l*_.zoom)/(_.right-_.left);const r=Math.floor(Math.log10(n));n>=10?(n=Math.round(n),this._zoomValue=n.toFixed(0)):r<-2?this._zoomValue=n.toExponential(1):this._zoomValue=n.toFixed(Math.abs(Math.abs(r)+1)),this._label.innerHTML=this._zoomValue+"%",this._element.style.width="104px",this._label.style.right="2px"}_customMetricSystemUnits(_,l){if(this.units==="m")switch(l){case-11:_*=1e9,this._label.innerHTML=_.toFixed(2)+" nm";break;case-10:_*=1e9,this._label.innerHTML=_.toFixed(1)+" nm";break;case-9:case-8:case-7:_*=1e9,this._label.innerHTML=_.toFixed(0)+" nm";break;case-6:case-5:case-4:_*=1e6,this._label.innerHTML=_.toFixed(0)+" &mu;m";break;case-3:case-2:case-1:_*=1e3,this._label.innerHTML=_.toFixed(0)+" mm";break;case 0:case 1:case 2:this._label.innerHTML=_.toFixed(0)+" m";break;case 3:case 4:case 5:case 6:_/=1e3,this._label.innerHTML=_.toFixed(0)+" km";break;default:this._label.innerHTML=_.toExponential(1)+" "+this.units}else switch(l){case-8:_*=1e6,this._label.innerHTML=_.toFixed(2)+" nm";break;case-7:_*=1e6,this._label.innerHTML=_.toFixed(1)+" nm";break;case-6:case-5:case-4:_*=1e6,this._label.innerHTML=_.toFixed(0)+" nm";break;case-3:case-2:case-1:_*=1e3,this._label.innerHTML=_.toFixed(0)+" &mu;m";break;case 0:case 1:case 2:this._label.innerHTML=_.toFixed(0)+" mm";break;case 3:case 4:case 5:_/=1e3,this._label.innerHTML=_.toFixed(0)+" m";break;case 6:case 7:case 8:_/=1e6,this._label.innerHTML=_.toFixed(0)+" km";break;default:this._label.innerHTML=_.toExponential(1)+" "+this.units}}_onKeyPress(_){this._valueEdited=!0;const l=_.keyCode<=57&&_.keyCode>=48||_.keyCode<=105&&_.keyCode>=96,n=_.keyCode===110||_.keyCode===190||_.keyCode===8||_.keyCode===37||_.keyCode===39||_.keyCode===69;_.keyCode===13&&(_.preventDefault(),this._label.blur()),l||n?this._valueEdited=!0:_.preventDefault()}_onBlur(_){if(this._background.style.opacity=.4,this._label.style.textOverflow="ellipsis",this._valueEdited){if(this._valueEdited=!1,this._style==="measure")return;const l=parseFloat(this._label.innerHTML);isNaN(l)?this._label.innerHTML=this._zoomValue+"%":this.dispatchEvent({type:"scaleBarEdited",message:l})}}_onFocus(_){this._background.style.opacity=this._colorSum>2?.8:.6,this._label.style.textOverflow="clip";const l=document.createRange(),n=window.getSelection();n.removeAllRanges(),l.selectNodeContents(this._label),n.addRange(l)}_onHover(_){this._fadeScaleBar(_.type==="pointerenter")}_fadeScaleBar(_){const l=_===!0?this._colorSum>2?.8:.6:.4;this._background.style.opacity=l}_init(_){this._element=document.createElement("div"),this._element.className="iptScaleBar",_.appendChild(this._element),this._bar=document.createElement("div"),this._bar.className="iptScaleBarLine",this._background=document.createElement("div"),this._background.style.transitionProperty="opacity",this._background.style.transitionDuration="2s",this._background.style.transitionTimingFunction="ease-in-out",this._background.className="iptBackground",this._label=document.createElement("div"),this._label.className="iptScaleBarLabel",_.appendChild(this._label),this._label.innerHTML="",this._element.appendChild(this._background),this._element.appendChild(this._bar),this._element.appendChild(this._label),this._label.addEventListener("keydown",this._onKeyPress.bind(this)),this._label.addEventListener("blur",this._onBlur.bind(this)),this._label.addEventListener("focus",this._onFocus.bind(this)),this._label.addEventListener("pointerenter",this._onHover.bind(this)),this._label.addEventListener("pointerleave",this._onHover.bind(this))}}},D,V),D.exports=B},9632:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return class{constructor(_){this._visible=!0,this._empty=!0,this._lines=null,this._init(_)}setVisible(_,l){this._visible=_,this._empty=l,this._update()}get visible(){return this._visible}setColor(_){_[0]+_[1]+_[2]>2?this._lines.material.color.setRGB(0,0,0):this._lines.material.color.setRGB(.8,.8,.8)}setPosition(_){const l=[_.max.x,_.max.y,_.max.z,_.min.x,_.max.y,_.max.z,_.min.x,_.min.y,_.max.z,_.max.x,_.min.y,_.max.z,_.max.x,_.max.y,_.min.z,_.min.x,_.max.y,_.min.z,_.min.x,_.min.y,_.min.z,_.max.x,_.min.y,_.min.z];this._lines.geometry.setAttribute("position",new d.Float32BufferAttribute(l,3))}_update(){this._visible&&!this._empty?this._lines.visible=!0:this._lines.visible=!1}_init(_){const l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new d.BufferGeometry;r.setIndex(new d.BufferAttribute(l,1)),r.setAttribute("position",new d.Float32BufferAttribute(n,3));const h=new d.LineBasicMaterial({color:8947848,toneMapped:!1,depthWrite:!1,depthTest:!0});this._lines=new d.LineSegments(r,h),this._lines.visible=!1,_.add(this._lines)}}},D,V),D.exports=B},8213:(D,V,f)=>{var R,B;R=[f(3681),f(5833),f(2981)],B=f.dj.d(R,function(d,N,_){return class extends N{constructor(n,r){super(),this._mesh=null,this._scene=new d.Scene,this._camera=new d.OrthographicCamera(-1,1,1,-1,-1,0),this.clearColor=n,this.clearAlpha=r!==void 0?r:0,this._defaultGradientColor=new d.Color(36863),this._gradientDefines="#define USE_GRADIENT",this._useGradient=!0,this._needsUpdate=!1,this._init(n)}update(n,r,h){const u=new d.Color(n[0],n[1],n[2]),g=new d.Color(r[0],r[1],r[2]);this._needsUpdate=this._useGradient!==h,this.clearColor=u,this.clearAlpha=0,this._defaultGradientColor=g,this._mesh.material.uniforms.u_outerColor.value=u,this._mesh.material.uniforms.u_innerColor.value=g,this._useGradient=h,this._gradientDefines=this._useGradient===!0?"#define USE_GRADIENT":"",this._needsUpdate&&this._updateFragmentShader()}render(n,r,h,u){n.setRenderTarget(null),n.setClearColor(this.clearColor,1),n.render(this._scene,this._camera)}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}reset(){this._init(this.clearColor)}_updateFragmentShader(){this._mesh.material.fragmentShader=this._getFragmentShader(),this._mesh.material.needsUpdate=!0}_getFragmentShader(){return[this._gradientDefines,this._shader.fragmentShader].join(`
`)}_init(n){const r=new d.PlaneGeometry(2,2,1);this._shader=_;const h=d.UniformsUtils.clone(this._shader.uniforms),u=new d.Color(n);h.u_outerColor.value=u,h.u_innerColor.value=this._defaultGradientColor;const g=new d.ShaderMaterial({depthTest:!1,depthWrite:!1,uniforms:h,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader(),side:d.DoubleSide});this._mesh=new d.Mesh(r,g),this._mesh.frustumCulled=!1,this._scene.add(this._mesh)}}},D,V),D.exports=B},3716:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){return{defines:{TOLERANCE:1e-6},uniforms:{u_compositeA:{value:null},u_compositeB:{value:null},u_depthA:{value:null},u_depthB:{value:null},nearClip:{value:0},farClip:{value:1}},vertexShader:`varying vec2 vUv;
        void main() {
            vUv = uv;
            gl_Position = vec4( position.xy, 0.0, 1.0 );
        }`,fragmentShader:`precision highp sampler2D;
        varying vec2 vUv;
        uniform sampler2D u_compositeA;
        uniform sampler2D u_compositeB;

        #ifdef WRITE_DEPTH
            uniform sampler2D u_depthA;
            uniform sampler2D u_depthB;
            uniform float nearClip;
            uniform float farClip;

            float linearizeDepth(float depth) {

                if (isOrthographic) {
                    return depth;
                } else {
                    float z = depth * 2.0 - 1.0;
                    return (2.0 * nearClip * farClip) / (farClip + nearClip - z * (farClip - nearClip));
                }
                
            }
        #endif

        void main() {
            
            // The "over" operator of this composite shader is designed to place the foreground image 
            // on top of the background image. This means that the foreground image's color and 
            // transparency directly influence the final appearance.

            // The foreground's RGB values are pre-multiplied by its alpha to ensure that its contribution 
            // to the final color is proportional to its opacity. This prevents the color from being overly 
            // diminished by its transparency.

            // The background image is not pre-multiplied by its own alpha in this operation because its 
            // contribution is modulated by the inverse of the foreground's alpha. This means the 
            // background color shows through based on how transparent the foreground is.

            // The background's contribution is naturally scaled by the transparency of the foreground, 
            // which does not require pre-multiplication for the intended "over" effect.

            vec4 srcA = texture(u_compositeA,vUv);
            vec4 srcB = texture(u_compositeB,vUv);

            // Compute output transparency
            gl_FragColor.a = srcA.a + (srcB.a * (1.0 - srcA.a));

            // Premultiply foreground color by alpha
            srcA.rgb = srcA.rgb * srcA.a;

            // Composite premultiplied colors
            gl_FragColor.rgb = srcA.rgb + (srcB.rgb * (1.0 - srcA.a));

            // Revert alpha multiplication
            gl_FragColor.rgb = gl_FragColor.rgb / gl_FragColor.a;

            #ifdef WRITE_DEPTH

                float depthA = linearizeDepth( texture(u_depthA,vUv).x );
                float depthB = linearizeDepth( texture(u_depthB,vUv).x );

                float finalDepth = 0.0;

                float maxDepth = max(depthA,depthB);
                float minDepth = min(depthA,depthB);

                if (maxDepth > TOLERANCE) {
                    finalDepth = mix(maxDepth, minDepth, float(minDepth > TOLERANCE));
                }

                if (isOrthographic) {
                    gl_FragDepth = finalDepth;
                } else {
                    gl_FragDepth = (2.0 * nearClip) / (farClip + nearClip - finalDepth * (farClip - nearClip));
                }

            #endif
        }`}},D,V),D.exports=B},4720:(D,V,f)=>{var R,B;R=[f(3681),f(5833),f(3053),f(3176)],B=f.dj.d(R,function(d,N,_,l){return class extends N{constructor(){super(),this._denoise=!1,this.reset()}render(r,h,u,g,p,y){y===void 0?r.setRenderTarget(null):r.setRenderTarget(y),this._uniforms.tDiffuse.value=u.texture,this._uniforms.tDepth.value=g.texture,this._uniforms.screenRectangle.value=p.u_screenRectangle.value,this._quad.render(r)}blend(r,h,u,g,p,y,x){x===void 0?r.setRenderTarget(null):r.setRenderTarget(x),this._uniforms.tDiffuse.value=u.texture,this._uniforms.tDepth.value=g.texture,this._uniforms.tDeferred.value=p.texture,this._uniforms.tDeferredDepth.value=p.depthTexture,this._uniforms.screenRectangle.value=y.u_screenRectangle.value,this._blendQuad.render(r)}reset(){this._shader=l,this._uniforms=d.UniformsUtils.clone(this._shader.uniforms),this._material=new d.ShaderMaterial({transparent:!0,defines:Object.assign({USE_RECTANGLE:1,USE_DEPTH:1,UNPACK_DEPTH:1},this._shader.defines),uniforms:this._uniforms,depthTest:!0,depthWrite:!0,depthFunc:d.AlwaysDepth,vertexShader:this._shader.vertexShader,fragmentShader:this._getFragmentShader()}),this._blendMaterial=new d.ShaderMaterial({transparent:!0,defines:Object.assign({USE_RECTANGLE:1,USE_DEPTH:1,UNPACK_DEPTH:1},this._shader.defines),uniforms:this._uniforms,depthTest:!0,depthWrite:!0,depthFunc:d.AlwaysDepth,vertexShader:this._shader.vertexShader,fragmentShader:this._getBlendFragmentShader()}),this._quad=new _(this._material),this._blendQuad=new _(this._blendMaterial)}setDenoising(r,h,u){const g=this._denoise;this._denoise=r,this._uniforms.spatialSigma.value=Math.min(h,20),this._uniforms.degreeOfSmoothing.value=u,this._denoise!==g&&this._updateFragmentShader()}_updateFragmentShader(){this._material.fragmentShader=this._getFragmentShader(),this._blendMaterial.fragmentShader=this._getBlendFragmentShader(),this._material.needsUpdate=!0,this._blendMaterial.needsUpdate=!0}_getFragmentShader(){return[this._denoise===!0?"#define DENOISE":"",this._shader.fragmentShader].join(`
`)}_getBlendFragmentShader(){return[this._denoise===!0?"#define DENOISE":"","#define BLEND_DEFERRED",this._shader.fragmentShader].join(`
`)}dispose(){this._material.dispose(),this._quad.dispose(),this._blendMaterial.dispose(),this._blendQuad.dispose()}}},D,V),D.exports=B},3176:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return{uniforms:{tDiffuse:{value:null},tDepth:{value:null},tDeferred:{value:null},tDeferredDepth:{value:null},opacity:{value:.618},screenRectangle:{value:new d.Vector4(0,0,1,1)},degreeOfSmoothing:{value:.05},spatialSigma:{value:3}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        precision highp sampler2D;
        #define INV_PI 0.31830988618379067153776752674503
        #define INV_SQRT2PI 0.39894228040143267793994605993439
        #define TOLERANCE 0.000001

        #ifdef BLEND_DEFERRED
            uniform sampler2D tDeferred;
            uniform sampler2D tDeferredDepth;
        #endif

        uniform float opacity;
        uniform sampler2D tDiffuse;

        #ifdef USE_RECTANGLE
            uniform vec4 screenRectangle;
        #endif

        #ifdef USE_DEPTH
            uniform sampler2D tDepth;
        #endif

        #ifdef DENOISE
            uniform float degreeOfSmoothing;
            uniform float spatialSigma;
        #endif

        varying vec2 vUv;

        const float UnpackDownscale = 255. / 256.;
        const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
        const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );

        #ifdef DENOISE
        vec4 denoise (vec4 centerPixel) {
            // Simplified version of bilateral filter. Precompute constants used
            // for approximating the gaussian kernel
            float sigmaSquared = spatialSigma * spatialSigma;
            float invSigma = 0.5 / sigmaSquared;
            float invSigma2PI = INV_PI * invSigma;
            float invThresholdSquared = 0.5 / (degreeOfSmoothing * degreeOfSmoothing);
            float invThresholdSqrt2PI = INV_SQRT2PI / degreeOfSmoothing;
            
            // Values used to compute final color
            float weightSum = 0.0;
            vec4 denoisedColor = vec4(0.0);
            #ifdef BLEND_DEFERRED
                vec2 size = vec2(textureSize( tDeferred, 0 ));
            #else
                vec2 size = vec2(textureSize( tDiffuse, 0 ));
            #endif
            
            for (float row = -spatialSigma; row <= spatialSigma; row++) {

                float pt = sqrt( sigmaSquared - row * row );

                for (float color = -pt; color <= pt; color++) {

                    vec2 d = vec2( row, color );
                    float blurFactor = exp( -dot( d, d ) * invSigma ) * invSigma2PI; 
                    
                    #ifdef BLEND_DEFERRED
                        vec4 neighborPixel =  texture( tDeferred, vUv+d / size );
                    #else
                        vec4 neighborPixel =  texture( tDiffuse, vUv+d / size );
                    #endif

                    vec4 diffVector = neighborPixel - centerPixel;
                    float intensityWeight = exp( -dot( diffVector, diffVector ) * invThresholdSquared) * blurFactor * INV_SQRT2PI / degreeOfSmoothing;
                                        
                    weightSum += intensityWeight;
                    denoisedColor += intensityWeight * neighborPixel;
                }
            }
            return denoisedColor / weightSum;
        }
        #endif

        float unpackRGBAToDepth( const in vec4 v ) {
            return dot( v, UnpackFactors );
        }

        void main () {
            #ifdef USE_DEPTH
                #ifdef UNPACK_DEPTH
                    float depth = unpackRGBAToDepth( texture2D( tDepth, vUv ) );
                #else
                    float depth = texture2D( tDepth, vUv ).x;
                #endif
            #endif

            #ifdef BLEND_DEFERRED

                float deferredDepth = texture2D( tDeferredDepth, vUv ).x;

                vec4 sceneColor = texture2D( tDiffuse, vUv );
                vec4 deferredColor = texture2D( tDeferred, vUv );
                vec4 color = vec4(0.0);

                #ifdef DENOISE
                    deferredColor = denoise(deferredColor);
                #endif

                // Premultiply colors
                sceneColor.rgb = sceneColor.rgb * sceneColor.a;
                deferredColor.rgb = deferredColor.rgb * deferredColor.a;

                if (deferredDepth > depth + TOLERANCE) {
                    // Render scene on top, composite premultiplied colors
                    color.rgb = sceneColor.rgb + (deferredColor.rgb * (1.0 - sceneColor.a));
                    color.a = sceneColor.a + (deferredColor.a * (1.0 - sceneColor.a));
                } else {
                    // Render deferred on top, composite premultiplied colors
                    color.rgb = deferredColor.rgb + (sceneColor.rgb * (1.0 - deferredColor.a));
                    color.a = deferredColor.a + (sceneColor.a * (1.0 - deferredColor.a));
                }

                color.rgb = color.rgb / color.a;

            #else

                vec4 color = texture2D( tDiffuse, vUv );
                #ifdef DENOISE
                    color = denoise(color);
                #endif

            #endif

            #ifdef USE_RECTANGLE
                float outsideRectangle = float(vUv.x < screenRectangle.x || vUv.y < screenRectangle.y || vUv.x > screenRectangle.z || vUv.y > screenRectangle.w);
                float appliedOpacity = 1.0 - (outsideRectangle * (1.0 - opacity));

                color.a *= appliedOpacity;
                gl_FragColor = color;                
            #else
                #ifdef USE_SSAA
                    // Used for applying supersampling antialiasing. The opacity is the weight of each pass
                    // and passes will be accumulated as an additive operation
                    gl_FragColor = color * opacity;
                #else
                    color.a *= opacity;
                    gl_FragColor = color;
                #endif
            #endif
            #ifdef USE_DEPTH
                gl_FragDepth = depth;
            #endif
        }`}},D,V),D.exports=B},174:(D,V,f)=>{var R,B;R=[f(3681),f(5833),f(3053),f(3716),f(3176),f(7205)],B=f.dj.d(R,function(d,N,_,l,n,r){return class extends N{constructor(u,g){super(),this._scene=u,this._overviewScene=g,this.compositeStyle="stencil",this.clearRequired=!1,this.reset()}render(u,g,p,y,x,w,M,T){switch(this.compositeStyle){case"direct":y.u_deferredTexture.value=null,u.setRenderTarget(p),u.render(this._scene,g);break;case"composite":y.u_deferredTexture.value=null,u.setRenderTarget(x),u.setClearColor(0,0),u.clear(),u.render(this._scene,g),u.setRenderTarget(M),u.setClearColor(0,0),u.clear(),this._uniforms.tDiffuse.value=p.texture,this._uniforms.tDepth.value=p.depthTexture,this._quad.render(u),this._compositeUniforms.u_compositeA.value=M.texture,this._compositeUniforms.u_compositeB.value=x.texture,this._compositeUniforms.u_depthA.value=M.depthTexture,this._compositeUniforms.u_depthB.value=x.depthTexture,this._compositeUniforms.farClip.value=g.far,this._compositeUniforms.nearClip.value=g.near,u.setRenderTarget(p),u.setClearColor(0,0),u.clear(),this._compositeQuad.render(u);break;case"stencil":y.u_deferredTexture.value=p.texture,this._stencil(u,g,p,y,T,x,w,!0);break;case"twopass":this.clearRequired===!0&&(u.setRenderTarget(x),u.setClearColor(0,0),u.clear(),this.clearRequired=!1),y.u_deferredTexture.value=x.texture,y.u_passNumber.value=0,this._stencil(u,g,p,y,T,w,!0),y.u_passNumber.value=2,this._stencil(u,g,x,y,T,w,!1),y.u_passNumber.value=0;break}}renderOverview(u,g,p,y){u.setRenderTarget(p),u.setClearColor(0,0),u.clear(),u.render(this._overviewScene,g)}_stencil(u,g,p,y,x,w,M){const T=u.getContext();u.setRenderTarget(x),u.setClearColor(0,0),u.clear(),T.enable(T.STENCIL_TEST),T.stencilOp(T.KEEP,T.KEEP,T.REPLACE),T.stencilFunc(T.ALWAYS,1,255),u.render(this._scene,g),M===!0&&(T.disable(T.STENCIL_TEST),u.setRenderTarget(w),this._maskUniforms.tDiffuse.value=x.texture,this._maskUniforms.threshold.value=.05,this._maskQuad.render(u),u.setRenderTarget(x),T.enable(T.STENCIL_TEST)),T.stencilFunc(T.EQUAL,0,255),T.stencilOp(T.KEEP,T.KEEP,T.KEEP),this._stencilUniforms.tDiffuse.value=p.texture,this._stencilQuad.render(u),T.disable(T.STENCIL_TEST),u.setRenderTarget(p),u.setClearColor(0,0),u.clear(),this._stencilUniforms.tDiffuse.value=x.texture,this._stencilQuad.render(u)}reset(){const u=l;this._compositeUniforms=d.UniformsUtils.clone(u.uniforms),this._compositeMaterial=new d.ShaderMaterial({transparent:!0,defines:Object.assign({WRITE_DEPTH:1},u.defines),uniforms:this._compositeUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:d.NoBlending,depthTest:!0,depthFunc:d.AlwaysDepth,depthWrite:!0}),this._compositeQuad=new _(this._compositeMaterial);const g=n;this._uniforms=d.UniformsUtils.clone(g.uniforms),this._uniforms.opacity.value=1,this._material=new d.ShaderMaterial({transparent:!0,defines:Object.assign({USE_DEPTH:1},g.defines),uniforms:this._uniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,blending:d.NoBlending,depthTest:!0,depthFunc:d.AlwaysDepth,depthWrite:!0}),this._quad=new _(this._material);const p=n;this._stencilUniforms=d.UniformsUtils.clone(p.uniforms),this._stencilUniforms.opacity.value=1,this._stencilMaterial=new d.ShaderMaterial({transparent:!0,defines:Object.assign({},p.defines),uniforms:this._stencilUniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,blending:d.NoBlending}),this._stencilQuad=new _(this._stencilMaterial);const y=r;this._maskUniforms=d.UniformsUtils.clone(y.uniforms),this._maskMaterial=new d.ShaderMaterial({transparent:!0,defines:Object.assign({},y.defines),uniforms:this._maskUniforms,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,blending:d.NoBlending}),this._maskQuad=new _(this._maskMaterial)}dispose(){this._material.dispose(),this._quad.dispose(),this._compositeMaterial.dispose(),this._compositeQuad.dispose(),this._stencilMaterial.dispose(),this._stencilQuad.dispose()}}},D,V),D.exports=B},334:(D,V,f)=>{var R,B;R=[f(3681),f(7431),f(3510),f(3053)],B=f.dj.d(R,function(d,N,_,l){return class extends N{constructor(r){super(),this._depthScene=r,this._bufferRequired=!0,this._peelRequired=!1,this._separatePassRequired=!1,this.clearBuffer=!0,this.reset()}render(r,h,u,g,p,y,x,w,M){!this._peelRequired&&!this._bufferRequired||(h.layers.enable(17),(this._peelRequired||this._separatePassRequired)&&(g.u_passNumber.value=0,r.setRenderTarget(w),this.clearBuffer&&r.clear(),r.render(this._depthScene,h)),r.setRenderTarget(M),this.clearBuffer&&(r.setClearColor(16777215,1),r.clear()),this._peelRequired||this._separatePassRequired?this._depthUniforms.tDiffuse.value=w.depthTexture:this._depthUniforms.tDiffuse.value=u.depthTexture,this._quad.render(r),h.layers.disable(17))}updateForPeel(r){this._peelRequired=r,this.enabled=this._peelRequired||this._bufferRequired}updateForBuffer(r,h){this._bufferRequired=r,this._separatePassRequired=h,this.enabled=this._peelRequired||this._bufferRequired}reset(){const r=_;this._depthUniforms=d.UniformsUtils.clone(r.uniforms),this._depthMaterial=new d.ShaderMaterial({uniforms:this._depthUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,depthTest:!0,depthWrite:!0,premultipliedAlpha:!0,transparent:!0,blending:d.NoBlending}),this._quad=new l(this._depthMaterial)}}},D,V),D.exports=B},5504:(D,V,f)=>{var R,B;R=[f(3681),f(5833),f(3053),f(3716),f(3510)],B=f.dj.d(R,function(d,N,_,l,n){return class extends N{constructor(h,u,g,p,y){super(),this._scene=h,this._depthScene=u,this.maxPasses=100,this.useExitCondition=!0,this.exitCheckPeriod=3,this.exitTolerance=1e-4,this.viewDepth=0,this.minPasses=1e6,this._hardwareSupport=g.hardwareSupport,this.reset(g.uniforms,p,y)}render(h,u,g,p,y,x,w,M){let T=Math.min(this.maxPasses,this.minPasses),A=this.useExitCondition&&(this.minPasses>10||!this._hardwareSupport),C=!1,z=0,H=!0;const q=[];this.viewDepth!==0&&(A=!1,T=this.viewDepth);const P=h.getClearColor,Z=h.getClearAlpha;h.setClearColor(0,0),p.u_passNumber.value=1,p.u_depthTexture.value=M.depthTexture;const K=[y,x];if(h.setRenderTarget(w),h.clear(),h.setRenderTarget(K[0]),h.clear(),h.setRenderTarget(K[1]),h.clear(),T===1?h.setRenderTarget(g):A&&this._updateTextureCache(w.width*w.height),T>1)for(let Y=0;Y<p.lights.length;Y++)q.push(p.lights[Y].object.intensity);h.render(this._scene,u);for(let Y=1;Y<T;Y++){const k=(Y-1)%2,ae=Y%2;if(Y===T-1&&(C=!0),h.setRenderTarget(this._depthRenderTarget),h.clear(),this._depthUniforms.tDiffuse.value=M.depthTexture,this._quad.render(h),p.u_previousTexture.value=this._depthRenderTarget.depthTexture,h.setRenderTarget(M),h.clear(),p.u_passNumber.value=2,h.render(this._depthScene,u),p.u_passNumber.value=1,p.u_depthTexture.value=M.depthTexture,Y>1)for(let j=0;j<p.lights.length;j++)p.lights[j].object.intensity*=.5;if(h.setRenderTarget(w),h.clear(),h.render(this._scene,u),C?h.setRenderTarget(g):(h.setRenderTarget(K[k]),h.clear()),this._uniforms.u_compositeA.value=K[ae].texture,this._uniforms.u_compositeB.value=w.texture,this._compositeQuad.render(h),C)break;if(A&&Y%this.exitCheckPeriod===0){H?h.readRenderTargetPixels(K[k],0,0,K[k].width,K[k].height,this._bufferA):h.readRenderTargetPixels(K[k],0,0,K[k].width,K[k].height,this._bufferB),H=!H,z=0;for(let j=0;j<this._bufferA.length/4;j++)(this._bufferA[j*4]!==this._bufferB[j*4]||this._bufferA[j*4+1]!==this._bufferB[j*4+1]||this._bufferA[j*4+2]!==this._bufferB[j*4+2]||this._bufferA[j*4+3]!==this._bufferB[j*4+3])&&(z=z+1);z/this._bufferA.length<this.exitTolerance&&(C=!0)}else A&&(Y-1)%this.exitCheckPeriod===0&&(H?h.readRenderTargetPixels(K[k],0,0,K[k].width,K[k].height,this._bufferA):h.readRenderTargetPixels(K[k],0,0,K[k].width,K[k].height,this._bufferB),H=!H)}if(this.viewDepth===0&&(p.u_depthTexture.value=null,p.u_previousTexture.value=null),p.u_passNumber.value=0,q.length>0)for(let Y=0;Y<p.lights.length;Y++)p.lights[Y].object.intensity=q[Y];h.setClearColor(P,Z)}setSize(h,u){this._depthRenderTarget.setSize(h,u)}dispose(){this._depthRenderTarget.dispose(),this._material.dispose(),this._depthMaterial.dispose(),this._quad.dispose(),this._compositeQuad.dispose()}reset(h,u,g){this._bufferA=[],this._bufferB=[],this._depthRenderTarget=new d.WebGLRenderTarget(u,g,{minFilter:d.LinearFilter,magFilter:d.LinearFilter,format:d.RGBAFormat,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!0}),this._depthRenderTarget.depthTexture=new d.DepthTexture,this._depthRenderTarget.depthTexture.type=d.FloatType;const p=l;this._uniforms=d.UniformsUtils.clone(p.uniforms),this._material=new d.ShaderMaterial({uniforms:this._uniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:d.NoBlending}),this._compositeQuad=new _(this._material);const y=n;this._depthUniforms=d.UniformsUtils.clone(y.uniforms),this._depthUniforms.u_depthTexture=h.u_depthTexture,this._depthMaterial=new d.ShaderMaterial({uniforms:this._depthUniforms,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,depthTest:!0,depthWrite:!0}),this._quad=new _(this._depthMaterial)}_updateTextureCache(h){h*4!==this._bufferA.length?(this._bufferA=new Uint8Array(h*4),this._bufferB=new Uint8Array(h*4)):this._bufferB.fill(0)}}},D,V),D.exports=B},3510:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){return{uniforms:{tDiffuse:{value:null}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tDiffuse;
        varying vec2 vUv;

        vec4 packDepthToRGBA( float depth ) {
            vec3 packFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0 );
            float shiftRight8 = 1.0 / 256.0; // Handle overflow
            float packUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
            
            vec4 rgba = vec4( fract(depth * packFactors), depth);
            rgba.yzw -= rgba.xyz * shiftRight8;
            return rgba * packUpscale;
        }

        void main() {
            float depth = texture( tDiffuse, vUv ).x;
            if (depth == 1.0) {
                discard;
            }
            gl_FragColor = packDepthToRGBA( depth );
            gl_FragDepth = depth;
        }`}},D,V),D.exports=B},7431:(D,V,f)=>{var R,B;R=[f(3681),f(5833),f(3053),f(5607)],B=f.dj.d(R,function(d,N,_,l){return class extends N{constructor(){super(),this.reset()}render(r,h,u,g){this._uniforms.tDiffuse.value=g.u_depthTexture.value,this._uniforms.cameraNear.value=h.near,this._uniforms.cameraFar.value=h.far,this._uniforms.isOrthographic.value=h.isOrthographicCamera===!0?1:0,r.setRenderTarget(u),r.clear(),this._quad.render(r),g.u_depthTexture.value=null,g.u_previousTexture.value=null}dispose(){this._material.dispose(),this._quad.dispose()}reset(){const r=l;this._uniforms=d.UniformsUtils.clone(r.uniforms),this._material=new d.ShaderMaterial({uniforms:this._uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this._quad=new _(this._material)}}},D,V),D.exports=B},5607:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){return{uniforms:{tDiffuse:{value:null},cameraNear:{value:0},cameraFar:{value:1},isOrthographic:{value:!0}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tDiffuse;
        uniform float cameraNear;
        uniform float cameraFar;
        varying vec2 vUv;

        float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
            return ( viewZ + near ) / ( near - far );
        }

        float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
            return ( near * far ) / ( ( far - near ) * invClipZ - far );
        }

        float readDepth() {
            float fragCoordZ = texture2D( tDiffuse, vUv ).x;
            if ( isOrthographic ) {
                return fragCoordZ;
            } else {
                float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
                return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );
            }
        }

        void main() {
            gl_FragColor = vec4( 1.0 - vec3( readDepth() ), 1.0 );
        }`}},D,V),D.exports=B},6620:(D,V,f)=>{var R,B;R=[f(3681),f(5833),f(3053),f(1707),f(8073)],B=f.dj.d(R,function(d,N,_,l,n){return class extends N{constructor(h){super(),this._scene=h,this.numPasses=100,this.currentPass=1,this.reset()}render(h,u,g,p,y,x,w,M){if(!this.enabled){this.currentPass=this.numPasses;return}const T=p.u_primaryLight.value;this._enableLayer(u,1,16);const A=p.u_primaryLight.value.clone(),C=p.u_primaryLightIntensity;p.u_primaryLight.value=A;const z=new d.Vector3;z.subVectors(T,p.u_cameraTarget.value),this._setRandomLightPosition(A,z,p),this.currentPass===1&&(h.setRenderTarget(x),h.setClearColor(0,0),h.clear(),h.setRenderTarget(w),h.setClearColor(0,0),h.clear(),h.setRenderTarget(y),h.setClearColor(0,0),h.clear(),h.render(this._scene,u),this._packedLightUniforms.lightColor.value=p.u_lightColor.value,this._packedLightUniforms.ambientStrength.value=p.u_ambientStrength.value),p.u_passNumber.value=4,h.setRenderTarget(M),h.setClearColor(0,0),h.clear(),h.render(this._scene,u);const H=this.currentPass%2;H===1?(h.setRenderTarget(x),this._uniforms.accumulatedLightMap.value=w.texture):(h.setRenderTarget(w),this._uniforms.accumulatedLightMap.value=x.texture);const q=1/this.currentPass;this._uniforms.newLightMap.value=M.texture,this._uniforms.weight.value=q,this._quad.render(h),h.setRenderTarget(g),h.setClearColor(0,0),h.clear(),this._packedLightUniforms.tDiffuse.value=y.texture,this._packedLightUniforms.tDepth.value=y.depthTexture,H===1?this._packedLightUniforms.lightMap.value=x.texture:this._packedLightUniforms.lightMap.value=w.texture,this._packedLightQuad.render(h),this.currentPass<this.numPasses&&(this.currentPass=this.currentPass+1),p.u_primaryLight.value=T,p.u_primaryLightIntensity=C,p.u_passNumber.value=0,this._disableLayer(u,1,16)}reset(){const h=l;this._uniforms=d.UniformsUtils.clone(h.uniforms),this._material=new d.ShaderMaterial({defines:Object.assign({},h.defines),uniforms:this._uniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:d.NoBlending,depthTest:!1,depthWrite:!1}),this._quad=new _(this._material);const u=n;this._packedLightUniforms=d.UniformsUtils.clone(u.uniforms),this._lightMaterial=new d.ShaderMaterial({defines:Object.assign({},u.defines),uniforms:this._packedLightUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:d.NormalBlending,depthTest:!0,depthFunc:d.AlwaysDepth,depthWrite:!0}),this._packedLightQuad=new _(this._lightMaterial)}dispose(){this._material.dispose(),this._quad.dispose(),this._lightMaterial.dispose(),this._packedLightQuad.dispose()}_setRandomLightPosition(h,u,g){const p=this._getTotalIntensity(g);if(this.currentPass>1){const y=Math.random();let x=0;for(let w=0;w<g.lights.length;w++)if(g.lights[w].visible&&(x+=g.lights[w].intensity/p.total,y<=x)){h.copy(g.lights[w].position),this._findLocationOnLight(h,u.length()*g.lights[w].size),g.u_primaryLightIntensity.value=p.primary;break}}else h.copy(g.lights[p.primaryIdx].position),g.u_primaryLightIntensity.value=g.lights[p.primaryIdx].intensity}_getTotalIntensity(h){let u=0,g=-1,p=0;for(let y=0;y<h.lights.length;y++)h.lights[y].visible&&(p+=h.lights[y].intensity,h.lights[y].intensity>g&&(u=y,g=h.lights[y].intensity));return{total:p,primaryIdx:u,primary:g}}_findLocationOnLight(h,u){const g=this._randomVector();g.setLength(u),h.add(g)}_randomVector(){const h=(Math.random()-.5)*2,u=Math.random()*Math.PI*2,g=Math.sqrt(1-h**2);return new d.Vector3(g*Math.cos(u),g*Math.sin(u),h)}}},D,V),D.exports=B},1707:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){return{uniforms:{accumulatedLightMap:{value:null},newLightMap:{value:null},weight:{value:1}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform float weight;
        uniform sampler2D accumulatedLightMap;
        uniform sampler2D newLightMap;
        varying vec2 vUv;

        const float packFactors = 256.0;
        const float shiftRight8 = 1.0 / 256.0;
        const float packUpscale = 256.0 / 255.0;
        const float unpackDownscale = 255.0 / 256.0;
        const vec2 unpackFactors = unpackDownscale / vec2( packFactors, 1.0 );

        vec4 packVec2ToRGBA( vec2 vals ) {
            vec4 rgba = vec4(fract(vals.x * packFactors), vals.x, fract(vals.y * packFactors), vals.y);
            rgba.g -= rgba.r * shiftRight8;
            rgba.a -= rgba.b * shiftRight8;
            return rgba * packUpscale;
        }

        vec2 unpackRGBAToVec2( vec4 rgba ) {
            return vec2(dot(rgba.xy, unpackFactors), dot(rgba.zw, unpackFactors));
        }

        void main() {

            // Read accumulated light map
            vec2 texel = unpackRGBAToVec2( texture2D( accumulatedLightMap, vUv ) );

            // Read new light map
            vec2 light = unpackRGBAToVec2( texture2D( newLightMap, vUv ) );

            // Find difference in light strength between new and accumulared light map
            vec2 color = light - texel;

            // Add the difference to the existing light map, scaled by the weight to
            // account for a cumulative average
            gl_FragColor = packVec2ToRGBA( texel + (color * weight) );

        }`}},D,V),D.exports=B},8073:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return{uniforms:{tDiffuse:{value:null},lightColor:{value:new d.Vector4(1,1,1,1)},lightMap:{value:null},tDepth:{value:null},ambientStrength:{value:.3}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDepth;
        uniform float ambientStrength;
        uniform sampler2D lightMap;
        uniform vec4 lightColor;
        varying vec2 vUv;

        const float packFactors = 256.0;
        const float unpackDownscale = 255.0 / 256.0;
        const vec2 unpackFactors = unpackDownscale / vec2( packFactors, 1.0 );

        vec2 unpackRGBAToVec2( vec4 rgba ) {
            return vec2(dot(rgba.xy, unpackFactors), dot(rgba.zw, unpackFactors));
        }

        void main() {

            vec4 color = texture2D( tDiffuse, vUv );

            vec2 texel = unpackRGBAToVec2( texture2D( lightMap, vUv ) );
            float lambertTerm = texel.x;
            float specularTerm = texel.y;

            vec4 ambientColor = lightColor * ambientStrength;
            vec4 diffuseColor = lightColor * lambertTerm;
            vec4 specularColor = lightColor * specularTerm * lambertTerm;

            // Calculate final color by combining different components
            // Some implementations sum all three light components before multiplying
            // with the color. This keeps the color from getting saturated. If we
            // pull out the specularColor term and add it later, it can create a
            // color lighter than the original color, giving a glossy effect.
            vec4 finalColor = ( color * (ambientColor + diffuseColor) + specularColor );

            // Keep the previous transparency
            finalColor.a = color.a;
            gl_FragColor = finalColor;
            gl_FragDepth = texture2D( tDepth, vUv ).x;

        }`}},D,V),D.exports=B},7205:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){return{uniforms:{tDiffuse:{value:null},threshold:{value:.05}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform float threshold;
        uniform sampler2D tDiffuse;
        varying vec2 vUv;

        void main() {
            vec4 texel = texture2D( tDiffuse, vUv );
            if ( texel.a < threshold ) {
                discard;
            }
            gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }`}},D,V),D.exports=B},2659:(D,V,f)=>{var R,B;R=[f(3681),f(5833),f(3053),f(2131)],B=f.dj.d(R,function(d,N,_,l){return class extends N{constructor(r){super(),this.reset(),this.initialized=!1,this.activated=!1,this.clearRequired=!1,this._uniforms.currentLocation.value=r.u_currentPosition.value,this._uniforms.u_viewportSize.value=r.u_viewportSize.value}render(r,h,u,g,p,y,x){this.activated?(r.setRenderTarget(p),this._uniforms.tDepth.value=g.texture,this.initialized||this._uniforms.priorLocation.value.copy(y.u_currentPosition.value),this._quad.render(r),this._uniforms.priorLocation.value.copy(y.u_currentPosition.value),this.initialized=!0,this._setRenderTarget(r,x),this._uniforms.tDiffuse.value=p.texture,this._blendQuad.render(r)):this.initialized?(this._setRenderTarget(r,x),this._uniforms.tDiffuse.value=p.texture,this._blendQuad.render(r)):(this._setRenderTarget(r,x),this._uniforms.tDepth.value=g.texture,this._hoverQuad.render(r))}reset(){this._shader=l,this._uniforms=d.UniformsUtils.clone(this._shader.uniforms),this._material=new d.ShaderMaterial({transparent:!0,defines:Object.assign({USE_DEPTH:1,UNPACK_DEPTH:1},this._shader.defines),uniforms:this._uniforms,depthTest:!1,depthWrite:!1,vertexShader:this._shader.vertexShader,fragmentShader:this._shader.fragmentShader}),this._quad=new _(this._material),this._blendMaterial=new d.ShaderMaterial({transparent:!0,defines:Object.assign({APPLY_ACCUMULATION:1},this._shader.defines),uniforms:this._uniforms,depthTest:!1,depthWrite:!1,vertexShader:this._shader.vertexShader,fragmentShader:this._shader.fragmentShader}),this._blendQuad=new _(this._blendMaterial),this._hoverMaterial=new d.ShaderMaterial({transparent:!0,defines:Object.assign({USE_DEPTH:1,UNPACK_DEPTH:1,ON_HOVER:1},this._shader.defines),uniforms:this._uniforms,depthTest:!1,depthWrite:!1,vertexShader:this._shader.vertexShader,fragmentShader:this._shader.fragmentShader}),this._hoverQuad=new _(this._hoverMaterial)}_setRenderTarget(r,h){h===void 0?r.setRenderTarget(null):r.setRenderTarget(h)}initialize(r,h,u){this._uniforms.color.value.fromArray(r),this._uniforms.opacity.value=h,this._uniforms.brushSize.value=u}dispose(){this._material.dispose(),this._quad.dispose(),this._blendMaterial.dispose(),this._blendQuad.dispose(),this._hoverMaterial.dispose(),this._hoverQuad.dispose()}}},D,V),D.exports=B},2131:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){return{uniforms:{tDiffuse:{value:null},tDepth:{value:null},color:{value:new d.Vector3(1,1,1)},opacity:{value:.3141},brushSize:{value:15},currentLocation:{value:new d.Vector2(0,0)},priorLocation:{value:new d.Vector2(0,0)},u_viewportSize:{value:new d.Vector2(1,1)}},vertexShader:`
        varying vec2 vUv;

        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        precision highp sampler2D;
        #define TOLERANCE 0.000001

        #ifdef USE_DEPTH
            uniform sampler2D tDepth;
        #endif

        #ifdef APPLY_ACCUMULATION
            uniform sampler2D tDiffuse;
        #endif

        uniform float opacity;
        uniform vec3 color;  
        uniform float brushSize;

        uniform vec2 currentLocation;
        uniform vec2 priorLocation;
        uniform vec2 u_viewportSize;

        varying vec2 vUv;

        const float UnpackDownscale = 255. / 256.;
        const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
        const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );

        float unpackRGBAToDepth( const in vec4 v ) {
            return dot( v, UnpackFactors );
        }

        float distanceSquared(vec2 pointA, vec2 pointB) {
            vec2 dist = pointA - pointB;
            return dot(dist, dist);
        }

        float pointLineDistanceSquared(vec2 point, vec2 lineStart, vec2 lineEnd) {
            vec2 line = lineEnd - lineStart + 1e-10;
            vec2 toPoint = point - lineStart;
            float t = max(0.0, min(1.0, dot(toPoint, line) / dot(line, line)));
            vec2 projection = lineStart + t * line;
            return distanceSquared(projection, point);
        }

        void main () {

            #ifdef USE_DEPTH
                #ifdef UNPACK_DEPTH
                    float depth = unpackRGBAToDepth( texture2D( tDepth, vUv ) );
                #else
                    float depth = texture2D( tDepth, vUv ).x;
                #endif

                #ifdef ON_HOVER
                    float depthFactor = 1.0 - (0.5 * float(depth > 1.0 - TOLERANCE));
                #else
                    float depthFactor = 1.0 - float(depth > 1.0 - TOLERANCE);
                #endif
            #else
                float depthFactor = 1.0;
            #endif

            #ifdef APPLY_ACCUMULATION
                float mixFactor = texture2D( tDiffuse, vUv ).x;
                vec4 appliedColor = vec4(color, opacity);
            #else
                #ifdef ON_HOVER
                    float distSq = distanceSquared(gl_FragCoord.xy, currentLocation * u_viewportSize);
                    vec4 appliedColor = vec4(color, opacity * depthFactor);
                #else
                    float distSq = pointLineDistanceSquared(gl_FragCoord.xy, currentLocation * u_viewportSize, priorLocation * u_viewportSize);
                    vec4 appliedColor = vec4(depthFactor);
                #endif

                float mixFactor = step(distSq, brushSize * brushSize);
            #endif

            gl_FragColor = mix(vec4(0.0, 0.0, 0.0, 0.0), appliedColor, mixFactor);
        }`}},D,V),D.exports=B},5833:(D,V,f)=>{var R,B;R=[],B=f.dj.d(R,function(){return class{constructor(){this.enabled=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){}reset(){}_enableLayer(N,_,l){N.layers.disable(0),N.layers.disable(_),N.layers.enable(_+l)}_disableLayer(N,_,l){N.layers.enable(0),N.layers.enable(_),N.layers.disable(_+l)}}},D,V),D.exports=B},8133:(D,V,f)=>{var R,B;R=[f(3681),f(5833),f(3053),f(3176)],B=f.dj.d(R,function(d,N,_,l){return class extends N{constructor(r){super(),this._scene=r,this.antialias=!1,this.duringInteraction=!1,this.sampleLevel=5,this.unbiased=!0,this._jitterOffset=this._getJitterVectors(),this.reset()}render(r,h,u,g,p){this.renderToScreen?r.setRenderTarget(null):(g.u_passNumber.value=0,r.setRenderTarget(u),r.clear()),this.antialias&&!this.duringInteraction?this.renderSSAA(r,h,u,g,p):r.render(this._scene,h)}renderSSAA(r,h,u,g,p){const y=this._jitterOffset[Math.max(0,Math.min(this.sampleLevel,5))],x=1/y.length,w=1/32,M={fullWidth:u.width,fullHeight:u.height,offsetX:0,offsetY:0,width:u.width,height:u.height},T=new d.Color;r.getClearColor(T);const A=r.getClearAlpha();r.setClearColor(0,0),r.setRenderTarget(u),r.clear(),r.setRenderTarget(p),r.clear(),this._uniforms.tDiffuse.value=p.texture;for(let C=0;C<y.length;C++){const z=y[C];h.setViewOffset(M.fullWidth,M.fullHeight,M.offsetX+z[0]*.0625,M.offsetY+z[1]*.0625,M.width,M.height);let H=x;if(this.unbiased){const q=-.5+(C+.5)/y.length;H+=w*q}r.setRenderTarget(p),r.clear(),r.render(this._scene,h),r.setRenderTarget(u),this._uniforms.opacity.value=H,this._quad.render(r)}h.clearViewOffset(),r.setClearColor(T,A)}reset(){const r=l;this._uniforms=d.UniformsUtils.clone(r.uniforms),this._material=new d.ShaderMaterial({defines:Object.assign({USE_SSAA:1},r.defines),uniforms:this._uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:d.AdditiveBlending,depthTest:!1,depthWrite:!1}),this._quad=new _(this._material)}dispose(){this._material.dispose(),this._quad.dispose()}_getJitterVectors(){return[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]]}}},D,V),D.exports=B},6508:(D,V,f)=>{var R,B;R=[f(3681),f(4720),f(8213),f(174),f(8133),f(334),f(5504),f(7431),f(6620),f(2659),f(7533)],B=f.dj.d(R,function(d,N,_,l,n,r,h,u,g,p,y){return class{constructor(w,M,T,A,C,z,H,q,P,Z,K,Y,k){this._antialias=!1,this._renderer=w,this.waitingToDraw=!1,this._init(),this._middlePasses=[],this._frontPasses=[],this._maxWidth=3840,this._maxHeight=2160,this._pixelScaleFactor=1,this._width=Math.min(Math.max(M.clientWidth,1),this._maxWidth),this._height=Math.min(Math.max(M.clientHeight,1),this._maxHeight),this._devicePixelRatio=window.devicePixelRatio,this._deferredBufferInUse=!1,this.clearOverview=!1,this._zoomDisplay=!1,this._zoomCanvas=A,this._zoomContext=A.getContext("2d"),this._canvas=T,this._context=T.getContext("2d"),this.depthPeelAllowed=!1,this.iterativeRendering=!1,this.outOfCoreRendering=!1,this._renderToScreen=new N,this._background=new _(C,1),this._deferredPass=new l(P,Z),this._orientationAxes=new y(M),this._renderPass=new n(z),this.addPass(this._renderPass),this._depthPass=new r(H),this._depthPass.enabled=!1,this.addPass(this._depthPass),this._depthPeelPass=new h(z,H,Y,k.width,k.height),this._depthPeelPass.enabled=!1,this.addPass(this._depthPeelPass),this._depthViewPass=new u,this._depthViewPass.enabled=!1,this.addPass(this._depthViewPass),this._iterativePass=new g(z),this._iterativePass.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio),this._paint=new p(Y.uniforms),this._paint.enabled=!1;const ae=new n(K);ae.renderToScreen=!0,this.addFrontPass(ae);const j=new n(q);j.renderToScreen=!0,this.addFrontPass(j)}addPass(w){this._middlePasses.push(w),w.setSize(Math.round(this._width*this._pixelRatio),Math.round(this._height*this._pixelRatio))}addFrontPass(w){this._frontPasses.push(w),w.setSize(this._width,this._height)}render(w,M){this._clearPaintBrush(),M.u_viewportSize.value.set(this._sceneBuffer.width,this._sceneBuffer.height),this._renderer.setClearColor(this._background.clearColor,this._background.clearAlpha),this._clearDeferredBuffer(),this._renderer.setRenderTarget(this._sceneBuffer),this._renderer.clear();for(let T=0,A=this._middlePasses.length;T<A;T++){const C=this._middlePasses[T];C.enabled!==!1&&C.render(this._renderer,w,this._sceneBuffer,M,this._renderTarget1,this._renderTarget2,this._renderTarget3,this._depthBuffer,this._depthRenderTarget)}this.outOfCoreRendering===!0&&this._deferredPass.renderOverview(this._renderer,w,this._renderTarget2,M),this.iterativeRendering===!0?(this._iterativePass.currentPass=1,this.renderIterativeLayer(w,M)):this.renderOverlay(w,M)}renderDeferredLayer(w,M){this._renderer.setRenderTarget(null),this._renderer.clear(),this._deferredBufferInUse===!1&&(this._deferredPass.clearRequired=!0),this._renderer.setRenderTarget(this._deferredBuffer),this._deferredBufferInUse=!0,this._deferredPass.render(this._renderer,w,this._deferredBuffer,M,this._renderTarget1,this._renderTarget2,this._renderTarget3,this._stencilTarget),this.clearOverview&&(this.clearOverview=!1,this._renderer.setRenderTarget(this._renderTarget2),this._renderer.clear()),this._depthPass.enabled&&(this._depthPass.clearBuffer=!1,this._depthPass.render(this._renderer,w,this._sceneBuffer,M,this._renderTarget1,this._renderTarget2,this._renderTarget3,this._depthBuffer,this._depthRenderTarget),this._depthPass.clearBuffer=!0),this.renderOverlay(w,M)}renderOverlay(w,M){this._renderBackground(w,M),this.outOfCoreRendering&&this._renderToScreen.render(this._renderer,w,this._renderTarget2,this._depthRenderTarget,M),this._deferredBufferInUse?this.iterativeRendering||this._deferredPass.compositeStyle==="composite"?this._renderToScreen.blend(this._renderer,w,this._sceneBuffer,this._depthRenderTarget,this._deferredBuffer,M):(this._renderToScreen.render(this._renderer,w,this._deferredBuffer,this._depthRenderTarget,M),this._renderToScreen.render(this._renderer,w,this._sceneBuffer,this._depthRenderTarget,M)):this._renderToScreen.render(this._renderer,w,this._sceneBuffer,this._depthRenderTarget,M),this._renderFrontLayer(w,M)}renderIterativeLayer(w,M){this._deferredBufferInUse=!0,this._iterativePass.render(this._renderer,w,this._deferredBuffer,M,this._renderTarget1,this._renderTarget2,this._renderTarget3,this._stencilTarget),this.renderOverlay(w,M)}_renderFrontLayer(w,M){if(this._paint.enabled&&this._paint.render(this._renderer,w,this._sceneBuffer,this._depthRenderTarget,this._renderTarget3,M),this._zoomDisplay){const T=Math.max(Math.ceil(M.u_currentPosition.value.x*this._width*this._devicePixelRatio)-1,0)-3,A=Math.max(Math.ceil((1-M.u_currentPosition.value.y)*this._height*this._devicePixelRatio)-1,0)-3;this._zoomContext.drawImage(this._renderer.domElement,T,A,7,7,0,0,this._zoomCanvas.width,this._zoomCanvas.height);const C=this._zoomContext.getImageData(Math.floor(this._zoomCanvas.width/2),Math.floor(this._zoomCanvas.height/2),1,1);C.data[0]+C.data[1]+C.data[2]>510?this._zoomContext.strokeStyle="black":this._zoomContext.strokeStyle="white",this._zoomContext.strokeRect(Math.floor(this._zoomCanvas.width/2)-4,Math.floor(this._zoomCanvas.height/2)-4,8,8)}this._orientationAxes.enabled===!0&&this._orientationAxes.render(this._renderer,w,this._sceneBuffer,M);for(let T=0,A=this._frontPasses.length;T<A;T++){const C=this._frontPasses[T];C.enabled!==!1&&C.render(this._renderer,w,this._sceneBuffer,M)}this._canvas.width=this._width,this._canvas.height=this._height,this._context.drawImage(this._renderer.domElement,0,0,this._canvas.width,this._canvas.height),this.waitingToDraw=!1}_renderBackground(w,M){this._renderer.setRenderTarget(null),this._renderer.clear(),this._background.render(this._renderer,w,this._sceneBuffer,M)}_clearDeferredBuffer(){this._deferredBufferInUse&&(this._renderer.setRenderTarget(this._deferredBuffer),this._renderer.clear(),this._deferredBufferInUse=!1,this._deferredPass.clearRequired=!0)}_clearPaintBrush(){this._paint.clearRequired&&(this._paint.clearRequired=!1,this._renderer.setRenderTarget(this._renderTarget3),this._renderer.setClearColor(0,0),this._renderer.clear())}dispose(){this.iterativeRendering=!1,this._sceneBuffer!==void 0&&this._sceneBuffer.dispose(),this._deferredBuffer!==void 0&&this._deferredBuffer.dispose(),this._stencilTarget!==void 0&&this._stencilTarget.dispose(),this._renderTarget1!==void 0&&this._renderTarget1.dispose(),this._renderTarget2!==void 0&&this._renderTarget2.dispose(),this._renderTarget3!==void 0&&this._renderTarget3.dispose(),this._depthBuffer!==void 0&&this._depthBuffer.dispose(),this._depthRenderTarget!==void 0&&this._depthRenderTarget.dispose(),this._background.dispose(),this._renderToScreen.dispose(),this._deferredPass.dispose(),this._iterativePass.dispose(),this._orientationAxes.dispose(),this._renderPass.dispose(),this._depthPeelPass.dispose(),this._depthViewPass.dispose()}reset(){this._init(),this._background.reset(),this._renderToScreen.reset(),this._paint.reset()}setAntialiasing(w){let M=!1;switch(w){case"msaa":this._renderPass.antialias=!1,M=!0;break;case"ssaa":this._renderPass.antialias=!0,M=!1;break;default:this._renderPass.antialias=!1,M=!1;break}this._antialias!==M&&(this._antialias=M,this.reset())}getDepthAtLocation(w,M){let T=Math.max(Math.ceil(w.x*this._depthRenderTarget.width)-1,0),A=Math.max(Math.ceil((1-w.y)*this._depthRenderTarget.height)-1,0),C=M;if(M>1){const Y=Math.round(C/2);T-Y<0||A-Y<0||T+Y>this._depthRenderTarget.width-1||A+Y>this._depthRenderTarget.height-1?C=1:(T-=Y,A-=Y)}const z=new Uint8Array(4*C*C);let H=0;const q=Math.round((C*C-1)/2);if(this._renderer.readRenderTargetPixels(this._depthRenderTarget,T,A,C,C,z),C>1){const Y=q-1;if(z[Y*4]<255||z[Y*4+1]<255||z[Y*4+2]<255||z[Y*4+3]<255)H=Y*4;else{const k=Math.round((C+1)/2),ae=new d.Vector2(k,k),j=new d.Vector2,F=new d.Vector2;let J=Number.MAX_VALUE,te=0,_e=!1;for(let ne=0;ne<C*C;ne++)(z[ne*4]<255||z[ne*4+1]<255||z[ne*4+2]<255||z[ne*4+3]<255)&&(F.set(ne%C+1,(ne-ne%C)/C+1),te=F.distanceTo(ae),te<J&&(j.copy(F),J=te,H=ne*4,_e=!0));_e===!0&&(j.sub(ae),w.x=w.x+j.x/this._depthRenderTarget.width,w.y=w.y-j.y/this._depthRenderTarget.height)}}const P=255/256,Z=new d.Vector4,K=new d.Vector4(P/(256*256*256),P/(256*256),P/256,P);return Z.fromArray(z,H).multiplyScalar(.00392156862745098).dot(K)}setDepthPeel(w,M){this.depthPeelAllowed=w,this._depthViewPass.enabled=w&&M!==0,this._iterativePass.enabled=M===0,this._depthPeelPass.viewDepth=M}setDepth(w,M,T){this._depthPeelPass.minPasses=w,this._depthPass.updateForBuffer(M,T)}setQualityParameters(w,M,T,A){this._depthPeelPass.maxPasses=w,this._depthPeelPass.useExitCondition=M,this._depthPeelPass.exitTolerance=T,this._depthPeelPass.enabled=A,this._renderPass.enabled=!A,this._depthPass.updateForPeel(A)}setDenoising(w,M,T){this._renderToScreen.setDenoising(w,M,T)}enablePaintPass(w,M,T,A){this._paint.initialize(M,T,A),this._paint.enabled=w}activatePaintPass(w){this._paint.activated=w}clearPaintPass(){this._paint.initialized&&(this._paint.clearRequired=!0,this._paint.initialized=!1)}setDeferredStyle(w,M){this._deferredPass.compositeStyle=w,this.outOfCoreRendering=M}getIterativeProgress(){return Math.floor(this._iterativePass.currentPass/this._iterativePass.numPasses*100)}setColor(w,M,T){this._background.update(w,M,T)}setMaxSize(w,M){(w[0]!==this._maxWidth||w[1]!==this._maxHeight)&&(this._maxWidth=w[0],this._maxHeight=w[1],this.setSize(this._width,this._height),this.setPixelRatio(M))}setAxesVisibility(w,M,T,A){this._orientationAxes.setVisible(w,M,T,A)}getAxesVisibility(){return this._orientationAxes.visible}setAxesLabels(w){this._orientationAxes.setLabels(w)}setZoomDisplay(w){this._zoomDisplay=w}setIterativeControls(w,M){this._iterativePass.numPasses=M>1e3?1e3:M,this.iterativeRendering=w}updateOnInteraction(w){this._renderPass.duringInteraction=w}setSize(w,M){this._width=Math.max(w,1),this._height=Math.max(M,1),this._validateCanvasSize();const T=Math.round(this._width*this._pixelRatio),A=Math.round(this._height*this._pixelRatio);this._sceneBuffer.setSize(T,A),this._deferredBuffer.setSize(T,A),this._renderTarget1.setSize(T,A),this._renderTarget2.setSize(T,A),this._renderTarget3.setSize(T,A),this._stencilTarget.setSize(T,A),this._depthBuffer.setSize(T,A),this._depthRenderTarget.setSize(T,A),this._renderer.setSize(this._width,this._height),this._background.setSize(T,A),this._renderToScreen.setSize(T,A),this._deferredPass.setSize(T,A),this._iterativePass.setSize(T,A);for(let C=0;C<this._middlePasses.length;C++)this._middlePasses[C].setSize(T,A);for(let C=0;C<this._frontPasses.length;C++)this._frontPasses[C].setSize(this._width,this._height)}setPixelRatio(w){this._pixelRatio=this._devicePixelRatio/(w*this._pixelScaleFactor),this.setSize(this._width,this._height)}_init(){const w=this._renderer.getSize(new d.Vector2);this._pixelRatio=this._renderer.getPixelRatio(),this._width=w.width,this._height=w.height,this._antialias?this._sceneBuffer=new d.WebGLMultisampleRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:d.LinearFilter,magFilter:d.LinearFilter,format:d.RGBAFormat}):this._sceneBuffer=new d.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:d.LinearFilter,magFilter:d.LinearFilter,format:d.RGBAFormat}),this._sceneBuffer.depthTexture=new d.DepthTexture,this._sceneBuffer.depthTexture.type=d.FloatType,this._deferredBuffer=new d.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:d.LinearFilter,magFilter:d.LinearFilter,format:d.RGBAFormat,depthBuffer:!0}),this._deferredBuffer.depthTexture=new d.DepthTexture,this._deferredBuffer.depthTexture.type=d.FloatType,this._stencilTarget=new d.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:d.LinearFilter,magFilter:d.LinearFilter,format:d.RGBAFormat,generateMipmaps:!1,stencilBuffer:!0,depthBuffer:!0}),this._renderTarget1=new d.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:d.LinearFilter,magFilter:d.LinearFilter,format:d.RGBAFormat,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!0}),this._renderTarget1.depthTexture=new d.DepthTexture,this._renderTarget1.depthTexture.type=d.FloatType,this._renderTarget2=this._renderTarget1.clone(),this._renderTarget3=this._renderTarget1.clone(),this._renderTarget3.depthTexture=new d.DepthTexture,this._renderTarget3.depthTexture.type=d.FloatType,this._depthBuffer=new d.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:d.NearestFilter,magFilter:d.NearestFilter,format:d.RGBAFormat,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!0}),this._depthRenderTarget=new d.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:d.NearestFilter,magFilter:d.NearestFilter,format:d.RGBAFormat,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!1}),this._depthBuffer.depthTexture=new d.DepthTexture,this._depthBuffer.depthTexture.type=d.FloatType}_validateCanvasSize(){this._width<=this._maxWidth&&this._height<=this._maxHeight?this._pixelScaleFactor=1:this._pixelScaleFactor=Math.pow(2,Math.ceil(Math.max(Math.log(this._width/this._maxWidth)/Math.log(2),Math.log(this._height/this._maxHeight)/Math.log(2))))}}},D,V),D.exports=B},3053:(D,V,f)=>{var R,B;R=[f(3681)],B=f.dj.d(R,function(d){const N=new d.OrthographicCamera(-1,1,1,-1,0,1),_=new d.BufferGeometry;return _.setAttribute("position",new d.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),_.setAttribute("uv",new d.Float32BufferAttribute([0,2,0,0,2,0],2)),class{constructor(n){this._mesh=new d.Mesh(_,n)}dispose(){this._mesh.geometry.dispose()}render(n){n.render(this._mesh,N)}get material(){return this._mesh.material}set material(n){this._mesh.material=n}}},D,V),D.exports=B},1522:(D,V,f)=>{var R,B;R=[f(3139)],B=f.dj.d(R,function(d){return{start:()=>{const N=new URLSearchParams(window.location.search);return new d(N.get("clientid"))}}},D,V),D.exports=B}},__webpack_module_cache__={};function __webpack_require__(D){var V=__webpack_module_cache__[D];if(V!==void 0)return V.exports;var f=__webpack_module_cache__[D]={id:D,loaded:!1,exports:{}};return __webpack_modules__[D](f,f.exports,__webpack_require__),f.loaded=!0,f.exports}__webpack_require__.m=__webpack_modules__,function(){function D(A,C){for(var z in C)A[z]=C[z];return A}function V(A,C,z){return _(A,C,z,0,V)}function f(A){if(!A)return V;var C=A.absMid;if(!C&&V.absMidsById[A.id]&&(C=V.absMidsById[A.id]),!C)return V;var z=function(q,P,Z){return _(q,P,Z,C,V)};for(var H in V)V.hasOwnProperty(H)&&(z[H]=V[H]);return z.toUrl=function(q){return M(q,C?{mid:C}:null)},z.toAbsMid=function(q){return w(q,C?{mid:C}:null)},V.undef&&(z.undef=function(q){V.undef(q,C)}),z}function R(A){for(var C in A)V.absMids[C]=A[C],V.absMidsById[A[C]]||(V.absMidsById[A[C]]=C)}function B(A){var C=d("dojo/has",null,!1),z=C.normalize(A,function(H){return H});return z&&__webpack_require__(z)||void 0}function d(A,C,z,H){A=A.split("!").map(function(Z){var K=Z.charAt(0)===".";return K&&!C?Z:w(Z,C?{mid:C}:null)}).join("!");var q;if(A in V.absMids&&__webpack_require__.m[V.absMids[A]])if(z){var P=__webpack_module_cache__[V.absMids[A]];q=P&&(H?P:P.exports)}else q=__webpack_require__(V.absMids[A]);if(!q)throw new Error("Module not found: "+A);return q}function N(A){if(A.absMid)return A;var C={i:A.id},z=V.absMidsById[A.id];return z&&(C.id=C.absMid=z),Object.defineProperty(C,"exports",{get:function(){return A.exports},set:function(H){A.exports=H},enumerable:!0,configurable:!0}),C}function _(A,C,z,H,q){var P={}.toString.call(A);if(P==="[object String]"){var Z=z!==!1,K=d(A,H,Z);if(typeof K=="object"&&K.__DOJO_WEBPACK_DEFINE_PROMISE__)throw new Error("Module not found: "+A);return K}else if(P==="[object Object]")throw new Error("Require config is not supported by WebPack");if(P==="[object Array]"){var Y=[],k=C,ae=[];if(A.forEach(function(F){try{Y.push(d(F,H))}catch(J){ae.push({mid:F,error:J})}}),ae.length===0)k&&(r(Y)?Promise.all(l(Y)).then(function(F){k.apply(this,n(F))}.bind(this)).catch(function(F){console.error(F)}):k.apply(this,Y));else{var j=new Error("findModules");j.src="dojo-webpack-plugin",j.info=ae,q.signal("error",j)}return q}else throw new Error("Unsupported require call")}V.toUrl=M,V.toAbsMid=w,V.absMids={},V.absMidsById=[],V.async=1;function l(A){var C=(Array.isArray(A)?A:[A]).map(function(z){return z&&typeof z.then=="function"&&!z.__DOJO_WEBPACK_DEFINE_PROMISE__?{__DOJO_WEBPACK_PROMISE_VALUE__:z}:z});return Array.isArray(A)?C:C[0]}function n(A){var C=(Array.isArray(A)?A:[A]).map(function(z){return z&&z.__DOJO_WEBPACK_PROMISE_VALUE__||z});return Array.isArray(A)?C:C[0]}function r(A){return(Array.isArray(A)?A:[A]).some(function(C){return typeof C=="object"&&C.__DOJO_WEBPACK_DEFINE_PROMISE__})}function h(A,C,z,H){function q(Z){return Z.__DOJO_WEBPACK_DEFINE_PROMISE__=!0,Z}function P(Z){z&&(z.exports=H);var K=C.apply(null,Z);return typeof z=="function"?z(K):K!==void 0?z.exports=K:K=z.exports,K}return r(A)?q(Promise.all(A).then(function(Z){return l(P(n(Z)))})):P(A)}var u=this||window;if(R({"images-threejs-ui/js/start":1522,"images-threejs-ui/js/MainPane":3139,"images-threejs-ui/js/Viewer":7290,"mw-messageservice/MessageService":210,"mw-messageservice/messageserviceimpl/createMessageServiceDefaultInstance":7355,"dojo/_base/lang":1873,"dojo/_base/kernel":9424,"dojo/global":8455,"dojo/has":9178,"dojo/_base/config":6723,"dojo/sniff":3994,"dojo/aspect":3660,"dojo/on":1929,"mw-messageservice/messageserviceimpl/MessageServiceBase":376,"dojo/_base/declare":1203,"dojo/Deferred":4371,"dojo/errors/CancelError":7800,"dojo/errors/create":5062,"dojo/promise/Promise":2749,"mw-log/Log":8976,"mw-log/impl/Modes":7781,"mw-log/impl/Levels":9694,"mw-log/impl/Type":1393,"mw-log/impl/Backlog":7354,"mw-log/util/LogUtils":804,"mw-log/util/LogForwardingUtils":7053,"mw-messageservice/messageserviceimpl/MessageServiceState":4528,"dojo/Evented":3543,"mw-statemachine/StateMachine":6014,"mw-statemachine/statemachineimpl/State":3558,"mw-statemachine/statemachineimpl/EventTrigger":5763,"mw-statemachine/statemachineimpl/Trigger":8171,"mw-statemachine/statemachineimpl/MessageTrigger":8338,"dojo/topic":7505,"mw-statemachine/statemachineimpl/RemoteTrigger":1609,"mw-remote/Remote":8374,"dojo/_base/Deferred":5642,"dojo/when":1636,"mw-remote/iframeproxy/IframeProxyClient":7570,"dojo/_base/connect":5135,"dojo/_base/event":4409,"dojo/dom-geometry":8771,"dojo/_base/window":8145,"dojo/dom":3458,"dojo/dom-style":2442,"dojo/mouse":4905,"dojo/_base/sniff":8609,"dojo/keys":3720,"dojo/dom-construct":2490,"dojo/dom-attr":4348,"dojo/dom-prop":1502,"mw-remote/iframeproxy/CheckUrlService":3245,"dojo/request/script":5665,"dojo/request/watch":1563,"dojo/request/util":3638,"dojo/errors/RequestError":5867,"dojo/io-query":7841,"dojo/_base/array":640,"dojo/errors/RequestTimeoutError":6930,"mw-remote/impl/FaultManager":742,"mw-remote/impl/RequestManager":4361,"mw-remote/RemoteEndPointsManager":9819,"mw-remote/EndPointsManager":9685,"mw-remote/utils/SecurityUtils":3971,"mw-remote/defaultMessageMapping":1912,"mw-remote/impl/Transaction":6113,"mw-utils/Utils":8260,"mw-deprecation-utils/deprecation":5260,"mw-remote/impl/ResponseManager":8083,"mw-remote/impl/AutoDetectedTransaction":1462,"mw-remote/impl/JsonTransaction":4771,"dojo/_base/xhr":8519,"dojo/dom-form":2693,"dojo/json":2570,"dojo/_base/json":5747,"dojo/request/xhr":9810,"dojo/request/handlers":819,"mw-remote/utils/SendMessageUtil":3461,"mw-remote/UploadToWorker":958,"mw-html-utils/HtmlUtils":1423,"mw-html-utils/_parseHtml/sanitize":9292,"mw-remote/ReplaceUploadIframe":8999,"mw-remote/utils/RemoteUrlUtils":4202,"mw-remote/serviceRegistryLookup!":245,"mw-remote/serviceRegistryLookup":3812,"mw-statemachine/statemachineimpl/TimeoutTrigger":6974,"mw-statemachine/statemachineimpl/Transition":80,"mw-messageservice/messageserviceimpl/isValidChannel":8706,"cometd/cometd":3553,"mw-messageservice/messageserviceimpl/transportEnums":54,"mw-messageservice/messageserviceimpl/MessageServiceAsync":9597,"cometd/AckExtension":7723,"mw-messageservice/messageserviceimpl/instanceEnums":140,"mw-messageservice/messageserviceimpl/messageServiceFactory":7223,"images-threejs-ui/js/decorations/ProgressSpinner":9782,"images-threejs-ui/js/CameraControls":6337,"images-threejs-ui/js/Toolbar":5069,"images-threejs-ui/js/Animation":9392,"images-threejs-ui/js/decorations/Message":5753,"mw-tooltip/Tooltips":5663,"mw-tooltip/impl/Tooltip":5813,"mw-tooltip/impl/Content":6752,"mw-tooltip/impl/enum/TypeEnum":2377,"mw-tooltip/utils/ContentUtils":8087,"mw-tooltip/impl/TooltipDepot":6091,"mw-tooltip/impl/TooltipState":3636,"mw-tooltip/impl/enum/StateEnum":1054,"mw-tooltip/impl/enum/DefaultsEnum":1251,"mw-tooltip/utils/TooltipUtils":8065,"mw-ui-themes/UIThemeManager":4397,"mw-ui-themes/ThemeEnum":9751,"mw-tooltip/impl/enum/ThemeEnum":5590,"images-threejs-ui/js/annotations/AnnotationControls":4576,"images-threejs-ui/js/annotations/PlaneControls":5039,"images-threejs-ui/js/annotations/InteractivePlane":8997,"images-threejs-ui/js/annotations/MarkerShader":6164,"images-threejs-ui/js/annotations/PointPool":4207,"images-threejs-ui/js/annotations/AbstractPool":6127,"images-threejs-ui/js/annotations/Marker":9721,"images-threejs-ui/js/annotations/LinePool":1571,"images-threejs-ui/js/annotations/Line":3497,"images-threejs-ui/js/annotations/AnglePool":9190,"images-threejs-ui/js/annotations/Angle":8276,"images-threejs-ui/js/annotations/PolygonPool":6751,"images-threejs-ui/js/annotations/Polyline":8311,"images-threejs-ui/js/annotations/ElevationPool":2218,"images-threejs-ui/js/annotations/Elevation":2560,"images-threejs-ui/js/annotations/CuboidPool":4563,"images-threejs-ui/js/annotations/Cuboid":2297,"images-threejs-ui/js/annotations/Face":8486,"images-threejs-ui/js/annotations/RectanglePool":4036,"images-threejs-ui/js/annotations/Rectangle":7234,"images-threejs-ui/js/annotations/FreehandPool":614,"images-threejs-ui/js/annotations/Freehand":2980,"images-threejs-ui/js/annotations/TextPool":5178,"images-threejs-ui/js/annotations/Text":3600,"images-threejs-ui/js/annotations/CSSLabel":9032,"images-threejs-ui/js/annotations/CaliperPool":9127,"images-threejs-ui/js/annotations/Caliper":8405,"images-threejs-ui/js/annotations/CirclePool":2649,"images-threejs-ui/js/annotations/Circle":4039,"images-threejs-ui/js/annotations/TSquarePool":5310,"images-threejs-ui/js/annotations/TSquare":2700,"images-threejs-ui/js/annotations/ThumbnailPool":193,"images-threejs-ui/js/annotations/Thumbnail":4639,"images-threejs-ui/js/annotations/LabelPool":9271,"images-threejs-ui/js/annotations/Crosshair":4775,"images-threejs-ui/js/annotations/Sphere":6658,"images-threejs-ui/js/annotations/Cylinder":7045,"images-threejs-ui/js/decorations/ObjectInfo":9015,"images-threejs-ui/js/decorations/Plus":1584,"images-threejs-ui/js/Volume":2158,"images-threejs-ui/js/Container":329,"images-threejs-ui/js/Image":7031,"images-threejs-ui/js/ImageShader":9170,"images-threejs-ui/js/VolumeShader":2591,"images-threejs-ui/js/Surface":1145,"images-threejs-ui/js/Points":4047,"images-threejs-ui/js/BlockedPoints":4297,"images-threejs-ui/js/PointBlockController":7387,"images-threejs-ui/js/BlockController":1155,"images-threejs-ui/js/ImageTile":539,"images-threejs-ui/js/Block":6427,"images-threejs-ui/js/VolumeTile":9202,"images-threejs-ui/js/PointBlock":2883,"images-threejs-ui/js/PriorityQueue":6613,"images-threejs-ui/js/LeastRecentUsedCache":4547,"images-threejs-ui/js/BlockedVolume":1756,"images-threejs-ui/js/OverviewVolume":8633,"images-threejs-ui/js/BlockedImage":7450,"images-threejs-ui/js/Line":7498,"images-threejs-ui/js/WideLine":665,"images-threejs-ui/js/WideLineShader":740,"images-threejs-ui/js/InstancedLineGeometry":9101,"images-threejs-ui/js/decorations/ScaleBar":2487,"images-threejs-ui/js/decorations/Wireframe":9632,"images-threejs-ui/js/decorations/Grid":5872,"images-threejs-ui/js/LightControls":5060,"images-threejs-ui/js/postprocessing/RenderingComposer":6508,"images-threejs-ui/js/postprocessing/CopyPass":4720,"images-threejs-ui/js/postprocessing/Pass":5833,"images-threejs-ui/js/postprocessing/ViewportQuad":3053,"images-threejs-ui/js/postprocessing/CopyShader":3176,"images-threejs-ui/js/postprocessing/BackgroundPass":8213,"images-threejs-ui/js/BackgroundShader":2981,"images-threejs-ui/js/postprocessing/DeferredRenderPass":174,"images-threejs-ui/js/postprocessing/CompositeShader":3716,"images-threejs-ui/js/postprocessing/MaskShader":7205,"images-threejs-ui/js/postprocessing/RenderPass":8133,"images-threejs-ui/js/postprocessing/DepthPass":334,"images-threejs-ui/js/postprocessing/DepthViewPass":7431,"images-threejs-ui/js/postprocessing/DepthViewShader":5607,"images-threejs-ui/js/postprocessing/DepthShader":3510,"images-threejs-ui/js/postprocessing/DepthPeelPass":5504,"images-threejs-ui/js/postprocessing/IterativeRenderPass":6620,"images-threejs-ui/js/postprocessing/LightMapShader":1707,"images-threejs-ui/js/postprocessing/LightingShader":8073,"images-threejs-ui/js/postprocessing/PaintPass":2659,"images-threejs-ui/js/postprocessing/PaintShader":2131,"images-threejs-ui/js/decorations/OrientationAxes":7533,"images-threejs-ui/js/MemoryControls":7385,"mw-binarystream/BinaryStreamFactory":1668,"mw-binarystream/BinaryStream":688,"mw-binarystream/impl/BinaryStreamTransport":5370,"mw-binarystream/impl/BinaryStreamWebSocket":5992,"mw-binarystream/impl/BinaryStreamFraming":7317,"dojo/domReady!":8161,"dojo/domReady":7207}),u.require=V,(self.webpackChunk=self.webpackChunk||[]).registerAbsMids=R,__webpack_require__.dj&&__webpack_require__.dj.name!=="dojo-webpack-plugin")throw new Error("__webpack_require__.dj name collision.");__webpack_require__.dj={name:"dojo-webpack-plugin",r:V,c:f,m:N,h:B,d:h,w:l,u:n};var g=Object.create(u,{document:{value:u.document}});Object.defineProperties(g,{window:{value:g},global:{value:g}}),g.define=g.require=void 0,u.dojoConfig=u.dojoConfig||{};var p=D(u.dojoConfig,{baseUrl:".",packages:[{name:"dojo",location:"release/derived/3p/ui/dojo",lib:"."},{name:"mw-log",location:"release/derived/ui/mw-log",lib:"."},{name:"dijit",location:"release/derived/3p/ui/dijit",lib:"."},{name:"mw-utils",location:"release/derived/ui/mw-utils",lib:"."},{name:"mw-ui-themes",location:"release/derived/ui/mw-ui-themes",lib:"."},{name:"mw-dialogs",location:"release/derived/ui/mw-dialogs",lib:"."},{name:"mw-deprecation-utils",location:"release/derived/ui/mw-deprecation-utils",lib:"."},{name:"mw-notifications",location:"release/derived/ui/mw-notifications",lib:"."},{name:"lit",location:"release/derived/3p/ui/lit",lib:"."},{name:"custom-elements",location:"release/derived/ui/custom-elements",lib:"."},{name:"mw-widget-api",location:"release/derived/ui/mw-widget-api",lib:"."},{name:"mw-html-utils",location:"release/derived/ui/mw-html-utils",lib:"."},{name:"dojox",location:"release/derived/3p/ui/dojox",lib:"."},{name:"mw-remote",location:"release/derived/ui/mw-remote",lib:"."},{name:"mw-icons",location:"release/derived/ui/mw-icons",lib:"."},{name:"mw-statemachine",location:"release/derived/ui/mw-statemachine",lib:"."},{name:"cometd",location:"release/derived/3p/ui/cometd",lib:"."},{name:"mw-messageservice",location:"release/derived/ui/mw-messageservice",lib:"."},{name:"mw-progress-indicator",location:"release/derived/ui/mw-progress-indicator",lib:"."},{name:"mw-dom-utils",location:"release/derived/ui/mw-dom-utils",lib:"."},{name:"mw-ddux",location:"release/derived/ui/mw-ddux",lib:"."},{name:"mw-event-utils",location:"release/derived/ui/mw-event-utils",lib:"."},{name:"mw-form",location:"release/derived/ui/mw-form",lib:"."},{name:"mw-browser-utils",location:"release/derived/ui/mw-browser-utils",lib:"."},{name:"popper",location:"release/derived/3p/ui/popper",lib:"."},{name:"Tippy",location:"release/derived/3p/ui/Tippy",lib:"."},{name:"mw-tooltip",location:"release/derived/ui/mw-tooltip",lib:"."},{name:"mw-draganddrop",location:"release/derived/ui/mw-draganddrop",lib:"."},{name:"mw-colorpicker",location:"release/derived/ui/mw-colorpicker",lib:"."},{name:"mw-gesture",location:"release/derived/ui/mw-gesture",lib:"."},{name:"mw-clipboard",location:"release/derived/ui/mw-clipboard",lib:"."},{name:"react",location:"release/derived/3p/ui/react",lib:"."},{name:"mw-event-emitter",location:"release/derived/ui/mw-event-emitter",lib:"."},{name:"mw-module-loader",location:"release/derived/ui/mw-module-loader",lib:"."},{name:"put-selector",location:"release/derived/3p/ui/put-selector",lib:"."},{name:"xstyle",location:"release/derived/3p/ui/xstyle",lib:"."},{name:"mw-binarystream",location:"release/derived/ui/mw-binarystream",lib:"."},{name:"uuid",location:"release/derived/3p/ui/uuid",lib:"."},{name:"performance",location:"release/derived/toolbox/performance/web",lib:"."},{name:"mw-promise",location:"release/derived/ui/mw-promise",lib:"."},{name:"regenerator-runtime",location:"release/derived/3p/ui/regenerator-runtime",lib:"."},{name:"lodash",location:"release/derived/3p/ui/lodash",lib:"."},{name:"object-hash",location:"release/derived/3p/ui/object-hash",lib:"."},{name:"mf0",location:"release/derived/toolbox/modeling/mf0/web",lib:"."},{name:"mf0_sync",location:"release/derived/toolbox/modeling/mf0_sync/web",lib:"."},{name:"mw-deferred-utils",location:"release/derived/ui/mw-deferred-utils",lib:"."},{name:"mw-peermodel",location:"release/derived/ui/mw-peermodel",lib:"."},{name:"mw-actiondataservice",location:"release/derived/ui/mw-actiondataservice",lib:"."},{name:"mw-dnd",location:"release/derived/ui/mw-dnd",lib:"."},{name:"mw-store-utils",location:"release/derived/ui/mw-store-utils",lib:"."},{name:"mw-dialog-utils",location:"release/derived/ui/mw-dialog-utils",lib:"."},{name:"mw-keybindings",location:"release/derived/ui/mw-keybindings",lib:"."},{name:"mw-string-utils",location:"release/derived/ui/mw-string-utils",lib:"."},{name:"prefdir",location:"release/toolbox/matlab/prefdir_service/src/js/prefdir",lib:"."},{name:"ui_core_utils",location:"release/ui/core/utils/js",lib:"."},{name:"viewmodel_zml",location:"release/toolbox/shared/viewmodel/zml/json",lib:"."},{name:"editor_application_interface",location:"release/toolbox/matlab/editor/application_interface/js",lib:"."},{name:"mw-fctrl",location:"release/ui/fctrl/fctrl_js-lib",lib:"."},{name:"mw-mvm",location:"release/toolbox/mvm_javascript/mw-mvm/mw-mvm-lib",lib:"."},{name:"dgrid",location:"release/derived/3p/ui/dgrid",lib:"."},{name:"spinner",location:"release/derived/3p/ui/spinner",lib:"."},{name:"element_core",location:"release/ui/core/element_core/js",lib:"."},{name:"mw-popout",location:"release/derived/ui/mw-popout",lib:"."},{name:"ui_core_dnd",location:"release/ui/core/dnd/js",lib:"."},{name:"sidebar",location:"release/ui/layout/sidebar/js",lib:"."},{name:"mw-perf",location:"release/derived/ui/mw-perf",lib:"."},{name:"mw-overlay-utils",location:"release/derived/ui/mw-overlay-utils",lib:"."},{name:"maven_component_ui",location:"release/derived/ui/maven_component_ui",lib:"."},{name:"mw-usv-client",location:"release/derived/ui/mw-usv-client",lib:"."},{name:"mw-scrollbar-slider",location:"release/derived/ui/mw-scrollbar-slider",lib:"."},{name:"componentframework",location:"release/toolbox/matlab/uitools/componentframeworkjs",lib:"."},{name:"mw-mda",location:"release/derived/toolbox/mw_mda",lib:"."},{name:"settings",location:"release/toolbox/matlab/settings_service/src/js/settings",lib:"."},{name:"mw-dom-snapshot-utils",location:"release/derived/ui/mw-dom-snapshot-utils",lib:"."},{name:"searchfield",location:"release/ui/search/searchfield/js",lib:"."},{name:"mw-slider",location:"release/derived/ui/mw-slider",lib:"."},{name:"mw-webwindow-dialogs",location:"release/derived/ui/mw-webwindow-dialogs",lib:"."},{name:"viewmodel",location:"release/toolbox/shared/viewmodel/web/viewmodel",lib:"."},{name:"mw-navigationbar",location:"release/derived/ui/mw-navigationbar",lib:"."},{name:"mw-datepicker",location:"release/derived/ui/mw-datepicker",lib:"."},{name:"mw-filename-utils",location:"release/derived/ui/mw-filename-utils",lib:"."},{name:"webwidgets_css",location:"release/ui/webwidgets/src/css",lib:"."},{name:"images",location:"release/ui/webwidgets/src/images",lib:"."},{name:"MW",location:"release/ui/webwidgets/src/js/MW",lib:"."},{name:"l10n",location:"release/ui/webwidgets/src/l10n",lib:"."},{name:"THREE",location:"release/derived/3p/ui/threejs",lib:"."},{name:"images-threejs-ui",location:"release/toolbox/images/ui/viewer3d/images-threejs-ui",lib:"."}],deps:["bootstrap"],async:!1,has:{"config-deferredInstrumentation":!1},supportedLocales:["ja-jp","ko-kr","zh-cn","en-us"]}),y={hasCache:{webpack:1,"host-browser":1,dom:1,"dojo-loader":1,"dojo-has-api":1,"dojo-dom-ready-api":1,"dojo-sniff":1,"dojo-test-sniff":1,"config-deferredInstrumentation":1,"config-tlmSiblingOfDojo":1}},x=__webpack_require__(2012);x.call(g,p,y,g,g),Object.keys(g.require.packs).forEach(function(A){var C=g.require.packs[A];(/(^\/)|(\:)/.test(C.main)||C.main.split("/").reduce(function(z,H){return z<0||H==="."?z:H===".."?--z:++z},0)<=0)&&typeof C.realMain>"u"&&(C.realMain=C.main,C.main="")});function w(A,C){var z=g.require.originalToAbsMid(A,C);if(z.indexOf("/")===z.length-1){var H=z.substring(0,z.length-1),q=g.require.packs[H];q&&q.realMain&&(z=H)}return z}function M(A,C){var z=g.require.originalToUrl(A,C),H=g.require.packs[A];if(H&&H.realMain){var q=z.split("?");/(^\/)|(\:)/.test(H.realMain)?q[0]=H.realMain:q[0]=q[0]+"/"+H.realMain,z=q.join("?")}return z}g.require.originalToAbsMid=g.require.toAbsMid,g.require.originalToUrl=g.require.toUrl,g.require.toAbsMid=w,g.require.toUrl=M,["baseUrl","has","rawConfig","on","signal"].forEach(function(A){V[A]=g.require[A]});var T=u.webpackChunk.absMidsWaiting;T&&(T.forEach(R),delete u.webpackChunk.absMidsWaiting)}();var __webpack_exports__=__webpack_require__(6300)})();
